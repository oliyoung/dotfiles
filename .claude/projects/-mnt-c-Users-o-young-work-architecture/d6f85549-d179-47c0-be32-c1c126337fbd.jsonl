{"type":"file-history-snapshot","messageId":"d3dc9279-1abf-4e9a-8ba4-922041831415","snapshot":{"messageId":"d3dc9279-1abf-4e9a-8ba4-922041831415","trackedFileBackups":{},"timestamp":"2026-01-07T01:19:37.137Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","type":"user","message":{"role":"user","content":"I'm writing up the Salesforce Customer Service migration solution design, help"},"uuid":"d3dc9279-1abf-4e9a-8ba4-922041831415","timestamp":"2026-01-07T01:19:37.101Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"d3dc9279-1abf-4e9a-8ba4-922041831415","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EiSdwHoq8EB1ycoBwefxwN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is asking for help writing up a Salesforce Customer Service migration solution design. Looking at the git status, I can see there's an untracked file:\n\n```\n?? architecture_definitions/salesforce_customer_support.adoc\n```\n\nSo it looks like they've already started creating a file for this. Let me check what exists in the repository to understand the context better, and then help them with the documentation.\n\nBased on the CLAUDE.md instructions, this repository uses:\n1. CML files for domain modeling\n2. Markdown files for architecture documentation\n3. However, I notice the new file is `.adoc` (AsciiDoc format)\n\nI should:\n1. First read the existing file to see what they've started\n2. Look at other architecture definition files to understand the pattern\n3. Check if there are any templates they should be following\n4. Help them structure and complete the documentation\n\nLet me start by reading the salesforce_customer_support.adoc file and looking at the directory structure.","signature":"EoAJCkYICxgCKkDzu6oNH8h3LKKd6qS+M0wg047bh54gNXolBC7rGQGRWjXQrj657SbHgrlxRJflLjnl+Y7UgA3l7neza+5Q7FK3EgyQQdR39N/fpHkXPVYaDBaILNoBROWnZsaLRSIwosr56NMYFOPN5k/33CsUHYnwm3jtAitET2oY3bKSWWrjOe6el2kp8HnvzD2bw+fiKucHqm901t9hkoAqWBaTymUhIZf5fl2TCsYQgLf+DkM9KTqXKNnzziwr37R4zw/g+8pkyzH4+tcoR9BJq9OtV8kzE81Upjb3a00tnXI24P5sh5nRH9TSYlbORsS+UYAd5Yakl71rShrdc1QXcWIEnhFUcjXk/7T1dplF8IqK8n+4dM5s5/+2G2mEOvj/nP6PpnA9aFje4Jm+xvAYSB7y5wT6xiq6yj7mDC8rCxDHOR1FrHYaVVT0+O1s8BCQ5qQoep2rgBE95XJDKBQzC+1I5vwj3KkTsGQ2f359pl/FDj3wrBO1+qyaNP1z+229SPEupjCKuh5QTzeiE8SGW+U2LoWcLWZNHZ/1vm1SK1EAzZbAdKlIe6jLhIGDPmKGd4LqzfHe5beyIPpl3Qldej9/CZVD1cH7m6cX1vZVNkiqunnl+4ZAIY86fXBfNOBOfU2vP5qNufYz1TQXVfgFzmSg7L4o3M5RBm8hZc4iZviWjZMshJ5bT5qUNBygzojd2kdv0r2xWp6vzI0v1yuV7XZNkZO7QMmhdYL0jMtCxziAhG+337MyO252UMIkou6Tb+3pccdzoz95GEARlikR/FUqzCtRZO83MrXWfRxSOnxGdU7GE7A2i0Mt9moAWXdxMnKESf/f+soyBEJLizEflODAxlwoXEA4B8u3hhsCyG8LfwGk5eKpd9FI7eIMxxZuPTowzsbge9yY01f9ayGUqaZUPOrTDVXItsNHh0/hhw/GpFrcqKDHVugsV5YN4XvxMNqxZrRpdQKPmBREFkUmnpgnFmf9rbeTIntxa7gTEMSebEw9DvUUudv/iYS/W3wMO91UjS6TnKZIyuzVTHQt+7RlMZtE/0+gDfuajlhUWU6QfLILlaWgKK4qB7CxcYET+tPSsSR4ZuiaaRIjM4Po5NJ4vOQMXGhNhPjdETyfL9Z46em8eJ7Wm/rgnCp5bNP7TOwbDp5HEWe3GtENj0C//mn6KTj7QnP5sTIuYQzEMmK7s9eBXs7q+Rf9NN18Ecmoj+XqPndF8tNFSDk5lYKts+u4ZCT/6+VQbDre7i8kZ77Bk2Gnz6TSNjd11yhl/34c7Ij72981kr/r83xOrqa/LmPYDDHhIhebKOtgD/dSlyaGYH79hBpL6JsZhhIJ87OklLDLYg2oYccyzvELncTADA9gZudwDXkNOVxUYLninOmu4kI13Z/ODWvefFgHZHJxT9ZTsNStkZF8FkM4zUd5yRu3mzJukTo87j24T0QKj88UAW/nr8tSLdfoDOes++5azNI4+E29hhDzwCLsSVc+pM8arQi82R367bep1Uf18CElayA9uWFDBZvubk+IGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":24615,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24615,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWs8ynX9Z5YYB1S1X51bA","type":"assistant","uuid":"e07ac5e7-89b6-4192-b423-b19c1c25f866","timestamp":"2026-01-07T01:19:45.176Z"}
{"parentUuid":"e07ac5e7-89b6-4192-b423-b19c1c25f866","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EiSdwHoq8EB1ycoBwefxwN","type":"message","role":"assistant","content":[{"type":"text","text":"I'll help you with the Salesforce Customer Service migration solution design. Let me first check what you've already started and look at the structure of similar documents."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":24615,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24615,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWs8ynX9Z5YYB1S1X51bA","type":"assistant","uuid":"de6d60e4-fd63-43d1-b325-1e05a96f9f40","timestamp":"2026-01-07T01:19:46.024Z"}
{"parentUuid":"de6d60e4-fd63-43d1-b325-1e05a96f9f40","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EiSdwHoq8EB1ycoBwefxwN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Se2ri9j5GHkPYxPEWuzjzA","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":24615,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24615,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWs8ynX9Z5YYB1S1X51bA","type":"assistant","uuid":"892ed830-4445-49ec-af37-9ac5129840ee","timestamp":"2026-01-07T01:19:47.174Z"}
{"parentUuid":"892ed830-4445-49ec-af37-9ac5129840ee","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EiSdwHoq8EB1ycoBwefxwN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Dq7gfKGmBwyc3fkhmTPxt2","name":"Glob","input":{"pattern":"architecture_definitions/*.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":24615,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24615,"ephemeral_1h_input_tokens":0},"output_tokens":425,"service_tier":"standard"}},"requestId":"req_011CWs8ynX9Z5YYB1S1X51bA","type":"assistant","uuid":"85d46fe9-a4ce-4e1e-bd6a-41b5b748a61c","timestamp":"2026-01-07T01:19:47.629Z"}
{"parentUuid":"85d46fe9-a4ce-4e1e-bd6a-41b5b748a61c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EiSdwHoq8EB1ycoBwefxwN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MLQitPqSAUdJujuBGuPprz","name":"Glob","input":{"pattern":"templates/*.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":24615,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24615,"ephemeral_1h_input_tokens":0},"output_tokens":425,"service_tier":"standard"}},"requestId":"req_011CWs8ynX9Z5YYB1S1X51bA","type":"assistant","uuid":"242d2990-e5e7-4106-8115-d4cb192f7877","timestamp":"2026-01-07T01:19:47.800Z"}
{"parentUuid":"242d2990-e5e7-4106-8115-d4cb192f7877","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Se2ri9j5GHkPYxPEWuzjzA","type":"tool_result","content":"     1→= Salesforce Customer Support\n     2→:project-name: Salesforce Customer Support\n     3→:togaf-adm-phase: Phase C: Information Systems Architectures\n     4→:last-updated: 2026-01-07\n     5→:document-type: Architecture Definition Document\n     6→:status: Discovery\n     7→:version: 0.1\n     8→:programme-lead:\n     9→:domain-architect: O.Young@otr.com.au\n    10→:doctype: article\n    11→:toc: left\n    12→:toclevels: 4\n    13→:sectanchors:\n    14→:sectlinks:\n    15→:sectnums:\n    16→:icons: font\n    17→:source-highlighter: highlightjs\n    18→:experimental:\n    19→:description:\n    20→:keywords:\n    21→\n    22→== Introduction & Vision\n    23→\n    24→=== Purpose\n    25→\n    26→The purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n    27→\n    28→=== Vision\n    29→\n    30→> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n    31→\n    32→=== Architectural Approach\n    33→\n    34→This architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n    35→\n    36→* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n    37→* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n    38→* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n    39→* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n    40→* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])\n    41→\n    42→=== Scope\n    43→\n    44→==== In Scope\n    45→\n    46→- Solution Building Blocks (SBBs) - specific technology products and versions\n    47→- Interface specifications (APIs, events, data formats)\n    48→- Data architecture and schema specifications\n    49→- Deployment architecture and infrastructure configuration\n    50→- Transition architecture with phased implementation states\n    51→- Technical validation criteria and testing approach\n    52→- External system integration specifications\n    53→\n    54→=== Out Of Scope (covered in Architecture Definition):\n    55→- Business requirements and stakeholder analysis\n    56→- Architecture decisions and rationale (ADRs)\n    57→- Bounded context definitions and responsibilities\n    58→- High-level integration patterns (ACL, Conformist, OHS+PL)\n    59→- Business capability mapping and value streams\n    60→- Non-functional requirements (referenced, not duplicated)\n    61→- Architecture principles and governance\n    62→\n    63→=== Architecture Overview\n    64→\n    65→[mermaid]\n    66→----\n    67→---\n    68→config:\n    69→  layout: elk\n    70→---\n    71→flowchart TB\n    72→    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    73→    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    74→    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    75→    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    76→    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    77→    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    78→    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    79→    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    80→    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    81→    EngagementService --> Salesforce\n    82→    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    83→    MobileApp -- Submits Feedback --> EngagementService\n    84→\n    85→    Customer:::customer\n    86→    MobileApp:::presentation\n    87→    POS:::presentation\n    88→    EntraID:::external\n    89→    ProfileService:::newService\n    90→    Salesforce:::external\n    91→    EventBus:::infrastructure\n    92→    LoyaltyService:::newService\n    93→    EngagementService:::newService\n    94→    EagleEye:::external\n    95→    Braze:::external\n    96→    D365CE:::external\n    97→    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    98→    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    99→    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n   100→    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n   101→    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n   102→----\n   103→\n   104→\n   105→==== Key Architectural Patterns\n   106→\n   107→== Executive Summary\n   108→\n   109→=== Challenge\n   110→\n   111→Migrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.\n   112→\n   113→=== Solution\n   114→- Replace D365 Customer Engagement with Salesforce for customer feedback and support\n   115→- Consolidate customer data into unified profiles via Profile Service\n   116→- Leverage event-driven architecture for seamless data synchronisation\n   117→- Migrate existing customer and case data from D365 CE to Salesforce\n   118→- Ensure minimal disruption to existing support operations during migration\n   119→\n   120→== Technical Requirements\n   121→\n   122→== Technical Architecture\n   123→\n   124→=== Technical Capability Requirements\n   125→\n   126→==== Requirements Traceability\n   127→\n   128→=== Service Catalogues\n   129→\n   130→==== Application Portfolio Catalogue\n   131→\n   132→==== Technology Capability Requirements\n   133→\n   134→==== Feature Flag Register\n   135→\n   136→==== Data Entity Catalogue\n   137→\n   138→=== Baseline Architecture\n   139→\n   140→==== Existing System Components\n   141→\n   142→==== Integration Architecture\n   143→\n   144→==== Technical Debt\n   145→\n   146→=== Gap Analysis\n   147→\n   148→==== Missing Capabilities\n   149→\n   150→==== Missing Bounded Contexts\n   151→\n   152→==== Missing Integration Patterns\n   153→\n   154→=== Target State Architecture\n   155→\n   156→==== Architectural Building Blocks (ABB)\n   157→\n   158→==== Integration Architecture\n   159→\n   160→===== System of Record Boundaries\n   161→\n   162→==== Data Architecture Principles\n   163→\n   164→===== Aggregate Persistence\n   165→\n   166→===== Event Store\n   167→\n   168→=== Architecture Decisions\n   169→\n   170→=== Migration Strategy\n   171→\n   172→=== Architectural Scope Boundaries\n   173→\n   174→==== Capabilities Included\n   175→\n   176→==== Capabilities Excluded\n   177→\n   178→==== Architectural Dependencies on Future Initiatives\n   179→\n   180→=== Technical Risks and Mitigation\n   181→\n   182→== Assumptions and Constraints\n   183→\n   184→=== Assumptions\n   185→\n   186→=== Constraints\n   187→\n   188→== Non-Functional Requirements\n   189→\n   190→== Monitoring and Observability\n   191→\n   192→=== Key Metrics\n   193→\n   194→=== Alerting Thresholds\n   195→\n   196→=== Dashboards\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"93d80c52-4a5b-4fcd-9a13-2105abeb435f","timestamp":"2026-01-07T01:19:48.225Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","content":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nThe purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n\n=== Vision\n\n> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n\n=== Architectural Approach\n\nThis architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n== Executive Summary\n\n=== Challenge\n\nMigrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.\n\n=== Solution\n- Replace D365 Customer Engagement with Salesforce for customer feedback and support\n- Consolidate customer data into unified profiles via Profile Service\n- Leverage event-driven architecture for seamless data synchronisation\n- Migrate existing customer and case data from D365 CE to Salesforce\n- Ensure minimal disruption to existing support operations during migration\n\n== Technical Requirements\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","numLines":196,"startLine":1,"totalLines":196}}}
{"parentUuid":"93d80c52-4a5b-4fcd-9a13-2105abeb435f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Dq7gfKGmBwyc3fkhmTPxt2","type":"tool_result","content":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/flybuys_integration.adoc\n/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc"}]},"uuid":"d6123b2f-80fa-4d6d-99f3-5f39b2211be9","timestamp":"2026-01-07T01:19:52.550Z","toolUseResult":{"filenames":["/mnt/c/Users/o.young/work/architecture/architecture_definitions/flybuys_integration.adoc","/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc"],"durationMs":4422,"numFiles":2,"truncated":false}}
{"parentUuid":"d6123b2f-80fa-4d6d-99f3-5f39b2211be9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MLQitPqSAUdJujuBGuPprz","type":"tool_result","content":"/mnt/c/Users/o.young/work/architecture/templates/solution_architecture_template.adoc"}]},"uuid":"8573aee3-264a-4e85-9eba-e3382a437860","timestamp":"2026-01-07T01:19:52.554Z","toolUseResult":{"filenames":["/mnt/c/Users/o.young/work/architecture/templates/solution_architecture_template.adoc"],"durationMs":4428,"numFiles":1,"truncated":false}}
{"parentUuid":"8573aee3-264a-4e85-9eba-e3382a437860","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013N5XsLzAD1VtRP1C7YNPNv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! I can see:\n1. The user has started a Salesforce Customer Support document in AsciiDoc format\n2. There's a template available: `solution_architecture_template.adoc`\n3. There's also another completed example: `flybuys_integration.adoc`\n\nLet me read both the template and the Flybuys example to understand the structure and help the user complete their document.","signature":"EpUECkYICxgCKkB38wGZkgvO5vRDHbeNfhsmbbHQMgIb+WtSN8x4IKdKf1mfATN+aH53ReTeTd6sPjraQqUNT4wg+XZyrAPg5JyxEgy8PVt0NotiqWkSXpQaDJnt2aVaDKxxII1e2yIwJSB3EHNLPwWAlj9f8dpta1lM3ovDo6lDROhhpfHB13AZO7/CzfoIuaf2qa6M0lWLKvwClV3Uq58GpUFZY8D/Fm5AHkkWc4Zm8nbpFOKkjE7vCoHkuWImOWt8mqAA6jNw/fs/BwFuIq8xlgvbyjft97QAStSC1EeNXg7VpTdgiNGjxbkwC5esGV0z7WXk/fTSAg5+U/wsENDef4eHgCPqTqWHOvq0q7ouCuBu46ErDxeFJopo3lGT+N96k55M9nby9skKcnS4o7VmfzG3VqWR2R4ovjwzcchKt1M9mVAVTA3stmolctagSFECPHoZxpcKRtdWB6ajlrWUEPF2lh04jw4cNmC9HdNdNgygOMXHIHNvJrq/uXyIYIMhCGsMvRHNjgM3zv4EE48zXyrHujgIrXz7ymqMBxjS8xZyabhgaJTBHJD/Uv1f5Cl9wJftzoUHn2fT8VkVYuO8ld9XJTbXKS+2kRn+uxGsN1H2WTKMzyNMxInl9v/v9nfG27D3hdkDDzPnqaebar6aKQF1m1ey0zo+XzgJ1vCovU8gP5d8w3coo+g3FHstYmLcGMHnqA4YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":2935,"cache_read_input_tokens":24615,"cache_creation":{"ephemeral_5m_input_tokens":2935,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWs8zwfqSKS2nQSsT9ss7","type":"assistant","uuid":"727f56db-241e-4ef8-89ef-7c3ea8a761a5","timestamp":"2026-01-07T01:19:57.632Z"}
{"parentUuid":"727f56db-241e-4ef8-89ef-7c3ea8a761a5","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013N5XsLzAD1VtRP1C7YNPNv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LcGYvaLGR7HHWuBENDtyDQ","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/templates/solution_architecture_template.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":2935,"cache_read_input_tokens":24615,"cache_creation":{"ephemeral_5m_input_tokens":2935,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWs8zwfqSKS2nQSsT9ss7","type":"assistant","uuid":"09993bca-ec08-492b-b9c4-9a5295bb9fda","timestamp":"2026-01-07T01:19:58.094Z"}
{"parentUuid":"09993bca-ec08-492b-b9c4-9a5295bb9fda","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013N5XsLzAD1VtRP1C7YNPNv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LhqWXyPrvAWuTYUknKiAEt","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/flybuys_integration.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":2935,"cache_read_input_tokens":24615,"cache_creation":{"ephemeral_5m_input_tokens":2935,"ephemeral_1h_input_tokens":0},"output_tokens":240,"service_tier":"standard"}},"requestId":"req_011CWs8zwfqSKS2nQSsT9ss7","type":"assistant","uuid":"5f02232d-13bd-4273-8656-8bb7d892bc6a","timestamp":"2026-01-07T01:19:58.531Z"}
{"parentUuid":"5f02232d-13bd-4273-8656-8bb7d892bc6a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LcGYvaLGR7HHWuBENDtyDQ","type":"tool_result","content":"     1→---\n     2→Document Type: Solution Architecture Document\n     3→Domain: [Link to Domain]\n     4→Status: [Discovery | In Progress | Complete | Approved | Deprecated]\n     5→Target Delivery: [Target Delivery Name or Date]\n     6→Programme Lead: [Email Address]\n     7→Domain Architect: [Email Address]\n     8→Business Owner: [Email Address]\n     9→Architecture Definition: [Link to Architecture Definition Document]\n    10→---\n    11→\n    12→== Introduction & Vision\n    13→\n    14→=== Purpose\n    15→\n    16→This Solution Architecture defines **how** the [Initiative Name] will be implemented - the specific technology products, configurations, interfaces, and deployment architecture that realize the Architecture Definition.\n    17→\n    18→=== Vision\n    19→\n    20→The [Initiative Name] Solution Architecture will deliver a robust, scalable, and maintainable technical solution that meets the business and technical requirements outlined in the Architecture Definition. It will leverage modern cloud-native technologies, adhere to best practices in software architecture, and align with OTRG's technology standards.\n    21→\n    22→=== Scope\n    23→\n    24→**In Scope** (this document):\n    25→- Solution Building Blocks (SBBs) - specific technology products and versions\n    26→- Interface specifications (APIs, events, data formats)\n    27→- Data architecture and schema specifications\n    28→- Deployment architecture and infrastructure configuration\n    29→- Transition architecture with phased implementation states\n    30→- Technical validation criteria and testing approach\n    31→- External system integration specifications\n    32→\n    33→**Out of Scope** (covered in Architecture Definition):\n    34→- Business requirements and stakeholder analysis\n    35→- Architecture decisions and rationale (ADRs)\n    36→- Bounded context definitions and responsibilities\n    37→- High-level integration patterns (ACL, Conformist, OHS+PL)\n    38→- Business capability mapping and value streams\n    39→- Non-functional requirements (referenced, not duplicated)\n    40→- Architecture principles and governance\n    41→\n    42→**Out of Scope** (covered in other documents):\n    43→- Detailed design (class diagrams, sequence diagrams for all flows)\n    44→- Implementation code and unit tests\n    45→- Project planning (sprints, resources, timeline)\n    46→- Business case and ROI analysis\n    47→- Operational runbooks and support procedures\n    48→\n    49→### Relationship to Architecture Definition\n    50→\n    51→```mermaid\n    52→graph LR\n    53→    A[Architecture Definition<br/>TOGAF Phase B,C,D] -->|Defines WHAT & WHY| B[Solution Architecture<br/>TOGAF Phase E]\n    54→    B -->|Defines HOW| C[Solution Design<br/>TOGAF Phase E]\n    55→    C -->|Implements| D[Working Software<br/>TOGAF Phase F,G]\n    56→\n    57→    A -->|Concepts| A1[Bounded Contexts<br/>Aggregates<br/>Integration Patterns]\n    58→    B -->|Specifics| B1[Technology Products<br/>APIs<br/>Infrastructure]\n    59→    C -->|Details| C1[Code Design<br/>Algorithms<br/>Unit Tests]\n    60→```\n    61→\n    62→**Key Differences:**\n    63→\n    64→| Aspect                     | Architecture Definition (Phase B,C,D)            | Solution Architecture (Phase E)                    |\n    65→| -------------------------- | ------------------------------------------------ | -------------------------------------------------- |\n    66→| **Focus**                  | WHAT to build and WHY                            | HOW to build with WHICH technologies               |\n    67→| **Bounded Contexts**       | Conceptual responsibilities and aggregates       | Specific microservices with technology stack       |\n    68→| **Integration**            | Patterns (ACL, Conformist, OHS+PL)               | Actual APIs, message formats, protocols            |\n    69→| **Data**                   | Aggregate invariants, domain concepts            | Database schemas, partition strategies, indexes    |\n    70→| **Decisions**              | ADRs with alternatives and rationale             | SBB selections justified by architecture decisions |\n    71→| **NFRs**                   | Performance/security requirements stated         | How we validate and test those requirements        |\n    72→| **Audience**               | ARB, business stakeholders, architects           | Implementation teams, DevOps, vendors              |\n    73→\n    74→---\n    75→\n    76→## Executive Summary\n    77→\n    78→**Challenge**: [1-2 sentences describing the technical problem to solve]\n    79→\n    80→**Solution Approach**:\n    81→- [Key technical approach 1 - e.g., \"Deploy BoundedContexts as microservices on Azure Container Apps\"]\n    82→- [Key technical approach 2 - e.g., \"Use NoSQL database for document storage with partition key optimization\"]\n    83→- [Key technical approach 3 - e.g., \"Implement Anti-Corruption Layers for external system integration\"]\n    84→- [Key technical approach 4 - e.g., \"Enable event-driven integration via Event Grid with CloudEvents schema\"]\n    85→- [Rollout strategy - e.g., \"Phased rollout using Strangler Fig pattern over X months\"]\n    86→\n    87→**Key Technology Decisions**:\n    88→- **Runtime**: [Technology - e.g., \".NET 8.0\"] (rationale - e.g., \"aligns with platform standards, team expertise\")\n    89→- **Hosting**: [Platform - e.g., \"Azure Container Apps\"] (rationale - e.g., \"consumption-based, autoscaling, managed\")\n    90→- **Database**: [Technology - e.g., \"Azure Cosmos DB\"] (rationale - e.g., \"NoSQL flexibility, partition key performance\")\n    91→- **Integration**: [Technology - e.g., \"Azure Event Grid\"] (rationale - e.g., \"CloudEvents standard, built-in retry, DLQ\")\n    92→- **Authentication**: [Technology - e.g., \"Auth0\"] (rationale - e.g., \"SaaS OAuth provider, reduces custom implementation\")\n    93→- **Monitoring**: [Technology - e.g., \"Azure Application Insights\"] (rationale - e.g., \"native integration, distributed tracing\")\n    94→\n    95→**Implementation Constraints** (from Architecture Definition):\n    96→- [Constraint 1 - reference CON-0XX from Architecture Definition]\n    97→- [Constraint 2 - reference CON-0XX from Architecture Definition]\n    98→- [Constraint 3 - reference CON-0XX from Architecture Definition]\n    99→\n   100→**Success Criteria** (validation):\n   101→- [Technical validation criterion 1 with metric]\n   102→- [Technical validation criterion 2 with metric]\n   103→- [Technical validation criterion 3 with metric]\n   104→\n   105→---\n   106→\n   107→## Solution Building Blocks\n   108→\n   109→This section maps the conceptual Architecture Building Blocks (ABBs) defined in the Architecture Definition to specific Solution Building Blocks (SBBs) - the actual technology products and components.\n   110→\n   111→### SBB Mapping to ABBs\n   112→\n   113→| ABB (from Architecture Definition)       | SBB ID  | SBB Name                    | Technology Product/Component                  |\n   114→| ---------------------------------------- | ------- | --------------------------- | --------------------------------------------- |\n   115→| [BoundedContext Name]                    | SBB-001 | [Service Name] API          | [Technology - e.g., \".NET 8.0 Web API on Azure Container Apps\"] |\n   116→| [BoundedContext Name] Data Store         | SBB-002 | [Service Name] Database     | [Technology - e.g., \"Azure Cosmos DB for NoSQL\"] |\n   117→| [BoundedContext Name]                    | SBB-003 | [Service Name] API          | [Technology]                                  |\n   118→| [BoundedContext Name] Data Store         | SBB-004 | [Service Name] Database     | [Technology]                                  |\n   119→| [Infrastructure Service Name]            | SBB-005 | [Service Name]              | [Technology]                                  |\n   120→| [Infrastructure Component Name]          | SBB-006 | [Component Name]            | [Technology]                                  |\n   121→\n   122→### SBB-001: [ServiceName] API\n   123→\n   124→**ABB Reference**: [BoundedContextName] (see Architecture Definition §X.X.X)\n   125→\n   126→| Attribute               | Specification                                                                 |\n   127→| ----------------------- | ----------------------------------------------------------------------------- |\n   128→| **Component Type**      | Microservice (Domain Service / Infrastructure Service)                        |\n   129→| **Technology Stack**    | [Runtime - e.g., \".NET 8.0, ASP.NET Core Web API, C# 12\"]                    |\n   130→| **Hosting Platform**    | [Platform - e.g., \"Azure Container Apps (consumption plan with autoscaling 1-10 instances)\"] |\n   131→| **API Contract**        | [Format - e.g., \"REST, OpenAPI 3.0 specification (see §5.1)\"]                |\n   132→| **Authentication**      | [Method - e.g., \"Azure AD B2C OAuth 2.0 Bearer tokens (JWT validation)\"]     |\n   133→| **Observability**       | [Tools - e.g., \"Application Insights SDK, structured logging (Serilog), correlation IDs\"] |\n   134→| **Configuration**       | [Method - e.g., \"Azure App Configuration with Key Vault references for secrets\"] |\n   135→| **Health Checks**       | [Implementation - e.g., \"ASP.NET Core health checks (/health endpoint) integrated with Container Apps\"] |\n   136→| **Deployment Unit**     | [Format - e.g., \"Docker container (linux/amd64), pushed to Azure Container Registry\"] |\n   137→\n   138→**Dependencies**:\n   139→- [SBB-XXX] ([Dependency Name]) - [Purpose]\n   140→- [SBB-XXX] ([Dependency Name]) - [Purpose]\n   141→\n   142→### SBB-002: [ServiceName] Database\n   143→\n   144→**ABB Reference**: [BoundedContextName] Data Store\n   145→\n   146→| Attribute               | Specification                                                                 |\n   147→| ----------------------- | ----------------------------------------------------------------------------- |\n   148→| **Database Type**       | [Type - e.g., \"NoSQL Document Database\" / \"Relational Database\"]             |\n   149→| **Product**             | [Product name and version - e.g., \"Azure Cosmos DB for NoSQL (API version 2023-11-15)\"] |\n   150→| **Consistency**         | [Model - e.g., \"Session consistency (default), Strong consistency for critical operations\"] |\n   151→| **Partition Strategy**  | [Strategy - e.g., \"Partition key: /customerId (enables single-partition queries)\"] |\n   152→| **Throughput**          | [Allocation - e.g., \"Autoscale: 1000-10000 RU/s (scales based on load)\"]     |\n   153→| **Geo-Replication**     | [Strategy - e.g., \"Single region (Australia East) - data residency requirement\"] |\n   154→| **Backup**              | [Strategy - e.g., \"Continuous backup (7-day point-in-time recovery)\"]        |\n   155→| **Indexes**             | [Index strategy - e.g., \"Default indexing policy + custom composite index on field1/field2\"] |\n   156→| **Containers**          | [Container list - e.g., \"container-name-1 (main container), container-name-2 (read model)\"] |\n   157→\n   158→**Data Residency**: [Region constraint - e.g., \"Australia East region (compliance with CON-0011)\"]\n   159→\n   160→<!-- Repeat SBB definitions for each component: SBB-003, SBB-004, SBB-005, etc. -->\n   161→\n   162→---\n   163→\n   164→## Data Architecture\n   165→\n   166→This section defines the logical and physical data models for Solution Building Blocks.\n   167→\n   168→### Logical Data Model\n   169→\n   170→**Entity Relationship Overview**:\n   171→\n   172→```mermaid\n   173→erDiagram\n   174→    ENTITY1 ||--o{ ENTITY2 : relationship\n   175→    ENTITY2 ||--o{ ENTITY3 : relationship\n   176→\n   177→    ENTITY1 {\n   178→        string id PK\n   179→        string foreignKeyId FK\n   180→        string property1\n   181→        datetime createdAt\n   182→    }\n   183→\n   184→    ENTITY2 {\n   185→        guid id PK\n   186→        string foreignKeyId FK\n   187→        string property1\n   188→        string property2\n   189→    }\n   190→\n   191→    ENTITY3 {\n   192→        guid id PK\n   193→        guid foreignKeyId FK\n   194→        string property1\n   195→        decimal amount\n   196→    }\n   197→```\n   198→\n   199→### Physical Data Models\n   200→\n   201→#### [ServiceName] - [DocumentName] Document Schema\n   202→\n   203→**Container**: `container-name`\n   204→**Partition Key**: `/partitionKeyField`\n   205→**Document Type**: JSON (Cosmos DB / DynamoDB / MongoDB)\n   206→\n   207→```json\n   208→{\n   209→  \"id\": \"string - unique document identifier\",\n   210→  \"aggregateId\": \"string - aggregate root identifier\",\n   211→  \"partitionKeyField\": \"string - partition key value\",\n   212→  \"property1\": \"string - description\",\n   213→  \"property2\": \"type - description\",\n   214→  \"nestedObject\": {\n   215→    \"subProperty1\": \"type\",\n   216→    \"subProperty2\": \"type\"\n   217→  },\n   218→  \"metadata\": {\n   219→    \"createdAt\": \"datetime - ISO8601 timestamp\",\n   220→    \"updatedAt\": \"datetime - ISO8601 timestamp\",\n   221→    \"version\": \"integer - optimistic concurrency version\"\n   222→  },\n   223→  \"_etag\": \"string - database concurrency token\"\n   224→}\n   225→```\n   226→\n   227→**Example Document**:\n   228→```json\n   229→{\n   230→  \"id\": \"doc_a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n   231→  \"aggregateId\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n   232→  \"partitionKeyField\": \"customer_xyz789\",\n   233→  \"property1\": \"example value\",\n   234→  \"property2\": 123,\n   235→  \"nestedObject\": {\n   236→    \"subProperty1\": \"value\",\n   237→    \"subProperty2\": \"value\"\n   238→  },\n   239→  \"metadata\": {\n   240→    \"createdAt\": \"2025-12-09T10:30:00Z\",\n   241→    \"updatedAt\": \"2025-12-09T10:30:00Z\",\n   242→    \"version\": 1\n   243→  },\n   244→  \"_etag\": \"\\\"0x8DCDEF123456\\\"\"\n   245→}\n   246→```\n   247→\n   248→**Indexes**:\n   249→- Primary: `/id` (automatic)\n   250→- Partition key: `/partitionKeyField` (automatic)\n   251→- Composite: `[/property1 ASC, /property2 ASC]` (custom - for querying pattern X)\n   252→\n   253→**Constraints**:\n   254→- `partitionKeyField`: Required, must match pattern `^pattern$`\n   255→- `property1`: Required, must be valid enum value\n   256→- Uniqueness: [Uniqueness constraint description]\n   257→\n   258→<!-- Repeat schema definitions for each document type -->\n   259→\n   260→### Data Migration Mappings\n   261→\n   262→#### [SourceSystem] → [TargetService] Migration\n   263→\n   264→**Source**: [Source database and table/collection]\n   265→**Target**: [Target service and database]\n   266→\n   267→| Source Field           | Target Field              | Transformation                                      |\n   268→| ---------------------- | ------------------------- | --------------------------------------------------- |\n   269→| `sourceField1`         | `targetField1`            | Direct copy                                         |\n   270→| `sourceField2`         | `targetField2`            | [Transformation logic - e.g., \"Format to ISO8601\"]  |\n   271→| N/A                    | `newField`                | [Generation logic - e.g., \"Generated: uuid()\"]      |\n   272→\n   273→**Migration Process**:\n   274→1. [Migration step 1]\n   275→2. [Migration step 2]\n   276→3. [Migration step 3]\n   277→\n   278→**Data Volume**: ~[number] records\n   279→**Migration Duration**: Estimated [duration]\n   280→\n   281→### Data Retention and Archival\n   282→\n   283→| Data Type                  | Retention Period | Storage Location                          | Archival Strategy                        |\n   284→| -------------------------- | ---------------- | ----------------------------------------- | ---------------------------------------- |\n   285→| [Data type 1]              | [Period]         | [Location - e.g., \"Cosmos DB hot storage\"] | [Strategy - e.g., \"N/A (active data)\"]   |\n   286→| [Data type 2]              | [Period]         | [Location]                                | [Strategy]                               |\n   287→\n   288→**Compliance Notes**:\n   289→- [Compliance requirement 1 - e.g., \"7-year retention for financial records\"]\n   290→- [Compliance requirement 2 - e.g., \"PII subject to deletion on request (GDPR/APP)\"]\n   291→\n   292→---\n   293→\n   294→## Deployment Architecture\n   295→\n   296→This section defines how Solution Building Blocks are deployed across infrastructure environments and networks.\n   297→\n   298→### Deployment Overview\n   299→\n   300→```mermaid\n   301→C4Deployment\n   302→    title [Initiative Name] - Production Deployment Architecture\n   303→\n   304→    Deployment_Node(cloud, \"[Cloud Platform] [Region]\", \"Cloud Platform\") {\n   305→        Deployment_Node(compute, \"Compute Environment\", \"[Platform Name]\") {\n   306→            Container(service1_api, \"[Service1] API\", \"[Technology]\", \"SBB-001\")\n   307→            Container(service2_api, \"[Service2] API\", \"[Technology]\", \"SBB-003\")\n   308→        }\n   309→\n   310→        Deployment_Node(data, \"Data Tier\", \"[Database Platform]\") {\n   311→            ContainerDb(service1_db, \"[Service1] DB\", \"[Database Type]\", \"SBB-002\")\n   312→            ContainerDb(service2_db, \"[Service2] DB\", \"[Database Type]\", \"SBB-004\")\n   313→        }\n   314→\n   315→        Deployment_Node(integration, \"Integration Services\") {\n   316→            Container(event_bus, \"Event Bus\", \"[Technology]\", \"SBB-006\")\n   317→            Container(api_gateway, \"API Gateway\", \"[Technology]\", \"SBB-010\")\n   318→        }\n   319→\n   320→        Deployment_Node(security, \"Security & Secrets\") {\n   321→            Container(key_vault, \"Key Vault\", \"[Technology]\", \"Secret storage\")\n   322→            Container(auth_service, \"Auth Service\", \"[Technology]\", \"SBB-005\")\n   323→        }\n   324→    }\n   325→\n   326→    Deployment_Node(external, \"External Systems\") {\n   327→        Container(external_system1, \"[External System 1]\", \"External SaaS/API\")\n   328→        Container(external_system2, \"[External System 2]\", \"External SaaS/API\")\n   329→    }\n   330→\n   331→    Deployment_Node(clients, \"Client Devices\") {\n   332→        Container(mobile_app, \"[Client Application]\", \"[Platform]\")\n   333→    }\n   334→```\n   335→\n   336→### Environment Strategy\n   337→\n   338→| Environment | Purpose                          | Infrastructure Scale              | Deployment Frequency |\n   339→| ----------- | -------------------------------- | --------------------------------- | -------------------- |\n   340→| **DEV**     | Developer feature testing        | [Scale - e.g., \"1 instance\"]      | Continuous (on commit)|\n   341→| **TEST**    | Integration testing, QA          | [Scale - e.g., \"1-2 instances\"]   | Daily                |\n   342→| **UAT**     | User acceptance, pilot           | [Scale - e.g., \"2-5 instances\"]   | Weekly               |\n   343→| **PROD**    | Production                       | [Scale - e.g., \"autoscale 1-20\"]  | [Frequency]          |\n   344→\n   345→### Network Architecture\n   346→\n   347→**Network Segmentation**:\n   348→\n   349→```\n   350→┌─────────────────────────────────────────────────────────────┐\n   351→│ [Cloud] Virtual Network ([CIDR])                            │\n   352→│                                                               │\n   353→│  ┌────────────────────────────────────────────────────────┐ │\n   354→│  │ Public Subnet ([CIDR])                                 │ │\n   355→│  │  - [Component 1] (public endpoint)                     │ │\n   356→│  │  - [Component 2] (SSL termination)                     │ │\n   357→│  └────────────────────────────────────────────────────────┘ │\n   358→│                                                               │\n   359→│  ┌────────────────────────────────────────────────────────┐ │\n   360→│  │ Application Subnet ([CIDR])                            │ │\n   361→│  │  - [Component 3] (internal)                            │ │\n   362→│  │  - [Component 4] (internal)                            │ │\n   363→│  └────────────────────────────────────────────────────────┘ │\n   364→│                                                               │\n   365→│  ┌────────────────────────────────────────────────────────┐ │\n   366→│  │ Data Subnet ([CIDR])                                   │ │\n   367→│  │  - [Database 1] (private endpoint)                     │ │\n   368→│  │  - [Database 2] (private endpoint)                     │ │\n   369→│  └────────────────────────────────────────────────────────┘ │\n   370→└─────────────────────────────────────────────────────────────┘\n   371→```\n   372→\n   373→**Network Security**:\n   374→- [Security measure 1 - e.g., \"API Gateway: TLS 1.3, OAuth 2.0 authentication\"]\n   375→- [Security measure 2 - e.g., \"Private endpoints: No public internet access\"]\n   376→- [Security measure 3 - e.g., \"NSG rules: Restrict inbound to API Gateway only\"]\n   377→\n   378→### Scaling and Resilience\n   379→\n   380→| Component            | Scaling Strategy                           | Resilience Pattern                         |\n   381→| -------------------- | ------------------------------------------ | ------------------------------------------ |\n   382→| [Service1] API       | [Strategy - e.g., \"Horizontal autoscale (CPU > 70%)\"] | [Pattern - e.g., \"Multi-instance (min 2 in PROD)\"] |\n   383→| [Service2] API       | [Strategy]                                 | [Pattern]                                  |\n   384→| [Database]           | [Strategy]                                 | [Pattern]                                  |\n   385→| [Event Bus]          | [Strategy]                                 | [Pattern]                                  |\n   386→\n   387→### Disaster Recovery\n   388→\n   389→**RPO/RTO Targets**:\n   390→- RPO: [Recovery Point Objective - e.g., \"1 hour (continuous backup, 7-day point-in-time recovery)\"]\n   391→- RTO: [Recovery Time Objective - e.g., \"4 hours (manual failover process, restore from backup)\"]\n   392→\n   393→**Backup Strategy**:\n   394→- [Component 1]: [Backup strategy]\n   395→- [Component 2]: [Backup strategy]\n   396→- [Component 3]: [Backup strategy]\n   397→\n   398→**Disaster Recovery Procedure**:\n   399→1. [DR step 1]\n   400→2. [DR step 2]\n   401→3. [DR step 3]\n   402→\n   403→**Exclusions**: [Items not covered by DR - e.g., \"Data in transit must be regenerated\"]\n   404→\n   405→---\n   406→\n   407→## Interface Specifications\n   408→\n   409→This section defines the contracts between Solution Building Blocks - REST APIs, domain events, and data formats.\n   410→\n   411→### REST API Specifications\n   412→\n   413→API contracts are defined using OpenAPI 3.0 specifications. These machine-readable specifications can be used to generate client SDKs, validate requests/responses, and import into API testing tools (Postman, Insomnia).\n   414→\n   415→#### [ServiceName] API\n   416→\n   417→**OpenAPI Spec**: `openapi-specs/[service-name]-v1.yaml`\n   418→\n   419→**Base URL**: `https://api.[domain]/[service]/v1`\n   420→\n   421→**Authentication**: [Method - e.g., \"OAuth 2.0 Bearer token (Azure AD B2C)\"]\n   422→\n   423→**Key Endpoints**:\n   424→- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n   425→- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n   426→- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n   427→\n   428→**Performance SLA**: [Target - e.g., \"p95 < 500ms (reference NFR-002 in Architecture Definition)\"]\n   429→\n   430→**Caching Strategy** (if applicable):\n   431→- [Resource type]: [TTL] in [Cache technology - e.g., \"Redis Cache\"]\n   432→\n   433→**Business Rules**: See OpenAPI spec for detailed request/response schemas and validation rules\n   434→\n   435→<!-- Repeat for each service API -->\n   436→\n   437→---\n   438→\n   439→### Domain Events Schema\n   440→\n   441→**Event Format**: [Format - e.g., \"CloudEvents 1.0 specification\"]\n   442→\n   443→**Transport**: [Technology - e.g., \"Azure Event Grid\"]\n   444→\n   445→#### Event: [EventName]\n   446→\n   447→**Topic**: `[topic-name]`\n   448→\n   449→**Schema**:\n   450→```json\n   451→{\n   452→  \"specversion\": \"1.0\",\n   453→  \"type\": \"com.[company].[service].[EventName]\",\n   454→  \"source\": \"/[service-name]\",\n   455→  \"id\": \"string (GUID)\",\n   456→  \"time\": \"ISO8601 timestamp\",\n   457→  \"datacontenttype\": \"application/json\",\n   458→  \"data\": {\n   459→    \"field1\": \"type - description\",\n   460→    \"field2\": \"type - description\"\n   461→  }\n   462→}\n   463→```\n   464→\n   465→**Consumers**: [List of consuming services]\n   466→\n   467→<!-- Repeat for each event type -->\n   468→\n   469→### Data Formats\n   470→\n   471→#### [DataFormat Name - e.g., \"Batch File Format (CSV)\"]\n   472→\n   473→**File Specification**: [Reference to external spec if applicable]\n   474→\n   475→**Format**:\n   476→```\n   477→[Format example or description]\n   478→```\n   479→\n   480→**Encoding**: [Encoding - e.g., \"UTF-8\"]\n   481→**Line Ending**: [Format - e.g., \"CRLF\"]\n   482→**Header Row**: [Required/Optional]\n   483→**Max File Size**: [Size limit]\n   484→\n   485→<!-- Additional format specifications -->\n   486→\n   487→---\n   488→\n   489→## Transition Architecture\n   490→\n   491→This section defines the phased approach to migrate from current state to target architecture, showing intermediate architecture states and technical dependencies.\n   492→\n   493→### Transition Principles\n   494→\n   495→1. **[Principle 1]**: [Description - e.g., \"No Big-Bang Migration: Incremental rollout using Strangler Fig pattern\"]\n   496→2. **[Principle 2]**: [Description - e.g., \"Zero Downtime: New services operate in parallel with legacy\"]\n   497→3. **[Principle 3]**: [Description - e.g., \"Feature Flag Control: All new capabilities behind feature flags\"]\n   498→4. **[Principle 4]**: [Description - e.g., \"Data Coexistence: Dual-write during transition period\"]\n   499→5. **[Principle 5]**: [Description - e.g., \"Rollback Capability: Each phase independently reversible\"]\n   500→\n   501→### Architecture States\n   502→\n   503→```mermaid\n   504→gantt\n   505→    title Transition Architecture Timeline\n   506→    dateFormat YYYY-MM\n   507→    section Architecture States\n   508→    AS-0 Current State           :done, as0, [start-date], [end-date]\n   509→    AS-1 [Phase 1 Name]          :active, as1, [start-date], [end-date]\n   510→    AS-2 [Phase 2 Name]          :as2, [start-date], [end-date]\n   511→    AS-3 [Phase 3 Name]          :as3, [start-date], [end-date]\n   512→    AS-4 Target State            :as4, [start-date], [end-date]\n   513→```\n   514→\n   515→### AS-0: Current State (Baseline)\n   516→\n   517→**Description**: [Description of current architecture state]\n   518→\n   519→**Active Components**:\n   520→- [Component 1]: [Current state description]\n   521→- [Component 2]: [Current state description]\n   522→\n   523→**Technical Debt**: [Key technical debt items]\n   524→\n   525→---\n   526→\n   527→### AS-1: [Phase 1 Name] ([Timeframe])\n   528→\n   529→**Description**: [What this phase establishes]\n   530→\n   531→**New SBBs Deployed**:\n   532→- [SBB-XXX]: [Component Name]\n   533→- [SBB-XXX]: [Component Name]\n   534→\n   535→**Migration Activities**:\n   536→- **[Activity 1]**: [Description]\n   537→- **[Activity 2]**: [Description]\n   538→\n   539→**Feature Flags**:\n   540→- `[FeatureFlag.Name]` = [value] ([scope - e.g., \"pilot users only\"])\n   541→\n   542→**Architecture Diagram**:\n   543→\n   544→```\n   545→[Simple text diagram showing components and relationships]\n   546→```\n   547→\n   548→**Success Criteria**:\n   549→- [Criterion 1 with specific metric]\n   550→- [Criterion 2 with specific metric]\n   551→\n   552→**Dependencies**:\n   553→- [Dependency 1] (external/internal dependency)\n   554→- [Dependency 2] (external/internal dependency)\n   555→\n   556→**Rollback**: [Rollback procedure]\n   557→\n   558→<!-- Repeat for AS-2, AS-3, AS-4 -->\n   559→\n   560→### Technical Dependency Graph\n   561→\n   562→```mermaid\n   563→graph TD\n   564→    A[AS-1: [Phase 1]] --> B[AS-2: [Phase 2]]\n   565→    B --> C[AS-3: [Phase 3]]\n   566→    C --> D[AS-4: Target State]\n   567→\n   568→    A -->|Prerequisite| E[Dependency 1]\n   569→    A -->|Prerequisite| F[Dependency 2]\n   570→\n   571→    B -->|Prerequisite| G[Dependency 3]\n   572→    B -->|Prerequisite| H[Dependency 4]\n   573→```\n   574→\n   575→### Transition Risks\n   576→\n   577→| Risk ID | Risk Description                                      | Mitigation                                                  | Contingency                              |\n   578→| ------- | ----------------------------------------------------- | ----------------------------------------------------------- | ---------------------------------------- |\n   579→| TR-001  | [Risk description]                                    | [Mitigation strategy]                                       | [Contingency plan]                       |\n   580→| TR-002  | [Risk description]                                    | [Mitigation strategy]                                       | [Contingency plan]                       |\n   581→\n   582→---\n   583→\n   584→## Solution Validation\n   585→\n   586→This section defines how the solution will be validated against requirements defined in the Architecture Definition.\n   587→\n   588→### Functional Validation\n   589→\n   590→**Validation Method**: [Method - e.g., \"Automated API integration tests + UAT scenarios\"]\n   591→\n   592→| Requirement ID | Validation Test                                                      | Acceptance Criteria                                      | Test Environment |\n   593→| -------------- | -------------------------------------------------------------------- | -------------------------------------------------------- | ---------------- |\n   594→| BR-001         | [Test description]                                                   | [Specific acceptance criteria]                           | UAT              |\n   595→| BR-002         | [Test description]                                                   | [Specific acceptance criteria]                           | UAT              |\n   596→\n   597→### Non-Functional Validation\n   598→\n   599→**Validation Method**: [Method - e.g., \"Load testing (JMeter) + Production monitoring (30-day observation)\"]\n   600→\n   601→| NFR ID  | Validation Test                                    | Acceptance Criteria                                       | Tool/Method                      |\n   602→| ------- | -------------------------------------------------- | --------------------------------------------------------- | -------------------------------- |\n   603→| NFR-001 | [Test description]                                 | [Specific acceptance criteria with metrics]               | [Tool/Method]                    |\n   604→| NFR-002 | [Test description]                                 | [Specific acceptance criteria with metrics]               | [Tool/Method]                    |\n   605→\n   606→### Integration Validation\n   607→\n   608→**Validation Method**: [Method - e.g., \"Contract testing (Pact) + Integration test harness\"]\n   609→\n   610→| Integration Point      | Validation Test                                         | Acceptance Criteria                                  | Method                           |\n   611→| ---------------------- | ------------------------------------------------------- | ---------------------------------------------------- | -------------------------------- |\n   612→| [External System]      | [Test description]                                      | [Acceptance criteria]                                | [Method]                         |\n   613→\n   614→### Security Validation\n   615→\n   616→**Validation Method**: [Method - e.g., \"Penetration testing + Security audit\"]\n   617→\n   618→| Security Control   | Validation Test                                           | Acceptance Criteria                                  | Auditor                          |\n   619→| ------------------ | --------------------------------------------------------- | ---------------------------------------------------- | -------------------------------- |\n   620→| [Control name]     | [Test description]                                        | [Acceptance criteria]                                | [Who validates]                  |\n   621→\n   622→### Validation Exit Criteria\n   623→\n   624→**Phase 1 ([Phase Name]) - Exit to [Next Phase]**:\n   625→- ✅ [Criterion 1 with specific metric]\n   626→- ✅ [Criterion 2 with specific metric]\n   627→- ✅ [Criterion 3 with specific metric]\n   628→\n   629→<!-- Repeat for each phase -->\n   630→\n   631→---\n   632→\n   633→## Technical Reference Specifications\n   634→\n   635→This section provides detailed technical specifications for external integrations and configuration baselines required for implementation.\n   636→\n   637→### External System Interface Specifications\n   638→\n   639→#### [External System Name] API Specification\n   640→\n   641→**Vendor**: [Vendor Name]\n   642→**Specification Version**: [Version] ([Date])\n   643→**Documentation**: [URL or location]\n   644→\n   645→| Parameter                | Value                                                      |\n   646→| ------------------------ | ---------------------------------------------------------- |\n   647→| **Base URL**             | `https://[domain]/[path]`                                  |\n   648→| **Authentication**       | [Method]                                                   |\n   649→| **Rate Limits**          | [Limits]                                                   |\n   650→| **SLA**                  | [Uptime %, latency target]                                 |\n   651→\n   652→<!-- Repeat for each external system -->\n   653→\n   654→### Configuration Baselines\n   655→\n   656→#### [Technology Component] Configuration\n   657→\n   658→**[Configuration Name]**:\n   659→```json\n   660→{\n   661→  \"parameter1\": \"value\",\n   662→  \"parameter2\": \"value\"\n   663→}\n   664→```\n   665→\n   666→<!-- Repeat for each configuration baseline -->\n   667→\n   668→### Environment Configuration Matrix\n   669→\n   670→| Configuration Item          | DEV                  | TEST                 | UAT                  | PROD                    |\n   671→| --------------------------- | -------------------- | -------------------- | -------------------- | ----------------------- |\n   672→| **[Item 1]**                | [Value]              | [Value]              | [Value]              | [Value]                 |\n   673→| **[Item 2]**                | [Value]              | [Value]              | [Value]              | [Value]                 |\n   674→\n   675→### Reference Documents\n   676→\n   677→| Document Title                          | Version | Owner          | Location                                    |\n   678→| --------------------------------------- | ------- | -------------- | ------------------------------------------- |\n   679→| [Document name]                         | [Ver]   | [Owner]        | [URL or location]                           |\n   680→\n   681→---\n   682→\n   683→## Template Usage Notes\n   684→\n   685→### Before Finalization\n   686→\n   687→1. Remove all instructional text (like this section)\n   688→2. Replace all placeholders with actual values\n   689→3. Ensure all SBB mappings trace back to ABBs in Architecture Definition\n   690→4. Verify all NFR validations reference Architecture Definition NFR IDs\n   691→5. Confirm deployment architecture aligns with infrastructure constraints\n   692→6. Validate interface specifications match Architecture Definition integration patterns\n   693→7. Check transition architecture phases have clear success criteria\n   694→8. Ensure external system specifications are current and verified\n   695→\n   696→### Document Maintenance\n   697→\n   698→- Update when technology selections change\n   699→- Revise when Architecture Definition is updated\n   700→- Keep interface specifications synchronized with actual implementations\n   701→- Update transition architecture as phases complete\n   702→- Maintain version history for audit trail\n   703→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5609a996-cf8a-4e88-a481-f7b095b45762","timestamp":"2026-01-07T01:19:59.177Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/templates/solution_architecture_template.adoc","content":"---\nDocument Type: Solution Architecture Document\nDomain: [Link to Domain]\nStatus: [Discovery | In Progress | Complete | Approved | Deprecated]\nTarget Delivery: [Target Delivery Name or Date]\nProgramme Lead: [Email Address]\nDomain Architect: [Email Address]\nBusiness Owner: [Email Address]\nArchitecture Definition: [Link to Architecture Definition Document]\n---\n\n== Introduction & Vision\n\n=== Purpose\n\nThis Solution Architecture defines **how** the [Initiative Name] will be implemented - the specific technology products, configurations, interfaces, and deployment architecture that realize the Architecture Definition.\n\n=== Vision\n\nThe [Initiative Name] Solution Architecture will deliver a robust, scalable, and maintainable technical solution that meets the business and technical requirements outlined in the Architecture Definition. It will leverage modern cloud-native technologies, adhere to best practices in software architecture, and align with OTRG's technology standards.\n\n=== Scope\n\n**In Scope** (this document):\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n**Out of Scope** (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n**Out of Scope** (covered in other documents):\n- Detailed design (class diagrams, sequence diagrams for all flows)\n- Implementation code and unit tests\n- Project planning (sprints, resources, timeline)\n- Business case and ROI analysis\n- Operational runbooks and support procedures\n\n### Relationship to Architecture Definition\n\n```mermaid\ngraph LR\n    A[Architecture Definition<br/>TOGAF Phase B,C,D] -->|Defines WHAT & WHY| B[Solution Architecture<br/>TOGAF Phase E]\n    B -->|Defines HOW| C[Solution Design<br/>TOGAF Phase E]\n    C -->|Implements| D[Working Software<br/>TOGAF Phase F,G]\n\n    A -->|Concepts| A1[Bounded Contexts<br/>Aggregates<br/>Integration Patterns]\n    B -->|Specifics| B1[Technology Products<br/>APIs<br/>Infrastructure]\n    C -->|Details| C1[Code Design<br/>Algorithms<br/>Unit Tests]\n```\n\n**Key Differences:**\n\n| Aspect                     | Architecture Definition (Phase B,C,D)            | Solution Architecture (Phase E)                    |\n| -------------------------- | ------------------------------------------------ | -------------------------------------------------- |\n| **Focus**                  | WHAT to build and WHY                            | HOW to build with WHICH technologies               |\n| **Bounded Contexts**       | Conceptual responsibilities and aggregates       | Specific microservices with technology stack       |\n| **Integration**            | Patterns (ACL, Conformist, OHS+PL)               | Actual APIs, message formats, protocols            |\n| **Data**                   | Aggregate invariants, domain concepts            | Database schemas, partition strategies, indexes    |\n| **Decisions**              | ADRs with alternatives and rationale             | SBB selections justified by architecture decisions |\n| **NFRs**                   | Performance/security requirements stated         | How we validate and test those requirements        |\n| **Audience**               | ARB, business stakeholders, architects           | Implementation teams, DevOps, vendors              |\n\n---\n\n## Executive Summary\n\n**Challenge**: [1-2 sentences describing the technical problem to solve]\n\n**Solution Approach**:\n- [Key technical approach 1 - e.g., \"Deploy BoundedContexts as microservices on Azure Container Apps\"]\n- [Key technical approach 2 - e.g., \"Use NoSQL database for document storage with partition key optimization\"]\n- [Key technical approach 3 - e.g., \"Implement Anti-Corruption Layers for external system integration\"]\n- [Key technical approach 4 - e.g., \"Enable event-driven integration via Event Grid with CloudEvents schema\"]\n- [Rollout strategy - e.g., \"Phased rollout using Strangler Fig pattern over X months\"]\n\n**Key Technology Decisions**:\n- **Runtime**: [Technology - e.g., \".NET 8.0\"] (rationale - e.g., \"aligns with platform standards, team expertise\")\n- **Hosting**: [Platform - e.g., \"Azure Container Apps\"] (rationale - e.g., \"consumption-based, autoscaling, managed\")\n- **Database**: [Technology - e.g., \"Azure Cosmos DB\"] (rationale - e.g., \"NoSQL flexibility, partition key performance\")\n- **Integration**: [Technology - e.g., \"Azure Event Grid\"] (rationale - e.g., \"CloudEvents standard, built-in retry, DLQ\")\n- **Authentication**: [Technology - e.g., \"Auth0\"] (rationale - e.g., \"SaaS OAuth provider, reduces custom implementation\")\n- **Monitoring**: [Technology - e.g., \"Azure Application Insights\"] (rationale - e.g., \"native integration, distributed tracing\")\n\n**Implementation Constraints** (from Architecture Definition):\n- [Constraint 1 - reference CON-0XX from Architecture Definition]\n- [Constraint 2 - reference CON-0XX from Architecture Definition]\n- [Constraint 3 - reference CON-0XX from Architecture Definition]\n\n**Success Criteria** (validation):\n- [Technical validation criterion 1 with metric]\n- [Technical validation criterion 2 with metric]\n- [Technical validation criterion 3 with metric]\n\n---\n\n## Solution Building Blocks\n\nThis section maps the conceptual Architecture Building Blocks (ABBs) defined in the Architecture Definition to specific Solution Building Blocks (SBBs) - the actual technology products and components.\n\n### SBB Mapping to ABBs\n\n| ABB (from Architecture Definition)       | SBB ID  | SBB Name                    | Technology Product/Component                  |\n| ---------------------------------------- | ------- | --------------------------- | --------------------------------------------- |\n| [BoundedContext Name]                    | SBB-001 | [Service Name] API          | [Technology - e.g., \".NET 8.0 Web API on Azure Container Apps\"] |\n| [BoundedContext Name] Data Store         | SBB-002 | [Service Name] Database     | [Technology - e.g., \"Azure Cosmos DB for NoSQL\"] |\n| [BoundedContext Name]                    | SBB-003 | [Service Name] API          | [Technology]                                  |\n| [BoundedContext Name] Data Store         | SBB-004 | [Service Name] Database     | [Technology]                                  |\n| [Infrastructure Service Name]            | SBB-005 | [Service Name]              | [Technology]                                  |\n| [Infrastructure Component Name]          | SBB-006 | [Component Name]            | [Technology]                                  |\n\n### SBB-001: [ServiceName] API\n\n**ABB Reference**: [BoundedContextName] (see Architecture Definition §X.X.X)\n\n| Attribute               | Specification                                                                 |\n| ----------------------- | ----------------------------------------------------------------------------- |\n| **Component Type**      | Microservice (Domain Service / Infrastructure Service)                        |\n| **Technology Stack**    | [Runtime - e.g., \".NET 8.0, ASP.NET Core Web API, C# 12\"]                    |\n| **Hosting Platform**    | [Platform - e.g., \"Azure Container Apps (consumption plan with autoscaling 1-10 instances)\"] |\n| **API Contract**        | [Format - e.g., \"REST, OpenAPI 3.0 specification (see §5.1)\"]                |\n| **Authentication**      | [Method - e.g., \"Azure AD B2C OAuth 2.0 Bearer tokens (JWT validation)\"]     |\n| **Observability**       | [Tools - e.g., \"Application Insights SDK, structured logging (Serilog), correlation IDs\"] |\n| **Configuration**       | [Method - e.g., \"Azure App Configuration with Key Vault references for secrets\"] |\n| **Health Checks**       | [Implementation - e.g., \"ASP.NET Core health checks (/health endpoint) integrated with Container Apps\"] |\n| **Deployment Unit**     | [Format - e.g., \"Docker container (linux/amd64), pushed to Azure Container Registry\"] |\n\n**Dependencies**:\n- [SBB-XXX] ([Dependency Name]) - [Purpose]\n- [SBB-XXX] ([Dependency Name]) - [Purpose]\n\n### SBB-002: [ServiceName] Database\n\n**ABB Reference**: [BoundedContextName] Data Store\n\n| Attribute               | Specification                                                                 |\n| ----------------------- | ----------------------------------------------------------------------------- |\n| **Database Type**       | [Type - e.g., \"NoSQL Document Database\" / \"Relational Database\"]             |\n| **Product**             | [Product name and version - e.g., \"Azure Cosmos DB for NoSQL (API version 2023-11-15)\"] |\n| **Consistency**         | [Model - e.g., \"Session consistency (default), Strong consistency for critical operations\"] |\n| **Partition Strategy**  | [Strategy - e.g., \"Partition key: /customerId (enables single-partition queries)\"] |\n| **Throughput**          | [Allocation - e.g., \"Autoscale: 1000-10000 RU/s (scales based on load)\"]     |\n| **Geo-Replication**     | [Strategy - e.g., \"Single region (Australia East) - data residency requirement\"] |\n| **Backup**              | [Strategy - e.g., \"Continuous backup (7-day point-in-time recovery)\"]        |\n| **Indexes**             | [Index strategy - e.g., \"Default indexing policy + custom composite index on field1/field2\"] |\n| **Containers**          | [Container list - e.g., \"container-name-1 (main container), container-name-2 (read model)\"] |\n\n**Data Residency**: [Region constraint - e.g., \"Australia East region (compliance with CON-0011)\"]\n\n<!-- Repeat SBB definitions for each component: SBB-003, SBB-004, SBB-005, etc. -->\n\n---\n\n## Data Architecture\n\nThis section defines the logical and physical data models for Solution Building Blocks.\n\n### Logical Data Model\n\n**Entity Relationship Overview**:\n\n```mermaid\nerDiagram\n    ENTITY1 ||--o{ ENTITY2 : relationship\n    ENTITY2 ||--o{ ENTITY3 : relationship\n\n    ENTITY1 {\n        string id PK\n        string foreignKeyId FK\n        string property1\n        datetime createdAt\n    }\n\n    ENTITY2 {\n        guid id PK\n        string foreignKeyId FK\n        string property1\n        string property2\n    }\n\n    ENTITY3 {\n        guid id PK\n        guid foreignKeyId FK\n        string property1\n        decimal amount\n    }\n```\n\n### Physical Data Models\n\n#### [ServiceName] - [DocumentName] Document Schema\n\n**Container**: `container-name`\n**Partition Key**: `/partitionKeyField`\n**Document Type**: JSON (Cosmos DB / DynamoDB / MongoDB)\n\n```json\n{\n  \"id\": \"string - unique document identifier\",\n  \"aggregateId\": \"string - aggregate root identifier\",\n  \"partitionKeyField\": \"string - partition key value\",\n  \"property1\": \"string - description\",\n  \"property2\": \"type - description\",\n  \"nestedObject\": {\n    \"subProperty1\": \"type\",\n    \"subProperty2\": \"type\"\n  },\n  \"metadata\": {\n    \"createdAt\": \"datetime - ISO8601 timestamp\",\n    \"updatedAt\": \"datetime - ISO8601 timestamp\",\n    \"version\": \"integer - optimistic concurrency version\"\n  },\n  \"_etag\": \"string - database concurrency token\"\n}\n```\n\n**Example Document**:\n```json\n{\n  \"id\": \"doc_a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n  \"aggregateId\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n  \"partitionKeyField\": \"customer_xyz789\",\n  \"property1\": \"example value\",\n  \"property2\": 123,\n  \"nestedObject\": {\n    \"subProperty1\": \"value\",\n    \"subProperty2\": \"value\"\n  },\n  \"metadata\": {\n    \"createdAt\": \"2025-12-09T10:30:00Z\",\n    \"updatedAt\": \"2025-12-09T10:30:00Z\",\n    \"version\": 1\n  },\n  \"_etag\": \"\\\"0x8DCDEF123456\\\"\"\n}\n```\n\n**Indexes**:\n- Primary: `/id` (automatic)\n- Partition key: `/partitionKeyField` (automatic)\n- Composite: `[/property1 ASC, /property2 ASC]` (custom - for querying pattern X)\n\n**Constraints**:\n- `partitionKeyField`: Required, must match pattern `^pattern$`\n- `property1`: Required, must be valid enum value\n- Uniqueness: [Uniqueness constraint description]\n\n<!-- Repeat schema definitions for each document type -->\n\n### Data Migration Mappings\n\n#### [SourceSystem] → [TargetService] Migration\n\n**Source**: [Source database and table/collection]\n**Target**: [Target service and database]\n\n| Source Field           | Target Field              | Transformation                                      |\n| ---------------------- | ------------------------- | --------------------------------------------------- |\n| `sourceField1`         | `targetField1`            | Direct copy                                         |\n| `sourceField2`         | `targetField2`            | [Transformation logic - e.g., \"Format to ISO8601\"]  |\n| N/A                    | `newField`                | [Generation logic - e.g., \"Generated: uuid()\"]      |\n\n**Migration Process**:\n1. [Migration step 1]\n2. [Migration step 2]\n3. [Migration step 3]\n\n**Data Volume**: ~[number] records\n**Migration Duration**: Estimated [duration]\n\n### Data Retention and Archival\n\n| Data Type                  | Retention Period | Storage Location                          | Archival Strategy                        |\n| -------------------------- | ---------------- | ----------------------------------------- | ---------------------------------------- |\n| [Data type 1]              | [Period]         | [Location - e.g., \"Cosmos DB hot storage\"] | [Strategy - e.g., \"N/A (active data)\"]   |\n| [Data type 2]              | [Period]         | [Location]                                | [Strategy]                               |\n\n**Compliance Notes**:\n- [Compliance requirement 1 - e.g., \"7-year retention for financial records\"]\n- [Compliance requirement 2 - e.g., \"PII subject to deletion on request (GDPR/APP)\"]\n\n---\n\n## Deployment Architecture\n\nThis section defines how Solution Building Blocks are deployed across infrastructure environments and networks.\n\n### Deployment Overview\n\n```mermaid\nC4Deployment\n    title [Initiative Name] - Production Deployment Architecture\n\n    Deployment_Node(cloud, \"[Cloud Platform] [Region]\", \"Cloud Platform\") {\n        Deployment_Node(compute, \"Compute Environment\", \"[Platform Name]\") {\n            Container(service1_api, \"[Service1] API\", \"[Technology]\", \"SBB-001\")\n            Container(service2_api, \"[Service2] API\", \"[Technology]\", \"SBB-003\")\n        }\n\n        Deployment_Node(data, \"Data Tier\", \"[Database Platform]\") {\n            ContainerDb(service1_db, \"[Service1] DB\", \"[Database Type]\", \"SBB-002\")\n            ContainerDb(service2_db, \"[Service2] DB\", \"[Database Type]\", \"SBB-004\")\n        }\n\n        Deployment_Node(integration, \"Integration Services\") {\n            Container(event_bus, \"Event Bus\", \"[Technology]\", \"SBB-006\")\n            Container(api_gateway, \"API Gateway\", \"[Technology]\", \"SBB-010\")\n        }\n\n        Deployment_Node(security, \"Security & Secrets\") {\n            Container(key_vault, \"Key Vault\", \"[Technology]\", \"Secret storage\")\n            Container(auth_service, \"Auth Service\", \"[Technology]\", \"SBB-005\")\n        }\n    }\n\n    Deployment_Node(external, \"External Systems\") {\n        Container(external_system1, \"[External System 1]\", \"External SaaS/API\")\n        Container(external_system2, \"[External System 2]\", \"External SaaS/API\")\n    }\n\n    Deployment_Node(clients, \"Client Devices\") {\n        Container(mobile_app, \"[Client Application]\", \"[Platform]\")\n    }\n```\n\n### Environment Strategy\n\n| Environment | Purpose                          | Infrastructure Scale              | Deployment Frequency |\n| ----------- | -------------------------------- | --------------------------------- | -------------------- |\n| **DEV**     | Developer feature testing        | [Scale - e.g., \"1 instance\"]      | Continuous (on commit)|\n| **TEST**    | Integration testing, QA          | [Scale - e.g., \"1-2 instances\"]   | Daily                |\n| **UAT**     | User acceptance, pilot           | [Scale - e.g., \"2-5 instances\"]   | Weekly               |\n| **PROD**    | Production                       | [Scale - e.g., \"autoscale 1-20\"]  | [Frequency]          |\n\n### Network Architecture\n\n**Network Segmentation**:\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│ [Cloud] Virtual Network ([CIDR])                            │\n│                                                               │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │ Public Subnet ([CIDR])                                 │ │\n│  │  - [Component 1] (public endpoint)                     │ │\n│  │  - [Component 2] (SSL termination)                     │ │\n│  └────────────────────────────────────────────────────────┘ │\n│                                                               │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │ Application Subnet ([CIDR])                            │ │\n│  │  - [Component 3] (internal)                            │ │\n│  │  - [Component 4] (internal)                            │ │\n│  └────────────────────────────────────────────────────────┘ │\n│                                                               │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │ Data Subnet ([CIDR])                                   │ │\n│  │  - [Database 1] (private endpoint)                     │ │\n│  │  - [Database 2] (private endpoint)                     │ │\n│  └────────────────────────────────────────────────────────┘ │\n└─────────────────────────────────────────────────────────────┘\n```\n\n**Network Security**:\n- [Security measure 1 - e.g., \"API Gateway: TLS 1.3, OAuth 2.0 authentication\"]\n- [Security measure 2 - e.g., \"Private endpoints: No public internet access\"]\n- [Security measure 3 - e.g., \"NSG rules: Restrict inbound to API Gateway only\"]\n\n### Scaling and Resilience\n\n| Component            | Scaling Strategy                           | Resilience Pattern                         |\n| -------------------- | ------------------------------------------ | ------------------------------------------ |\n| [Service1] API       | [Strategy - e.g., \"Horizontal autoscale (CPU > 70%)\"] | [Pattern - e.g., \"Multi-instance (min 2 in PROD)\"] |\n| [Service2] API       | [Strategy]                                 | [Pattern]                                  |\n| [Database]           | [Strategy]                                 | [Pattern]                                  |\n| [Event Bus]          | [Strategy]                                 | [Pattern]                                  |\n\n### Disaster Recovery\n\n**RPO/RTO Targets**:\n- RPO: [Recovery Point Objective - e.g., \"1 hour (continuous backup, 7-day point-in-time recovery)\"]\n- RTO: [Recovery Time Objective - e.g., \"4 hours (manual failover process, restore from backup)\"]\n\n**Backup Strategy**:\n- [Component 1]: [Backup strategy]\n- [Component 2]: [Backup strategy]\n- [Component 3]: [Backup strategy]\n\n**Disaster Recovery Procedure**:\n1. [DR step 1]\n2. [DR step 2]\n3. [DR step 3]\n\n**Exclusions**: [Items not covered by DR - e.g., \"Data in transit must be regenerated\"]\n\n---\n\n## Interface Specifications\n\nThis section defines the contracts between Solution Building Blocks - REST APIs, domain events, and data formats.\n\n### REST API Specifications\n\nAPI contracts are defined using OpenAPI 3.0 specifications. These machine-readable specifications can be used to generate client SDKs, validate requests/responses, and import into API testing tools (Postman, Insomnia).\n\n#### [ServiceName] API\n\n**OpenAPI Spec**: `openapi-specs/[service-name]-v1.yaml`\n\n**Base URL**: `https://api.[domain]/[service]/v1`\n\n**Authentication**: [Method - e.g., \"OAuth 2.0 Bearer token (Azure AD B2C)\"]\n\n**Key Endpoints**:\n- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n- `[HTTP METHOD] /[resource-path]` - [Brief endpoint description]\n\n**Performance SLA**: [Target - e.g., \"p95 < 500ms (reference NFR-002 in Architecture Definition)\"]\n\n**Caching Strategy** (if applicable):\n- [Resource type]: [TTL] in [Cache technology - e.g., \"Redis Cache\"]\n\n**Business Rules**: See OpenAPI spec for detailed request/response schemas and validation rules\n\n<!-- Repeat for each service API -->\n\n---\n\n### Domain Events Schema\n\n**Event Format**: [Format - e.g., \"CloudEvents 1.0 specification\"]\n\n**Transport**: [Technology - e.g., \"Azure Event Grid\"]\n\n#### Event: [EventName]\n\n**Topic**: `[topic-name]`\n\n**Schema**:\n```json\n{\n  \"specversion\": \"1.0\",\n  \"type\": \"com.[company].[service].[EventName]\",\n  \"source\": \"/[service-name]\",\n  \"id\": \"string (GUID)\",\n  \"time\": \"ISO8601 timestamp\",\n  \"datacontenttype\": \"application/json\",\n  \"data\": {\n    \"field1\": \"type - description\",\n    \"field2\": \"type - description\"\n  }\n}\n```\n\n**Consumers**: [List of consuming services]\n\n<!-- Repeat for each event type -->\n\n### Data Formats\n\n#### [DataFormat Name - e.g., \"Batch File Format (CSV)\"]\n\n**File Specification**: [Reference to external spec if applicable]\n\n**Format**:\n```\n[Format example or description]\n```\n\n**Encoding**: [Encoding - e.g., \"UTF-8\"]\n**Line Ending**: [Format - e.g., \"CRLF\"]\n**Header Row**: [Required/Optional]\n**Max File Size**: [Size limit]\n\n<!-- Additional format specifications -->\n\n---\n\n## Transition Architecture\n\nThis section defines the phased approach to migrate from current state to target architecture, showing intermediate architecture states and technical dependencies.\n\n### Transition Principles\n\n1. **[Principle 1]**: [Description - e.g., \"No Big-Bang Migration: Incremental rollout using Strangler Fig pattern\"]\n2. **[Principle 2]**: [Description - e.g., \"Zero Downtime: New services operate in parallel with legacy\"]\n3. **[Principle 3]**: [Description - e.g., \"Feature Flag Control: All new capabilities behind feature flags\"]\n4. **[Principle 4]**: [Description - e.g., \"Data Coexistence: Dual-write during transition period\"]\n5. **[Principle 5]**: [Description - e.g., \"Rollback Capability: Each phase independently reversible\"]\n\n### Architecture States\n\n```mermaid\ngantt\n    title Transition Architecture Timeline\n    dateFormat YYYY-MM\n    section Architecture States\n    AS-0 Current State           :done, as0, [start-date], [end-date]\n    AS-1 [Phase 1 Name]          :active, as1, [start-date], [end-date]\n    AS-2 [Phase 2 Name]          :as2, [start-date], [end-date]\n    AS-3 [Phase 3 Name]          :as3, [start-date], [end-date]\n    AS-4 Target State            :as4, [start-date], [end-date]\n```\n\n### AS-0: Current State (Baseline)\n\n**Description**: [Description of current architecture state]\n\n**Active Components**:\n- [Component 1]: [Current state description]\n- [Component 2]: [Current state description]\n\n**Technical Debt**: [Key technical debt items]\n\n---\n\n### AS-1: [Phase 1 Name] ([Timeframe])\n\n**Description**: [What this phase establishes]\n\n**New SBBs Deployed**:\n- [SBB-XXX]: [Component Name]\n- [SBB-XXX]: [Component Name]\n\n**Migration Activities**:\n- **[Activity 1]**: [Description]\n- **[Activity 2]**: [Description]\n\n**Feature Flags**:\n- `[FeatureFlag.Name]` = [value] ([scope - e.g., \"pilot users only\"])\n\n**Architecture Diagram**:\n\n```\n[Simple text diagram showing components and relationships]\n```\n\n**Success Criteria**:\n- [Criterion 1 with specific metric]\n- [Criterion 2 with specific metric]\n\n**Dependencies**:\n- [Dependency 1] (external/internal dependency)\n- [Dependency 2] (external/internal dependency)\n\n**Rollback**: [Rollback procedure]\n\n<!-- Repeat for AS-2, AS-3, AS-4 -->\n\n### Technical Dependency Graph\n\n```mermaid\ngraph TD\n    A[AS-1: [Phase 1]] --> B[AS-2: [Phase 2]]\n    B --> C[AS-3: [Phase 3]]\n    C --> D[AS-4: Target State]\n\n    A -->|Prerequisite| E[Dependency 1]\n    A -->|Prerequisite| F[Dependency 2]\n\n    B -->|Prerequisite| G[Dependency 3]\n    B -->|Prerequisite| H[Dependency 4]\n```\n\n### Transition Risks\n\n| Risk ID | Risk Description                                      | Mitigation                                                  | Contingency                              |\n| ------- | ----------------------------------------------------- | ----------------------------------------------------------- | ---------------------------------------- |\n| TR-001  | [Risk description]                                    | [Mitigation strategy]                                       | [Contingency plan]                       |\n| TR-002  | [Risk description]                                    | [Mitigation strategy]                                       | [Contingency plan]                       |\n\n---\n\n## Solution Validation\n\nThis section defines how the solution will be validated against requirements defined in the Architecture Definition.\n\n### Functional Validation\n\n**Validation Method**: [Method - e.g., \"Automated API integration tests + UAT scenarios\"]\n\n| Requirement ID | Validation Test                                                      | Acceptance Criteria                                      | Test Environment |\n| -------------- | -------------------------------------------------------------------- | -------------------------------------------------------- | ---------------- |\n| BR-001         | [Test description]                                                   | [Specific acceptance criteria]                           | UAT              |\n| BR-002         | [Test description]                                                   | [Specific acceptance criteria]                           | UAT              |\n\n### Non-Functional Validation\n\n**Validation Method**: [Method - e.g., \"Load testing (JMeter) + Production monitoring (30-day observation)\"]\n\n| NFR ID  | Validation Test                                    | Acceptance Criteria                                       | Tool/Method                      |\n| ------- | -------------------------------------------------- | --------------------------------------------------------- | -------------------------------- |\n| NFR-001 | [Test description]                                 | [Specific acceptance criteria with metrics]               | [Tool/Method]                    |\n| NFR-002 | [Test description]                                 | [Specific acceptance criteria with metrics]               | [Tool/Method]                    |\n\n### Integration Validation\n\n**Validation Method**: [Method - e.g., \"Contract testing (Pact) + Integration test harness\"]\n\n| Integration Point      | Validation Test                                         | Acceptance Criteria                                  | Method                           |\n| ---------------------- | ------------------------------------------------------- | ---------------------------------------------------- | -------------------------------- |\n| [External System]      | [Test description]                                      | [Acceptance criteria]                                | [Method]                         |\n\n### Security Validation\n\n**Validation Method**: [Method - e.g., \"Penetration testing + Security audit\"]\n\n| Security Control   | Validation Test                                           | Acceptance Criteria                                  | Auditor                          |\n| ------------------ | --------------------------------------------------------- | ---------------------------------------------------- | -------------------------------- |\n| [Control name]     | [Test description]                                        | [Acceptance criteria]                                | [Who validates]                  |\n\n### Validation Exit Criteria\n\n**Phase 1 ([Phase Name]) - Exit to [Next Phase]**:\n- ✅ [Criterion 1 with specific metric]\n- ✅ [Criterion 2 with specific metric]\n- ✅ [Criterion 3 with specific metric]\n\n<!-- Repeat for each phase -->\n\n---\n\n## Technical Reference Specifications\n\nThis section provides detailed technical specifications for external integrations and configuration baselines required for implementation.\n\n### External System Interface Specifications\n\n#### [External System Name] API Specification\n\n**Vendor**: [Vendor Name]\n**Specification Version**: [Version] ([Date])\n**Documentation**: [URL or location]\n\n| Parameter                | Value                                                      |\n| ------------------------ | ---------------------------------------------------------- |\n| **Base URL**             | `https://[domain]/[path]`                                  |\n| **Authentication**       | [Method]                                                   |\n| **Rate Limits**          | [Limits]                                                   |\n| **SLA**                  | [Uptime %, latency target]                                 |\n\n<!-- Repeat for each external system -->\n\n### Configuration Baselines\n\n#### [Technology Component] Configuration\n\n**[Configuration Name]**:\n```json\n{\n  \"parameter1\": \"value\",\n  \"parameter2\": \"value\"\n}\n```\n\n<!-- Repeat for each configuration baseline -->\n\n### Environment Configuration Matrix\n\n| Configuration Item          | DEV                  | TEST                 | UAT                  | PROD                    |\n| --------------------------- | -------------------- | -------------------- | -------------------- | ----------------------- |\n| **[Item 1]**                | [Value]              | [Value]              | [Value]              | [Value]                 |\n| **[Item 2]**                | [Value]              | [Value]              | [Value]              | [Value]                 |\n\n### Reference Documents\n\n| Document Title                          | Version | Owner          | Location                                    |\n| --------------------------------------- | ------- | -------------- | ------------------------------------------- |\n| [Document name]                         | [Ver]   | [Owner]        | [URL or location]                           |\n\n---\n\n## Template Usage Notes\n\n### Before Finalization\n\n1. Remove all instructional text (like this section)\n2. Replace all placeholders with actual values\n3. Ensure all SBB mappings trace back to ABBs in Architecture Definition\n4. Verify all NFR validations reference Architecture Definition NFR IDs\n5. Confirm deployment architecture aligns with infrastructure constraints\n6. Validate interface specifications match Architecture Definition integration patterns\n7. Check transition architecture phases have clear success criteria\n8. Ensure external system specifications are current and verified\n\n### Document Maintenance\n\n- Update when technology selections change\n- Revise when Architecture Definition is updated\n- Keep interface specifications synchronized with actual implementations\n- Update transition architecture as phases complete\n- Maintain version history for audit trail\n","numLines":703,"startLine":1,"totalLines":703}}}
{"parentUuid":"5609a996-cf8a-4e88-a481-f7b095b45762","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (36843 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_01LhqWXyPrvAWuTYUknKiAEt"}]},"uuid":"51c77121-ed64-4255-ad8b-29e85b6fd71a","timestamp":"2026-01-07T01:19:59.380Z","toolUseResult":"Error: File content (36843 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content."}
{"parentUuid":"51c77121-ed64-4255-ad8b-29e85b6fd71a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0161e66tC14VCdEx2YefxSeX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The Flybuys document is very large. Let me read just the beginning portion to understand the structure and content.","signature":"EpwCCkYICxgCKkDnDfV5DrHQT2R/xzvKqiz/jVroPWg8VD97jWaFaDcKPq1huuYlFtQ9mUeJLa48K2jjR2I2v9YuYP2hSNZeg6nxEgy9goFGgNEtyVbc2cgaDO3mhqEyAz4TknqqKCIwMpsbg+gfhjXgpiUb2b6lVSWAv86qKDHURkWwpoMOdy+waXp1WQx6xKk/K5Q8Vv6qKoMBcaBT3pvRoE3gAyiJJlzkZAJjomzr3rNSZv+g/+AJdTybf5IOUNZqXy1VeuUVOQESekknqb/je2/3k+0rIPyKt2Wv1AaHIdqdzHULBGznHlArYlViP+BIiE0JhJeCubeXOb1yCCJb57F+r51CfjsLYVKp8o07JSI0uiOIXTUA5yTWOqUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":10622,"cache_read_input_tokens":27550,"cache_creation":{"ephemeral_5m_input_tokens":10622,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWs91SFoLLAwJYc1R39h3","type":"assistant","uuid":"7c6b0b22-6750-4497-91e1-fb32bacfdcb4","timestamp":"2026-01-07T01:20:04.166Z"}
{"parentUuid":"7c6b0b22-6750-4497-91e1-fb32bacfdcb4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0161e66tC14VCdEx2YefxSeX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CdsReFLJ516yWeUnsJqaLu","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/flybuys_integration.adoc","offset":1,"limit":200}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":10622,"cache_read_input_tokens":27550,"cache_creation":{"ephemeral_5m_input_tokens":10622,"ephemeral_1h_input_tokens":0},"output_tokens":146,"service_tier":"standard"}},"requestId":"req_011CWs91SFoLLAwJYc1R39h3","type":"assistant","uuid":"4b30086a-4d73-401b-851e-308e0a625cb1","timestamp":"2026-01-07T01:20:05.194Z"}
{"parentUuid":"4b30086a-4d73-401b-851e-308e0a625cb1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CdsReFLJ516yWeUnsJqaLu","type":"tool_result","content":"     1→= Flybuys Integration - Architecture Definition\n     2→:project-name: Flybuys Integration\n     3→:togaf-adm-phase: Phase C: Information Systems Architectures\n     4→:document-type: Architecture Definition Document\n     5→:status: Discovery\n     6→:version: 0.1\n     7→:domain: Loyalty\n     8→:programme-lead: Frankie.Mullaly@vivaenergy.com.au\n     9→:domain-architect: O.Young@otr.com.au\n    10→:business-owner: D.Peisley@otr.com.au\n    11→:business-analyst: Fiona.Cheung@vivaenergy.com.au\n    12→:solution-architecture: link:/solution_architectures/flybuys_integration.adoc[Solution Architectures/Flybuys Integration]\n    13→:doctype: article\n    14→:toc: left\n    15→:toclevels: 4\n    16→:sectanchors:\n    17→:sectlinks:\n    18→:sectnums:\n    19→:icons: font\n    20→:source-highlighter: highlightjs\n    21→:experimental:\n    22→:description: Architecture Definition Document for Flybuys Coalition Loyalty Integration\n    23→:keywords: loyalty, flybuys, integration, architecture-definition, togaf, ddd\n    24→\n    25→== Introduction & Vision\n    26→\n    27→=== Purpose\n    28→\n    29→OTR and Reddy Express customers experience fragmented loyalty programmes across the OTRG store network. REXP stores use manual Flybuys batch processing, OTR stores offer native rewards, and no digital coalition partner linking exists. This limits customer choice, creates operational overhead, and constrains competitive positioning against national chains with integrated loyalty programmes.\n    30→\n    31→=== Vision\n    32→\n    33→> Enable customers to seamlessly link coalition loyalty partners via mobile app, select their reward preference, and earn partner points at any OTR/REXP store—while maintaining architectural flexibility to evolve OTR’s native loyalty capability independently.\n    34→\n    35→=== Architectural Approach\n    36→\n    37→This architecture introduces three bounded contexts (link:../bounded_context/profile.adoc[Profile Service], link:../bounded_context/loyalty.adoc[Loyalty Service], link:../bounded_context/engagement.adoc[Engagement Service]) implementing Domain-Driven Design patterns:\n    38→\n    39→* *link:../bounded_context/profile.adoc[Profile Service]*: Partner account linking (OAuth 2.0), reward preference management, canonical customer identity (VCI)\n    40→* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Transaction adjudication, credential resolution, partner integration facade, automated batch posting\n    41→* *link:../bounded_context/engagement.adoc[Engagement Service]*: Customer engagement campaigns, notification orchestration, Braze Anti-Corruption Layer\n    42→* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n    43→* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys], link:../bounded_context/external/microsoft_dynamics_365_commerce.adoc[D365 Commerce])\n    44→* *Phased rollout*: Parallel deployment alongside legacy link:../bounded_context/interfaces/otr_app_api.adoc[OTR App API] with feature flag-controlled gradual enablement (link:#AS-1_Foundation[AS-1 Foundation] → link:#AS-2_Linking[AS-2 Linking] → link:#AS-3_Grants[AS-3 Grants]) The link:../bounded_context/profile.adoc[Profile Service] also serves as a facade for link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] integration to link:../bounded_context/external/salesforce_crm.adoc[Salesforce CRM] before the #Highlander programme.\n    45→\n    46→=== Architecture Overview\n    47→\n    48→The following diagram shows the target state architecture with three new bounded contexts (Profile Service, Loyalty Service, Engagement Service) integrating with existing systems:\n    49→\n    50→[mermaid]\n    51→----\n    52→---\n    53→layout: elk\n    54→---\n    55→flowchart LR\n    56→    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    57→    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    58→    Customer -- Receives --> EngagementService[\"Engagement Service<br>Campaign Triggers<br>Customer Notifications<br>Braze Integration\"]\n    59→    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra<br>External ID<br>CIAM\"]\n    60→    MobileApp -- \"Link Partner Account<br>OAuth 2.0 + PKCE\" --> ProfileService[\"Profile Service<br>Partner Account Linking<br>Reward Preferences\"]\n    61→    MobileApp -- Get Partner Links<br>Update Preferences --> ProfileService\n    62→    MobileApp -- Query Flybuys Balance<br>via ACL --> LoyaltyService[\"Loyalty Service<br>Transaction Adjudication<br>Credential Resolution<br>Batch Processing\"]\n    63→    POS -- Scan Loyalty Credential<br>Resolve to VCI --> LoyaltyService\n    64→    POS -- \"Transaction Adjudication<br>Real-time &lt;500ms\" --> LoyaltyService\n    65→    ProfileService -- \"Store OAuth Tokens<br>AES-256 Encrypted\" --> OAuthService[\"OAuth Service<br>Token Management\"]\n    66→    ProfileService -- Query Customer Profile<br>Conformist --> Salesforce[\"Salesforce CRM<br>Customer Profile<br>System of Record\"]\n    67→    ProfileService -- Publish Events<br>PartnerLinked<br>RewardPreferenceChanged --> EventBus[(\"Event Bus<br>Domain Events\")]\n    68→    LoyaltyService -- Transaction Adjudication<br>via ACL --> EagleEye[\"EagleEye<br>Loyalty Engine<br>Points, Offers, Wallet\"]\n    69→    LoyaltyService -- Query Wallet/Points/Tiers<br>via ACL --> EagleEye\n    70→    LoyaltyService -- Nightly Batch SFTP<br>PGP Encrypted --> Flybuys[\"Flybuys<br>Coalition Partner<br>OAuth, SFTP\"]\n    71→    LoyaltyService -- OAuth Balance Query<br>via ACL --> Flybuys\n    72→    LoyaltyService -- Query Reward Preference<br>REST API --> ProfileService\n    73→    LoyaltyService -- Publish Events<br>TransactionAdjudicated<br>PointsEarned --> EventBus\n    74→    EngagementService -- Consume Events<br>PartnerLinked<br>TransactionAdjudicated<br>PointsEarned --> EventBus\n    75→    EngagementService -- Trigger Campaigns<br>Push Notifications<br>via ACL --> Braze[\"Braze<br>Marketing Automation<br>Webhooks\"]\n    76→    EngagementService -- Query Customer Profile<br>Conformist --> Salesforce\n    77→    OAuthService -- OAuth Token Exchange<br>Authorization Code Flow --> Flybuys\n    78→\n    79→     Customer:::customer\n    80→     MobileApp:::presentation\n    81→     POS:::presentation\n    82→     EngagementService:::newService\n    83→     EntraID:::external\n    84→     ProfileService:::newService\n    85→     LoyaltyService:::newService\n    86→     OAuthService:::infrastructure\n    87→     Salesforce:::external\n    88→     EventBus:::infrastructure\n    89→     EagleEye:::external\n    90→     Flybuys:::external\n    91→     Braze:::external\n    92→    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    93→    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    94→    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    95→    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    96→    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n    97→----\n    98→\n    99→==== Key Architectural Patterns\n   100→\n   101→[width=\"100%\",cols=\"19%,34%,47%\",options=\"header\",]\n   102→|===\n   103→|Pattern | Application | Rationale\n   104→|*Anti-Corruption Layer (ACL)* | LoyaltyService → EagleEye, FlybuysEngagementService → Braze | Isolates domain model from external system changes, translates between bounded contexts\n   105→|*Customer-Supplier + Conformist* | ProfileService → SalesforceEngagementService → Salesforce | We conform to Salesforce API (external system we don’t control)\n   106→|*Backend-for-Frontend (BFF)* | LoyaltyService | Orchestrates multiple backend systems (EagleEye, ProfileService) for POS/Mobile clients\n   107→|*Event-Driven Architecture* | Event Bus (OHS+PL) | Loose coupling between bounded contexts, asynchronous notification of domain events\n   108→|*Event Consumer* | EngagementService | Consumes domain events from Profile and Loyalty contexts to trigger customer campaigns\n   109→|*OAuth 2.0 + PKCE* | ProfileService → Flybuys | Secure partner account linking without storing passwords\n   110→|*Strangler Fig* | Parallel deployment with feature flags | Gradual migration to new bounded contexts\n   111→|===\n   112→\n   113→== Technical Requirements\n   114→\n   115→[width=\"100%\",cols=\"4%,96%\",options=\"header\",]\n   116→|===\n   117→|ID | Description\n   118→|TR-001 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Salesforce%2520Contact[Salesforce Contact] record in link:../bounded_context/external/salesforce_crm.adoc[Salesforce CRM]\n   119→|TR-002 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI] part of their link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n   120→|TR-003 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Wallet[Loyalty Wallet] part of their link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n   121→|TR-004 | link:../ubiquitous_language.adoc#Customer[Customers] have a single set of link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n   122→|TR-005 | link:../ubiquitous_language.adoc#Customer[Customers] are able to link and unlink their link:../ubiquitous_language.adoc#Flybuys%2520Digital%2520Identity[Flybuys Digital Identity] from any link:../bounded_context/interfaces/mobile.adoc[Mobile Application]\n   123→|TR-006 | link:../ubiquitous_language.adoc#Customer[Customers] can manage their link:../ubiquitous_language.adoc#Reward%2520Preference[Reward Preference] (select and retain preference)\n   124→|TR-007 | link:../bounded_context/external/flybuys.adoc[Flybuys] link:../ubiquitous_language.adoc#Partner[Partner] transactions are posted to link:../bounded_context/external/flybuys.adoc[Flybuys] for points allocation to link:../ubiquitous_language.adoc#Flybuys%2520Earning%2520Rules[Earning Rules]\n   125→|TR-008 | link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] stores recognise all link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials] and grant Flybuys Points on fulfilled Transactions where a Customer has a linked Flybuys Digital Identity\n   126→|TR-009 | link:../bounded_context/interfaces/otr_plus_pos.adoc[OTR+ POS] stores recognise all link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials] and grant Flybuys Points on fulfilled Transactions where a Customer has a linked Flybuys Digital Identity\n   127→|TR-010 | link:../ubiquitous_language.adoc#Customer[Customers] can retrieve their link:../bounded_context/external/flybuys.adoc[Flybuys] points balance in real-time within any link:../bounded_context/interfaces/mobile.adoc[Mobile Application]\n   128→|[line-through]*TR-011* |[line-through]*link:../bounded_context/external/flybuys.adoc[Flybuys] link:../ubiquitous_language.adoc#Digital%2520Fuel%2520Dockets[Digital Fuel Dockets] are redeemable at link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] and link:../bounded_context/interfaces/otr_plus_pos.adoc[OTR+ POS]*\n   129→|TR-012 | All transactions by link:../ubiquitous_language.adoc#Loyalty%2520Credential[Credentialed] link:../ubiquitous_language.adoc#Customer[Customers] through any channel are adjudicated by link:../bounded_context/external/eagle_eye.adoc[EagleEye]\n   130→|TR-013 | Web and Mobile Clients geographically show which Loyalty programmes are available at each store\n   131→|TR-014 | All changes are communicated using a decoupled event-based architecture\n   132→|TR-015 | ==Reporting==\n   133→|TR-016 | ==Customer Service==\n   134→|===\n   135→\n   136→=== Technical Requirements Mapping\n   137→\n   138→[cols=\",\",options=\"header\",]\n   139→|===\n   140→|Business Requirement | Technical Requirement\n   141→|LNKHL_001 | TR-005\n   142→|LNKHL_002 | TR-005\n   143→|LNKHL_003 | TR-004\n   144→|LNKHL_004 | TR-005\n   145→|LNKHL_005 | TR-005\n   146→|LNKHL_006 | TR-014\n   147→|LNKHL_007 | TR-014\n   148→|LNKHL_008 | TR-014\n   149→|LNKHL_009 | TR-014\n   150→|NTWHL_001 | TR-012\n   151→|NTWHL_002 | TR-012\n   152→|NTWHL_003 | TR-013\n   153→|NTWHL_003 | TR-013\n   154→|PEHL_001 | TR-012\n   155→|PEHL_002 |\n   156→|PEHL_003 | TR-010\n   157→|PEHL_004 | TR-012\n   158→|INAHL_001 | TR-008 TR-009\n   159→|INAHL_002 | TR-008 TR-009\n   160→|INAHL_003 | TR-008 TR-009\n   161→|INAHL_004 | TR-008 TR-009\n   162→|INAHL_005 | TR-008 TR-009\n   163→|INAHL_006 | TR-008 TR-009\n   164→|INSHL_001 | TR-008 TR-009\n   165→|INSHL_002 | TR-014\n   166→|TCRHL_001 | TR-007\n   167→|TCRHL_002 | TR-015\n   168→|TCRHL_003 | TR-015\n   169→|TCRHL_004 | TR-015\n   170→|TCRHL_005 | TR-015\n   171→|TCRHL_006 | TR-015\n   172→|TCRHL_007 | TR-015\n   173→|CEHL_001 | TR-016\n   174→|CEHL_002 | TR-016\n   175→|CEHL_003 | TR-016\n   176→|===\n   177→\n   178→=== Stakeholder Analysis\n   179→\n   180→[width=\"100%\",cols=\"20%,28%,10%,11%,31%\",options=\"header\",]\n   181→|===\n   182→|Stakeholder | Role | Interest Level | Influence Level | Engagement Strategy\n   183→|Darren Peisley | Business Owner | High | High | Steering, requirements sign-off\n   184→|Amin Joderyi | Mobile Application and Ecommerce Lead | High | High |Collaboration\n   185→|Frankie Mullaly | Programme Lead | High | Medium | Status updates, escalation point\n   186→|Oli Young | Domain Architect | High | High | Collaboration, architecture decisions\n   187→|Fiona Cheung | Business Analyst | Medium | Medium | Requirements gathering, documentation\n   188→|David Le Pham | Product Owner | High | High | Product decisions, prioritisation\n   189→|Paola Buchan | Marketing & Campaigns Lead | High | Medium | Campaign planning, promotional strategy\n   190→|Nick Cannizzo | Project Manager | High | Low | Programme coordination\n   191→|Mobile App Users | End Users | High | Low | Beta testing programme, feedback surveys\n   192→|link:../bounded_context/external/flybuys.adoc[Flybuys] | External Partner |Medium | Medium | Coordination, API support\n   193→|link:../bounded_context/external/eagle_eye.adoc[EagleEye] | SaaS Loyalty Platform Vendor | Medium | Medium | Business reviews, support tickets\n   194→|D365 Team | POS Operations | Medium | Medium | Training sessions, operational readiness\n   195→|Customer Support Team | Support & Troubleshooting | Medium | Low |Training, escalation procedures\n   196→|Fullstack Team | CRM Integration | Low | Low | Integration coordination\n   197→|Platform Infrastructure | Cloud Platform | Low | High | Deployment planning, capacity planning\n   198→|Data Team | Data Integration | Low | Medium | Data pipeline coordination\n   199→|===\n   200→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4a4b8d79-9e76-4aa8-a573-da64ecb99f9f","timestamp":"2026-01-07T01:20:05.471Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/flybuys_integration.adoc","content":"= Flybuys Integration - Architecture Definition\n:project-name: Flybuys Integration\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:domain: Loyalty\n:programme-lead: Frankie.Mullaly@vivaenergy.com.au\n:domain-architect: O.Young@otr.com.au\n:business-owner: D.Peisley@otr.com.au\n:business-analyst: Fiona.Cheung@vivaenergy.com.au\n:solution-architecture: link:/solution_architectures/flybuys_integration.adoc[Solution Architectures/Flybuys Integration]\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description: Architecture Definition Document for Flybuys Coalition Loyalty Integration\n:keywords: loyalty, flybuys, integration, architecture-definition, togaf, ddd\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR and Reddy Express customers experience fragmented loyalty programmes across the OTRG store network. REXP stores use manual Flybuys batch processing, OTR stores offer native rewards, and no digital coalition partner linking exists. This limits customer choice, creates operational overhead, and constrains competitive positioning against national chains with integrated loyalty programmes.\n\n=== Vision\n\n> Enable customers to seamlessly link coalition loyalty partners via mobile app, select their reward preference, and earn partner points at any OTR/REXP store—while maintaining architectural flexibility to evolve OTR’s native loyalty capability independently.\n\n=== Architectural Approach\n\nThis architecture introduces three bounded contexts (link:../bounded_context/profile.adoc[Profile Service], link:../bounded_context/loyalty.adoc[Loyalty Service], link:../bounded_context/engagement.adoc[Engagement Service]) implementing Domain-Driven Design patterns:\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: Partner account linking (OAuth 2.0), reward preference management, canonical customer identity (VCI)\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Transaction adjudication, credential resolution, partner integration facade, automated batch posting\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: Customer engagement campaigns, notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys], link:../bounded_context/external/microsoft_dynamics_365_commerce.adoc[D365 Commerce])\n* *Phased rollout*: Parallel deployment alongside legacy link:../bounded_context/interfaces/otr_app_api.adoc[OTR App API] with feature flag-controlled gradual enablement (link:#AS-1_Foundation[AS-1 Foundation] → link:#AS-2_Linking[AS-2 Linking] → link:#AS-3_Grants[AS-3 Grants]) The link:../bounded_context/profile.adoc[Profile Service] also serves as a facade for link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] integration to link:../bounded_context/external/salesforce_crm.adoc[Salesforce CRM] before the #Highlander programme.\n\n=== Architecture Overview\n\nThe following diagram shows the target state architecture with three new bounded contexts (Profile Service, Loyalty Service, Engagement Service) integrating with existing systems:\n\n[mermaid]\n----\n---\nlayout: elk\n---\nflowchart LR\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    Customer -- Receives --> EngagementService[\"Engagement Service<br>Campaign Triggers<br>Customer Notifications<br>Braze Integration\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra<br>External ID<br>CIAM\"]\n    MobileApp -- \"Link Partner Account<br>OAuth 2.0 + PKCE\" --> ProfileService[\"Profile Service<br>Partner Account Linking<br>Reward Preferences\"]\n    MobileApp -- Get Partner Links<br>Update Preferences --> ProfileService\n    MobileApp -- Query Flybuys Balance<br>via ACL --> LoyaltyService[\"Loyalty Service<br>Transaction Adjudication<br>Credential Resolution<br>Batch Processing\"]\n    POS -- Scan Loyalty Credential<br>Resolve to VCI --> LoyaltyService\n    POS -- \"Transaction Adjudication<br>Real-time &lt;500ms\" --> LoyaltyService\n    ProfileService -- \"Store OAuth Tokens<br>AES-256 Encrypted\" --> OAuthService[\"OAuth Service<br>Token Management\"]\n    ProfileService -- Query Customer Profile<br>Conformist --> Salesforce[\"Salesforce CRM<br>Customer Profile<br>System of Record\"]\n    ProfileService -- Publish Events<br>PartnerLinked<br>RewardPreferenceChanged --> EventBus[(\"Event Bus<br>Domain Events\")]\n    LoyaltyService -- Transaction Adjudication<br>via ACL --> EagleEye[\"EagleEye<br>Loyalty Engine<br>Points, Offers, Wallet\"]\n    LoyaltyService -- Query Wallet/Points/Tiers<br>via ACL --> EagleEye\n    LoyaltyService -- Nightly Batch SFTP<br>PGP Encrypted --> Flybuys[\"Flybuys<br>Coalition Partner<br>OAuth, SFTP\"]\n    LoyaltyService -- OAuth Balance Query<br>via ACL --> Flybuys\n    LoyaltyService -- Query Reward Preference<br>REST API --> ProfileService\n    LoyaltyService -- Publish Events<br>TransactionAdjudicated<br>PointsEarned --> EventBus\n    EngagementService -- Consume Events<br>PartnerLinked<br>TransactionAdjudicated<br>PointsEarned --> EventBus\n    EngagementService -- Trigger Campaigns<br>Push Notifications<br>via ACL --> Braze[\"Braze<br>Marketing Automation<br>Webhooks\"]\n    EngagementService -- Query Customer Profile<br>Conformist --> Salesforce\n    OAuthService -- OAuth Token Exchange<br>Authorization Code Flow --> Flybuys\n\n     Customer:::customer\n     MobileApp:::presentation\n     POS:::presentation\n     EngagementService:::newService\n     EntraID:::external\n     ProfileService:::newService\n     LoyaltyService:::newService\n     OAuthService:::infrastructure\n     Salesforce:::external\n     EventBus:::infrastructure\n     EagleEye:::external\n     Flybuys:::external\n     Braze:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"19%,34%,47%\",options=\"header\",]\n|===\n|Pattern | Application | Rationale\n|*Anti-Corruption Layer (ACL)* | LoyaltyService → EagleEye, FlybuysEngagementService → Braze | Isolates domain model from external system changes, translates between bounded contexts\n|*Customer-Supplier + Conformist* | ProfileService → SalesforceEngagementService → Salesforce | We conform to Salesforce API (external system we don’t control)\n|*Backend-for-Frontend (BFF)* | LoyaltyService | Orchestrates multiple backend systems (EagleEye, ProfileService) for POS/Mobile clients\n|*Event-Driven Architecture* | Event Bus (OHS+PL) | Loose coupling between bounded contexts, asynchronous notification of domain events\n|*Event Consumer* | EngagementService | Consumes domain events from Profile and Loyalty contexts to trigger customer campaigns\n|*OAuth 2.0 + PKCE* | ProfileService → Flybuys | Secure partner account linking without storing passwords\n|*Strangler Fig* | Parallel deployment with feature flags | Gradual migration to new bounded contexts\n|===\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"4%,96%\",options=\"header\",]\n|===\n|ID | Description\n|TR-001 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Salesforce%2520Contact[Salesforce Contact] record in link:../bounded_context/external/salesforce_crm.adoc[Salesforce CRM]\n|TR-002 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI] part of their link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n|TR-003 | Every link:../bounded_context/interfaces/mobile.adoc[Mobile Application] user has a link:../ubiquitous_language.adoc#Wallet[Loyalty Wallet] part of their link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n|TR-004 | link:../ubiquitous_language.adoc#Customer[Customers] have a single set of link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials]\n|TR-005 | link:../ubiquitous_language.adoc#Customer[Customers] are able to link and unlink their link:../ubiquitous_language.adoc#Flybuys%2520Digital%2520Identity[Flybuys Digital Identity] from any link:../bounded_context/interfaces/mobile.adoc[Mobile Application]\n|TR-006 | link:../ubiquitous_language.adoc#Customer[Customers] can manage their link:../ubiquitous_language.adoc#Reward%2520Preference[Reward Preference] (select and retain preference)\n|TR-007 | link:../bounded_context/external/flybuys.adoc[Flybuys] link:../ubiquitous_language.adoc#Partner[Partner] transactions are posted to link:../bounded_context/external/flybuys.adoc[Flybuys] for points allocation to link:../ubiquitous_language.adoc#Flybuys%2520Earning%2520Rules[Earning Rules]\n|TR-008 | link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] stores recognise all link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials] and grant Flybuys Points on fulfilled Transactions where a Customer has a linked Flybuys Digital Identity\n|TR-009 | link:../bounded_context/interfaces/otr_plus_pos.adoc[OTR+ POS] stores recognise all link:../ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credentials] and grant Flybuys Points on fulfilled Transactions where a Customer has a linked Flybuys Digital Identity\n|TR-010 | link:../ubiquitous_language.adoc#Customer[Customers] can retrieve their link:../bounded_context/external/flybuys.adoc[Flybuys] points balance in real-time within any link:../bounded_context/interfaces/mobile.adoc[Mobile Application]\n|[line-through]*TR-011* |[line-through]*link:../bounded_context/external/flybuys.adoc[Flybuys] link:../ubiquitous_language.adoc#Digital%2520Fuel%2520Dockets[Digital Fuel Dockets] are redeemable at link:../bounded_context/interfaces/otr_pos.adoc[OTR POS] and link:../bounded_context/interfaces/otr_plus_pos.adoc[OTR+ POS]*\n|TR-012 | All transactions by link:../ubiquitous_language.adoc#Loyalty%2520Credential[Credentialed] link:../ubiquitous_language.adoc#Customer[Customers] through any channel are adjudicated by link:../bounded_context/external/eagle_eye.adoc[EagleEye]\n|TR-013 | Web and Mobile Clients geographically show which Loyalty programmes are available at each store\n|TR-014 | All changes are communicated using a decoupled event-based architecture\n|TR-015 | ==Reporting==\n|TR-016 | ==Customer Service==\n|===\n\n=== Technical Requirements Mapping\n\n[cols=\",\",options=\"header\",]\n|===\n|Business Requirement | Technical Requirement\n|LNKHL_001 | TR-005\n|LNKHL_002 | TR-005\n|LNKHL_003 | TR-004\n|LNKHL_004 | TR-005\n|LNKHL_005 | TR-005\n|LNKHL_006 | TR-014\n|LNKHL_007 | TR-014\n|LNKHL_008 | TR-014\n|LNKHL_009 | TR-014\n|NTWHL_001 | TR-012\n|NTWHL_002 | TR-012\n|NTWHL_003 | TR-013\n|NTWHL_003 | TR-013\n|PEHL_001 | TR-012\n|PEHL_002 |\n|PEHL_003 | TR-010\n|PEHL_004 | TR-012\n|INAHL_001 | TR-008 TR-009\n|INAHL_002 | TR-008 TR-009\n|INAHL_003 | TR-008 TR-009\n|INAHL_004 | TR-008 TR-009\n|INAHL_005 | TR-008 TR-009\n|INAHL_006 | TR-008 TR-009\n|INSHL_001 | TR-008 TR-009\n|INSHL_002 | TR-014\n|TCRHL_001 | TR-007\n|TCRHL_002 | TR-015\n|TCRHL_003 | TR-015\n|TCRHL_004 | TR-015\n|TCRHL_005 | TR-015\n|TCRHL_006 | TR-015\n|TCRHL_007 | TR-015\n|CEHL_001 | TR-016\n|CEHL_002 | TR-016\n|CEHL_003 | TR-016\n|===\n\n=== Stakeholder Analysis\n\n[width=\"100%\",cols=\"20%,28%,10%,11%,31%\",options=\"header\",]\n|===\n|Stakeholder | Role | Interest Level | Influence Level | Engagement Strategy\n|Darren Peisley | Business Owner | High | High | Steering, requirements sign-off\n|Amin Joderyi | Mobile Application and Ecommerce Lead | High | High |Collaboration\n|Frankie Mullaly | Programme Lead | High | Medium | Status updates, escalation point\n|Oli Young | Domain Architect | High | High | Collaboration, architecture decisions\n|Fiona Cheung | Business Analyst | Medium | Medium | Requirements gathering, documentation\n|David Le Pham | Product Owner | High | High | Product decisions, prioritisation\n|Paola Buchan | Marketing & Campaigns Lead | High | Medium | Campaign planning, promotional strategy\n|Nick Cannizzo | Project Manager | High | Low | Programme coordination\n|Mobile App Users | End Users | High | Low | Beta testing programme, feedback surveys\n|link:../bounded_context/external/flybuys.adoc[Flybuys] | External Partner |Medium | Medium | Coordination, API support\n|link:../bounded_context/external/eagle_eye.adoc[EagleEye] | SaaS Loyalty Platform Vendor | Medium | Medium | Business reviews, support tickets\n|D365 Team | POS Operations | Medium | Medium | Training sessions, operational readiness\n|Customer Support Team | Support & Troubleshooting | Medium | Low |Training, escalation procedures\n|Fullstack Team | CRM Integration | Low | Low | Integration coordination\n|Platform Infrastructure | Cloud Platform | Low | High | Deployment planning, capacity planning\n|Data Team | Data Integration | Low | Medium | Data pipeline coordination\n|===\n","numLines":200,"startLine":1,"totalLines":2722}}}
{"parentUuid":"4a4b8d79-9e76-4aa8-a573-da64ecb99f9f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017hW9DykmuGeWwcDr6L7Y4o","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a good understanding:\n\n1. The user has started a Salesforce Customer Support architecture definition document in AsciiDoc\n2. They have a template to follow (`solution_architecture_template.adoc`)\n3. They have a completed example (Flybuys Integration) that shows how to structure a comprehensive architecture document\n4. The current Salesforce document has the basic outline but needs to be filled in\n\nThe user is asking for help writing this up. I should:\n1. Understand what they need help with specifically\n2. Help them complete the sections based on the template\n3. Ensure consistency with the DDD architecture approach shown in the repository\n\nLet me ask the user what specific help they need since this is a large document with many sections to complete.","signature":"EqEHCkYICxgCKkAxVsJ9zPr6QNEzqt6py3GIIj3r9ZOMwR+OcfUsmV4Brlg2QNTxvJ/oxMW6Vro3BtcHc84BFd1H6NzgKNQB6qeXEgwHnH0WPw5LMwJTRoQaDJwEMv1AjP1EeTMf5SIwapUA2qGkpzzFxohJ5wUoWFuKnX8l1VXNh0EU8HILJOXKRTEwentMmjN/iPrcZ9QLKogGfE6ara/yzeqXrSIoyY394LhvBiVBTBP+gfYzvxSWofepDsgjK7IZuZorW0ohdFsA7LEQmAbQkQE2GsltdbU7JUSOOxnH/ayJCMA0nGj66nRB8SSvI6tvvyUf9Prsy/Gpfk1Z9UL91EeQTIxm17vNumelk7OFTISsUTgnO5Mp8ctIOdx1B1Rk6jS0o+gR/6TfmZ59xiQ1weaWUnAjeYPSp984/zHMbo+VMF8EILMgBo76faEmihNMEQTCmqZQnwQRAqSDNsCSXemBYUTi/xDxeUbsmLT++U95QC6wmLUoUtTATK5RkKwbJ/lrq4hfvbmVUHO3cnBcFz5EKQEMmqDXLa76fvmIqE83NXFKbW9Bo3q1/EBnPJ3+LNe4r/zlI+I55x0jysxfrs3C1fMnDy/lCwDMbPdjfgn1vwPVExV89q77UjAoObTJc9WQND8qEVQ0B2AGANwQKHc898j0Kxiv1eDaJ0XaE8Ia9ANSPOmddy67wbO2ddBLhf/DxoJxsTUKDCov+rUAJ3hNiS84wq0Hf14QWa+lVgu8V8yi5UeQVDULVDxYfwM1RTUA2gkjjd2YXgpCrFPIT/KodDSMVsztuL49mxmCD5n6M5HjWiRFN8Zy5LUt/yRE+gBoyVGk2WPcaNlWsc0Zh2DTJQGMjuqDsI4JZ7vYDqhPgik/PRW4qTdi5OB/vUBpnBpD2qCqQoktoKi1hm5dzaDW/UxW2XFG4Wx4n5JBhR++oe5W7TkjFS1DNW+aQ75uMglPthIh8RZDAOj2/66ovPjXtqfZ+6ONc/V4mZSfwzDjgZVP9wksZb2SmOeSR/leIpeKhLBNHhSTXOAdMQH1ABMoumgf0/pX3XLcn36EBjD7Sv5/3VYSRmXtYD+FBqueMf3jKZ1Wz+FgMe40SGBz/mdospDxpb0kZXwkn1NIsfRXWAnQRSBFwCTWQJ6KqZLXr2ktiq2lUC+difUyTLd/FURTwv3EM8hURN/Axq6TrHg5wl0KTdK5R+na1AMj1XDAhzBOwUyhgnEhaavZdyOzydoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":5229,"cache_read_input_tokens":38172,"cache_creation":{"ephemeral_5m_input_tokens":5229,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWs91tKD8nB9x19pqcuVP","type":"assistant","uuid":"5c8d08bc-dce7-4f52-aff1-8de2e99d71d3","timestamp":"2026-01-07T01:20:15.025Z"}
{"parentUuid":"5c8d08bc-dce7-4f52-aff1-8de2e99d71d3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017hW9DykmuGeWwcDr6L7Y4o","type":"message","role":"assistant","content":[{"type":"text","text":"I can see you've started the Salesforce Customer Support architecture definition document with a good outline. You have the template and the Flybuys Integration example to reference.\n\nWhat specific aspect of the document would you like help with? For example:\n\n**High-priority sections** that define the architecture:\n- **Executive Summary** - Challenge, solution approach, key decisions\n- **Technical Requirements** - Specific requirements and mapping to business requirements\n- **Baseline Architecture** - Current D365 CE state\n- **Gap Analysis** - What's missing, what needs to be built\n- **Target State Architecture** - The TO-BE architecture with bounded contexts\n- **Architecture Decisions** - ADRs for key technical decisions\n- **Migration Strategy** - Phased approach to migrate from D365 CE to Salesforce\n\n**Supporting sections**:\n- Data Entity Catalogue\n- Integration Architecture details\n- Technical Risks\n- Non-Functional Requirements\n\nWhich sections would you like to focus on first? Or would you prefer I help you work through the document systematically from top to bottom?\n\nAlso, to better understand the context:\n- What's the current state with D365 Customer Engagement (what capabilities does it provide)?\n- What specific Salesforce product are you migrating to (Service Cloud, Sales Cloud)?\n- What are the primary use cases (case management, customer feedback, both)?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":5229,"cache_read_input_tokens":38172,"cache_creation":{"ephemeral_5m_input_tokens":5229,"ephemeral_1h_input_tokens":0},"output_tokens":477,"service_tier":"standard"}},"requestId":"req_011CWs91tKD8nB9x19pqcuVP","type":"assistant","uuid":"2c372cfd-1276-4188-bb86-061ff8adc70e","timestamp":"2026-01-07T01:20:23.350Z"}
{"type":"file-history-snapshot","messageId":"c15a0dd0-be49-4dee-9fab-d4af81cccd80","snapshot":{"messageId":"c15a0dd0-be49-4dee-9fab-d4af81cccd80","trackedFileBackups":{},"timestamp":"2026-01-07T01:21:16.573Z"},"isSnapshotUpdate":false}
{"parentUuid":"2c372cfd-1276-4188-bb86-061ff8adc70e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Current state is irrelevant since we're deprecating it"},"uuid":"c15a0dd0-be49-4dee-9fab-d4af81cccd80","timestamp":"2026-01-07T01:21:16.540Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"c15a0dd0-be49-4dee-9fab-d4af81cccd80","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019a72e2ceJwN7n6krhz58G4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying the current state (D365 CE) is irrelevant since they're deprecating it. This suggests they want to focus on the target state architecture rather than spending time documenting the baseline.\n\nHowever, from a TOGAF perspective and the template, there are sections for:\n- Baseline Architecture (current state)\n- Gap Analysis\n- Migration Strategy\n\nThe user might want to:\n1. Skip or minimize the baseline documentation\n2. Focus on the target state architecture\n3. Define the migration strategy to move away from D365 CE\n\nLet me ask what they want to focus on, since they're writing this document. I should help them understand what's important vs what can be minimized.\n\nLooking at the document they've started:\n- They have the intro and vision done\n- They have the architecture overview diagram done (showing the new services)\n- Many sections are empty placeholders\n\nI should help them understand that even if D365 CE is being deprecated, they may need:\n1. A minimal baseline section (what capabilities are being replaced)\n2. Gap analysis (what new capabilities are needed)\n3. Migration strategy (how to transition)\n4. Data migration (what data needs to move from D365 CE to Salesforce)\n\nBut if they truly want to skip that, I should help them focus on what matters: the target state and how it works.\n\nLet me ask a clarifying question about what they want to tackle.","signature":"EoUMCkYICxgCKkAUho0L3gzQrqHTADMr4YtowexNPRTLezWCI5Ys+mg+r8/ImYnVT6VBdTxuhSF88y7IJhwQJ7uy9GmezBPNozWEEgy9efiggYRhZf7iRAkaDIdM+sgjPQojDB7AFyIwh8/7xaAkRvRbKPRAN+B7PJBVTyg30gqNtmBsEJ39q+nUBVPNM/Vk6crgFfRrb9PkKuwKQAcCGnemjXtjFChB2bjOzKyHHZHvieralcWhy7mCKNEPDyYXhidNzX4MD89mVZIm4ta472llhhT5iLOKLKluCKnZStZZSAMWnOJSPvbtJFtlduDNs4a7QxJ+8CqvpyFVrqybqgJIKueiXzPaPTYAGKMc1GUMSLvXSyLI/JS23fF87ESFj7Qf/LimWIgOkwSsD3IS7+6rk/0NJY94WRLP7Rygd5wuPhzd+yFh8mOVbghqMWZ4qpMduTmpN9kissAON0rEAI1ZBHhYKLKGxJxv+ZnAzXjg2V0nRDkZaZmI24joTYPPnxcY7Wl8NRP7KVIVor3R09+UExotgCYVkMWFWYJe7NEixkEi62IjxuVkrRjQ+P2hjmwgquXhNU03didZve3vcGVOH6lRdRU3RAE5NCsoLLE0ancKsVfx1tLsjUEOoAAxmFYSEkKEQKxZfkfzdvPXz/1yC6tJzG7ugRp/b0Y5/GcIBfGJxyCJc6CXSxjL3Vw5xXpNQMdrS5YXv7Ng41wZkyB08+VuHW30oCq1X6geGE1G2+yv9n7XvVPdlG30ktmEUwFvkbL62v8KWG+WdKKQUbsvyYgK8Y54+zTY9hFvVktogzMBmbusOkGj9blEiyQo3qBlKCAVhpya1WcXZfsWmpQrHt4/aLYB5UJzGitpXKuLcjwJ4zJARkjRYiZrqtiul8oAOJsrmK9dvzwCxiyGf1Wb51fSMVV1/EHJRtBNxwclHOzmRFhFj8CNASceQYkMr0nwmZd5rHXySvkor+z/ONI+Q+Y5d6J8pRupYzCApbnV3sNX21WbeTKat2p+Gx2KAmCtd/SS61hW6vyYLyASFwszJn/IlRBdniq/sedjii/3Efktpg84zj7DfDlh/eOHsgECYo0kXgXdDI9yIaWADSpKwbyHjUM17mINXlnDP82ymI5qCSAErp1GpLfWbv4TxcqawNWKIMLc6h37mbU1ceRvfSYp6xa8khtx40kBcX0UpQjcutp4nqSK5h9GPWIeLyJ5u0KB74hCa1GR0EhabgkxqObJa/lYCvb/tHpb3TRv/NG8yWKZ2t0aAtjCSVbmnhML94EA9zqP2Hpk3751mROwzviFzkc+m2Yl3lCaLFUj7teYyhc8bJ8mqzutmIyMz+WTk1alk8uVBcsXDuFZ7iepDlvRqV6DGineZsX0IgwBSSJnQvYIejMGYm64QZt8zbWBhD+X+J8aTRId2n4eo82gQw+CFcXI/JH3Y/E6DBiDjRjgfFTjZwQheNWIkfCYjGxkGdk+j3bAzn10aAM6ccn7foIRec0jQhowF6/c+Ya6Esxam3B1psS3898VSsuXVBER4Q/ETYwcRfaIlHlQQP6c/jMV5v0GpbxE6AwZKGz+vWsslR20Dg5osocRL6J8Mz4/K6U/+HzJK+Ekk155A/yK0+in7BZ/ZB38NVVcRrxYTXVXNJ9h3wnAkWCzpMdxm6CiZU/gUnbszJww6611LRSOU8fMlXC+NKV27+rWBi+NTiMBggKNPz26RdlX+/NZxbrQCTTKnjGmbuN6qkc0AvN8ih+KvhvJAFfvpC87UVobiZ/gJQpS63MIeNrtqoDBIGm95mZNyxVg966HgRfrEEcn+5bC87Vp+HdLlmBpm8NOR1Mwr20dl+0w0Gwk3F+BfQ33t3y16t6wnW7ELYMuBHQnHWOz/K3zMtVL1POqetB+GU6YasVh/V1N78IGs5eRLtPR+1LQihxPWZDRdQ++4CojqrwLFazxA7Mc0JecaXKjielGeY7LNRjzffGlQnr2b3NcfpB/3mLsk98uxabhRrCuN9L4LCbmgd5MZH8+1lHpcvnh/QB1TN80gHZu6H8KakcSi0UQ1qIYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":18727,"cache_read_input_tokens":24615,"cache_creation":{"ephemeral_5m_input_tokens":18727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWs977SsZWYZf9shPo873","type":"assistant","uuid":"836c0097-d1b1-437f-a6a9-73e443e0b414","timestamp":"2026-01-07T01:21:26.717Z"}
{"parentUuid":"836c0097-d1b1-437f-a6a9-73e443e0b414","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019a72e2ceJwN7n6krhz58G4","type":"message","role":"assistant","content":[{"type":"text","text":"Got it - D365 CE is being sunset, so no need to document legacy details.\n\nLet's focus on what matters for the **target state**. Looking at your document, I'd suggest we tackle these sections in priority order:\n\n## Critical sections to complete:\n\n1. **Executive Summary** - The \"what and why\" in 1 page\n   - Challenge: Why are we doing this migration?\n   - Solution: What are we building?\n   - Key decisions: Salesforce Service Cloud vs Sales Cloud? Integration patterns?\n\n2. **Target State Architecture** - The core technical design\n   - Bounded contexts involved (ProfileService, EngagementService, Salesforce)\n   - Integration patterns (Conformist to Salesforce, Event-driven, etc.)\n   - System of Record boundaries (what does Salesforce own vs other services?)\n\n3. **Migration Strategy** - How do we get there?\n   - Data migration from D365 CE → Salesforce (contacts, cases, etc.)\n   - Phased rollout approach\n   - Feature flags, rollback strategy\n\n4. **Architecture Decisions** - Key ADRs\n   - Why Salesforce over alternatives?\n   - Which Salesforce product/modules?\n   - Integration approach (REST APIs, events, middleware?)\n   - Data synchronization strategy\n\n## Quick questions to get started:\n\n- **Salesforce product**: Service Cloud? Sales Cloud? Both?\n- **Primary use cases**: Case management? Customer feedback? Knowledge base?\n- **Integration approach**: ProfileService as facade to Salesforce? Or direct integration from other services?\n- **Data to migrate**: Customer contacts, support cases, feedback history?\n\nWhich section should we start with?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":18727,"cache_read_input_tokens":24615,"cache_creation":{"ephemeral_5m_input_tokens":18727,"ephemeral_1h_input_tokens":0},"output_tokens":704,"service_tier":"standard"}},"requestId":"req_011CWs977SsZWYZf9shPo873","type":"assistant","uuid":"851f3ae0-2c36-448e-9e1c-c890fdf1eb24","timestamp":"2026-01-07T01:21:35.505Z"}
{"type":"file-history-snapshot","messageId":"7c80e11c-5c9a-4f02-a492-f343a05250fd","snapshot":{"messageId":"7c80e11c-5c9a-4f02-a492-f343a05250fd","trackedFileBackups":{},"timestamp":"2026-01-07T01:23:38.199Z"},"isSnapshotUpdate":false}
{"parentUuid":"851f3ae0-2c36-448e-9e1c-c890fdf1eb24","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Lets go through this one-by-one"},"uuid":"7c80e11c-5c9a-4f02-a492-f343a05250fd","timestamp":"2026-01-07T01:23:38.170Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-07T01:23:40.549Z","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","content":"/agents"}
{"parentUuid":"7c80e11c-5c9a-4f02-a492-f343a05250fd","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KJ7XbL8jjGfoaPgJyECWdV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to go through the document one-by-one. Based on my instructions in CLAUDE.md, I should ask \"one question at a time when building documentation conversationally - avoid overwhelming with multiple questions in a single response.\"\n\nSo I should start with the first critical section (Executive Summary) and ask ONE focused question to help build it out.\n\nLet me start with the Executive Summary's \"Challenge\" statement - what problem are we solving?","signature":"EvEECkYICxgCKkCZw0XCkcI8gh3HCjmHTptkXLISccyRHCEQUzKgNipI3PcOm0pzp4EyBioVpYAdgYNpRQQieSHr9eYke5px9GRVEgxVx4mpS32ZFM+wgosaDLBeFreJniwWMPrBOSIwCQ9iQ2xEroKsKX8kscFyZLoOJ2Ee+UrZ7Ghia1UXAXD9VpLJv5U8IpGDaq85dXbXKtgDGPKBh46YhRyBkMT3F+MGbEQxFaT66FRW1gDpER+LWky4sgrJKhpEdSscBPAxQoJNwGj/QUkvMuL6HB8K2oQPwXpwk97KofYMFuJCeqTba3v6bkeDSGhB7obmfNazp9SeZrtsCpo7vshtrG/FNTe7fkRu4k02j1TRnTru3hc9gnmDQ1+2wg0PxNsdGyiad+jmW7yrRl0S6Bdpo3CO9wIsJJpoDo0CIZeJN9enomil9UYEx/v8yfM3ewqdcRjuXGHT4ozjZTVmb4kf46eSO9bHQnzPyykycOqh2Sm/QozfpeEK7xVtXcpQEaMsitp6Ab5NiT4xMM34gF7rIzW3crTMY9zhhAh7dkafEcNhIt9CV7Ptce1huoX0n+sOFwfTVzPaeqs3pI0rqKAxJe0xvKcY6Zok6W3AWiddQGpXseNKSQcQdkCZJ8hB9Ra/XemkLGBS8MJ0P0A4KVfLNS155BLMACwfcgQxByS57WNGwZLvn2V+K2IVzOTKAC7f1LnSqSLF0iYcH0SthwARyUjMY7C06E903TXCLewcWUoytMQfA64HKXgNvOtYeYfU+U98Jz9AII507VWp8fBwQk0RZm1lX5w8kdhsOd3zXaWYS34pYvo4tEhK2GsDzBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":396,"cache_read_input_tokens":43342,"cache_creation":{"ephemeral_5m_input_tokens":396,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CWs9HZHuesTYsYCjz8FU9","type":"assistant","uuid":"8a7e8b28-b0b6-40f5-ab00-c61617c130fe","timestamp":"2026-01-07T01:23:43.591Z"}
{"parentUuid":"8a7e8b28-b0b6-40f5-ab00-c61617c130fe","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KJ7XbL8jjGfoaPgJyECWdV","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect. Let's start with the **Executive Summary**.\n\nFirst question: **What's the business challenge we're solving?**\n\nLooking at your current draft, you have:\n> \"Migrate from D365 Customer Engagement to Salesforce for customer feedback and support\"\n\nBut that's the _what_, not the _why_. What business problem is this solving? For example:\n- Are we consolidating customer support across multiple channels?\n- Is D365 CE lacking capabilities we need (e.g., omnichannel support, AI-powered case routing)?\n- Are we unifying customer data that's currently fragmented?\n- Are support teams struggling with current tooling?\n- Is this part of a broader Salesforce consolidation strategy?\n\nWhat's the core business pain point that's driving this migration?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":396,"cache_read_input_tokens":43342,"cache_creation":{"ephemeral_5m_input_tokens":396,"ephemeral_1h_input_tokens":0},"output_tokens":282,"service_tier":"standard"}},"requestId":"req_011CWs9HZHuesTYsYCjz8FU9","type":"assistant","uuid":"e18197f2-2740-4841-a397-bd01a139a364","timestamp":"2026-01-07T01:23:48.154Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-07T01:23:49.751Z","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"parentUuid":"e18197f2-2740-4841-a397-bd01a139a364","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"system","subtype":"local_command","content":"<command-name>/agents</command-name>\n            <command-message>agents</command-message>\n            <command-args></command-args>","level":"info","timestamp":"2026-01-07T01:23:58.188Z","uuid":"6008c11c-97c0-4c84-9f1a-586afae263cc","isMeta":false}
{"parentUuid":"6008c11c-97c0-4c84-9f1a-586afae263cc","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"system","subtype":"local_command","content":"<local-command-stdout>Agents dialog dismissed</local-command-stdout>","level":"info","timestamp":"2026-01-07T01:23:58.188Z","uuid":"49620f56-7a76-4630-86db-6b4156f71cc9","isMeta":false}
{"type":"file-history-snapshot","messageId":"04538c04-762b-460d-87ab-512f3e060501","snapshot":{"messageId":"04538c04-762b-460d-87ab-512f3e060501","trackedFileBackups":{},"timestamp":"2026-01-07T01:24:22.263Z"},"isSnapshotUpdate":false}
{"parentUuid":"49620f56-7a76-4630-86db-6b4156f71cc9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"We're consolidating all the digital channels into Salesforce, via the Engagement Service"},"uuid":"04538c04-762b-460d-87ab-512f3e060501","timestamp":"2026-01-07T01:24:22.237Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"04538c04-762b-460d-87ab-512f3e060501","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GravYLrYtaJqe7jaiAofJQ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - now we're getting clarity. The business challenge is about consolidating digital channels into Salesforce, with EngagementService as the integration layer.\n\nSo the architecture pattern here is:\n- **Salesforce** = System of record for customer support/feedback\n- **EngagementService** = Anti-Corruption Layer / Facade that sits between digital channels (Mobile App, Web) and Salesforce\n- This prevents tight coupling between presentation layer and Salesforce\n\nThis aligns with the DDD patterns in the CLAUDE.md:\n- EngagementService already handles customer engagement, campaigns, notifications\n- EngagementService already has a Braze ACL\n- Now it's also becoming the facade for Salesforce customer support\n\nLet me confirm my understanding and then help structure the Executive Summary.","signature":"ErsHCkYICxgCKkC4QpgDAeIMcTJ/IKskSo6sk9xBVlTJENxSXOnLcg7e6D6J04F/rRsTCaonZZHYHSWYpCbr5H+Bx5d4g6G7pURCEgzdaxQfrLmZmq3SF1UaDGq1n3DOw1eJjqxdVyIwuiVxFDL7guwIvs2sSrtfGzjxClnkYPrX3yZ9tQbezdl7aUR14xxX1iy3TNg8mLZdKqIGyinT9KYu0FP6pd24TNLVQX1xmLLGx+ntIwivV85oJjgtRwFwawg0AW0qPgtALR4rt3M3nLicrU+9HDr68Gf62Rvcwzn9EUvcdcbNlE1Vp5HsNBFU+jRPtqAL2wGqOy4g/fcJ7Lhx62LBDnVLL2b5phy31z6V4SjcCQPDzsdFFASRaA7RYrJOpTz3gnYSP7da3HNFmVR5oZbpj8cm+XnnJxS5f/GJoUyVuK5RzdB2cqUplDLp1ILEHQKKDOswY0GKDc+jLAXjPgE/pn58fa/yrEo/oI2oXT/XhF6z+dJhZ+aSCjIaAvaDPLCXtBxMHsbITDF530b1DRTUaObhZgEp8MTOZ6y1usXe8Q+Oa46hZ3U7hIWoo4VTjV39EJsQ3ajv9yV0mgMUBqY1d9W+wb+Je4LQVuo9d2HvZ5yTFxtC+pGQ80r0cB1+vBZ0ypo0pH+T0K+0YphQ+NHE0HH5vS66WO0+O0ah3RUSdu0kgv/6QxhHoqWtBFn/BWkN47lkDh8GXNV9ai49dz9E1W8UnuyJd7NbRQG0eB96xKecl5ZU5V4rqZYFC1C6Vp4CC4klENVdsY2ipypHMywPVvPBeYwhnLHEKCTTXFO66tuXKf3Gv1YerTmt3oFo/HZMs8bzXf7gS5IbJBl9hbGK22tvK8JuR1rLBZeVZ/vgBI3WY2eKCplWOC94mJHa1Dr1pcdb43FiDm6FzBiTjBGXV4o9Uqj4PTCu0bIFF6zhy1IShiG0JFi2fHVQtnHUzq36c6aE+JRIeullkIllHEqw+jJ8qfhmYHz58FwoS6Zq7HzO5UFyJvJoPJwyffE057EEWBVBh31Mj8eFwpATRFoEusTN9VDM6aNQ7e4HbHuemMH24CPmPpcHn1SzXYbD01ts8mdxGHPEIw1gWL4mQwZ5i6IZU/bLciH0qRinYwT0ELJk/J2M08b9qLfNZPc3EJXftz8ngxzRljaiigFbTHzVxbp8lZYzs6AHhh7dSd5b8jxjzS+FiUZfHnvd6+M/om09c1Yk/u8dBFh9n7nESJb/EMHGyJBkXZHAg+T8Rtc5PHY3yiZBwROX2RgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":303,"cache_read_input_tokens":43738,"cache_creation":{"ephemeral_5m_input_tokens":303,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWs9LoVGvkwxefcGUNUMN","type":"assistant","uuid":"07faf697-b936-4af7-b3e7-4976dda4a27e","timestamp":"2026-01-07T01:24:34.513Z"}
{"parentUuid":"07faf697-b936-4af7-b3e7-4976dda4a27e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GravYLrYtaJqe7jaiAofJQ","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - that clarifies the architecture pattern. So:\n\n**EngagementService** acts as the **Anti-Corruption Layer / Facade** between digital channels (Mobile App, Web) and **Salesforce** (system of record for customer support/feedback).\n\nLet me confirm my understanding:\n\n**Current challenge:**\n- Digital channels (Mobile App, Web) currently interact with D365 CE for customer feedback and support\n- This creates tight coupling and fragmentation\n- Need to consolidate all customer support touchpoints through Salesforce\n\n**Solution:**\n- Salesforce becomes the **system of record** for customer support cases, feedback, and service interactions\n- EngagementService provides a **stable interface** for digital channels (Mobile App, Web)\n- EngagementService translates between OTR's domain language and Salesforce's API (ACL pattern)\n- This protects digital channels from Salesforce API changes\n\n**Integration pattern:**\n- Mobile App/Web → EngagementService (REST API) → Salesforce (via ACL)\n- Similar to how EngagementService already integrates with Braze via ACL\n\nIs this correct? And which Salesforce product are we using - **Service Cloud**?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":303,"cache_read_input_tokens":43738,"cache_creation":{"ephemeral_5m_input_tokens":303,"ephemeral_1h_input_tokens":0},"output_tokens":462,"service_tier":"standard"}},"requestId":"req_011CWs9LoVGvkwxefcGUNUMN","type":"assistant","uuid":"34e95e70-7e82-421b-90ce-9cb748202868","timestamp":"2026-01-07T01:24:39.892Z"}
{"type":"file-history-snapshot","messageId":"21eb2561-1640-482e-9d77-c7a4d6cac566","snapshot":{"messageId":"21eb2561-1640-482e-9d77-c7a4d6cac566","trackedFileBackups":{},"timestamp":"2026-01-07T01:25:06.904Z"},"isSnapshotUpdate":false}
{"parentUuid":"34e95e70-7e82-421b-90ce-9cb748202868","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Salesforce is already used for some customer support cases, by other business units"},"uuid":"21eb2561-1640-482e-9d77-c7a4d6cac566","timestamp":"2026-01-07T01:25:06.870Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"21eb2561-1640-482e-9d77-c7a4d6cac566","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MAnSbeSaY6Usvh1ehAVVP1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ah, so Salesforce is already in use for customer support by other business units. This means:\n\n1. Salesforce (likely Service Cloud) is already established as the system of record for customer support\n2. Other business units are already using it\n3. This migration is about bringing the digital channels (currently on D365 CE) into the same Salesforce instance\n4. This is a consolidation/standardization play - getting everyone on the same platform\n\nSo the challenge is:\n- Digital channels are currently on D365 CE\n- Other business units already use Salesforce for support\n- This creates fragmentation - customer support data is split across two systems\n- Leads to poor customer experience (agents can't see full history), operational inefficiency, duplicate tooling costs\n\nThe solution is:\n- Migrate digital channel customer support/feedback from D365 CE to Salesforce\n- EngagementService provides the facade/ACL for digital channels to interact with Salesforce\n- Consolidates all customer support into single platform (Salesforce)\n- Unifies customer support data across all business units\n\nI should ask about:\n- What business units already use Salesforce?\n- What does Salesforce currently handle vs what D365 CE handles?\n- Are we using the same Salesforce instance or separate ones?\n- What objects/data in Salesforce (Cases, Contacts, etc.)?","signature":"EtoLCkYICxgCKkCoHkpO5buwQdvz+J53/IyftK8c+7eZHkr+WokXjOObqnBsd8t/DyDX4e65S2x/LN7YkCPcTfb2B5u4UEV3ZTobEgwkh1ZVclA8wBHpENwaDDUcqRWH6QW0E9aZ1iIwcEgpsut+SfQ4rGBA1wXLo8PiyK4oJTd1gbvo87/qkGa6V5QK906INEY9YH2nQQM8KsEKC+ORojXa6/oX/3Kbd16GY4m9ZEnRnS0oT5NwLZyzkChfz3TxtXk0C/iGeWzQ1FtcguNZECMxbNqNTN49PNQ24tUCqWpifScSZsd1HxNeXHdwM97bxhGG3Fu6hqxLiIS0T3CA8lqIkJtHlvzDtAwfdFq5UuAIks5c/atRiL6HNzFnQQ/iTlwydf87FopvOVhaFJKqv+g8G253cyNPZ0b7CphrjZaf45zEulcAop0QgvnVSm80ZOrt2rU3MP61YW1YDt3XaI+Xpwe/5Kd/OJSOHwxMJiFibAqGrB7fKStWmH1h1qNnNYEAGPa5j35jUZuR74CQi5qT0WSKdYT67dTTRJElGmPjluVTKy0hX9mTFfT+gmeQzAVy6t9Pt9R4hEYhT034nlGlovr9pO9plAejWUbUABeHSDlIazLmLbpDmizb2U78R40Y2Bq6kXVi1v/IDN8yf3QfgZd7lxBFOFGYCsZGuYyAHBTPoI/r0LI8GAnxvntaZKeDeXLiM8rkqUyWoXujI4YwRbLkjE3TorTHApbunHIKjRPbvg6a1ik98H+n961EXqK7WJbynP+soteBREj2yKZJ2KyovTpsDKACcEUGEBFd3Q1dKpm2fBGQGQSe6tBo80LsGFnjIXikOZHjeQhTb7ALoWspcZP9xEEVzqkWRtPNNubyZbJjudcay/K9HeOZNwTuNHwj9arLQBErOLs75gUalcvqRBs3duSQRiNqxGuSiFterOHC4J6dSNRDGW157Xj3StZ/c1FQzhquEHyG3XbgfjNSV8MaTfqHsD9SzvnW0KzwLNObkrQnkndXsX4ZDPNOcKqyAw9KeNYG4/Bz4gmYMtANend1fChG5/DPlnskyzPQCxFJ+Q6yZjDBXWZhoSxAjqijjcQ2kB5Iu2ipEW1nqrTEgW14p+XtF8Hiq/4Yx6dlxXI2Ve2nAzlLyKRWsjKHrt7I/chipk6t5NuRc2jjup2Wb7X5Yxf9i36CXiiAqjH0IZQAuyozN2CKOiE/eLVDrExB0Hfo46fwBmNitDcXxcaPEY0BM0mJWXjsye7Qa1v2XkGjXqGo5hPqepfwCQE3OxgMJLEG1y7nW8NI5N/IwineZX9cEwdQQrEiFEFXbhpG5IET9ihiTswGm9qcYG5iyXPDicOxSZwzIYVwzZ6u8V7/3++WHOYVwbEb5afAtWJUYnlCFgPIVOteCpHaOZ0GibPXEOZEgV/B5WT2fyoNWl44HvTg9GYL96EprEG0AfZYQUhvCHO/f7VNKqMf3Tj1Cq0zuxxvPL0rNjN/VUjDWHV1p4LdanOJT8h7oSr2U+JE2MEhTqIwxIDdfOFcWs6lp3sGbLb1MSWe5iKi7pifYtNSaZOxLuBmhv62eUEazk8Wh6W2aCdASRJGORwSCqy6jgjtV4iUgxYYjW8Pdk2tDNUJ3pDyNS/jsrJjLaWTLWPURTx/pHLHD2n3pJL4P6SFJ2aiAEb5PZBDX9Gyh6H5k0bKNqZn3hhxyjk3MXGuzf7GyoNeN/tA7L3FaRl32RzoszGrbFjpXJGz5XJwo1xqx0EpZnGwCAGzwUMpqgKi2XY/bMzUsmKUt4DjbnU8h6xNYXGj7dUY4hHqQRCJOrOvCQQfNPELSqTBnaQz23Mbow2tDj5QF1oDVzYw5LXadQWVSeV7Xe4tyeHmJ9rnArRRGA1yfFbKV/JlgmngAKvmfyMGU4VXg8nZSIEzVXVtzhwD+Egvmveqy5ACK+zpu7uhEXCropotdl+we71IP6dipH4+RofvItu+Dla+YyAv3Gwhb9oetB8FInroVRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":295,"cache_read_input_tokens":44041,"cache_creation":{"ephemeral_5m_input_tokens":295,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWs9Q6ERmBxUctW4GxPX6","type":"assistant","uuid":"6d95b5c1-3fe0-4bbf-8695-4cd654b72810","timestamp":"2026-01-07T01:25:16.544Z"}
{"parentUuid":"6d95b5c1-3fe0-4bbf-8695-4cd654b72810","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MAnSbeSaY6Usvh1ehAVVP1","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent - that changes the framing significantly.\n\n**Current state:**\n- Salesforce is already the platform for customer support in other business units\n- Digital channels (Mobile App, Web) currently use D365 CE for customer feedback/support\n- This creates **fragmentation** - customer support data split across two systems\n\n**Challenge:**\n- Support agents don't have unified view of customer interactions (some in Salesforce, some in D365 CE)\n- Operational inefficiency - maintaining two support platforms\n- Inconsistent customer experience across channels\n- Duplicate tooling costs\n\n**Solution:**\n- Consolidate all customer support onto **Salesforce** (the established platform)\n- Retire D365 CE for digital channel support\n- EngagementService provides facade/ACL for digital channels → Salesforce\n\nQuestions to clarify:\n\n1. **Which business units already use Salesforce?** (e.g., retail operations, corporate, fuel wholesale?)\n2. **What use cases does Salesforce currently handle?** (e.g., B2B customer support, store operations issues?)\n3. **Same Salesforce instance or separate?** (Are we connecting to existing instance or deploying new one?)\n4. **What Salesforce objects are we using?** (Cases, Contacts, Knowledge Articles, etc.?)\n\nWhat's the scope of customer support/feedback we're migrating from D365 CE?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":295,"cache_read_input_tokens":44041,"cache_creation":{"ephemeral_5m_input_tokens":295,"ephemeral_1h_input_tokens":0},"output_tokens":634,"service_tier":"standard"}},"requestId":"req_011CWs9Q6ERmBxUctW4GxPX6","type":"assistant","uuid":"67d91153-5030-4863-9b1f-ec4529308f2d","timestamp":"2026-01-07T01:25:22.233Z"}
{"type":"file-history-snapshot","messageId":"f9e6d431-a61d-4443-b9fe-2c0d1ca97ebb","snapshot":{"messageId":"f9e6d431-a61d-4443-b9fe-2c0d1ca97ebb","trackedFileBackups":{},"timestamp":"2026-01-07T01:25:52.287Z"},"isSnapshotUpdate":false}
{"parentUuid":"67d91153-5030-4863-9b1f-ec4529308f2d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Questions 1-by-1 please"},"uuid":"f9e6d431-a61d-4443-b9fe-2c0d1ca97ebb","timestamp":"2026-01-07T01:25:52.258Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"f9e6d431-a61d-4443-b9fe-2c0d1ca97ebb","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0163LRuweyGhJJEimBozhVsV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to ask one question at a time. Let me start with the first one.","signature":"EvkBCkYICxgCKkASYThkdy2wL1FMc3SY7NqcHZfnSNpbHz6fsHG7OYf1244IOPS0gfQqCJgLR+2g99BliYxe0SwY5A+SW+BAy9pAEgy48WXG4oEwAEu2WgEaDN1MucR8cpQMSqRyESIwWstBnGuF934U4Qspe86EMYcrJNLb8zGpwyPlH3KyrVdbJ7xKjlLJ3ahKm9RyNM9ZKmGa/kbkiRODhEmPou8WLjtn907c7cEVbTFXZZNaWRgsDi219c7PfqacfG9u9nQlPW+kSKQqlYYqf7eOWOaEmpeL8b6YvP+n5WxO5owNzsTaNUU2el3x9vecH3suqjTNOMlQGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":329,"cache_read_input_tokens":44336,"cache_creation":{"ephemeral_5m_input_tokens":329,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CWs9TSQx5bD9Fvg4yPdsG","type":"assistant","uuid":"e623ed76-8e92-468b-b345-bec8117ab31b","timestamp":"2026-01-07T01:25:56.174Z"}
{"parentUuid":"e623ed76-8e92-468b-b345-bec8117ab31b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0163LRuweyGhJJEimBozhVsV","type":"message","role":"assistant","content":[{"type":"text","text":"Right, sorry about that.\n\n**Question 1:** Which business units already use Salesforce for customer support?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":329,"cache_read_input_tokens":44336,"cache_creation":{"ephemeral_5m_input_tokens":329,"ephemeral_1h_input_tokens":0},"output_tokens":55,"service_tier":"standard"}},"requestId":"req_011CWs9TSQx5bD9Fvg4yPdsG","type":"assistant","uuid":"f5a07660-1db6-41f4-b4ee-dd4c92243de5","timestamp":"2026-01-07T01:25:56.539Z"}
{"type":"file-history-snapshot","messageId":"cf345b87-4eba-4267-8438-080854207095","snapshot":{"messageId":"cf345b87-4eba-4267-8438-080854207095","trackedFileBackups":{},"timestamp":"2026-01-07T01:27:30.507Z"},"isSnapshotUpdate":false}
{"parentUuid":"f5a07660-1db6-41f4-b4ee-dd4c92243de5","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Its used by the Viva Energy side of our business, we've inherited it as part of a corporate merger"},"uuid":"cf345b87-4eba-4267-8438-080854207095","timestamp":"2026-01-07T01:27:30.461Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"cf345b87-4eba-4267-8438-080854207095","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UWQmXCDf9WWXLN1dXv5hrp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Interesting - so Salesforce is coming from the Viva Energy side of the business as part of a corporate merger. This is a consolidation/harmonization play, not an organic platform choice.\n\nThis means:\n- OTR (digital channels, mobile app) currently uses D365 CE\n- Viva Energy (parent company/merged entity) uses Salesforce\n- Post-merger, there's a strategic decision to standardize on Salesforce\n- This is a platform consolidation, not a greenfield choice\n\nThis changes the challenge framing:\n- Challenge: Post-merger, we have duplicate customer support platforms (D365 CE for OTR digital, Salesforce for Viva Energy)\n- Solution: Consolidate onto Salesforce (the enterprise standard from Viva Energy)\n\nNext question should be: What use cases does Salesforce currently handle for Viva Energy?","signature":"ErcHCkYICxgCKkAA7m+O4P7wfIO02qB6YM+AsKyYqN1OLMgVJyi9n8ivxouYz79qP5CD5aapITCH7uBdwXci700T4AIV2ltNSuhoEgx6Qcj+tpId+X+KvlQaDIT5gdpKITZocGZDySIwYgaH6yIZBE/TqMKfjGv6N79V4+w/sCQlMNV/I2go2DumRi/DuxT2ms6GMNsfPvkyKp4Gaf4LK4+/rJo21wYqnhoZWXJYleVwUylF468Khq4osKjXT740p6jdL9R4Qoaj88vYQEIVCoVgFsul2ILvdCZvFh2zrViop/LyyxPV1gW1md66soTKA+c8qfl/75tmJr66P+R0ZQ+MchEHlcMhWSZeM3fWaWsw1e+3yWy0jM5eqlF3jLVsvbu815be9Ed0MUCkIIhpiMGBzgIhsY3EltJ/nYgdbmnBX31kR3qFh6YZdmvWRM2Hn+x15I8qQZDjIfEbUTfIbnDWFCRwC25URc/NwrejwxlIahxja5DDEsOxowsBHz3wzQDXu3KsSAu/Xva4C/xO+oXcArenkCOM6AV4SG5YZLYbq/0eP7VFexk3WydMXLbkTgX15cA8VsUnzLgmB8WVKNk9JtcYMF+7i6nZTxGnxB4vtWiv9qgGg7cHmxYE+EnqRGW0r8AEJwXsT1yRyKd+kIl6BiKRUxys4cN1WXjhukBHu7018vb458j1Ey7XnqfIgGczNaGv6y128XAkGeSBsSsSAVK7PApS7dPBdG8HRn31gZKK7yM/jWsZCnld4tht+ahD/83ETW1O5+V7XZuNZUJnJ4P76V99rh3ImaBgvbFaAswjcWCVFUU5qsoBRmJYKVJCoqWir3P0nKkuQf2PQeaBOVEohNFI+QUG80riu32n883h8RZNMKePwn4uSyCB3LPstE2PISFjz4HLSSXzfz67z8J3w0pQTalBQ5QCtZ+AJGPU3XRH4xXQ7vt3yUEiXe/0WeVEOJNg9n6z+8OBbII0+4ESs3no5OyDTf66K2P3uZ7QQDaksnMMfx9ON/C0MruZZwiVaCp2V0BnUBsIwM1QvWQDe13IjhVSqueLBjEDWyLnOTEn580z+pAJ/ahoNnqGWJnjdhnahjYXcqHtxkhOKJeTFLlaX5I0NyAgY4w8QBb4dO1lUzNdcXXdPEImplaHhHnIg5U0m7mGGgtZZOEO50pD0yrxGHkoL+VQnGTsyTtYPVmuRjKg/Khi9cQv2KTCgDuB3SKAvdPAiN41m5YEuNFsmQyJF7xS5MYaSFrZlesZXa+ws1cHGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":156,"cache_read_input_tokens":44665,"cache_creation":{"ephemeral_5m_input_tokens":156,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWs9agn6ECFBDHSqNd29d","type":"assistant","uuid":"878b3d5a-af87-4e28-b386-743cfbc7d6c0","timestamp":"2026-01-07T01:27:37.377Z"}
{"parentUuid":"878b3d5a-af87-4e28-b386-743cfbc7d6c0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UWQmXCDf9WWXLN1dXv5hrp","type":"message","role":"assistant","content":[{"type":"text","text":"Got it - **Viva Energy** (parent company) uses Salesforce, and OTR inherited it through the corporate merger.\n\nSo this is a **platform consolidation** post-merger:\n- OTR digital channels (Mobile App, Web) currently use D365 CE\n- Viva Energy uses Salesforce as their enterprise customer support platform\n- Strategic decision to standardize on Salesforce across the merged entity\n\n**Question 2:** What customer support use cases does Salesforce currently handle for Viva Energy?\n\n(e.g., fuel wholesale customer support? B2B accounts? Store operations issues?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":156,"cache_read_input_tokens":44665,"cache_creation":{"ephemeral_5m_input_tokens":156,"ephemeral_1h_input_tokens":0},"output_tokens":344,"service_tier":"standard"}},"requestId":"req_011CWs9agn6ECFBDHSqNd29d","type":"assistant","uuid":"e80101c2-4b9b-4bfa-8b30-f7b06c004494","timestamp":"2026-01-07T01:27:39.553Z"}
{"type":"file-history-snapshot","messageId":"1dfd7f1b-5716-4774-9aef-ec020fb626dd","snapshot":{"messageId":"1dfd7f1b-5716-4774-9aef-ec020fb626dd","trackedFileBackups":{},"timestamp":"2026-01-07T01:28:51.717Z"},"isSnapshotUpdate":false}
{"parentUuid":"e80101c2-4b9b-4bfa-8b30-f7b06c004494","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Fuel wholesale, Shell Card customers, customers of other retail channels"},"uuid":"1dfd7f1b-5716-4774-9aef-ec020fb626dd","timestamp":"2026-01-07T01:28:51.680Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"1dfd7f1b-5716-4774-9aef-ec020fb626dd","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Ef7HZoRGsNCqdDwJVux7Ap","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect - so Salesforce currently handles:\n- Fuel wholesale customer support (B2B)\n- Shell Card customers (fuel card program)\n- Customers of other retail channels (non-OTR/REXP retail)\n\nNow OTR is adding:\n- OTR/REXP digital channel customers (Mobile App, Web users)\n\nThis gives me good context for the challenge statement. Let me continue.","signature":"EvwDCkYICxgCKkASR1GmgmLB6OJAb0hOgMBqLl3XhId+XwjQhOlqOY0UjMLYnk0USRms8KfIOw9w++GGI44MNy8OVQiYsMz991CbEgxbIvH+DZ0l3ENd+RUaDM+pkV8DKO6mS9/5MiIwXl8B9JkqQax/vaw1nbf7Q/Pibk8k8PG8fcPMRDG9xvh720sd+ytVjS8DiwOcJzyDKuMCj4RXbGZeC8m+dAKPFLAVh1jSTgqvh/mbmIw7skWMPJjyzOG0htuN6OoE47IsBAHz6ziOhVX9S0Cmk0Rk2uEGsGvyF6MbfaE3M8j9YYjZlof+8Gdwxgl08DNWA4NeJJOmMg2dkkjma9WTzkhhdsjxffIyd5qQQRjWsgXnX0YD/aiVdUPDI5Wg31VhUSExWE8ONNr2zxYDsAG6ddbLA1IdFI0+eCVTE4Pvc13QTddDuegfcyEZq8cpx82lfRN923oJxMfnlNkivP5B42z+rpKnyF8X7uFiu0yOnjFEHJqBi7rhjQh4bd70uCjUJKZ2TvMtuRDxssaYzeG2o0FapL13lWqwgiJH5O1HWX96mEC2AFPPsF/YP16t9DDzXLPVXygBUcLXDwXO4pdJmfdHM5N2TC7U5+yWsp8OCEgfsNZKR8CjH4MCQ+ykDExbwfMBiR2WXIR/6Fr3G4jciDP34CZFZI9IDxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":155,"cache_read_input_tokens":44821,"cache_creation":{"ephemeral_5m_input_tokens":155,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWs9gfMBXJHNrCKSawAig","type":"assistant","uuid":"dffda62d-a34a-4d7b-ba24-1596b0063075","timestamp":"2026-01-07T01:28:56.391Z"}
{"parentUuid":"dffda62d-a34a-4d7b-ba24-1596b0063075","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Ef7HZoRGsNCqdDwJVux7Ap","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent. So Salesforce currently handles:\n- **Fuel wholesale customer support** (B2B)\n- **Shell Card customers** (fuel card program)\n- **Other retail channels** (non-OTR/REXP)\n\nNow we're adding:\n- **OTR/REXP digital customers** (Mobile App, Web) → currently on D365 CE\n\nThis creates a complete customer support view across all Viva Energy channels.\n\n**Question 3:** Are we connecting to the **same Salesforce instance** that Viva Energy uses, or deploying a separate OTR-specific instance?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":155,"cache_read_input_tokens":44821,"cache_creation":{"ephemeral_5m_input_tokens":155,"ephemeral_1h_input_tokens":0},"output_tokens":243,"service_tier":"standard"}},"requestId":"req_011CWs9gfMBXJHNrCKSawAig","type":"assistant","uuid":"ba09d012-0535-455e-9900-486be394eca1","timestamp":"2026-01-07T01:28:58.662Z"}
{"type":"file-history-snapshot","messageId":"c01b736a-196d-4394-9cc3-aaf8409d3d1b","snapshot":{"messageId":"c01b736a-196d-4394-9cc3-aaf8409d3d1b","trackedFileBackups":{},"timestamp":"2026-01-07T01:29:26.904Z"},"isSnapshotUpdate":false}
{"parentUuid":"ba09d012-0535-455e-9900-486be394eca1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Yes"},"uuid":"c01b736a-196d-4394-9cc3-aaf8409d3d1b","timestamp":"2026-01-07T01:29:26.866Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"c01b736a-196d-4394-9cc3-aaf8409d3d1b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P8DvFoYz6wbdiM7MKDeCUL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user said \"Yes\" but I asked an \"or\" question, so I need to clarify which option they're confirming:\n- Same Salesforce instance (shared with Viva Energy), OR\n- Separate OTR-specific instance\n\nI need to ask for clarification.","signature":"EooDCkYICxgCKkD7DLeytVQIdamrnwrAA4oEyXoZGj6TTDJHYPcHgQZN6gf5xQ+BzBpQDboTbxXAA14K/m9yG53pdwQ3ITAPKm8nEgwfuXfeC7YTt4l6wlgaDBFVfMm++fJpgKazBiIwdbaUaG89+BR2Lo6HkmMwnP1rjMLsmeE34j2IKP3s/A1lWcV07A331uBFxDaP7aKdKvEB7mceP8CB5WxiTN8evKyDpGQWZhFRwGjzEvpQt0S2BIq39rFdI5ihfLdMkeTZ17euVE/PBZSg7e9FE9aTlrVBPK2/fwzEoyJ7CtgfGBkgm2NIQ7G149JkavByGIKZGeSucHJbMNjUjrR0PhWtHARwbIGbqDZcXpbSLOBHl7ptzzJI+GICXfGxd6f9Wpc8SE+QhEB4cFGdMBHUlDdN4GWH4KYO/yk/QkN87X6/2KdHb3OvVkaKEB5vdiubE0ioxb4VT4JG/MJyVcbHV8Ddgr2YT0MklEUwXxW5UQcafN/5IywdoHtAwVdo5VRHsZmajjOOTBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":146,"cache_read_input_tokens":44976,"cache_creation":{"ephemeral_5m_input_tokens":146,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWs9jG6XtfMgJ2MTrKb4Z","type":"assistant","uuid":"cc46d573-1945-4ffa-aeb7-a981f0ef7245","timestamp":"2026-01-07T01:29:31.195Z"}
{"parentUuid":"cc46d573-1945-4ffa-aeb7-a981f0ef7245","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P8DvFoYz6wbdiM7MKDeCUL","type":"message","role":"assistant","content":[{"type":"text","text":"Sorry, I asked an \"or\" question - let me clarify:\n\nAre we connecting to the **same shared Salesforce instance** that Viva Energy currently uses?\n\nOR\n\nAre we deploying a **separate OTR-specific Salesforce instance**?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":146,"cache_read_input_tokens":44976,"cache_creation":{"ephemeral_5m_input_tokens":146,"ephemeral_1h_input_tokens":0},"output_tokens":132,"service_tier":"standard"}},"requestId":"req_011CWs9jG6XtfMgJ2MTrKb4Z","type":"assistant","uuid":"3a1c85cb-eaf3-4917-9adb-aebcd8a96945","timestamp":"2026-01-07T01:29:32.061Z"}
{"type":"file-history-snapshot","messageId":"18b82136-19a2-4278-a00f-ce9eab57aa63","snapshot":{"messageId":"18b82136-19a2-4278-a00f-ce9eab57aa63","trackedFileBackups":{},"timestamp":"2026-01-07T01:41:33.344Z"},"isSnapshotUpdate":false}
{"parentUuid":"3a1c85cb-eaf3-4917-9adb-aebcd8a96945","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Shared instance"},"uuid":"18b82136-19a2-4278-a00f-ce9eab57aa63","timestamp":"2026-01-07T01:41:33.313Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"18b82136-19a2-4278-a00f-ce9eab57aa63","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_014PLc5u7EmvgnHWYDkaVM6t","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect - shared Salesforce instance. This is important because:\n1. Data governance and tenant isolation becomes critical\n2. We need to ensure OTR customer data is properly segmented\n3. Integration patterns need to respect multi-tenant considerations\n4. Conformist pattern makes even more sense - we're joining an existing platform, not designing our own\n\nLet me move to the next question.","signature":"EqoECkYICxgCKkAxDrxO+0nPu7nnNjP+szA5Y9KjYwZ3+jqPYMWNjLnllkT9dSji+EKZp/efjzOxTXT9V48kbHJw2j7OWET/bIfjEgy7luZ9IORNGWXtZOIaDNiRvNfZWWMgnMrKECIwfFkpVkB20lcxfUQKP/+/9b13fBKA5iU0IF+SLtbjWvL6Yu6lbqPNgRVCEEjg+eShKpEDWanOF7Jmxk+NNNKKTt7En5vN3ptjHmkaR29o5jckS4gyfCmh0T1gNys6xjIAIy069gGE3dWBctbT6AFANF+P4mMtaw3c0rdLxnuYHN+J0Ame9b/IXaZ7Nic6YfZaFB6O+GKDPCxYMCbKzFX22G+gtyK4BLElTN5ncCRRLmHwZqCeaaav4zCpNdFM/5+y46dt/ipXbgeAEJ+4548l9aamU45qCdUkeeiVn1lXPHq5xbNX2mAoOLvdU7y5/xkeK+Q+eRpwlToWi1NPoEPoXyqid3g7k5NN/dTrLS9Wlp12hoQdA7kHzyXlVF4haaP7VMy14zsC0M9sBh7/sZxHmH9+xnajssPIio3Iv2PmVyCQc0nLEFZUNXM0Ufs2KQ639SuLyHrNbPRRTIJf20fqJVTWwdIZCpM7eY/wTwdwWbt5JtQreqHk6/2Pu4RQX3srGJeUDjCepF/wYWS5jIuY0+EQBkXE0Zf2GFX9ps3yxmU0gHzQqV49rgnD/eshAU5Q8PuZCqh2HpQ6M9eqoNJxXbfJNhEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":45292,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":45292,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsAep8q5CXfLDd5AKp1D","type":"assistant","uuid":"777f35ff-9526-4f44-9240-0de203074ff0","timestamp":"2026-01-07T01:41:38.845Z"}
{"parentUuid":"777f35ff-9526-4f44-9240-0de203074ff0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_014PLc5u7EmvgnHWYDkaVM6t","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **shared Salesforce instance** across Viva Energy Group.\n\nThis means:\n- Data governance and tenant isolation is critical (OTR customer data vs Viva Energy wholesale vs Shell Card)\n- We're **conforming to an existing Salesforce configuration** (not designing from scratch)\n- Stronger Conformist pattern - we adapt to their established setup\n\n**Question 4:** What Salesforce objects/modules are we using? \n\n(e.g., Service Cloud Cases, Contacts, Knowledge Base, Omnichannel routing?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":45292,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":45292,"ephemeral_1h_input_tokens":0},"output_tokens":216,"service_tier":"standard"}},"requestId":"req_011CWsAep8q5CXfLDd5AKp1D","type":"assistant","uuid":"f51d4b13-2a91-4860-89e4-39777d1ed04c","timestamp":"2026-01-07T01:41:41.426Z"}
{"type":"file-history-snapshot","messageId":"67c8b419-1c3e-4656-a3e5-332160de31c2","snapshot":{"messageId":"67c8b419-1c3e-4656-a3e5-332160de31c2","trackedFileBackups":{},"timestamp":"2026-01-07T01:42:09.261Z"},"isSnapshotUpdate":false}
{"parentUuid":"f51d4b13-2a91-4860-89e4-39777d1ed04c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"I think it's just Service Cloud"},"uuid":"67c8b419-1c3e-4656-a3e5-332160de31c2","timestamp":"2026-01-07T01:42:09.230Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"67c8b419-1c3e-4656-a3e5-332160de31c2","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PG9jNTgjHsazj1oh14LxSz","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user says \"I think it's just Service Cloud\" - they're not 100% certain. I should confirm this and then ask about the specific objects within Service Cloud that we'll be using.\n\nLet me ask about the specific Salesforce objects we'll interact with (Cases, Contacts, etc.) to understand the data model.","signature":"EtYDCkYICxgCKkCMlOKMCbKUZpIk2d8Qtj0Ou2yMuy24/vVY7J/+BTK5/cFCHiDHA5FKqO+zC6uG6IFUY6Lt72Neh+K8a52rr32MEgyv0eX8BlBXF1kvOiYaDCtTCeqmrci70uGQSyIwMlB3HDxSiZEaZXbsCQKiMUzZrP8DQwYrCUcLAXej/NBMx+JsWF+7EyLytIOgxh9NKr0ChWNDhVsbuaR44iDlXqWOceiIOjXq8Of4sUeaaLqlgO9aNkYVarxA73CzgV0blxHw04b0SDfBYhcXQftQaIxGH97tw6M6aXmwROYfK/bhFYKtIGCEZtJXqVdWTT6CIQoEzeNatdsyQfjdsMXeTiXEgHnzg2cPv0+7qYoia6nIzwNWeSTFjz5g8g+fCQ7rvt/M+lMBjDF0y59iNBXW+2xnzs/FNP4wMiNAtYwnNyujkX8pmG0lB+l4LkTuUWvoQFB5HmkTp1WL92mW/xHLlRoDNV/+bBbVMDlUx33AF6MM/S1eTyaUGQIG9TtmO13YTb+1winSXhmju2NS3p9zVh829rmVVsCcmJL+P8ThgPLbgZHwVbywb9rRYDjgmYbzb0ZSvDmjJERiH7PrshBavsRzTzlKwxbtxWjuWfXHzDsYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":135,"cache_read_input_tokens":45292,"cache_creation":{"ephemeral_5m_input_tokens":135,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsAhTYRG9ZELaD18Z94D","type":"assistant","uuid":"ab66076a-6ab9-4725-89b3-cadd45242de5","timestamp":"2026-01-07T01:42:13.320Z"}
{"parentUuid":"ab66076a-6ab9-4725-89b3-cadd45242de5","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PG9jNTgjHsazj1oh14LxSz","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **Service Cloud** for case management and customer support.\n\n**Question 5:** What specific Salesforce objects will we interact with?\n\n(e.g., Cases for support tickets, Contacts for customer profiles, Knowledge Articles, etc.?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":135,"cache_read_input_tokens":45292,"cache_creation":{"ephemeral_5m_input_tokens":135,"ephemeral_1h_input_tokens":0},"output_tokens":134,"service_tier":"standard"}},"requestId":"req_011CWsAhTYRG9ZELaD18Z94D","type":"assistant","uuid":"5cbb9c20-8cd9-4b8a-9fda-cc04d1b8ec5d","timestamp":"2026-01-07T01:42:14.317Z"}
{"type":"file-history-snapshot","messageId":"743f11ff-fb22-46c1-bf40-ca88cf16b9f6","snapshot":{"messageId":"743f11ff-fb22-46c1-bf40-ca88cf16b9f6","trackedFileBackups":{},"timestamp":"2026-01-07T01:44:01.801Z"},"isSnapshotUpdate":false}
{"parentUuid":"5cbb9c20-8cd9-4b8a-9fda-cc04d1b8ec5d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Cases and Contacts "},"uuid":"743f11ff-fb22-46c1-bf40-ca88cf16b9f6","timestamp":"2026-01-07T01:44:01.769Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"743f11ff-fb22-46c1-bf40-ca88cf16b9f6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01USkMioUJRSEhkZcKxgMEXu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect. So we have:\n\n**Salesforce objects:**\n- Cases (support tickets/customer feedback)\n- Contacts (customer profiles)\n\n**Question 6:** Now I need to understand what customer support/feedback use cases are currently in D365 CE that we're migrating to Salesforce. What types of cases/feedback do digital customers submit?","signature":"EukDCkYICxgCKkD3n02XKgk1BOcDt3Bx2jZ6660L42GMWtruXfqSzwVvMOKlFBpNoxgA2LGdTQhERIC5+q07lOU9ggT9RgYengbGEgyUWF5HdCO3bUZ12DwaDCMpnaanICHjBhYZEiIwvuEOZXlcpKDNWHevcui4063zLNJaf4qQdi0M9T9xUonlX/tLBoFkqate9TvqTsFwKtACNwQS0QJsMFB05embqKxE2PMeEOshO4B0rlmdIr97Ym6NirmhG99FNR3bFHoZoeBn5zJ8m2fNicrZ+dp9S+ab36zTEcCKFB4rGsDubOZinpKV7o+SpGRk+YCzXQXKLjny7fcpINZ+HWxk91qIJRdGW2Bppx/ixlxdRnNCltXbhd2lLvi8jD6GT7l463t4JWzrqX1ORxzV4naL+4+57KuVrAOmiFP2sOgHhHs87MYV0vk5lOr/ehz+hzZCou3d72STBR+h1mBCtOvfIKmAOSfTK9O9yJcoAoHeXa1hDUv9VKhQU62cnMObcXx1Zsy+6JY/52NmR2tOUAmJ0/bkOU6Cu7Ph0LeUT1bcA6raZtdKNs8vv1gcPfx7BvvmVVTXtLTn/HOQAt+W5tZ9i+KtlUqnBHsNlOzLMdziWOilTW6A+3MIYYNtJzgHy9ikTgPUVlSzGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":64,"cache_read_input_tokens":45427,"cache_creation":{"ephemeral_5m_input_tokens":64,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsAqkSPfFytLUmNqo6Wa","type":"assistant","uuid":"6a7f95ed-e4ba-4449-abc4-d7da33397ec3","timestamp":"2026-01-07T01:44:06.180Z"}
{"parentUuid":"6a7f95ed-e4ba-4449-abc4-d7da33397ec3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01USkMioUJRSEhkZcKxgMEXu","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Cases** (support tickets/feedback) and **Contacts** (customer profiles).\n\n**Question 6:** What types of customer support/feedback cases do digital customers currently submit through D365 CE?\n\n(e.g., app issues, transaction disputes, loyalty points inquiries, store feedback, product complaints?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":64,"cache_read_input_tokens":45427,"cache_creation":{"ephemeral_5m_input_tokens":64,"ephemeral_1h_input_tokens":0},"output_tokens":156,"service_tier":"standard"}},"requestId":"req_011CWsAqkSPfFytLUmNqo6Wa","type":"assistant","uuid":"7f26b4ac-7d08-450a-80a5-5d152574cf0d","timestamp":"2026-01-07T01:44:07.420Z"}
{"type":"file-history-snapshot","messageId":"5790c459-3cf1-4215-add8-5d46868cf55a","snapshot":{"messageId":"5790c459-3cf1-4215-add8-5d46868cf55a","trackedFileBackups":{},"timestamp":"2026-01-07T01:44:59.055Z"},"isSnapshotUpdate":false}
{"parentUuid":"7f26b4ac-7d08-450a-80a5-5d152574cf0d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"App Issues, transaction disputes, product issues, maybe store feedback? "},"uuid":"5790c459-3cf1-4215-add8-5d46868cf55a","timestamp":"2026-01-07T01:44:59.020Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"5790c459-3cf1-4215-add8-5d46868cf55a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MPf38unsybzo8k5ew8fZFo","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, so the types of cases are:\n- App issues (technical support)\n- Transaction disputes (payment/loyalty issues)\n- Product issues (quality complaints)\n- Store feedback (maybe - user is uncertain)\n\nNow I need to understand the data flow and integration points.\n\nNext question should be about how customers submit feedback - is it through the Mobile App directly? Through a form? Email? Multiple channels?","signature":"ErgECkYICxgCKkB5VBQaPaLE/bJCFZ+ko/56bfopV1pStWphFXDlHr4kuFf1aVNrT0Ei9IFI0k9Vqm95n5jvGDT0QwjYFhoomWW6EgyuPUbsBfD9wN8+Z9EaDO30wC0HiAhRgmO96yIwmAx+L6pJWrjaGMg5x0PzsJajWvw8xwxyrmO4yoK9XKYeK97UH7g+MNe5kwbsXOXWKp8DhzKaUSi21963iRnzHQKZ1v3rUjrjpZH+GktLNsYPhQQcOXoQsU+96CCn9WpcoeMYi9Elaq8YAIniBc8v0JAMoQGHPIZRW5a6F4wBFBanpnPCQBWKNKEQN2ZpxL4TsrAwitwPeLcxiuoiHrVs5Izqn8+RJZ0eml1HpjyVTch/SA6ILBg4mP/S9wK7QBjt9W6MoL7bKG+udBJsrfs4d+UboXGatl3FjvxMibBnMora1aPUYVxIEq1M5602izyRc/qGB0Mr8JRLo8Y7ERR52stRE0PwnSx5sZqL2KHf4VGpWAM39DdRvH/gdG/u062Mpn77WFLIfbIqbrZw4DtlDtFsq2ee3rgP3orSS8c7JdFXLDQH8Kv6fnNnKRUr9JSJsvDbeTpwbP6N4X3JVYDsK9HPP2NQ8crnbkWOl2IVZS2wzJODvqBue2YAWATqNCjhYnsY6cwnq6/2u4WmgXJZCHJpjAB9dCJSNCt9c5GhB3IgAjCWp+Yudhi4SYOdXJXA6dpjENGqsV8KE+aNhzOTi/D3LXIGjiKw0LXonVJ+QHKcWBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":191,"cache_read_input_tokens":45491,"cache_creation":{"ephemeral_5m_input_tokens":191,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsAuyPNdC4Dc7C5HanjB","type":"assistant","uuid":"1de93a99-27e6-4f73-b5c2-67d6cc0b7a20","timestamp":"2026-01-07T01:45:04.144Z"}
{"parentUuid":"1de93a99-27e6-4f73-b5c2-67d6cc0b7a20","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MPf38unsybzo8k5ew8fZFo","type":"message","role":"assistant","content":[{"type":"text","text":"Good - so we're handling:\n- **App issues** (technical support)\n- **Transaction disputes** (payment/loyalty problems)\n- **Product issues** (quality complaints)\n- **Store feedback** (possibly)\n\n**Question 7:** How do customers currently submit these feedback/support requests through D365 CE?\n\n(e.g., in-app feedback form, email integration, chat, phone calls logged by agents?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":191,"cache_read_input_tokens":45491,"cache_creation":{"ephemeral_5m_input_tokens":191,"ephemeral_1h_input_tokens":0},"output_tokens":191,"service_tier":"standard"}},"requestId":"req_011CWsAuyPNdC4Dc7C5HanjB","type":"assistant","uuid":"c0f6e20c-3422-4ba5-9500-e120d576e282","timestamp":"2026-01-07T01:45:05.669Z"}
{"type":"file-history-snapshot","messageId":"9c04e114-8bcb-45f6-8825-3d9bff404f08","snapshot":{"messageId":"9c04e114-8bcb-45f6-8825-3d9bff404f08","trackedFileBackups":{},"timestamp":"2026-01-07T01:46:18.844Z"},"isSnapshotUpdate":false}
{"parentUuid":"c0f6e20c-3422-4ba5-9500-e120d576e282","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"In app feedback "},"uuid":"9c04e114-8bcb-45f6-8825-3d9bff404f08","timestamp":"2026-01-07T01:46:18.814Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"9c04e114-8bcb-45f6-8825-3d9bff404f08","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01T8RXgcASGEQzbgtLGxusVX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"So customers submit feedback through in-app feedback forms, which currently go to D365 CE.\n\nNow we're moving to:\n- Mobile App → EngagementService → Salesforce Service Cloud (Cases + Contacts)\n\nLet me think about the next question. I want to understand:\n- How does this relate to ProfileService? \n- ProfileService owns the Salesforce Contact reconciliation (from the Flybuys doc)\n- EngagementService will create Cases in Salesforce\n- But Contacts... does ProfileService manage that, or does EngagementService?\n\nLooking at the architecture diagram in the current document:\n```\nProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce\nEngagementService --> Salesforce\n```\n\nAnd from the Flybuys integration doc:\n```\nProfileService -- Query Customer Profile<br>Conformist --> Salesforce\nEngagementService -- Query Customer Profile<br>Conformist --> Salesforce\n```\n\nSo both services interact with Salesforce. ProfileService reconciles/creates Contacts, EngagementService creates Cases and also queries Contacts.\n\nNext question should be about the relationship between EngagementService and ProfileService when creating Cases:\n- Does EngagementService need to link Cases to Contacts?\n- Does EngagementService query ProfileService for the Salesforce Contact ID, or does it query Salesforce directly?\n- How do we maintain referential integrity (Case.ContactId → Contact)?\n\nActually, looking at the current diagram more carefully:\n```\nProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce\nEngagementService --> Salesforce\n```\n\nThis suggests ProfileService is responsible for ensuring Mobile App users have Salesforce Contact records. Then EngagementService creates Cases linked to those Contacts.\n\nLet me ask about this relationship.","signature":"EoIPCkYICxgCKkCsThrO7QuDzX8LX17aQjLC2p8fRD+AYp9pbVOOiXNyBdFq6O6hjvOqGayPZ6vOfn/U0QWk0eQjXUCvmLsNez25EgwsLoa0HeCH+5uNHjQaDHQg4GrSN1z4IpC0WSIwuUMFCgg5QkpMRY+JRu8HsNkFybxT/JS89yxrgoEW3TVfd0g3wb9aZR1HR6OeFz0KKukNbvsdKQp9Hdc9mVJ4OX+I3TgOQyquMvrZ7bN9ylSFbyaPKkX+fYWXZMQ7pqDCm+eG5kaFxjUrvPp7nGVTT6A5SSmCg7CmDgSycQa5d84h0Wgh34tDGO7tL1dg5tMgtPe8L7uXG3byA1iL3PH/39IPqugBd30DD/W8X830kmKOScmKDzOuuCxQXEtIVzab5EbPUGkFYUAzqpCeS5RafhLF8R6eoU1GNaUsmdpEA02XhzbJCDWriRSpIM0wSGO6/LMiMh6WTCPf0Dvu0WKJOBMm6tTmL0ngeMAoUSQv76pnJnJESSYxlFW7cgD2xIZJihKzjpRt5WeqA6oFW6G18crHejWHIY3X944uYR5IdBXQzc3gT2vt/w69fW7TSzwtCPktPwbYqrAmlYinfTSVT0lKNbCuUuOQvyZROTpREWIQf/IrfNwYPobhznoNZMHUsC8kzNIJTFVeT4WCMNqxx0y9De95K6kWfWFROPrFuFB7eCRPtywho8U4OPBBOghjiKyL5X61JCht3mtFid8BFWu9Xd5gyuxUJWILouiSXsMgzlWXbe4aLXf44vQspqcds7r3g1SW1AKErWjzGSYgjYc26cQcxB2Ut7hlt4ci9zpi5SM5FpUA6B5uXqfBiMuFNzIy2qGtRxyGKwaAFjODYbEt2OWr28yXneG5qwwnFrbG04HqFezewBAq6HmcKIIKrIrw2oCqahhZkdOcTw3afzEsQkbn1Hv4MKZbxU8wafLzK6Fy8qCEuIhCVJPkQdjolhkrlA+wM+rYWVCBWHq1gI+ovPIWvJND0o6J6+EyS1uyFEAYGFgvuY1gNxmHJlLJfyl+sLA0tB4HA9SJvHwGrcckkaozLGa2hEfl/7PX9MLy3PMiAkKOdBeynyHMO6nPk0fzKRBrj7kat3VUWBUEwVKaDh975N6g8Ky0nLp1r/KejnU9681lDSfEO+mEuMedQ6BdE5L74HhwYF2aSvnw7xplayChTTiUWEBo6P0faHcTzUy6oGzyFg6XpNPKlFg+lU1J1Ixv+KpmO6WsCQoy+nicnaCRJWI2WwBEWtNOVEYu7YIlM97zxqRAvcJaKkVZSG0rH6mLKKNgn0F3NY9n2WfVyLNk9pZ6670cg+wV8S/Ma04NW6BQ/3P+lzvt5DcfpFDfulanDF4VtG+g8tiA2FTpSoQQlkWEeO5RJhJix6axwUQDoPU7TXlcIze4wXgSh2Fl4LcsD6rMfm+BN5iPimCo3Cxq2yiP48jG40bwsXgKl0rKx7Yc9DPDIpE24U9dwmGY1IQTauBw8jsBAV01Z3/6Aqzeo5E7lCpIdFAA3awNdCDm0VOV3iYmws2UihL7CfB7MRnZ73Ckd3t/BCffHV9969W81REUAvcPkx20VaUdW/1OiDfeBYj04B6OAs+LyszUUlpS+pe+zNhJbLicg3lRcP+HyItojFHme3y1+ez/KROgRadGNI1+DjIcCLHRZmBoGdMQJgul35DoyIXHYZJa19XhjX9luYmL4Qi/eKuNTbOnrMMKR5SqFhzOEaWH/mysfS6GXXJeSDcgP+oiYHEF2L/YrxgaXpjCLRw53L+gZQmDgSb+obgUnze1Pr1/N1bKZA39rTVEqhYMVqLGOsnZ/Hux1pQ40Rvy1l8+0DRtlhekup8N3BKZY14/ychk1xd8VkNEbd7YmuUEPfPcPKoHx53G7WfM7yxd5bYse1yl3HidfoeyV0bNgmMbCdyBy9L50xxonsJC1btsJtJTIzDShDHae3KtKJPUmoizEe/yZgGIWgQmEoF1pQJSAMUMP77Klkk8NkusSW89k/AhRXB8elTg5xgQlheypfTmlwrK/0+Ii1X6Hkhz+6UBMCmVV9p57Nx/5SG6/cohOsL4RXcYaP7FIfK7CcXc4Dfeq/oqBQea1NAgco8cIeCJJXXTgb7cymw/sxZD/+8SDjI71ZgOlFAX2ji8sFC/XlbKc6PdiWPcJl/6pZW8I97NtKMCAd8Dz0SCDMgw4u+0GBbGdG8wi5jnhnrC47cv9U5f1f2XwJgoHXlipY9UMi5dLsMijUVYMrHbG3cZEhLW/yXAcygYjkf9iWVA1FzaiB3iOXixKxTquRUUoTtVdA8CA5RSPcN/0LusDVMJzpb6jCi1wRhdwP4ZXR4E9v28h+MzhiTxe+AG+6GkNqCtUb1tFJa9GVekTCNgWcwksi1bMWOT/8mtg/LH3QgRTJkbP9ytiy/YR8S6PC76Bb7+5maz1Kx0DsDLYq3u7hdD8da0Mn0BeOgnyiHEzKBq/HzB6wd+ALJNS8euC00y5AfcII+ocpuqyU39qysaOqoam+z6fO1h8CRxmTcNKU6EcH8EatVwc0kccToDgKjNwYzjDPIYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":103,"cache_read_input_tokens":45682,"cache_creation":{"ephemeral_5m_input_tokens":103,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsB1rfibkiuDkX2xi5za","type":"assistant","uuid":"b9c5b914-a454-4a3e-8bab-31112ed91c7d","timestamp":"2026-01-07T01:46:31.275Z"}
{"parentUuid":"b9c5b914-a454-4a3e-8bab-31112ed91c7d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01T8RXgcASGEQzbgtLGxusVX","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **in-app feedback form** → currently sends to D365 CE → now will go to Salesforce via EngagementService.\n\nLooking at your architecture diagram, I see:\n- **ProfileService** reconciles app users as Salesforce Contacts\n- **EngagementService** sends to Salesforce (presumably creating Cases)\n\n**Question 8:** When a customer submits feedback via the app, does the flow look like this?\n\n1. Mobile App → EngagementService (submit feedback API)\n2. EngagementService looks up Salesforce Contact ID (from ProfileService or directly from Salesforce?)\n3. EngagementService creates Case in Salesforce, linked to Contact\n\nIs that correct? Or does ProfileService play a different role?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":103,"cache_read_input_tokens":45682,"cache_creation":{"ephemeral_5m_input_tokens":103,"ephemeral_1h_input_tokens":0},"output_tokens":609,"service_tier":"standard"}},"requestId":"req_011CWsB1rfibkiuDkX2xi5za","type":"assistant","uuid":"d5cf75a6-bfe3-402c-b30d-d78b41250d0a","timestamp":"2026-01-07T01:46:34.984Z"}
{"type":"file-history-snapshot","messageId":"7cce33c3-1cd5-4cc0-a4c0-0c414c9c3ad4","snapshot":{"messageId":"7cce33c3-1cd5-4cc0-a4c0-0c414c9c3ad4","trackedFileBackups":{},"timestamp":"2026-01-07T01:53:31.382Z"},"isSnapshotUpdate":false}
{"parentUuid":"d5cf75a6-bfe3-402c-b30d-d78b41250d0a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"That's correct"},"uuid":"7cce33c3-1cd5-4cc0-a4c0-0c414c9c3ad4","timestamp":"2026-01-07T01:53:31.337Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"7cce33c3-1cd5-4cc0-a4c0-0c414c9c3ad4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01K2ZGqu2kX5LL4trps5xXCk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great, so the flow is:\n1. Mobile App → EngagementService (submit feedback API)\n2. EngagementService looks up Salesforce Contact ID \n3. EngagementService creates Case in Salesforce, linked to Contact\n\nNow I need to understand how EngagementService gets the Salesforce Contact ID. Does it:\n- Call ProfileService to get the Contact ID?\n- Query Salesforce directly?\n- Receive the Contact ID from the Mobile App?\n\nLet me ask this next.","signature":"EtYECkYICxgCKkApvgiz5wysRkLxHuDaNVvns0j4uRFDHr8db+6sV8HWzPtj7G84bbE8BR25mtRmfpscdxJnhDY+55euI7Z5bZHsEgwExw/Xd2gHN0lgZwQaDDIeic3up5bcQ/8JQyIw+Dctj5vHF5tZrANH1n89e0EAL5AA/WsOyIJ0wLTAn1177z3ZFSE11+vC5HpBKNmfKr0DwhVcMUEDBU+3SmmucTwwgrQcPCN23usb9r+PTkzuGcsWYPTBIo3mTtbRzsaFJtWGUtwvFGaX4dL/pKLbI7PJF0NgCXdYvB/dWTMx0umIg4K4qXtyPGU9KYm4cB+2HjVjIJ9kozTSPwlleTo45x81I8IWukiiRokcsRzv3usbPDh/DwP3FX5fuTDFg0sCDCp/5wDuXM+WvEmImvtNKMf+E7aNmz2ebQ6yup5EYPwMCbaUz/0Cs2Ez7ugd5YkDQwaiXf2e0jweMwe8zpPRgmdfeQxx3+5J/f/roA4Xe5zC9IeOAvSvo+bOgCxML/dLSuGxTBQtTIpT+vL8RJ2aG/QpUCf1Wzy8dPFpNlzlzKYWD4VpQTlAWVGLzL60D9p6vuzEyMaM5IDq6HC+ek/Pe0yjuvII7V4j+PQ34X6jpKMVrgU3ps84f28VhhfzLQFL/Cwx+Hgw2VslPSZkfFG0f+A99iLpNMjGuRbN4bnpK9FgBg5c9xq/xIqE39+tEGgUFZYrShwt6gkwiSLxzZlwLHrA72sbWwhrCn62kCSN+PGMjop1EXlbYGTeoL42eONIEGOVqJk8SJWa3xGvl2i1sxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":45968,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":45968,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsBZjy34qFqfPvRBtPwi","type":"assistant","uuid":"39df1db4-cf47-435b-9a96-3c14dc374b8d","timestamp":"2026-01-07T01:53:36.461Z"}
{"parentUuid":"39df1db4-cf47-435b-9a96-3c14dc374b8d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01K2ZGqu2kX5LL4trps5xXCk","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect. Now I understand the flow.\n\n**Question 9:** How does EngagementService get the **Salesforce Contact ID** when creating a Case?\n\nDoes it:\n- **Option A:** Call ProfileService API to lookup Contact ID by VCI/user identifier?\n- **Option B:** Query Salesforce directly to find Contact?\n- **Option C:** Mobile App passes Contact ID in the feedback submission?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":45968,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":45968,"ephemeral_1h_input_tokens":0},"output_tokens":220,"service_tier":"standard"}},"requestId":"req_011CWsBZjy34qFqfPvRBtPwi","type":"assistant","uuid":"2d06a2c9-17a7-4c17-8e26-d944b453378e","timestamp":"2026-01-07T01:53:38.312Z"}
{"type":"file-history-snapshot","messageId":"ca0ddbfe-da7d-46c5-8eed-4052148721b7","snapshot":{"messageId":"ca0ddbfe-da7d-46c5-8eed-4052148721b7","trackedFileBackups":{},"timestamp":"2026-01-07T01:58:31.889Z"},"isSnapshotUpdate":false}
{"parentUuid":"2d06a2c9-17a7-4c17-8e26-d944b453378e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"C makes the most sese"},"uuid":"ca0ddbfe-da7d-46c5-8eed-4052148721b7","timestamp":"2026-01-07T01:58:31.860Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"ca0ddbfe-da7d-46c5-8eed-4052148721b7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01V8bJRrEiy5fNxzMRp5qNUu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Option C - Mobile App passes Contact ID in the feedback submission.\n\nSo the flow is:\n1. User authenticates (Microsoft Entra External ID)\n2. ProfileService reconciles the authenticated user as a Salesforce Contact (Just-In-Time)\n3. Mobile App has the Salesforce Contact ID cached/stored\n4. When submitting feedback, Mobile App includes Contact ID in the request\n5. EngagementService creates Case in Salesforce, linking to that Contact ID\n\nThis is simpler - EngagementService doesn't need to do lookups, it just creates the Case with the ContactId provided.\n\nNext question should be about what data we're migrating from D365 CE - existing Cases and Contacts?","signature":"ErQGCkYICxgCKkBIL25kp9RYmMuOez9hMDiNHgDRmI2sN+8Qa++C1z5WzcnBA12pDCNLQhtUe9XdUa6/Knn0e6Mib/eYLgCp5+aeEgz8fbwtsGrpTOcNfywaDFdEvbwIcWdvlrE3HyIwHoyHjwqHnCUghUspp6YPgBJ+X9xY+3p4AU7VAiSOSRJswsmwF+SyGpfAhEstMFYsKpsF+K7ByZdJwnsz5JzIcvWj+PQhZevJel7BtgJrdjI/N/Oafjb6CgujkmXjFbOrXPj3RDtJvCht2H/NKmigh1y9K6crADBRjYSFcrWcC69CRtK3Q4hAZ/NIKJplEwuJivwwD1MWRHgPOiuYJY7IotZ01KKSFiN+glvKi7HfndYvVB/ENTYnRmnRufVJqWHTdEP2bTzAPTtThGSeFmOmZkswy+bY2WDOmj2D7/Qm9xCSBxsBht6cd59qQGY778UBLy+o1kDjH+AS4FtnZCC5UQoCvneNoBPEmDE3XTpyM8sSBnJbrLkXqmpcgqQfY4OxU58KrkDZJ0T/y94p3PkxVb+vsNLRvvQAsZ8VOO47iNPFRABaHagkgWBGPNzUdwPEY2waQ+OSNZDiBNAShwTPrtZjqSmh6GIQGn9dhdhezJ2E4HjNGB0sZfamdba/V/HxOTpeBpQ/weO5i03cLyJrwe7FCO8Osb69WkfAa9cqjxAeKExRVdlSnjz5fAVvivRZadfggMaU+9dFAErScgFZlMTMKXIYd50Q1zwn6rEOvDmazb/5/aNgyXj4eeSogNZ/0H9h7DauoQZBhnPoMg0NCJYPAYRNqH4DpNffQiHuDBAYg6KtK79ItR/DvJwye2yzNj/yCZZ3IJ3IYv2MvSMPkjq8tEOZS/B+G5ZqHcGKDsf+nkyoFRRmCnQMJgNYqQZG5urILGw1WJV7YLpoYVxfN3yMFiA0Z0aQG40SKaZ3bSXgolWhTrjKOwkXiZFxqt5WzAtNEhtC3JN9i6g2o9lKdTgugoR1mwe5vg0Kvb1c8dYecNlpN+DYDcIYnmqfdWLOLWuxBUUvybGGTSwN1/1KBOP+4P4NS4JnQSWv4IM2NykcfyARTXPQNra7Lilq3BgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":206,"cache_read_input_tokens":45968,"cache_creation":{"ephemeral_5m_input_tokens":206,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsBwtYqRZM8rNCMksaBX","type":"assistant","uuid":"d28e5c73-b7b4-4bcf-92ac-e83a43f689c7","timestamp":"2026-01-07T01:58:38.135Z"}
{"parentUuid":"d28e5c73-b7b4-4bcf-92ac-e83a43f689c7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01V8bJRrEiy5fNxzMRp5qNUu","type":"message","role":"assistant","content":[{"type":"text","text":"Got it - **Mobile App includes Salesforce Contact ID** when submitting feedback.\n\nFlow:\n1. User authenticates → ProfileService reconciles user as Salesforce Contact (Just-In-Time)\n2. Mobile App caches/stores Salesforce Contact ID\n3. User submits feedback → Mobile App sends to EngagementService with Contact ID\n4. EngagementService creates Case in Salesforce, linked to Contact\n\n**Question 10:** What data are we migrating from D365 CE to Salesforce?\n\n- **Historical Cases** (past support tickets/feedback)?\n- **Contacts** (customer profiles - or do these already exist in Salesforce via ProfileService reconciliation)?\n- **Both?**\n- **Nothing** (fresh start, D365 CE data archived separately)?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":206,"cache_read_input_tokens":45968,"cache_creation":{"ephemeral_5m_input_tokens":206,"ephemeral_1h_input_tokens":0},"output_tokens":352,"service_tier":"standard"}},"requestId":"req_011CWsBwtYqRZM8rNCMksaBX","type":"assistant","uuid":"6e5f06dc-a2b6-4826-a9e6-975e2af2c148","timestamp":"2026-01-07T01:58:41.067Z"}
{"type":"file-history-snapshot","messageId":"9e35db8f-91ab-4622-bb58-769732394e54","snapshot":{"messageId":"9e35db8f-91ab-4622-bb58-769732394e54","trackedFileBackups":{},"timestamp":"2026-01-07T02:00:36.380Z"},"isSnapshotUpdate":false}
{"parentUuid":"6e5f06dc-a2b6-4826-a9e6-975e2af2c148","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Contacts, but they're stored in an app specific database, so we'll migrate/replicate that into Salesforce"},"uuid":"9e35db8f-91ab-4622-bb58-769732394e54","timestamp":"2026-01-07T02:00:36.357Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"9e35db8f-91ab-4622-bb58-769732394e54","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019pK1HekT8mxuj784r5RCjm","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Interesting - so Contacts currently exist in a D365 CE database that's app-specific. These need to be migrated/replicated into Salesforce.\n\nThis is important because:\n1. ProfileService will reconcile app users as Salesforce Contacts (Just-In-Time integration)\n2. But there's an existing database of app user contacts that needs to be migrated first\n3. This is likely a one-time data migration to seed Salesforce with existing app users\n\nLet me clarify where these contacts currently live and the migration strategy.","signature":"EqcFCkYICxgCKkBQ3C1o2FPSyvvsmr/Ro8plg0Ay5AZMUOmVut+RpgkbtqhiE9dgPkFhEamqMXDosIRFHj9lPyjUa0S6IRnDQK2bEgzt0QOsa+4LtjP7uKMaDMzG6DpphiziFdliuSIwZnMAlBsYeIuWEuuqXSaefVBg9A5ocMqnG+VLE9664yjMEc9vn7R7HkRezR3RGOD6Ko4EE6eXu6ku27IyCV5WRJFzL0HTpsRwMrQnSbHDo52XnFaxndVOJDV4pptlscptfCPCy1SFBXbB24ZOvmZZXm2btD+z6WjSoxWisoNn/LqhkvGbIl+cBWrPKCZ+k6vAOBLRr5nF55uDeLVCh+Lzo72MM14QgP0FNNe9aPQDgOxxr7ZXMWHWW0APlXRFMsP6yuDIQ28UdPGIQy6bSwmBpC19HMZ35Y601ZyOkVcj8zK2ciV5jYF/KfxDAN1Y/IuxhZAT9qeTzj2S8J3Rm6UTsn8UY5sTppi8L++pBwD3xvY2U2r0yyEsHgyXxMZx9xYDgHkmEGovq0eTRdEPxTRG8bdPh4mameas+i6GO56tZ0UpZ9CJEjR5j0n/dbYSR0IoBX1oVuRbVse0XrotNJKAcA0+XJYaOc7Cs3vtaHArfKmB6opBVnqs1TeEqPTQ4I2IxQbQt5P3TCViAiAr8nzyROOqxNpID4sjIxHojFFiaQYnuln/u79Etkmvs3HNM9MXT1MmwPubpP4IuT2FdKgNygZCqceg+NpfMCLSltsOqM80ADNcr6Yj56RySUutwYO8ZD9rq2Ib5u1ryZSbYxvudup4KD7mERKc4dPzWxFc/71peHV1toJiVElKu+FSyL0ij26vh2SA7f7kRKGJ5em8MR5rSQKmsGgRRc4iGmTofqUc2/IT5HRr47Wgm7M3ACkSxhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":211,"cache_read_input_tokens":46174,"cache_creation":{"ephemeral_5m_input_tokens":211,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWsC74sh4fPAVYGejK68B","type":"assistant","uuid":"20cf7177-715f-439f-92c9-f9874bad3f2f","timestamp":"2026-01-07T02:00:42.812Z"}
{"parentUuid":"20cf7177-715f-439f-92c9-f9874bad3f2f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019pK1HekT8mxuj784r5RCjm","type":"message","role":"assistant","content":[{"type":"text","text":"Ah - so there's an **existing app-specific database** (presumably linked to D365 CE) that stores customer contact data.\n\n**Migration:**\n- One-time migration/replication of existing app user Contacts from app database → Salesforce\n- After migration, ProfileService handles Just-In-Time reconciliation for new users\n\n**Question 11:** After the initial migration, how do we keep Contacts synchronized?\n\n- **Option A:** ProfileService becomes the only writer (Just-In-Time creates/updates Contacts in Salesforce)\n- **Option B:** App database remains active, bidirectional sync with Salesforce\n- **Option C:** App database deprecated, Salesforce becomes system of record for Contacts"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":211,"cache_read_input_tokens":46174,"cache_creation":{"ephemeral_5m_input_tokens":211,"ephemeral_1h_input_tokens":0},"output_tokens":291,"service_tier":"standard"}},"requestId":"req_011CWsC74sh4fPAVYGejK68B","type":"assistant","uuid":"28df8574-1d57-406d-9825-2416965ee235","timestamp":"2026-01-07T02:00:46.285Z"}
{"type":"file-history-snapshot","messageId":"e077dc05-c748-43a9-913d-53ad6a74687e","snapshot":{"messageId":"e077dc05-c748-43a9-913d-53ad6a74687e","trackedFileBackups":{},"timestamp":"2026-01-07T02:00:58.884Z"},"isSnapshotUpdate":false}
{"parentUuid":"28df8574-1d57-406d-9825-2416965ee235","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"A"},"uuid":"e077dc05-c748-43a9-913d-53ad6a74687e","timestamp":"2026-01-07T02:00:58.856Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"e077dc05-c748-43a9-913d-53ad6a74687e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DvfmCkHJwHJaD8okhWRXX4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect - so ProfileService is the only writer for Contacts after the initial migration. This makes sense with the Just-In-Time integration pattern mentioned in the document.\n\nSo the pattern is:\n1. One-time migration: App database → Salesforce Contacts\n2. Ongoing: ProfileService JIT reconciliation (creates/updates Contacts in Salesforce)\n3. App database eventually deprecated (or becomes read-only legacy data)\n\nLet me ask about historical Cases from D365 CE.","signature":"EvcECkYICxgCKkBSa9TcyEKBMuoaJzXip9qka96xl1hpHjV0MNVJzW6mcv5tUk5lJ8CACbBqpzT6CXa1h4bbHgMK+F1dtCAc9M4nEgwX9K7C1hxcZSH0fb8aDIckGynr5xtpgGMqXCIwBFDqxTxjJY0GqZyGdTinIFHFgjUEXFb5rbaGwmIy63IW8SXypze+Pk1XTkAHfKxsKt4DQ2OCdi8FWGfLmznzyYw1sIIF0kVbq/YoH61cxgINlEowYzewGP6m08WAwvfdLTQq7SK4EMwonOW3Uj2CuHK02EmfmfN5m5ralrHPF52SCBOlbElD/kBHeUP4jyIZW3iVISU1CcNMF1vddzZXjJ1Zv4eKyJwzBI7h2UKkO/xSmc/madsID+NsjvaNkg/UNB9rgzuFtdJEDNmTsNEU15EfoVQ2dMfCkILSGOPxD9IoWy8vo0XL+KjLAycKI/9FD+C7Y/4qWb0Lnb8yPHBHx27ZmWxNahXHCrSTokjCxFkqKZXgbzOi4eXg23xSr4TN75DRyde1zBDsTsFIyhp2gX2AjeM/0puSyKAYxwFPLNL/e1wiOxBnBi/edUCkXUn6TzoPz6KC5iZX+BDtUXO0v+Vcb1yw5STfDU3yNeNSEs7i1Q5P+GgtkFbJQMdv2eK+b0mFp1Ll9EuPlLIqNyM1fEOfX7NIn+HI1RgF0qbThJNDjyYy3i4L9rcL39rWCT/bDvosHZnZOjuCV+d5/wvVotKOypJb0vHQXjK4izAcIRqTWU2WvKSBd4cHxP+dq/pSu3xqrjQ5Ln4pGfUUSW386NViS/RgUFy0RKkiY/wQkbFoxV7cwfjjlCINSe4Ikk49cRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":166,"cache_read_input_tokens":46385,"cache_creation":{"ephemeral_5m_input_tokens":166,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsC8j8MYG8zcwzrEniac","type":"assistant","uuid":"8d59b610-46ea-4cb5-abaa-99dad314487e","timestamp":"2026-01-07T02:01:04.228Z"}
{"parentUuid":"8d59b610-46ea-4cb5-abaa-99dad314487e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DvfmCkHJwHJaD8okhWRXX4","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **ProfileService becomes the single point of integration** for Contact management after migration.\n\nMigration flow:\n1. **One-time:** App database Contacts → Salesforce\n2. **Ongoing:** ProfileService JIT reconciliation (creates/updates Contacts in Salesforce)\n3. App database eventually deprecated for Contact data\n\n**Question 12:** What about **historical Cases** (support tickets/feedback) from D365 CE?\n\n- **Migrate them to Salesforce** (preserve support history)?\n- **Archive separately** (Salesforce starts fresh)?\n- **No migration needed** (limited value)?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":166,"cache_read_input_tokens":46385,"cache_creation":{"ephemeral_5m_input_tokens":166,"ephemeral_1h_input_tokens":0},"output_tokens":255,"service_tier":"standard"}},"requestId":"req_011CWsC8j8MYG8zcwzrEniac","type":"assistant","uuid":"57955d3c-0e70-4a94-91d2-67c14e902782","timestamp":"2026-01-07T02:01:06.664Z"}
{"type":"file-history-snapshot","messageId":"e0ae9a1e-39bc-43ba-85ec-79ce357e3d66","snapshot":{"messageId":"e0ae9a1e-39bc-43ba-85ec-79ce357e3d66","trackedFileBackups":{},"timestamp":"2026-01-07T02:01:40.497Z"},"isSnapshotUpdate":false}
{"parentUuid":"57955d3c-0e70-4a94-91d2-67c14e902782","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"No migration needed"},"uuid":"e0ae9a1e-39bc-43ba-85ec-79ce357e3d66","timestamp":"2026-01-07T02:01:40.468Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"e0ae9a1e-39bc-43ba-85ec-79ce357e3d66","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WEVQz3YXQjupoZuWqtE8pt","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so no historical Case migration. This simplifies the migration significantly.\n\nLet me summarize what we have so far:\n\n**Context:**\n- Viva Energy (parent company post-merger) uses Salesforce Service Cloud for customer support\n- Currently handles: fuel wholesale, Shell Card customers, other retail channels\n- Shared Salesforce instance across Viva Energy Group\n- OTR digital channels currently use D365 CE for customer support/feedback\n- Strategic consolidation onto Salesforce platform\n\n**Use Cases:**\n- In-app feedback submission: app issues, transaction disputes, product issues, store feedback\n- Currently: Mobile App → D365 CE\n- Target: Mobile App → EngagementService → Salesforce Service Cloud\n\n**Salesforce Objects:**\n- Cases (support tickets/feedback)\n- Contacts (customer profiles)\n\n**Architecture Flow:**\n1. User authenticates → ProfileService reconciles as Salesforce Contact (JIT)\n2. Mobile App caches Contact ID\n3. User submits feedback → Mobile App → EngagementService (with Contact ID)\n4. EngagementService creates Case in Salesforce\n\n**Data Migration:**\n- Contacts: One-time migration from app database → Salesforce\n- Cases: No migration (fresh start)\n- Ongoing: ProfileService handles JIT Contact reconciliation\n\n**Integration Patterns:**\n- EngagementService → Salesforce: Anti-Corruption Layer (Conformist pattern)\n- ProfileService → Salesforce: Conformist (for Contact reconciliation)\n\nNow I should ask about the phased rollout and technical constraints.","signature":"EvMMCkYICxgCKkDEHqwMTaeu0DvoCuPJJi9cLiyoCTeLwMPAQiFyWGdxcTKTh+KfuFCI3HvQDq82J/inSd3TyWk7qrPEJGymVzzeEgw0BmLanI3nmmkmmPQaDFWnh6OiaMlPSO1J0SIw77FLmXy7Fq6OYNPjAVM/SQslbU4qXCF7Gd8TFH9zvh3/iVzCMKi1ksY9y59QctPYKtoLBtgDH1ZiyYJuobIM6I/QGIw8YOOoJcur5EFrRdR1hsta5V4ubxdZpOhq6EPnPhLPMEFWwhLbJO5qbi3QojmtERcLM0XlTB0agOQWs2W37ELDuMG2YAVSxGxmEhANnKnupVIUht+4p+5qQlS55lAZ0Wp5Po+SLaw42fZaP5a0FNGdS17yvPOeXeqMNnzmMduhMfd6S/vljIZqKNKnynMaAe+N27M1XkFE3+YqLel+VRQbSpGVTXaXQuTw6f1apMI/nb9LOU9GRP94j3tiu/3Dny6NuNNovFUbhk6kV3sj8+TmR3lcEVoHPpv44grLOFXjhDdBviAH7vH/5Ztca3nffEaACkTXZC1GPbfc8RJLMSvqqORenq4k1DJvaPW0ObJAle4V31Ne2J4F4mScW/2XCJrwnm9toG5o9Jy/oeUaRItkrmPA0q45g/RtgvJeXI+mQ/M1++VTuE++HbNxAzwrH+kF/KP4eOfK9njdx3LpOqEg7jPoKz/lrxk+4/pNYsMOYrxCZ5Zs1a+TXPu1F1YWeB3lDE5LI9N0ltLnrXk8JK7mvxfiF8I7AfNLWTbbNZIXeRfYwtirPq3xRWS+5qIOALpTYnf/oQ82+t1ih6jrfvcav5SEGGf4uc8rxPqQMeHFFJV1uayRQ5HNmSCC3NPU32bSM0Bvlai22gtiq4mczxppdHFpenqlSO73zEU1ttEPTUiwqpTFg2lYM5Flu3DnnQFZjeQQkBxCOfGv7Azme6kyF+/Q1/IbRGy13QOKVW9k2Q/C7UPe05+CI/bIFANEZWzKLgCFX92qkXTL3Whe0wjFfte8/WmXjIPibDlaVxfYzq6+PW5zHw9SveqBMcD2UcFgcq4bgKc8ryyUCh4bTtZkGKkpF+pRCO6jx+7vIDC4SenpRVQ1XtIw8jL+wl3rUwGLi6K6tU0R1BuMb+Eh0AZVVwmnRXOb3rew9YVFCvlaRc5rqPNWwlHXZlWJJG7KfP4KyeUWK1SLWWdg2nVCX5LA4ViVGthw6nHO7645YBIT2t+epX2H6UBQZMwj13ftwJ5fDQ++NBhh1r9x1GG6QAg3/mT8F/pH35DcwQZdceECHVE8wX7iSQrMKNm39na6O+q5daURgMbogCCl+jpxffFCJFj5QQ+C/IF67grI9wjR3V5Zd/cO9tgL+wKUMbZ1u8sw1wgpZ0R3QxpnsNd+ahf2w6Mv6vzl/DsmXkcbYAehDZKf1jX5vf01Z7cnotU3+jEkl8aejtvD7olcHIH9ZYikIve3kH0yWS3KNDueYsRlB+FMzhzvoC6kT+yOHOTkDpGThLeuA5bwYnq16Q+w+FmfEXEySc1V+PGNhf3mujFBTslyZ42ZfApk6V3Ka0BjntlMBoo5Jo1U6pXfYpenckKPzPcsF0DM4DtsZ72WTQQQhTyGMgAk/QQjHWUwMHVw/R9vRdH2gzKWYkv/3+qj/FENBcMZBmesa+CQK7yvSzWWTTQxcBBMp4z9FzuyCqmR18UeOSPtQFH0GplWCvLRnoodg7qA4EuVBQOujjYrhHGNvK8STYc/KZrKE/UrpNSShxhQ2q8XTxyOxkho8Owty8I7b+U1BsuyRAWmxbSrbevlv0BEmWEJZEPPoZt/8VncEgGBXP7JARW1N2/bztNyaOZa/+wZrngtS2yX44GxxqgpaA5k4CfTwwyaEWqS7xCK5KVv1hIJxAF2dwiy8e1tqlH+w91d3P+FKxVxpG+IUlSBCF1hzSmVskrkw7BdslRBESzJ7z7MIS/223GqP/czvLGvQhdTccEU/0B1uUNs9EqqaVIknEGLKR9lrhDUBxQKAO+X0fyiZEmv6IE78l8Z3/Kf+DJt6grIHDHBM5hPx5u/KthixTfi/hGLJhXH8gZhp2q0zI5MXUj955zTozPD3Fl+xzQPffdkGisTljD77hBHeuWjjG6iiiLyj+JdvvP7pPCUEpa7uunzd/ZzWZNGhRSVpB1RsEdfeH7GRQzW1AMDXvYW+EuEwq4vmRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":248,"cache_read_input_tokens":46551,"cache_creation":{"ephemeral_5m_input_tokens":248,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCBo73nj1szP1wn4cTn","type":"assistant","uuid":"7f27ba6e-cbe7-4809-bc4a-da58e4d8d6de","timestamp":"2026-01-07T02:01:56.582Z"}
{"parentUuid":"7f27ba6e-cbe7-4809-bc4a-da58e4d8d6de","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WEVQz3YXQjupoZuWqtE8pt","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent - **no Case migration**, clean cutover. Salesforce starts fresh for OTR digital customer support.\n\n**Migration scope:**\n- ✅ Contacts: One-time migration from app database → Salesforce\n- ❌ Cases: No migration\n- ✅ Ongoing: ProfileService JIT reconciliation\n\n**Question 13:** How are we rolling this out?\n\n- **Big bang cutover** (switch all users at once)?\n- **Phased rollout** (feature flags, pilot users first)?\n- **Parallel run** (submit to both D365 CE and Salesforce temporarily)?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":248,"cache_read_input_tokens":46551,"cache_creation":{"ephemeral_5m_input_tokens":248,"ephemeral_1h_input_tokens":0},"output_tokens":513,"service_tier":"standard"}},"requestId":"req_011CWsCBo73nj1szP1wn4cTn","type":"assistant","uuid":"ca9e906d-1264-4f0f-a02e-a77c300f7922","timestamp":"2026-01-07T02:01:59.156Z"}
{"type":"file-history-snapshot","messageId":"ac9071bb-afcf-463b-b744-a7ba3502a592","snapshot":{"messageId":"ac9071bb-afcf-463b-b744-a7ba3502a592","trackedFileBackups":{},"timestamp":"2026-01-07T02:04:55.835Z"},"isSnapshotUpdate":false}
{"parentUuid":"ca9e906d-1264-4f0f-a02e-a77c300f7922","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Big bang cutover"},"uuid":"ac9071bb-afcf-463b-b744-a7ba3502a592","timestamp":"2026-01-07T02:04:55.803Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"ac9071bb-afcf-463b-b744-a7ba3502a592","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QwUm1cjBqmvUUSniotwDsa","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - big bang cutover. That simplifies the transition architecture significantly - no parallel run, no gradual migration states.\n\nLet me continue with questions about the architecture to fill in the Executive Summary and other sections.\n\nI should ask about:\n- Integration patterns (we know EngagementService → Salesforce, but what about events?)\n- Non-functional requirements (SLA, performance)\n- What happens to D365 CE after cutover\n- Any other systems that interact with this\n- Technology choices for the integration\n\nLet me continue one question at a time.","signature":"EtUFCkYICxgCKkD3z+JImeKeafC5dxmeDre0EG1mNo8JvQlT9Ql7QpKjADcSid0/tP0vy5fM16iZhflLSDVOA1oonup72Y764d4GEgz8pWmh2iMvE3pFwWYaDGpyO/XAyvUmmw4eeiIw4gs5ZrxqsZZn2Y3MpP2ZngRYRhC8vMzVlRE+X7BM4eMgOqCued2W5UvX0IR1kK5jKrwEIuUAbvPj8qC4o6hprSJyLVf/C4z7nKkvga1rtDWLsLlzI7kLZMiWL7ICPFZs3ly9hvojWQcbtbxNy4TneGn7H5EDJ9E0s513qOwWGwE625vM/Dy98HNLaFcSPceIa8A+OuPyauu6pYDHMu0/9t/3UIzC4XYVi2XF1M2k6sibLFsYMwx4QlxMJRgrFGnRyE9TOUgxixqWEzd1UiDT9xDG+aFIkTuc3buiHlvSiHWXIhrPuLq5XCgCI6rAHu1PEsfdi8juOjvpG4N3u9WIXL21wTDvdEb793OpP67pSRbFuPk4HRsN+scMnAUugdId9q/E5Y170wBkvyN/PkOvPSxKc93TtVqcQpIwoAkx3wvqGlXld7Tzia34jzn8FUnjBUCWsgNLQzeBguapYfhYaqc03DbKHKGoJyx4HJk+dHf+8RH/re11BffJUKHWw8mjeh9SlwcCbYD6NTKvZJp2UNyQKTaFywRm4L/hQvaMyezhxaLkCAjnNHC4Y28FPdWh+qOWYAx89AE8a27jokaRHOyK74B0uDorsv3lGxI0eHa/xQUpj+Zes3jj7UKVRbAPu9Mg30DP+v1uE0vb3RIGDyXHdTpKyCyOHpchnMw+Lus1Aq0GRRuWQ60nNCjzhy3fyAIzf4w+JzDBjtvdBS5AeZw9aUeZy1GXYYDcaPXr42PZJ5cyUBAlYriaC+FGjbx2u1EaM12csxZb6GZ4s7YrptA4LS58K1HGzPTSANaIxWZiY8LJL1eDv3f5DbJdCDcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":151,"cache_read_input_tokens":46799,"cache_creation":{"ephemeral_5m_input_tokens":151,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCSC8nGFWjShL7PAMS3","type":"assistant","uuid":"a4219b98-961b-4932-9301-dda8f57e7276","timestamp":"2026-01-07T02:05:04.042Z"}
{"parentUuid":"a4219b98-961b-4932-9301-dda8f57e7276","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QwUm1cjBqmvUUSniotwDsa","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **big bang cutover** simplifies the transition architecture.\n\nNo AS-1, AS-2, AS-3 phased states like Flybuys integration. Just:\n- **AS-0:** Current state (D365 CE)\n- **AS-1:** Target state (Salesforce via EngagementService)\n\n**Question 14:** Does EngagementService publish **domain events** when Cases are created?\n\n(e.g., `CustomerFeedbackSubmitted`, `SupportCaseCreated` for other bounded contexts to consume?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":151,"cache_read_input_tokens":46799,"cache_creation":{"ephemeral_5m_input_tokens":151,"ephemeral_1h_input_tokens":0},"output_tokens":259,"service_tier":"standard"}},"requestId":"req_011CWsCSC8nGFWjShL7PAMS3","type":"assistant","uuid":"d4fcf305-c8c6-468b-9607-b8390741f64d","timestamp":"2026-01-07T02:05:06.835Z"}
{"type":"file-history-snapshot","messageId":"950ccad8-ed08-4da0-975e-a711c58cc777","snapshot":{"messageId":"950ccad8-ed08-4da0-975e-a711c58cc777","trackedFileBackups":{},"timestamp":"2026-01-07T02:06:21.272Z"},"isSnapshotUpdate":false}
{"parentUuid":"d4fcf305-c8c6-468b-9607-b8390741f64d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"It should"},"uuid":"950ccad8-ed08-4da0-975e-a711c58cc777","timestamp":"2026-01-07T02:06:21.249Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"950ccad8-ed08-4da0-975e-a711c58cc777","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EkeGWtLiYGeGjkvwiaHd17","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so EngagementService follows the event-driven architecture pattern, publishing domain events when Cases are created in Salesforce.\n\nLet me think about what event would be published... probably something like:\n- `CustomerFeedbackSubmitted` \n- `SupportCaseCreated`\n\nThis allows other bounded contexts (LoyaltyService, RecommendationService, etc.) to react to customer support events if needed.\n\nLet me continue with the questions to gather all the context needed for the Executive Summary and architecture sections.","signature":"EqwFCkYICxgCKkCQpORwXw0V7ZNoC6VOOIDD5kaV/XpUFUBJN6USsEWCUNMb8BKO6TjLsx68jhUGQwxThukx4x4ZWOXNBKTbMQ6FEgzJ/mfmG0Oq5uyJ6UAaDJofXocAxjtGU7n35CIwp0nKBwS2047nIQ9haVX29wipyqmiypVSwzxM8gWwRIHNeDEo2sbdx/Thc+lJP3ZKKpMElus566iBOnxvtlZuE0FqmTtXKxAwYqqMUP7DmnfmJfGcCxU+WxGekCvWkF8N4bvN0k1YC2t5uvzQ8+5rdw1za925nDcjLQGTlSFfiLR3X5XBrcZFAgPBkePEDn0Ee/c58Epj6AwMtbBhc7RcOFwblZK8aIUv0SJ2X4nmtcV1Fe9Ua5xEOqLkA45WyUMUx7OgTGPrOZEZdzkkoV1J7CEAKTeHyNxGYCn7gWGC5QqieRt6NrY/HTyg7cGrH+wqxQysMtbfSEKPI8Tm8AMuflNmceZyObBqzGURqdBWSuzAG+bITW8n3Ue+YExcJ+DvRFnAAkCK0HM4IUQh1kZWKFjKAQ4mWoQkneDhv1Ma/FBsXHrzyrB8ztjB3ZLnkF2/wfF7skh6zg8Yfw32orqqKD83GNpyB71NX8/Lwnl59UBxH7R6ZU++/KFVE1XDdKC2odhvqPVyBwryg0BSq6p79Jao0XpVwS29Ei2+nKd67lIUCmIY6OxvsirVf+Fsm61ShMBJalawDh7KsJBlGW6CPRLa4dfKlcr3h+E6rbhuTX2p7/JkGkfjg33T/QYnVTIpNB0biX2TommZKDZTLEhVr2atrelsOsvo05USoDjhlG88hK4ce0OHwEdyD2kwT6xEctlmdhDTQcR5QmnqY+QHbON2vj2CF+tXQXfvR61yQRtMz81b5QdatHTat+SOH0Ng00FghbXpGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":134,"cache_read_input_tokens":46950,"cache_creation":{"ephemeral_5m_input_tokens":134,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCYVPn9DmZpyz8stcAu","type":"assistant","uuid":"e9cc8900-3dc8-4259-8797-584c304b9d2d","timestamp":"2026-01-07T02:06:27.703Z"}
{"parentUuid":"e9cc8900-3dc8-4259-8797-584c304b9d2d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EkeGWtLiYGeGjkvwiaHd17","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **event-driven integration** for loose coupling.\n\nEngagementService publishes events like:\n- `CustomerFeedbackSubmitted` \n- `SupportCaseCreated`\n\nOther bounded contexts can subscribe if needed (e.g., LoyaltyService might track customer satisfaction).\n\n**Question 15:** What are the **key architectural decisions** we need to document?\n\nSo far I have:\n1. **Salesforce Service Cloud** (consolidate onto Viva Energy platform post-merger)\n2. **Shared Salesforce instance** (multi-tenant governance)\n3. **EngagementService as ACL** (protect digital channels from Salesforce changes)\n4. **ProfileService for Contact reconciliation** (JIT pattern)\n5. **Event-driven** (publish domain events via Event Bus)\n6. **Big bang cutover** (no phased rollout)\n7. **No Case migration** (fresh start)\n\nAny other key technical decisions? (e.g., synchronous vs async Case creation, error handling strategy, data residency?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":134,"cache_read_input_tokens":46950,"cache_creation":{"ephemeral_5m_input_tokens":134,"ephemeral_1h_input_tokens":0},"output_tokens":368,"service_tier":"standard"}},"requestId":"req_011CWsCYVPn9DmZpyz8stcAu","type":"assistant","uuid":"e480b5f1-f6c3-4b4b-968e-203cdee5ac94","timestamp":"2026-01-07T02:06:32.570Z"}
{"type":"file-history-snapshot","messageId":"d6347c14-25b5-4797-b723-5705c649db55","snapshot":{"messageId":"d6347c14-25b5-4797-b723-5705c649db55","trackedFileBackups":{},"timestamp":"2026-01-07T02:09:43.156Z"},"isSnapshotUpdate":false}
{"parentUuid":"e480b5f1-f6c3-4b4b-968e-203cdee5ac94","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"We're going to do async case creation, lets mention that Salesforce is the system of record for the case data"},"uuid":"d6347c14-25b5-4797-b723-5705c649db55","timestamp":"2026-01-07T02:09:43.137Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"d6347c14-25b5-4797-b723-5705c649db55","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0168hhKYx6KfRxcbaLExZEgt","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good additions:\n- **Async Case creation** (EngagementService queues the request, processes async)\n- **Salesforce = System of Record** for Case data (no local caching/storage of Cases)\n\nLet me add these to the list and move forward.","signature":"Eo4DCkYICxgCKkDW3Rnatvrvp7XChtf4niLtluBaWsQzaky8kOfSY6+28CHdaZ5Mn9NumM0d1MyuoAsloM2qXIQvbQbB5pMqN91QEgx3kdpbevIioGQGOhYaDKsU7aA0UbxTuW7hdiIwBXMaHKE6YC3uS7TN4gWgXT/4aUOZ2PEWWOPMb80YF9S8Kyb8z6rr5OZzk2NgQODWKvUBTWZaAssrOWwfGXnyaw6wcFE83X5i6xVkJVFaTmLuZrVRf7RvhRAeaJzfZHRqMljCc1wzco1Kgso9q/VGeuV3k6yzG4MxM1gbhBsCskAqXwVLnj0cB17kn5SRbPvI43ghjvRnId8xxP/5wfy4UdGPjIZiAyg735/Of7bxTqUGpvlMYUj5HTtYnv1InE8UUON054KDQnp8F+t2on91iCTGFbRfSnYuQOpoGGv1wtvI7XhcmH0jCITlmS3Xfi6kzDYQoY1zpi9ceCf5CFNW9Lw89lY2x6cpnGyaeArTzvGFkcFNLS9v8+/FSWDzBSRXgaE2txc4DKoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":375,"cache_read_input_tokens":47084,"cache_creation":{"ephemeral_5m_input_tokens":375,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCoNJ4FXEC1rAgaAFSB","type":"assistant","uuid":"ccf7633c-6816-478b-875c-2f10ed8257f9","timestamp":"2026-01-07T02:09:47.909Z"}
{"parentUuid":"ccf7633c-6816-478b-875c-2f10ed8257f9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0168hhKYx6KfRxcbaLExZEgt","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - adding:\n\n8. **Async Case creation** (non-blocking user experience, resilience to Salesforce downtime)\n9. **Salesforce = System of Record** for Case data (no local Case storage in EngagementService)\n\n**Question 16:** For the **Executive Summary**, what's the expected outcome/benefit?\n\nWhat improves for:\n- **Customers** (faster response times? Better support experience?)\n- **Support agents** (unified view across all channels?)\n- **Business** (cost savings from retiring D365 CE? Operational efficiency?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":375,"cache_read_input_tokens":47084,"cache_creation":{"ephemeral_5m_input_tokens":375,"ephemeral_1h_input_tokens":0},"output_tokens":201,"service_tier":"standard"}},"requestId":"req_011CWsCoNJ4FXEC1rAgaAFSB","type":"assistant","uuid":"cdb48474-2b8f-4000-8a73-9b73d688be65","timestamp":"2026-01-07T02:09:50.844Z"}
{"type":"file-history-snapshot","messageId":"d3807ed7-9024-4694-8555-86572e248bac","snapshot":{"messageId":"d3807ed7-9024-4694-8555-86572e248bac","trackedFileBackups":{},"timestamp":"2026-01-07T02:10:57.429Z"},"isSnapshotUpdate":false}
{"parentUuid":"cdb48474-2b8f-4000-8a73-9b73d688be65","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"It's a consolidation, a better unified view, and a retiring of the current support experience which isn't working so well"},"uuid":"d3807ed7-9024-4694-8555-86572e248bac","timestamp":"2026-01-07T02:10:57.411Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"d3807ed7-9024-4694-8555-86572e248bac","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01K3awFeuDzxHU2YfeTjbWPU","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so the benefits are:\n1. Platform consolidation (retire D365 CE)\n2. Unified customer view for support agents (across all Viva Energy channels)\n3. Better support experience (D365 CE isn't working well - pain point for customers/agents)\n\nI think I have enough to draft the Executive Summary now. Let me check what else I need:\n\nExecutive Summary typically has:\n- Challenge (1-2 sentences)\n- Solution (bullet points)\n- Key decisions\n- Success criteria\n\nI have:\n- Challenge: Fragmented support across D365 CE (digital) and Salesforce (other channels), D365 CE not working well\n- Solution: Consolidate onto Salesforce via EngagementService ACL\n- Key decisions: All the ones we discussed\n- Success criteria: Need to ask about this\n\nLet me ask about success criteria to complete the Executive Summary section.","signature":"EswHCkYICxgCKkBMMPz9zh+OIyDkoiNm+7K0KyEk9YR7mBm9IvL+oY6GLBPrPgpOVo8/NhJqELsGVIJq+Zgm9/CUSAVfVLHkc3bFEgwkpYgjBiT6+234FgMaDJCkFFRIPDsFWtxyeSIw0oKYugRXjvccWA1ainqgGYgAyh4qr+IFtqx8bdNfhgDlCaWQ7DfYuS9qACDi1pvbKrMGjCA8DOkucZ6M+XiJpY7MP8EE0b7xYvZ4q4JvMYSRpu4YCY4s+qOrc+dHQWxS0Ghsm23r12V5YYijRjEERbyhxC9zDWmGgU8bFrEbKubBInLfTIg5wpk7iDw0QlU5gW0bDCbYz6ywboxdn2XxqH8Lx96r706/WWlLn5iALg93SUgvb1u9fW17hyUTXZHio8OJ1c5iZSDf9milx1zI6R3tE142Vhj44N33YX3J8cSDdjsOB43s0JvzaSUS0NloynymE8yTH8/Nte/xwlmLvoYEyaRanvlih3XR4pI+/o+x/2uoRNIRlPiiZdyl+Ta8hUetSFMfRIF1sphBgBPEOHGrBXvo+mSQEJ/z2qr8KOsoKXYJzCa08RgkDWqom0/7O0cXGvLe9PPCW4slm6/bg/tmUqPMBXF0S9cL2ymhuUD9Wa3g8FKJMIh/RyGSgf+E4tkh3TB0ytgwxbmli2NnLIIyyn1yCmMd5R/+Brp/oUhmQgsQD4jwRTMeD32wMVHJ7NmpQ1N9Fqo5Xza/KzrUpgF8XNiMa/uX+1LsC3/ncPqezDDVKqnTalnP6sdlpwW+bNeVnsQyzpkcHovec/WtTScK/YJQEf9kb8IY9m6+rh7UBjujd6VdlNgbO+ZBjI7NWLJvlaJD4mLKaLahS/rK2KgsFhUEk/CPl4JShlyLyqNC/vk4FNB/XG+6GrUZp3aFZ4dRjn+pZx2Fi0ZxWkrXtVfftgrNG9kRaki1zEN6hP9GA5mB5yIzFY6nOwCldcMeEVAC413gie7Vr0sVDSmiQ57xSgeLtgG80kUhf5wPPrBU5fW/w7Q/JeuqlOQkALtx3AHcyVvgh1/tgKp1biIwMtmedE3mZ/Z0dWtUUwSijmBSl2Zc+0THusRCZZX7Y49wglNFOEiOW3xxeW/+3BW8VCZ8mamGKZywsJlsNPavSV1i192xqBZASaU1xRXPvpq+DOzqItITcHTOOAUYXVx0yH/G18JjdiK9jWa13kayDvoh0p0rbJ/xY7fXPbO3aTpJkJXF7F4XIVKbki55yBVVZX6WsgjvxKX+gzh3Nv4RlSdMFZVm8xHVCz49ceDJonK3LLX0zjsuGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":160,"cache_read_input_tokens":47459,"cache_creation":{"ephemeral_5m_input_tokens":160,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCtrExd4P2JXtsHc9Le","type":"assistant","uuid":"239d5fa3-1f25-43f3-973f-ddb5f4ed0cc4","timestamp":"2026-01-07T02:11:05.686Z"}
{"parentUuid":"239d5fa3-1f25-43f3-973f-ddb5f4ed0cc4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01K3awFeuDzxHU2YfeTjbWPU","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect. So the business value is:\n\n**Benefits:**\n- **Platform consolidation** (retire D365 CE, standardize on Salesforce)\n- **Unified customer view** (support agents see all interactions across digital + other channels)\n- **Improved support experience** (D365 CE has issues, Salesforce is proven platform)\n\n**Question 17:** What are the **success criteria** for this migration?\n\nHow do we measure if this is successful? Examples:\n- \"All digital customer feedback routed to Salesforce within X days of launch\"\n- \"Support agents have single pane of glass for customer history\"\n- \"D365 CE decommissioned by [date]\"\n- \"Customer satisfaction score improves by X%\"\n- \"Average case resolution time decreases\"\n\nWhat metrics matter?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":160,"cache_read_input_tokens":47459,"cache_creation":{"ephemeral_5m_input_tokens":160,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCtrExd4P2JXtsHc9Le","type":"assistant","uuid":"06a67d6d-c167-4e0d-aeef-13aa2e01d512","timestamp":"2026-01-07T02:11:09.726Z"}
{"type":"file-history-snapshot","messageId":"25d2c394-b4fb-4701-9b64-6ac444ad868d","snapshot":{"messageId":"25d2c394-b4fb-4701-9b64-6ac444ad868d","trackedFileBackups":{},"timestamp":"2026-01-07T02:12:01.969Z"},"isSnapshotUpdate":false}
{"parentUuid":"06a67d6d-c167-4e0d-aeef-13aa2e01d512","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Love all those"},"uuid":"25d2c394-b4fb-4701-9b64-6ac444ad868d","timestamp":"2026-01-07T02:12:01.930Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"25d2c394-b4fb-4701-9b64-6ac444ad868d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012yqQcJhCTh439q6hmQVRZ1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great - the user likes all those success criteria. Now I have enough information to start drafting the Executive Summary section. Let me think about what I have:\n\n**Challenge:**\n- Customer support fragmented across D365 CE (digital channels) and Salesforce (other business units)\n- D365 CE isn't working well for digital customer support\n- Post-merger with Viva Energy, need platform consolidation\n- Support agents lack unified view of customer interactions\n\n**Solution:**\n- Consolidate digital customer support onto Salesforce (shared Viva Energy instance)\n- EngagementService as ACL/facade between digital channels and Salesforce\n- ProfileService handles Contact reconciliation (JIT pattern)\n- Async Case creation for resilience\n- Event-driven architecture (publish domain events)\n- Big bang cutover (no phased rollout)\n- One-time Contact migration, no Case migration\n\n**Key Decisions:**\n1. Salesforce Service Cloud (shared instance)\n2. EngagementService as ACL\n3. ProfileService for Contact reconciliation\n4. Async Case creation\n5. Salesforce = System of Record for Cases\n6. Event-driven (publish domain events)\n7. Big bang cutover\n8. Contact migration only\n\n**Success Criteria:**\n- All digital customer feedback routed to Salesforce\n- Support agents have single pane of glass\n- D365 CE decommissioned\n- Customer satisfaction score improves\n- Average case resolution time decreases\n\nI should now ask if they want me to draft the Executive Summary section, or if there are more questions first. Actually, looking back at the conversation flow, we've been doing one question at a time to build up context. I think I have enough to draft the Executive Summary now, but I should check if there's anything else before I start writing.","signature":"Et0OCkYICxgCKkCPM7ykHD78SbMo1WabSj1lGUSzRaDZ6GH5FIRz+ys5dAUyCjoeAxH8vXB6FU2vzOdiGyNyXyHNUM1DUXZcY42SEgw6celxQzxDVQ+NQBcaDGKeF0+LDtslrpjxKSIwszAm7CUZ3zTF9Jxjit5duP28is8OJUfb2QZ5Wrqaxj1+DG1GJUjVjo9yNe9JKZsfKsQNO4E+YMT6HdeddKoWjv57eGUzjHBay/IzQbKcnqIgACs8Ih0F69urTsJO95PW5FPryDA/rzDYOV9P20jCXbCnXksuS6rwGrzJmXGISnl/B+W+ARnxBX1caEyvxVzJrOkV6loXqO+sA3tlyoU+4RuZRxBCQo1ATMlRQsywM28HDWVVwI9qnSOWPTMIZWIGFcrMUVRl2ZSaEFRthBj4pTlRRjIgw/KEHw83gimtvoC0RYpJXpyM0sTTSsbGLVTsPmegQId0cLzanWN8IQ3w6Tk/LLq/sgudbQThqNezZ7lbwOxprvMc4N77m1BxrJiCEt+GJUUMBf0gZ3uk62S2nIzb9vQbvzswwE9hYT+LmXf1MJnmwPpx65fw/aafCyGOkR1xTT69o4UOJfqSC77fWaKCXJ411Al/WfNw0I4OtXePZXc5uOY8AIL17JJ3PloXMMXDJNC8nXBXuN08nudGHibMPxtBrIZABfHEVW881mrYZ4ODtPBgRMzJv3fVb8g0u9bExXQXcp6IFS7q6NINki44xYJf7Bz4BWWiDFrWZSA2+CErHtHalUDlJiTx4tnT8qI2vjpoTlYh8PES6Ptktxg6Vs6XHBGGA5twCZfodM2hyoX2Co/LLocMsdVBp1cCLw824dSg/OYtjYEMUt7Ru8PP9ACuPM+jgHhWLzy+1jcO1EJf+kQho4QreCm1K+d2FJMGVSfGBLInxGzMqtFkMFOQswtjClHj0VQDQl7IhXlWUNod7qs+X2WUprBPuE9x7/Vrajzfk6t5YhvKaEYlBgMrmhYq8NqKOXryz7++5oq5ppxE/T963qfXaPhspMEGU2BGJtrDf5PrX8UhoMdNNGzcVlzaoMB5r+vRrbWXcCqzFO1XlDDFYgSDDZGEqsAzJlwIWTyUcFYcQrAv/0seBVMET/9mfAotgf7j1hTeuaZ+1fH2lNZU4ZWbskP46RxIFynjQXZCrZh80cl88d6LzUwgFZ9sRKZWTm6NicS0DixkkiXbpD8XkdVF1UBHnGciPEkRoAUBctvadrWSWAdV8LVKvn/Khros4H7Y66v8lQrjdOkBkM6lYEb5IVO0eohikmH53uGF3Vp0lvIrgmLLbjmzT+yAKhH4+A5FCRd09CQntk4a6YaGVLKm2JZhtHNF6KOhfER/4ri2r2becIg6gKMG63MCZZ0gbdOabf7Xx+uqUAqUFMgXTlEFTcvdoFKo2NnXCB7lKbyNaiK5u8jGySElDQrITneYakbcW2XVaGiK1C8c3XGSKnhnpHSrSTL3ZR39DHNlYvRcdJIJxvgQDFKDnfUBVW06VxcVhRpe51vn/KdF01iwyKqG3Wko7aCsl09SxXtDP1Xy0RONiubE/h7GJdCgn6z2mq8lu/ueZv7Gupu0Fri0xiNmZwljDa4YjG9hiYlaExdmeC+S8uIDWFiJP3DNRKhM2sWzMEXM3ZmRojzNahwez02xdu6GhjB1hWSGEVNmDLyj/WU2eyMgAQRzUifRTzhL5DIVSqcI7NsNI4BkVoY+IBTwpAeTkp/LYVHYQdj3AsHwsFztKJsKqRsyetrwK4G8EV3Y1Y7uog8FC4ASCRMOXjcEDefMY0EkmcLVPknheZ2okEUeETSqHg76bLUvS1Ad9CKZRBTEWWlvYmEqB0AD1aIa3ABiMo4NI1+gpWZd9xFf87E/zeKwmMLYk6DoWv+mHKbedCLEfH9bqM/fB+bshDJWDeBQ4/H5LkwtJ2S2AEUpNrqg/rJzwQEAGHb8ktapdxWfmq6lwgHH3Rz0oGim1dHLBsd4pPwZzBoyYQAVk975x6vl8CNaYru6EMCkcYoEXnIs73p7AYDyn/3Mq4+BT1tw6aHeDYXuqM42W4suqAyelK6qQQj4JC7UeXi1sh4ArSQ0Twi1yqh1CzFxhZJ7JfiDiOOGNugahEJJUN6EkmBb08srvShNpGkN1KXpGiOUX0Iiyi4mcy7xjEtiwFJ5zwrbiYIlVnSBpE1qq4eK6yUDL8hlU+oQkRsjjP229cesH/olLQnY6vIdH+nibSIS3gbFIE2IzWPr1GHFeimXjKPnsz9JojL8YwNOuvzSuRcRLriY76+R5aQKmuVJEjbQKUcJbPPBpT0aAQIH/0hWAmbcLj0HQqIfHiR7pEjRcZGKao9Yo5At3zr4S/GTiWSzLrNdjD8xRTzvAtNr4QWaHbGKJRxZaekyU3WrVwQLH8Vf1LinBugebzxf0SijxW5SvaeElFU1wRMNlupvBLEw5yhbIUpKqxev74RDOKJizSWxbxDOxAThM3icMZbteEnByNq5KjAeV55k2wm0FrLU9RgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":191,"cache_read_input_tokens":47619,"cache_creation":{"ephemeral_5m_input_tokens":191,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsCycBG3Tfw4Kg8hzyPp","type":"assistant","uuid":"898c0779-d02b-4a75-be88-7fedf18707f5","timestamp":"2026-01-07T02:12:12.304Z"}
{"parentUuid":"898c0779-d02b-4a75-be88-7fedf18707f5","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012yqQcJhCTh439q6hmQVRZ1","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent - we have solid success criteria.\n\nI now have everything I need to draft the **Executive Summary** section:\n\n**Challenge:**\n- Customer support fragmented (D365 CE for digital, Salesforce for other channels)\n- D365 CE not working well for digital support\n- Post-merger consolidation onto Viva Energy's Salesforce platform\n- No unified customer view across channels\n\n**Solution:**\n- Consolidate onto Salesforce Service Cloud (shared instance)\n- EngagementService as ACL\n- ProfileService for Contact reconciliation (JIT)\n- Async Case creation\n- Event-driven architecture\n- Big bang cutover\n- Contact migration only\n\n**Success Criteria:**\n- All digital feedback → Salesforce\n- Unified customer view for agents\n- D365 CE decommissioned\n- Improved customer satisfaction\n- Faster case resolution\n\nShould I draft the **Executive Summary** section now, or do you want to cover anything else first?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":191,"cache_read_input_tokens":47619,"cache_creation":{"ephemeral_5m_input_tokens":191,"ephemeral_1h_input_tokens":0},"output_tokens":635,"service_tier":"standard"}},"requestId":"req_011CWsCycBG3Tfw4Kg8hzyPp","type":"assistant","uuid":"22ad5e3d-3f08-45e8-b5db-cefe4e99de07","timestamp":"2026-01-07T02:12:15.572Z"}
{"type":"file-history-snapshot","messageId":"317f13da-2878-46d8-a59b-ed9ae2f8c64c","snapshot":{"messageId":"317f13da-2878-46d8-a59b-ed9ae2f8c64c","trackedFileBackups":{},"timestamp":"2026-01-07T02:12:56.422Z"},"isSnapshotUpdate":false}
{"parentUuid":"22ad5e3d-3f08-45e8-b5db-cefe4e99de07","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Criticially evaluate my responses and suggest areas I haven't covered"},"uuid":"317f13da-2878-46d8-a59b-ed9ae2f8c64c","timestamp":"2026-01-07T02:12:56.397Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"317f13da-2878-46d8-a59b-ed9ae2f8c64c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JvvJ4LofqnSJx5Nw6XXRLf","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me critically evaluate what we've covered and identify gaps:\n\n**What we've covered well:**\n- Business context (post-merger consolidation)\n- Solution approach (EngagementService ACL, ProfileService JIT)\n- Migration scope (Contacts yes, Cases no)\n- Rollout strategy (big bang)\n- Integration pattern (async Case creation, events)\n- Success criteria\n\n**Areas that seem unclear or missing:**\n\n1. **Error Handling & Resilience:**\n   - What happens if Salesforce is down when user submits feedback?\n   - Does EngagementService queue the Case creation? \n   - Retry strategy? Dead letter queue?\n   - How does the user know their feedback was received vs created in Salesforce?\n   - Do we acknowledge immediately to user, then create Case async?\n\n2. **Data Governance & Security:**\n   - Multi-tenant Salesforce instance - how do we isolate OTR digital customer data from Viva Energy wholesale/Shell Card?\n   - Record types in Salesforce to distinguish digital channel Cases?\n   - Data residency requirements (Australian customer data)?\n   - PII handling in transit/at rest?\n\n3. **Contact Reconciliation Details:**\n   - How do we match app database contacts to potentially existing Salesforce contacts?\n   - Matching logic (email? phone? VCI?)\n   - What if Contact already exists in Salesforce (duplicate detection)?\n   - ProfileService JIT: creates new Contact or updates existing?\n\n4. **Case Routing & Assignment:**\n   - When EngagementService creates a Case, how does it get routed to the right support team?\n   - Case priority/severity mapping?\n   - SLA requirements?\n   - Do we use Salesforce Omnichannel routing or simple assignment rules?\n\n5. **Notifications & Follow-up:**\n   - How do customers get notified about Case updates/resolution?\n   - Email from Salesforce directly? Or through EngagementService/Braze?\n   - Can customers view Case status in the app?\n   - Two-way communication (customer replies to support agent)?\n\nI'll explore the remaining key considerations for the contact and case data models. The contact data strategy needs careful alignment with existing Salesforce schemas and digital customer requirements. We'll need to map essential profile information, ensuring seamless integration between the mobile app database and Salesforce while maintaining data integrity and supporting digital customer interactions.\n\nFor case management, the focus is on capturing comprehensive user feedback details. This includes defining precise mapping between mobile app submission fields and Salesforce Case objects, creating custom fields to support digital channel nuances, and establishing clear categorization mechanisms that enable effective support routing and tracking.\n\nThe case types will likely encompass App Issue, Transaction Dispute, Product Issue, and Store Feedback categories, each requiring specific handling and routing protocols.\n\nPerformance, availability, and scalability emerge as critical non-functional considerations. We must define precise asynchronous processing timelines, manage potential Salesforce maintenance conflicts, and establish robust monitoring frameworks to track case creation success and potential integration failures.\n\nIntegration technology selection will be pivotal - determining the optimal Salesforce API approach, authentication mechanisms, and understanding potential rate limit constraints. The migration strategy must also address data volume, cleansing requirements, and comprehensive validation processes to ensure smooth transition of existing customer contact information.\n\nThe cutover demands meticulous sequencing, balancing a \"big bang\" approach with strategic event orchestration. Key transition moments include disabling legacy system integrations, enabling new Salesforce connections, and implementing comprehensive smoke testing with a clear rollback contingency.\n\nOperational readiness hinges on multiple interdependent factors: infrastructure preparedness, configuration modifications, administrative ownership, and support team training. We'll need to develop nuanced handling protocols for digital case sources and establish robust reporting mechanisms to track emerging interaction patterns.\n\nCritical architectural considerations center on error resilience, data reconciliation, and precise mapping between submission platforms and Salesforce. Authentication protocols, multi-tenant data isolation, and integration technology specifics demand rigorous definition to ensure seamless, secure case management.\n\nThe prioritized approach segments requirements into must-address, important, and deferrable categories, allowing focused resolution of core technical challenges while maintaining flexibility for future refinement.","signature":"EqknCkYICxgCKkBLrp77zQfXSje4Zi8jD7a5NQC6WQ3O1tJa3iDd6BxRfX/fACoNIFlgT+iENnoo4lkGOABSpWp+tYLf8QaW8G4eEgyl/CIkZKo1FYp3kvQaDObIqfZcE75FSoNzlyIwwffOhnyq9KQftAIs5LGwZBPjI35JL5XK4b4eG71i0s6LcT2lHY+ImjAiBvWq+HzFKpAmMjBfyAAV2ZemqhNM/tjdV9r+0Y1Qjqh1y/LqMBzSX1cRd32beXP6ij0iCJyMB4MLpSYBSsntCnkQ75j+5iAK+D5Rpd3WO9EtbkBj5qws9fgn9qNd7uOU2s+zC9gbqpalk7do88+UJzA9UCnh0ve7PLn2fXbQw21G15yAT0UbpUpCs3dURAtxtsbw8pfY1FblZMqVSspqNqyQ4IOnrJyfVLDXisirve77+whChOx9gCG4+2mRX0+eXZVgtYf6Cxq5Otcrzh2aogkngowKiSO70UraH7HgtJJL/WBXoO+0ds1WQ5WgzBlwVVjhr80KAVzLq7K5xnyYvu/fDfRa7DxIHpgcYLy6oUeHTjQzQv9B6RwuHxWzokiCFSxPsGuq4fZ3wQlVOxE7xQENsjUdp/OytRFlDeyQWW6d8xdanZXl4T1ssFcI8v4fAcfVuDWjNtEXxjm0H52/fYfKi1FDRvhVUIRYBkqxZGmQ00F17D3SgUd+iK7oJcOUldRWxPVPsjmwAr7T9zJ9LybCHGBRG7DeXH57wXBB4w8cu2aRcnDVqnT4Lc+H/lzEeWtT8FA1tGovv4WMJe4jHTkoOgkL0P+zENPPHfSVC/+mFyFqadLD1GwEJ6NZ55rk+Jcp9/qFsP42pitZNMd3IqrJQbR/vrhegI1K/RfZe4WCqyzePjh8GmMjkF0v3WVJvY0Dl0gM9OnPfvhFE/DNX5JzsGI39ap9HaU8FVEoo2O5cYAfIIu73tv9Q9lQ2SnZ1xo4n69H1aggMkM31/EH+Mp7DU4b72Sgu4vQZPTYsm7/RVjWsJSFTeN+9zGQrjxNbnO/821BbbWzsByf58RDjhNDkr4zI3EV8vinrhbWboK4RkHM0M7Y16YbwwmCNyWpx2CoUdvNvZ4XoVjNAaEm8wsG0dBOSibqt7ihPWplzVA4rQFP+nSWgieNZeNxWsuKtX6Z9HyIZrEb77u2GSsgO2nrLCWWeuQannTfzs3B+7rdebVdqzFm8zYD7baqFrE1EzWaT82JO1FiW3x9QPNM0gEG8LKfZk7qe+1r5sht0lVnCIGn/5oG7qe0tOV21FvLG97e86NMBGOFZ6Cwr67g79dckjT7/eEZgV8hQUuUpkbZl0XlLYw31Le34ogKLEd6cGLCwJU3+wzlTPGVEXUvwW7rETMHb1mUiszVFsZV82ovimdmpbcRtBoLCJbWnORqINhLX42w+Y53wkiScvxJE+36604YDrBEeEpmjN3NOtgxz5PwuFhiAl+y++wtXayHI0GC2pd97mJO4T+xRe3PW6nTro2I/QkukFRL8L8x0JgCriFABaeXV5lmpNYGvwA8cU5qJHIUPn0qLj1QE8R5ZLUNMWgCGdc73dyLX7Ew1m5MiWBm2sajnDCxMVe3qnKmi0uUJqMOQ1g8Rv55TSL2mqgf6TDQrrlt1tdmIDcr6AngB6w+rjia1SbLuy+aOQSLYPZI0Z0e7SS8yQ7/TSP2Lt3HEpBKVn5NKZ4BTw2CzveHaDcxn/yaIcXtFIOG3X3mQSPJzk5ZKaooS33fzRqO8hC6gNd9XPwK0fLf2HtPcJe7pRPFK9gH7MVsVI2vkK1TegaKsJna4DupaJA2U8CZNgCUgaaOwKsnyPOHT76RmNlSqJDRhzVXTuDd6tFhGSSiGCw5ifPfP0BV31RixxxT5SPiLmkDSJLUfxf6xO6DkPtYBB1wERQiW8HSRx/xKhpHMk3B7qDfPMAUqQ81BkHn7GHcyfsBC21AmuARvaTTEI95bdWfiVpmjCQru4psd6VrPZgOy4Kc/3kozzXXsggXnG7WsUotJssEnHEcaImiIPs+7ziMooXzHQ3/Tg90Bk+lp/++GPtmtTmiQwkixT1PKUzu1/66CtaS88QulgViuMHDvNhDZI8JIKrDll6OYWCk2Qf4HKSU6HOusUobnIYrXPApKihOBNEgr/kUA9+RxsGRbgz0GLqpTQMg1n/iqDZJKXq4P74UslBrfK65L0WlGTN1PU/rDAFPIIXUQK/GHtVzv8axlZnS6mwIvyCJ2tR10I+L8imn072w5cnMPZX0gfYWelEErlz2Gy+O/7wNLKfv0DXB4egwNT+0QY+p3QJKEnY3zACLmnax+V31dvwt7ZBdr0+eJ+m26G90jThGfLrTqxBFcy8i/1F8aOFZ7M9KUmzO7YwTxm/IhkOmt97OrkOE4kpapKhIz3rGlir9GJUsmHejGa47zlFd3CSruIxFv5Q0kjcw2LFQVlcdB4SAAVCXQ+l5hstH807jG8aNoPlW9GH6CpOs/uyssOKO8ivOan2cQYm/pRcCev1IM2a78nxICc8orf4wv8gv6zrpYp6iZF0sCV+FxCx+fJymKo/8jn7UjahcUeTZ31YRKx6vXgN6iw+71/tPy10aYrfuWjXhhAiztt27HmpVJjldWQsvsqzHlP+n302Hbto9nzIUVZIQVd0k/CZlW+mPcsOvAu+j1joYBD3JtPb7rDQUS8QvcQbl9zGaEy6tKK5p8aUQ6q3je7OOLWAg3JJJdiZ8LVdZHKzjYtSwXZgtzYZralFL7gt2km0lMq9wUxSsCJpd2bpzNUzktyGKwsTSlYq2rlOfp3NKKDGJkmIOmVyCXCqFOV9/80LK8yfPjHupLRNAnh4YguDJcLO/B3Giw6z04htVdQp1nZ2JMIfPvsZPB6Iv7c4yb1oLp2RAjihzOqaGm6GvfoLRcV+/JVIUPUN96JB28r5viXJl6WPyt6oYPCTtyBfE++rfbL/XZRuCsBANn0gG5+y1wexDQP/w52Qwpi0wPhKLXB162oZKLuA+IAX/TbFVt1QDxSBaDM2u26S8P4q2wZ85aVPl5qVAIh86CcNtoDTIRv5Ea/o8vH71Dko9GmxEuU+po8RyrOOhrg8kO1QhCEXlqtwfyrKAEx1Vp/Sxce0Lx20AzoMabH7wpBMlnQNN1xljZWSjoYS3giaQa5kaiWfPQQv7Htnk+Q7kYSaiRY+ltTKCR54LHUINiPVf4U2WkQjYl/HZzfFKlW6FU/fwli+hsjIEv4S7Baj9x3pkb5KOKI5eVbVokjRAX/b9/SRgBYaChxiVNvbpX6XCkEy6wXJSGYy4jZBU/bO8Qz+ujpKIvg5brpFs8h463BBuCdLn1GnjcJntxwGY6WoMRPXlMZO524LLnL81Uk9jmqVW/gxmHS/pB2k+rKUI9R2lNmGAMd6OpBREq/WZIf61eGVZBWEcU/rMG4TgSyMFNP+IVVOIaLtkc8Ccd5r0UrjqxwRN9JOzbEwJEbJ3eNTftq/GbkUPvvA1suTNsEgDiZ5qUCoyEmkj2JGEK+pszvRR2659qf9KI/N6iG/tLJm//HxKQgPO4GXWW3flwFuLeV14R4A5w5G183o3ZEjkmv0PkIUPdWQ+gsEllZHISTr/YZj1yOKXvfopiS7/3Zr3IOCdqGmujaNj2+vI1HnxmVYem+Sbz2u545j1BkixpjAnICzqgNqDuSAoPXXbDomVitBDJjr6fSqlXmT2sWKlyBZUK2rQ6zSa0zFkaUkZcQYYkaftL7Ca6zwi5/LtOY67hOc6Os5kL5fADfkAwWf+RmPPXLtiAVYS+B9517PMo+ctVzlh47i2wPEdtpZK4AS2b99RdFh3yDtKBtqU7WTUIroC3c1QwDrCBmXXsoL4BZdBRqsCJBo+UeyH1K5XKcPtBKju4QiXSE4nJ1dWjDvPkOLhxj5xiUDvDT2gzrbGOQAQOkzaV1ZxnR7SQCAzafBg+ZKPdFY1mMvfJDQsMTxzX6bqEoDL2yjGCLWNDoBtzswlwrny4YGqkszTxnY94/1gM1Q1Hdo8vT3YeBi04lJ8k+ojXhsSGjtFvtOtV7KXkR/iobiOWRpf/YdFFs1+lvH0UKOzUPnxIaH+7a0M/uCuMMbgMMYeoTqceUhCMcHa4I1KjKGLRZLgbNzEyBoWRXgM7q3b+fiHmI4F4vK/mysEZcCjsqIZBqHXRH5cBfBm+mVSiQlvfP0BC/ivenZCumo6uArhS7gqcS+F2iiK80RJpUrw9BDNA3EZHj9ske+VJEUL4FRdpchBqBFndInEZaFB7AH1ngw9IWebjkdAOB9eDypcbeWKta+ShGy7R+nSX10WocKmnHk9sTWLOycELZcrWNZQ+Z5DGAy3vwHIz8iI4FAW8ur/FHH8ava29nPXYYFrR9Avwcs9UeQUmkPtuYwoQT6+kynwcfxmDMggLYAVhpjULdFaihlacoAllAodJHJZl4nnnoEZwV/QawuP5pxy0fl252ktvYA4VZoP6UMdsHLpxMR2vYgXP1/U3tDkgnWdRlJY32/y9w7C6QAW0tYYXFPIib9vVCEDq6p0nGAJbq3tH3BD6JHADs/jRIgWv5PkAAH2wNgW9/nksqY24QlmsOFdVomCEfZ3BtCoVQn95l1cckh26XJ70yvKkbuFolQe1g+pAl+OcmuXW1kEaWC0GzGKUCh/qekA56PNg9bRmbgoua9+KYb/znEr7wadBgK29Pe/mEEvpSbyjdiatlK1HqydcAHMmigmiSi7PpeRPfBGUiy3MOEIbkp4zutVxV111dBj/HAmB/efRywoEpy/Gca1i7dNrkiuxYR9aQIBZZxtj1A7ItQIjOaWfg0B9tGu3rJgx45K2nMhdrOK/seDb4xecH2jhC9yTXOJmqUudvk6ebjp45XAEg3A3Qzg+onnwODknvYDiGXNDUHOLTOfykrbEhcno4cLNIfPHKN4tyf+MHs6iSIZLzihOSVFWvCxRi+cysycOdGG9CEHTlzJfrGkBH4ntihQssUDXg6kF9ywyRz4HNAhvoMNTab3Vben9ayOfYVgntcxK9PRkSEUpPynZfAB5QRV4QKyMbQJXQLdv7gS/5qRirikYVyUtHoN7uaIkRzbKLVeoeRdSuykYy58Te8TOYTQO+IEjc3A67WNK3UeCKhIk7FE58i68QZD02m8xZIWlYJDo5r4v6RUW6XbKyTSKTT3wU8t8Z+ajjh69Wb0wHZKo9pc55bATZvKnXuwwiFv9xdCd65AMSGyiok2YgjRLhdOdhVeNMRX0Qlu6r+6AhAnEPMv3SYWTwBhyyDOFtHaPuu4q4+tK6Anugpme9kRI7m3wi5zA6f8qYOMVWyxG7s/lw3tvCULS0BCbacUb6YOuwUzOt90jFRMd4wdE1H80TsXXF+mPT6W5cLUs2xYau3ARfP5RDsC5GdAu4y2RlogRRDTJk+Hqx4KTUns0m6DRuIxSbvBOw7CdQctgtf6J5rKU4LCoAVQcUaitQ+fd/ELqJP7xOnKdtJPbs48UdXM2pUXdJodmJqJdPLbxk4ZizzmQFvqjHmZB85P8VLxKq1iSeXb1VUPuc6Wu06PnG55tg7lI2ofVrcltfCuJk55tQnStIogjJxfOhWwM5Z8A91y5RRqxqhh1t0f9fVyNdaVchJRCnbxuk22C1cw5oHo9GUJS6SM9pGlwt2ugriop270zE5nVpK1s9Ujcx09t3GTA1TFU0oLC/zowKJjsQYxgXUfo6NGGTrDbbBwjFjbcZcp8wCP699kfcAVNyWQlUtsvPH1tcP+SFOOA+QWT2k4w/vJZb7FnEsZUpV+og7swTahbQtOqnUPvODgKEhMjBFpBwHrRiFOa6K71Idq9vleNK2Ow1CUkx6ETE3AD8Wrr8lo/DfhWgbpUdLfT4YELP2mivP/MwHyu3oxbgKrcDwU0qs/JJkqrlDFE10xBmZaOtZ291x2bihT5ZczLJDoES/Y4F6qKgx905sGf+ByEcs3yvuBU+UNOJ7hWwf3j5PEfkohv0L+Q3l1X7Q1Y71dclgjUZpHcfLobSckitJCHMnHGD7UPubHjIp8rR/kjouXch0yOwL5r+jgL8+0Xn9Zgi+Xn9L+S2cYm7F++bKD+7TiroAZPOulZJmXXVsX0avEaYOiksFuUjKTRU/rebEsW7JVSNmEN/Z+hh+xflVl3eR0sJXFFdNJIw5xbSnFyVNMA4NVvwdUH8tqzexnjb6loLCENRdkRROh4P6tpGSBwpmZlQ4N7K1Z6FXgtV+NuwqU7LUYBRGzAYAxn+wI0cSQGrnAUfx0RJjrhUyhnnoC0deT/AV/DK+yKB6BG9gOEtRHgxZEmfca4+Y+TE2ecPSh5EP3kYgs3mMkjeDR3rcmvvyHJf60pidhCX96X8FSD7XN4S/MfJOW5CFPxtooz72h+gdD/0JpBRNFWjZhHhuIbg1inxAOJBniHoR7p7UDINujg5o4ivZcBWlFnJdEVaSyjZJ/Lb/jsK0JPzIUE1LzXSOeKNUb2V6Seri5d9oXYJuudyOyAbwb49VkVsd9OTLtwquqonfNcqihhtuYK7XkYcHL3xFG86+A9lzcIs96Pe+I2Duko1z7VLu6PQD1lwHCTR7orBRUMh1OtYMzBbpRy6TQ74FG/4lLmw8xN38+lFc9amJDCmtN6IBk4plhyRQwnOE69UkWlKN0uQvF1STujCZdxoTrEasQq+uc+EaSpWZ37QWB52OMcE1Gx8aOpMdr+gMLI80sZ8wYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":340,"cache_read_input_tokens":47810,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsD3ceQ7zNKKKQp87qx3","type":"assistant","uuid":"f61f8d90-e046-4882-b56c-61c3e0add5ff","timestamp":"2026-01-07T02:13:33.900Z"}
{"parentUuid":"f61f8d90-e046-4882-b56c-61c3e0add5ff","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JvvJ4LofqnSJx5Nw6XXRLf","type":"message","role":"assistant","content":[{"type":"text","text":"Good question. Let me identify the **critical gaps** in what we've covered:\n\n## Critical Missing Areas:\n\n### 1. **Error Handling & Resilience**\n- User submits feedback → EngagementService acknowledges immediately?\n- If Salesforce is down, do we queue Case creation (message queue/Event Bus)?\n- Retry strategy? Dead letter queue for failed Case creation?\n- How does user know their feedback was received vs successfully created in Salesforce?\n\n### 2. **Contact Reconciliation/Deduplication**\n- During migration: How do we match app database Contacts to potentially existing Salesforce Contacts?\n- Matching logic (email? phone? VCI? Salesforce External ID?)\n- What if Contact already exists in Salesforce from other channels?\n- ProfileService JIT: Always creates new Contact or checks for duplicates first?\n\n### 3. **Case Data Model Mapping**\n- What fields does Mobile App submit? (description, category, attachments, screenshots, device info?)\n- How do these map to Salesforce Case fields?\n- Case Type/Category classification (App Issue, Transaction Dispute, Product Issue, Store Feedback)?\n- Custom fields needed for digital channel Cases?\n\n### 4. **Multi-Tenant Data Isolation**\n- Shared Salesforce instance - how do we separate OTR digital Cases from Viva Energy wholesale/Shell Card?\n- Record Types in Salesforce? Separate queues? Field-level security?\n- Data visibility rules (which support teams see which Cases)?\n\n### 5. **Salesforce Integration Specifics**\n- REST API? Bulk API? Platform Events?\n- Authentication (OAuth 2.0? Service account credentials? Named user license?)\n- API rate limits (how many Cases can we create per hour)?\n\n### 6. **Case Routing & Customer Notifications**\n- How do Cases get assigned to the right support team in Salesforce?\n- How do customers get notified about Case status/resolution? (Email from Salesforce? Push notification via EngagementService/Braze?)\n- Can customers view Case status in the app?\n\nWhich of these are most critical to address first?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":340,"cache_read_input_tokens":47810,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":1721,"service_tier":"standard"}},"requestId":"req_011CWsD3ceQ7zNKKKQp87qx3","type":"assistant","uuid":"881d5148-2b94-4389-9ee9-d8c6efff0264","timestamp":"2026-01-07T02:13:39.327Z"}
{"type":"file-history-snapshot","messageId":"36d88666-06bf-4c3e-9bd4-944b0444f147","snapshot":{"messageId":"36d88666-06bf-4c3e-9bd4-944b0444f147","trackedFileBackups":{},"timestamp":"2026-01-07T02:13:59.457Z"},"isSnapshotUpdate":false}
{"parentUuid":"881d5148-2b94-4389-9ee9-d8c6efff0264","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"one by one"},"uuid":"36d88666-06bf-4c3e-9bd4-944b0444f147","timestamp":"2026-01-07T02:13:59.425Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"36d88666-06bf-4c3e-9bd4-944b0444f147","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Dei1heXchGsergRHPCbsdq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to go through these critical gaps one by one, asking questions to fill in the details. Let me start with the first one.","signature":"ErICCkYICxgCKkAZZDWA1lFvzHLFj5fXTfzNQw9fMtXXs7QTnNoK0A97zrTMUYZVAYohW2oOBMaGI5BrVvJjVwJSV9dxAohEF4oAEgwHVifc96imZHmSwckaDD7V7XKu2LQeD5lUpSIwSmb9kaP6EmkfHsp8i4FGSgslPvf6jClFCyJB0JyR/AWT1OXNBEGoBv/PrNyG/GWaKpkBXV0bNUSXN3K2Rwz2nTT8qJvsTOcZJ29asUttreDvqHhW1Whh9NizadU4ORmO2tTam4aoLbjVRd1BNU+yIQpbfUQKA0BgCP7lDVcEBVMkQBiFQnR/pxB0hVmJTzPQWfriHB6O/YIa+iQF4FhcNNgQmBTNbyViuIzer/iHjQ4pfBDuYPvmbDy37/atCyg8bKth9QuKRuZxHJHTGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":504,"cache_read_input_tokens":48150,"cache_creation":{"ephemeral_5m_input_tokens":504,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CWsD8GExHD9uu1M9m9Apx","type":"assistant","uuid":"44b78f83-458c-4e7c-ba48-1aa451fad47b","timestamp":"2026-01-07T02:14:02.969Z"}
{"parentUuid":"44b78f83-458c-4e7c-ba48-1aa451fad47b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Dei1heXchGsergRHPCbsdq","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect. Let's start with **#1: Error Handling & Resilience**.\n\n**Question 18:** When a user submits feedback in the Mobile App, what's the immediate user experience?\n\n- **Option A:** User gets instant confirmation \"Feedback submitted\" (EngagementService acknowledges immediately, queues Case creation)\n- **Option B:** User waits for Salesforce Case creation to complete before seeing confirmation\n- **Option C:** User sees \"Feedback submitted\" but gets a follow-up notification once Case is created in Salesforce\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":504,"cache_read_input_tokens":48150,"cache_creation":{"ephemeral_5m_input_tokens":504,"ephemeral_1h_input_tokens":0},"output_tokens":165,"service_tier":"standard"}},"requestId":"req_011CWsD8GExHD9uu1M9m9Apx","type":"assistant","uuid":"0f303d7e-6bd7-4440-ab13-df8cba88d2ea","timestamp":"2026-01-07T02:14:05.302Z"}
{"type":"file-history-snapshot","messageId":"a063738b-e56d-4724-8748-3e28b01affe3","snapshot":{"messageId":"a063738b-e56d-4724-8748-3e28b01affe3","trackedFileBackups":{},"timestamp":"2026-01-07T02:15:56.032Z"},"isSnapshotUpdate":false}
{"parentUuid":"0f303d7e-6bd7-4440-ab13-df8cba88d2ea","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Option C"},"uuid":"a063738b-e56d-4724-8748-3e28b01affe3","timestamp":"2026-01-07T02:15:56.003Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"a063738b-e56d-4724-8748-3e28b01affe3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017CqbFkYLh3upndiDapU4GW","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Option C - User sees \"Feedback submitted\" immediately, then gets a follow-up notification once Case is created in Salesforce.\n\nThis implies:\n1. Mobile App → EngagementService (immediate acknowledgment)\n2. EngagementService queues the Case creation request (async)\n3. Background worker processes queue → creates Case in Salesforce\n4. Once successful, triggers notification back to user\n\nThis requires:\n- Message queue/Event Bus for async processing\n- Notification mechanism (push notification via Braze through EngagementService?)\n- Handling for failed Case creation (retry, DLQ)\n\nLet me ask about the notification mechanism next.","signature":"EpoGCkYICxgCKkBNPOQpH1olGm5QSj3fw84CElIlGIpq98Wk4AQhcak5jRuY/URAs11Lv29yGjDJz8FTYbELeTSBQaKI/fYwB9NiEgzQXj28uufHKK4+eBkaDKeMVehe/iNGhuz3kyIw9Czu6/1KtEdiDeteZd/h11fQrqAn/DgkyamRLlPByqow++9E5YWsAe37Su6mFhQkKoEFnqkqU/Fo+D1QfCorufac7oru0gs/ddMN6LZ/8DaI56pmSRDE3mc8IbalSUgtKX+SSP5nvELhlXAqB34h2zO4HyWKicKJK83i9P5m+enqLjyXjUWYXUAM7nPGVicgjMh88i7IaeuAY4lo0Rz8HtcpkdLuk4pBEPOlkFP75n5dChF+CPjPMypsONrq0No/ql1tDj9EM1chUerEWmmrNGF/k5EATX8ACLnKusJ4dWjM/HCvQ9ZIb09jWj1KTcLoM9fXFTFnpt5VIBTWDLjf4drbKHMn/SS0Hw7c7BBPnlIclbuNuaZzCoqhlLVwvTu666Tnuufxgnw01Wfa3LL3tTIvowcPS1FoZQeDYGCce07+M+QEvtflcRmJpZOrYpIWGuAvBrmhLYHv8ycdQpIveHtyrJtKcweRazaI56Lpx5uq6iw4jScpG0CKfsEWVgduepHlZdydsHUKCySrxo2sxkQv0x87FWqc7lCfjhFXhc6c4Y0ZhDEF4/thzXztqPuSjFtvJ/LnH7A9zQbssYTzs6n7eZZ2iQ8d/MGo1tL/CNkM0hFpLGxtW+MZZJqDc8bvBJyaTeuELg9Kws87rmUIwHj8qebqiYI/4Uuy60QaFSfUbZpLYbNtqkIRMhlVVqEzKkXfo3ZldKHP8kNNx/ovy2koaeKYoKvFId4YJcOabuNxdyui0aK6sN/LU3MNjif3xuPwJDZ/u5WJ1BcB+FWWhksaBkZ+CSRJsVQ7GP8aRU+rHXq64ShedWJz/tT/iC6vzXrK4EDjdbilPm0KmOUXAeGULHPMPP3ONkIH020F6YH3D0LkqUA31Vxqk3fAePgiwmT4HJCQVuaRqGVa4Cd95ByYLpcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":132,"cache_read_input_tokens":48654,"cache_creation":{"ephemeral_5m_input_tokens":132,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsDGrqncXzLAwskVVrhN","type":"assistant","uuid":"0048f947-dfae-4c03-a08b-a2845f959599","timestamp":"2026-01-07T02:16:02.632Z"}
{"parentUuid":"0048f947-dfae-4c03-a08b-a2845f959599","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017CqbFkYLh3upndiDapU4GW","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **Option C: Immediate acknowledgment + async notification**.\n\nFlow:\n1. User submits feedback → Mobile App shows \"Feedback submitted\"\n2. EngagementService queues Case creation (async processing)\n3. Background worker creates Case in Salesforce\n4. User receives notification when Case is successfully created\n\n**Question 19:** How does the user get the **follow-up notification** when the Case is created?\n\n- **Option A:** Push notification via Braze (EngagementService publishes event → triggers Braze campaign)\n- **Option B:** Email from Salesforce directly\n- **Option C:** In-app notification center\n- **Option D:** Combination (email + push)?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":132,"cache_read_input_tokens":48654,"cache_creation":{"ephemeral_5m_input_tokens":132,"ephemeral_1h_input_tokens":0},"output_tokens":318,"service_tier":"standard"}},"requestId":"req_011CWsDGrqncXzLAwskVVrhN","type":"assistant","uuid":"a964575b-d890-41aa-ad95-0ab7a0ce7b1d","timestamp":"2026-01-07T02:16:05.581Z"}
{"type":"file-history-snapshot","messageId":"a77c1ad0-317b-4917-86fb-82369c812347","snapshot":{"messageId":"a77c1ad0-317b-4917-86fb-82369c812347","trackedFileBackups":{},"timestamp":"2026-01-07T02:16:30.658Z"},"isSnapshotUpdate":false}
{"parentUuid":"a964575b-d890-41aa-ad95-0ab7a0ce7b1d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"a"},"uuid":"a77c1ad0-317b-4917-86fb-82369c812347","timestamp":"2026-01-07T02:16:30.625Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"a77c1ad0-317b-4917-86fb-82369c812347","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Y81MT93cFjeHH6xFtcw5Px","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user chose Option A - push notification via Braze. So the flow is:\n\n1. User submits feedback → Mobile App shows \"Feedback submitted\"\n2. EngagementService queues Case creation (async)\n3. Background worker creates Case in Salesforce\n4. EngagementService publishes event (e.g., `SupportCaseCreated`)\n5. EngagementService consumes event → triggers Braze campaign → push notification to user\n\nThis aligns with the existing architecture where EngagementService has ACL to Braze for notifications.\n\nNext question should be about what happens if Case creation fails - retry strategy, dead letter queue, etc.","signature":"EokGCkYICxgCKkCAJnttwyVsSNhoVnBraA2UtpKcKUITlp+ENsLddKrr1tCB/UNelTU3CIZsU/a+SXz02KbG/rX1jUYG44gEvBQ0EgyS52jAMMNsVkfYT84aDOE94zqrHh1jX7Et1SIwAwiACuLs9ogCj77xjbEx7jFmoUGKKxqXH1pjnezB/IGoS8jMJHpf3hUzNM8WOc6bKvAEPibD8fSwNDx8Rj0vXKVpyaZI/AQP06TGAhtfofxv3eFr+R0IWzZptJO6wbE5djvq6kGd7ForjkCLzGNppYW/dVkniO7vAS9IVFrUPA95Py2vjD8JkVyze+TxlE/r8ooOVlxfltgg+fUKYzkZO0Mz02Z86latZeEa1pKO33OX48U0zFgAGrFhFwl3VmQLu2zQaZywFZmKUyzw5JC4WRSvecA08RZCfiN7YiPzBQOXEbOVv6CtDnOgeQJYBH0wl7q7ju/MAmedEEvEvLpyvp21wHFwcukD9BD2IqGU8xAuHtboFmCeWqFFheRGsCXEkMuiHUwC3S7ICqWBZi//GijDnKDQgAYqmQAxb0FmzxcTlj1Il3tT4sXtUpRdhcxlpPlaoXFaaa2RXHT39RWWP2FD48CyYnUk/w0uQaO18mASlGCl+PiIwy0WTziAfGgekhSvGOq0qjctS95V9242KEsjmwjdUVrnSy5YgDDtI9RgBll29Pzxxj6JuxvFNK6Mr/oOf51zpASC0BXgyTjEn++MA7TYFx4AsnFo0T6ldOsNZrC1pXGe7wrC9I/7QOQL+FrCOWwqGJrP9MZjCkuvvLvp/I0Hjzs5nGobxZjM6hREcvhWd6rYhpIvWJJSt/p+x8o0NpAOHlNGG2/DaUj0F/RrjiGAzQKyRZLsdCsfAFKxpPM2IpW0iWEkK4Pzdo9FKgd5PtfwRTQQ3qsYZJCwe5HbO0JPzcYNBxhNvIpmG9yEWx+iBs1GUGiscVuq89VNymEgAi3r4CX/cJa8QMHB9NKAdk29diTi9hmTxWxSDlsPWTzjQWB4Z2GhOSgYVpZoJ+QfGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":269,"cache_read_input_tokens":48786,"cache_creation":{"ephemeral_5m_input_tokens":269,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsDKQphNUPXuDzgou2Wc","type":"assistant","uuid":"3b5dd43b-ce1c-44a7-9a38-bd102e1141cd","timestamp":"2026-01-07T02:16:36.163Z"}
{"parentUuid":"3b5dd43b-ce1c-44a7-9a38-bd102e1141cd","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Y81MT93cFjeHH6xFtcw5Px","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Push notification via Braze**.\n\nFlow:\n1. User submits → \"Feedback submitted\" confirmation\n2. EngagementService queues Case creation\n3. Case created in Salesforce\n4. EngagementService publishes `SupportCaseCreated` event\n5. EngagementService (or event consumer) triggers Braze campaign → push notification\n\n**Question 20:** If **Case creation fails** (Salesforce down, API error, validation failure), what happens?\n\n- **Option A:** Retry automatically (exponential backoff), give up after N attempts → dead letter queue\n- **Option B:** Alert operations team, manual intervention required\n- **Option C:** Send different notification to user \"We're experiencing issues, we'll contact you via email\"\n- **Option D:** Combination?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":269,"cache_read_input_tokens":48786,"cache_creation":{"ephemeral_5m_input_tokens":269,"ephemeral_1h_input_tokens":0},"output_tokens":347,"service_tier":"standard"}},"requestId":"req_011CWsDKQphNUPXuDzgou2Wc","type":"assistant","uuid":"6db2521d-2ba7-40a1-a6d4-682fc276432c","timestamp":"2026-01-07T02:16:39.598Z"}
{"type":"file-history-snapshot","messageId":"df99d554-7f16-4958-97a9-8c9bcf167007","snapshot":{"messageId":"df99d554-7f16-4958-97a9-8c9bcf167007","trackedFileBackups":{},"timestamp":"2026-01-07T02:19:03.452Z"},"isSnapshotUpdate":false}
{"parentUuid":"6db2521d-2ba7-40a1-a6d4-682fc276432c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"A, with B"},"uuid":"df99d554-7f16-4958-97a9-8c9bcf167007","timestamp":"2026-01-07T02:19:03.424Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"df99d554-7f16-4958-97a9-8c9bcf167007","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MFmB6iuf2qd89Gr7NeaF6r","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so they want:\n- Option A: Automatic retry with exponential backoff, then dead letter queue after N attempts\n- Option B: Alert operations team when things fail/go to DLQ\n\nSo the error handling strategy is:\n1. Immediate ack to user\n2. Queue Case creation\n3. Retry automatically (exponential backoff)\n4. After N failed attempts → Dead Letter Queue\n5. Alert ops team when Cases land in DLQ\n6. Manual intervention/investigation\n\nNext question should be about the retry strategy specifics or move on to dead letter queue handling.","signature":"ErcFCkYICxgCKkDnt0r4ttIbRm5gU/OAosJZ8SvLcg0NVIy3bJSc1tyQb5B1QUCVSif0QzhQ4uvYrcFSxqLCOzee0836FKN+j+x6Egxg/8EKV49e/8+mmLgaDGw6vKyuY043eszA0SIw5sJPYNSpzLmPuKPDJ5UH+YgYoIk6lOAnRT0YWA3e6X15DBEl0/z5WqK0fEGaoR5WKp4E+4raIP19C8Dh47upzahrH6yr/E37juMIVgj75V3HxMnCiJ2y3vcNxXy4F4Zf1RLG46S1F6qt3adlVXHxTYOz2a8p/EJHBFo+x0Escvg3dCpj++nDGNxoqlnF8lLXsHgeAEKO1B8VyUFHC1BZ2PYWGquM7pvTlxQntuYP/LggjO7Jx6Mob3FY0wrhVXfyGh44EfTU/5XN/pBqlMQIb/SKubXUjWzwUCQ6Al+MgFBV/Hmaqi5N8jBI4zm1v5lW8PapdeKNcR98n3IkUusmGPvxvID1cJY88FJWBBMXLmpNRF1L5ObvaEFUTfA+fZAb019jebfnHyWNEG+g3kZChCrEKdkeLFKS8tsyb7EFldlnLNE4b/Exahy/DfkucE86mdX0pWcedObjzC0CadSkTVhuE2tRnq3RtSPQdi7F5OfkV+2eKyHr0c1+xQXD3Kxha4NwtD/AkZgzZD7ilF1da3jjGbsIuzSRwtYj/+0gfeY+56FutNv124KsnBSljfdbsqrxctUo4O/ZkzayOSGtsW6cSgtDL4h0xy2HTtb6M/FtJNjmXLeIT1PW8wBSLC9FkdHRdKtCJueOz+/WMiUWOe2rCUV68acL8IEpHJBvwkIsHVh8c3yO8dg6XS4Jnqj2FVeTD/DcOyn/fBRgB2aZVoYUYcVLHHogz9VtMZemFlN0O+ksD6cvcTH/O5vDIRW22KfcbNd/lKX4NZx2vuTJkisYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":194,"cache_read_input_tokens":49055,"cache_creation":{"ephemeral_5m_input_tokens":194,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsDWgbmx52CaxRQ19Q1d","type":"assistant","uuid":"7dab9d0d-d6f7-4c0e-b70e-83130160a0f7","timestamp":"2026-01-07T02:19:09.465Z"}
{"parentUuid":"7dab9d0d-d6f7-4c0e-b70e-83130160a0f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MFmB6iuf2qd89Gr7NeaF6r","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent - **automatic retry + ops alerting**.\n\nError handling flow:\n1. Case creation fails → retry with exponential backoff\n2. After N failed attempts → Dead Letter Queue (DLQ)\n3. Alert operations team (DLQ monitoring/alerts)\n4. Manual intervention to investigate and reprocess\n\n**Question 21:** What happens to the **user** if their Case lands in the DLQ?\n\n- **Option A:** User never knows (ops team investigates and manually creates Case, then notifies customer)\n- **Option B:** User gets notification \"There was an issue, our team is looking into it\"\n- **Option C:** User doesn't get the success notification (absence of notification = potential issue)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":194,"cache_read_input_tokens":49055,"cache_creation":{"ephemeral_5m_input_tokens":194,"ephemeral_1h_input_tokens":0},"output_tokens":300,"service_tier":"standard"}},"requestId":"req_011CWsDWgbmx52CaxRQ19Q1d","type":"assistant","uuid":"8650b400-fecc-4f16-adcd-025baa1b600e","timestamp":"2026-01-07T02:19:12.913Z"}
{"type":"file-history-snapshot","messageId":"14489aad-7eaf-45e0-b5c4-e7b79afbe16b","snapshot":{"messageId":"14489aad-7eaf-45e0-b5c4-e7b79afbe16b","trackedFileBackups":{},"timestamp":"2026-01-07T02:22:35.629Z"},"isSnapshotUpdate":false}
{"parentUuid":"8650b400-fecc-4f16-adcd-025baa1b600e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"A"},"uuid":"14489aad-7eaf-45e0-b5c4-e7b79afbe16b","timestamp":"2026-01-07T02:22:35.580Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"14489aad-7eaf-45e0-b5c4-e7b79afbe16b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PEFMfwiKFPNz2RHU3A35t1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - Option A. User doesn't get notified about the failure. Ops team handles it behind the scenes and manually intervenes to create the Case if needed.\n\nThis means:\n- Happy path: User gets success notification via Braze\n- Failure path: User doesn't get notification, ops team investigates DLQ and resolves\n\nLet me move to the next question about the retry/queue mechanism.","signature":"EpwECkYICxgCKkBMJ6PbB2S3grsy9LGkDQdrp3CxIwqoFktuJUWXu5xUC8VqoV8TwPDIXbcxtM6tsc/qeSHQxoLfakPYNj2Mbg/SEgzEXI00nhXdi7HKhMwaDN2G/j2C4xeZdJc0xCIwrR/qWUZNXk/Pbbw2SGwCcvNhG8gefDOeds1zm/TxML33Tz/ZlHbr8w3UHG5uU6N2KoMDkJDDoRQAEy1X/UHwsfZPdLC2Jx/gVXuaAlfqJk8tBmhqfyJIxjJsKiYlToSZdVrOd/LxbCNZ/hevazEn1n7Kuu0oH4nOOGaSARkqyzZejBlYH6beWzzfaZob/BifUU6yvi2lqi2Qjb8OibP9Q87/ySChvBzLyeVTgXr6BJSdvTTcbqhxV2t9dNytwVSLO7yO526HADKRM9a1qpmXLn6eg9xrBdKoFC3PYI49/H1kuE0ZIeHaDbca8M9sZfCDibXZyJbm5xw/9LndYKJETPCbbumMHyAAg+LFbCY4nZIvG3Jo91j+BIjZkRvTvnTsY9OObu4z4qgMde7Z5rO+pzX3Q2ONyxtkcFHhZYavqC60vt/xPI78OT/pdHgaWlEx2JJBfaEg7RvSR7KEcN0pJ+zka1rhQidYvRZdGex3O39MojT0IQMXpdLC/S0MZcboDKgTzK5Dom02ZTJ2IDd9WkJToN9kXUjS1QmkZ/rlyvH171chNLbt8qHF9OCRGwEaSA70b67HGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":166,"cache_read_input_tokens":49249,"cache_creation":{"ephemeral_5m_input_tokens":166,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsDnKoaB9dfdmEy2hXdK","type":"assistant","uuid":"add3b930-a472-48c4-adc7-8196703227b6","timestamp":"2026-01-07T02:22:40.455Z"}
{"parentUuid":"add3b930-a472-48c4-adc7-8196703227b6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PEFMfwiKFPNz2RHU3A35t1","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **silent failure handling** by ops team.\n\nSo:\n- **Success:** User gets Braze push notification \"Your feedback has been received (Case #12345)\"\n- **Failure:** No notification, ops team investigates DLQ and manually resolves\n\n**Question 22:** What **message queue/event mechanism** does EngagementService use for async Case creation?\n\n- **Option A:** Event Bus (same infrastructure as domain events - SNS+SQS, EventBridge, Kinesis?)\n- **Option B:** Dedicated queue (separate from domain events)\n- **Option C:** Database outbox pattern (EngagementService persists pending Cases locally, background worker processes)\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":166,"cache_read_input_tokens":49249,"cache_creation":{"ephemeral_5m_input_tokens":166,"ephemeral_1h_input_tokens":0},"output_tokens":258,"service_tier":"standard"}},"requestId":"req_011CWsDnKoaB9dfdmEy2hXdK","type":"assistant","uuid":"d655e4df-c17a-497f-b410-6efee614604b","timestamp":"2026-01-07T02:22:44.016Z"}
{"type":"file-history-snapshot","messageId":"85b9f63e-87e9-4218-9f3b-22299c4f8fdf","snapshot":{"messageId":"85b9f63e-87e9-4218-9f3b-22299c4f8fdf","trackedFileBackups":{},"timestamp":"2026-01-07T02:24:40.668Z"},"isSnapshotUpdate":false}
{"parentUuid":"d655e4df-c17a-497f-b410-6efee614604b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"A"},"uuid":"85b9f63e-87e9-4218-9f3b-22299c4f8fdf","timestamp":"2026-01-07T02:24:40.637Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"85b9f63e-87e9-4218-9f3b-22299c4f8fdf","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016rhNZ1AjnyNcx7xVsSA4oY","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - they're using the Event Bus for async Case creation. This is consistent with the event-driven architecture.\n\nSo:\n- EngagementService receives feedback submission\n- Publishes command/event to Event Bus (could be a command like \"CreateSalesforceCase\" or just queues it)\n- Background worker subscribes to Event Bus, processes Case creation\n- On success: publishes `SupportCaseCreated` domain event\n- On failure: retries, then DLQ\n\nNow let me move to the next question about retry configuration.","signature":"EpgFCkYICxgCKkBC369qdhnyVgCINcQePwkAv4EOtA+OotkoooJHBTk37B6JoCsR8lg5ZWpAYwUt4veArWuelHhRq8dxy93nkurvEgzgw71tspP3sc8SrNUaDHQrphzP1TX197fYISIwEgt9K/BPk2/o/DzthC0ZhB7q5MpNK7N8CWScM/100dwGBfRuFNRFfDy/t6dLZ9JFKv8DmizYX7a21dSf6X/jZ1NJm/3G6DAZYJTNlgPoO/ftbLNMDZlHRMLgME+C2XeETY56+51FduU7EvZQXpJ0xCbQ1KF6LD1lyMMGB0/0kv+LbA6BCBkjVEWaYSCi8uiB2pRCADUG95ni3WRdvTT3F9nN43Z5nAyaghWyRAnlyOHCwR9RuhSXi8+6LmeCJfQznmibLASBc4gzOZFbWHJlajKZLX8x5U9sOWmgq44c8IRvwsmPeOjB7RWUEM/Gu11r+XeGdBku6Z4bo0w+RGDcfRX1yiu82X+vQzNer6QPTM8FTUL1iTTG/FZ4bXAJEPYBuwyY7yPZVnLraWHFzf8ZRs6+4P2/cUUqzSeTB+0cnCNhBvFks5vhaisOQFtYRvsP1QzUzdDhrkBDKiJYhmvJ4iDv1pH/CfRzeyHY1JzD+oV8qRSVyq8mc8mCZ6MXRmuEcADUVpkRI3W4xioVzvOpum2VqDEHkZjiidmVroq4daX8V2AgRq5GuR/0lDdR7LrgCOmXkx12ptaXroofN4ozrtJYj3K8COI41J+4FbzaWsYMWYY+F9VzDXPuT6rs4CqrE0BIkI5Q92xUv+7cSoS1OJbzy3dgnlRrZlsqN+v+NW6GfsKEKY22GTTLLi4sargJYwE9LHhHAHf4ATfOsn/Me6z9uUe2PyZmuRv8cgiw31ca9xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":269,"cache_read_input_tokens":49415,"cache_creation":{"ephemeral_5m_input_tokens":269,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsDwYWZJV5zfQg1cjPXU","type":"assistant","uuid":"67571c32-766a-4bd0-9e13-67ee57dc9b16","timestamp":"2026-01-07T02:24:46.657Z"}
{"parentUuid":"67571c32-766a-4bd0-9e13-67ee57dc9b16","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016rhNZ1AjnyNcx7xVsSA4oY","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Event Bus** (consistent with event-driven architecture).\n\nSo:\n- EngagementService receives feedback → publishes to Event Bus (command/work item)\n- Background worker subscribes → processes Case creation\n- Success → publishes `SupportCaseCreated` domain event\n- Failure → retry → DLQ\n\n**Question 23:** How many **retry attempts** and what's the **backoff strategy**?\n\n(e.g., \"3 retries with exponential backoff: 1min, 5min, 15min\" or \"5 retries over 24 hours\"?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":269,"cache_read_input_tokens":49415,"cache_creation":{"ephemeral_5m_input_tokens":269,"ephemeral_1h_input_tokens":0},"output_tokens":271,"service_tier":"standard"}},"requestId":"req_011CWsDwYWZJV5zfQg1cjPXU","type":"assistant","uuid":"43c49d20-5aaa-4a47-8e59-c054aecb3c21","timestamp":"2026-01-07T02:24:48.484Z"}
{"type":"file-history-snapshot","messageId":"a3e34e91-ab86-46e7-9726-24d8b7f0145f","snapshot":{"messageId":"a3e34e91-ab86-46e7-9726-24d8b7f0145f","trackedFileBackups":{},"timestamp":"2026-01-07T02:25:38.320Z"},"isSnapshotUpdate":false}
{"parentUuid":"43c49d20-5aaa-4a47-8e59-c054aecb3c21","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"That should configurable"},"uuid":"a3e34e91-ab86-46e7-9726-24d8b7f0145f","timestamp":"2026-01-07T02:25:38.284Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"a3e34e91-ab86-46e7-9726-24d8b7f0145f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01D7VdL4XfJDdNSsCKzSo3vV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good point - making retry configuration flexible is a best practice. This is an implementation detail that should be configurable rather than hardcoded in the architecture document.\n\nLet me move on to the next question. We've covered error handling and resilience pretty well:\n- Async Case creation via Event Bus\n- Immediate user acknowledgment\n- Success notification via Braze\n- Automatic retry with exponential backoff (configurable)\n- Dead letter queue for failed attempts\n- Ops team monitoring and manual intervention\n- Silent failure handling (no user notification on failure)\n\nNow I should move to the next critical gap: #2 Contact Reconciliation/Deduplication","signature":"EsEGCkYICxgCKkCziDjZebp4rj/H5J510r4+o+dOVgDutiHNIyw70jKHzYx/5u5MCMV7fXxQBbxuPuQnT+GRUOx7BJHexMKiEod+EgwEJ4oRMYr6OROaK7EaDGS9FLLXIdgYLIAZKCIwcAmjSxo0aaJasZ0humKH/kUZ89nPhxWfi4HeeU5+LYoj0rreIgN6c7RtMVDt3YBKKqgF9hT0DT2sRXwUCfq6Deps6fYsk6OIj614Nayma4y7GpzdmTkJnsj9MfvV6QUNwne931mRZS3GfacY/Hcw/76q8ZdLUp/GMmr8Isd6Cpj4OkHspoKNLBn8+n3EEJJj7YcIY4MrwRUXuvSlNzE7LMaOZ/4RNmBbZcXZwipwiDz1/rG947OzQimH009VOurNG9wcavD57x5THaErCGpl+Y9IFGgakHhHSLZY9QiwmfUeq78nR31+JwBS4sZ5ZwvFNZWAE6tua7ME+H6F8dEXmrOc87/jjlBXDNzUXUEk5jJjdNURGgwKR6lKO376dbpptVdl4HLLOYshw/flRDauGlwjFr5mwbNOrwTtVgXSp4QyxFgiU0l2fZaFk1ufoNVZghLibIlg/57LZE/VLEbp0qg85UM/6w5xcdfX49zYksfzS1m5JLY+CR6OBkJZA/BxFPSK/I5aGRJezZLmirhM3qWXDqTQNAZI+CZ5NpvusUmZJgv5TXYUWlHCqP8oHRLXG+/Dlv7R+dmGngeqNuSJuIxZ6sGhFLp8bwCgk5l20fOBWzAg/QHOZnCYsTzLVyBEuBnBEl5CeDSxK8Nekxt+EmM/P/sQ2h8P927RLg3vvj1zJWMCVuWrG99UAjap+RphrXE7yJBrbpoOG/xWflAtYR8b62/JLLMX7+TOfhMZqXAyxCMU04N3CVShqNZrNE2tr2vImGh+lH/pyXxYCfU6OcpyXv0dncOK7SqsyddrbR/3zKY1t10iF+apierdHaOZFvspZbYFiPE9wgqN5LMpcPZZpu+efa0ffXWR0PLNozpTiS7iFdxVuBWE3hykHdEdMDNgPHzfZfVkc9pK9/F2G2gl3I8f/U6gt1bU4S0uI30rYbDEa4zqL5h0cxABMhyDHu/slrf1t9O9oasYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":148,"cache_read_input_tokens":49684,"cache_creation":{"ephemeral_5m_input_tokens":148,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsE1oSr557L3JH42BP4X","type":"assistant","uuid":"d928d840-83cd-41bb-85da-ada4c44fb91a","timestamp":"2026-01-07T02:25:48.689Z"}
{"parentUuid":"d928d840-83cd-41bb-85da-ada4c44fb91a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01D7VdL4XfJDdNSsCKzSo3vV","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **configurable retry policy** (implementation detail, not architecture decision).\n\nWe've covered error handling:\n- ✅ Async Case creation via Event Bus\n- ✅ Immediate user acknowledgment  \n- ✅ Success notification via Braze\n- ✅ Retry with exponential backoff (configurable)\n- ✅ Dead letter queue + ops alerts\n- ✅ Silent failure handling\n\nMoving to **#2: Contact Reconciliation/Deduplication**.\n\n**Question 24:** During the **one-time migration** from app database → Salesforce, how do we handle **potential duplicates**?\n\nIf a Contact already exists in Salesforce (from other Viva Energy channels), do we:\n\n- **Option A:** Match by email/phone → update existing Contact (don't create duplicate)\n- **Option B:** Always create new Contact with source identifier (accept duplicates, manual cleanup later)\n- **Option C:** Match by Salesforce External ID field (e.g., VCI) → upsert logic\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":148,"cache_read_input_tokens":49684,"cache_creation":{"ephemeral_5m_input_tokens":148,"ephemeral_1h_input_tokens":0},"output_tokens":397,"service_tier":"standard"}},"requestId":"req_011CWsE1oSr557L3JH42BP4X","type":"assistant","uuid":"161db27a-8611-4d09-bd24-eb71ef1181a7","timestamp":"2026-01-07T02:25:53.677Z"}
{"type":"file-history-snapshot","messageId":"b702fc50-4ae8-42f8-a943-f3cc7c49dbed","snapshot":{"messageId":"b702fc50-4ae8-42f8-a943-f3cc7c49dbed","trackedFileBackups":{},"timestamp":"2026-01-07T02:26:34.832Z"},"isSnapshotUpdate":false}
{"parentUuid":"161db27a-8611-4d09-bd24-eb71ef1181a7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Upsert, matched by whatever params provided"},"uuid":"b702fc50-4ae8-42f8-a943-f3cc7c49dbed","timestamp":"2026-01-07T02:26:34.803Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"b702fc50-4ae8-42f8-a943-f3cc7c49dbed","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KZyrh17xTYDPLH42Db8wAp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - upsert logic with flexible matching based on available parameters. This makes sense for resilience.\n\nSo the migration will:\n- Try to match existing Salesforce Contacts using whatever identifiers are available (email, phone, VCI, etc.)\n- If match found → update existing Contact\n- If no match → create new Contact\n- Use Salesforce's upsert capabilities\n\nThis handles cases where Contacts might already exist from other channels or previous interactions.\n\nNow I need to ask about the ongoing JIT reconciliation - does ProfileService use the same logic?","signature":"EtMFCkYICxgCKkBBzfWE7qEF++wfEG9ygN/uc3WTPeGqC10RNQflQPvbkT/exd9hAFPGckM9OmU1Wfn0F9x8zt57JBAUoqqE6/pAEgzhj6fp3+XPwvP6OLcaDA/Ja9R/V8LhqueRECIwlSetvtVvP8Mnzc9nkHZDuKsUsojxZmwgb+VavYAsCYdLuppD35RTOp4d39Hw0UitKroEJHXJfUG5/RvsfHg+RL3aeUfcN/KupTjKlb4Vc3q7ZbyCn7s+AOmees0zfsKrjcsXv8M1cPQ9dhQYiWElG/oQKSh/u4cIRsm0UC6uNTJoLNS/FUeDXaYQygPr5I6nK7JNMM5sXkDcD0/x2GQ/ldfFcjpPVtRHkpRP87cbHXsis8vzILZTxjucBDXHWzXRVdfHePZQSzuOCqaoYEzWMfyo1zaoAS76kMzHhUcMs23/KMH/nQpisAwEWfwgkFcNFHcIAPNLwHhjLYjSdngcIrBthNIWOjFZ3BiECqbSMeHkOl/XlTrCivOrwbSGdXQ+PNgRxkg6K2qUbWqHiZuxJugaL2QxwRzHHsj/Hx9lqpzXe4daw8aslz5G8Ou0usZ3c1iTfa4FIE26m+co0TNEKX6U/LdvO7H3/zy5r5+dmCHPn9VKGiQAokr+dzDdW1XfkdrrldAN/Nfzhwlpf7SkoAUMRroq+NshPdqCakkBE9G/X06PJfeU/wNIKmEtmpRSUMewx4bqfCYn4Rbo5lxfzNvH3SIHe5pAC7bPE9Tn9VtcunbOxrvnoopgGM6BReUHsAPUkpoKvVUfw2NtsIZbVvpznS+kRPB9HhwtbzL68VT+W9w0TcXVX6LpfMbHTh+Oi9/WDf/NNijnCODtgs8A0zGzS09yP8wbBF+ELXLy+iZNisHsyX4JxNFv4cg+PPmf5tJF2QS+kICfXB3TW3JiNs9zUY/eFrK81D5HAk9g2zmBxJB7E64Vn3FGl5qnGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":259,"cache_read_input_tokens":49832,"cache_creation":{"ephemeral_5m_input_tokens":259,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsE5xm3cFBUXzoBqSvmD","type":"assistant","uuid":"3f421e97-e536-42b9-8a0f-2b071119a7aa","timestamp":"2026-01-07T02:26:42.158Z"}
{"parentUuid":"3f421e97-e536-42b9-8a0f-2b071119a7aa","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KZyrh17xTYDPLH42Db8wAp","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **upsert with flexible matching**.\n\nMigration logic:\n- Match on available identifiers (email, phone, VCI, etc.)\n- Match found → update existing Contact\n- No match → create new Contact\n\n**Question 25:** For **ongoing ProfileService JIT reconciliation**, does it use the same upsert logic?\n\nWhen a user authenticates via Mobile App:\n1. ProfileService checks if Contact exists in Salesforce (match by...?)\n2. Exists → update Contact details\n3. Doesn't exist → create new Contact\n\nWhat's the **primary matching key** for JIT lookups? (VCI? Email? Salesforce External ID field?)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":259,"cache_read_input_tokens":49832,"cache_creation":{"ephemeral_5m_input_tokens":259,"ephemeral_1h_input_tokens":0},"output_tokens":282,"service_tier":"standard"}},"requestId":"req_011CWsE5xm3cFBUXzoBqSvmD","type":"assistant","uuid":"f027a314-c8f0-4ba6-b1f8-60a8d6a32deb","timestamp":"2026-01-07T02:26:44.780Z"}
{"type":"file-history-snapshot","messageId":"4a8d7bb7-c7fe-4791-a4e9-4aa996c22cdb","snapshot":{"messageId":"4a8d7bb7-c7fe-4791-a4e9-4aa996c22cdb","trackedFileBackups":{},"timestamp":"2026-01-07T02:27:11.830Z"},"isSnapshotUpdate":false}
{"parentUuid":"f027a314-c8f0-4ba6-b1f8-60a8d6a32deb","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Probably email address"},"uuid":"4a8d7bb7-c7fe-4791-a4e9-4aa996c22cdb","timestamp":"2026-01-07T02:27:11.807Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"4a8d7bb7-c7fe-4791-a4e9-4aa996c22cdb","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011GsQtAi7dZJciQxwpPwfYS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user says \"probably email address\" which suggests they're not entirely certain. This is an important architectural decision because:\n\n1. Email can change\n2. Users might use different emails across channels\n3. Email matching could create duplicates if user changes email\n4. VCI seems like it would be the more stable identifier given it's the \"universal customer identifier\" mentioned in the project docs\n\nI should ask a clarifying question about whether email is the right choice, or suggest VCI as an alternative, given that VCI is described as the \"Universal customer identifier\" in the ubiquitous language.","signature":"EokGCkYICxgCKkAomYgq2WOjvPGMLOQ4+XzOrlSqsbv0ibidDUkrV6C4Qx53xfvcGX6PG2f12a73MXrYkBV2+JRejqxI78OY3R3BEgz5yLZmrXVACansvvkaDFyAw9KMG91aPjzdjSIwq8oaQt9Cd2VIpvhRU/qPVZNCdtLrJGnrVH730kIV/67RJa5kq2uqP9s85heHkPZWKvAENyAoYbyKIDb4+O/FdBai5SffP5gnw05WC4u45zlMuePycrcuGBiX9b5jBWkCu+gNax8Zdm2tAM+9DVaTcSuH2OSVbvBHY4xhxnKs1PlrGyX7LfxgHlY1fcJljtpcrfP4mbnPDIZidzmjp2J6YE5J6wrKFgbPg/WKRbLOngHW65OQ2UbbGLsV0IN7Sw1TeFgK7vEgJQLBcU9OGBWs7bWQvdVgGoJy7t35csZa5e8OOrkik14FcCW6rZS+VBDmMcJwXLmpA8/Dmjl1oZ3lULJlOlsFPXVK4JO1WvLpdHPgOX3sYKoDleCQwG58DQ35WZmf1LoZBKYigyn37IpgzdIXL7gnynI6cRNK5HfCrOK5SmYf915TKWFwqyq53AeC2qTEbjaJ8x+qkPcrwrqB33YtuFj1k9RWOnvOReZ5XP41qfN7fVfD7ddOmO1QOOSfwhBS5w4cpvKsAGb5/IU/Dxkdy/CBSFBDFx05Qa1DuzZ7y9CGgsTRSrHKQcI34Vi5q24og20pmduNBCFPlmuMCNOnnMkhCrrqBDO0pE1Eey891zDTrng4WW/6ZN7EyENAZKOfQfVrUsn5v+hxcivQEgWX+V6RSVp1eBQ9wKK0U/AntO74BwoNe94322yxAickUXoeXCSM8ZS+KyXhQn43Kd5d7Vp7nzwlDthkQjx78KqgBfUp1alB5DXE64dboI/DOoWG3B1Fk8gcTpySP/RxqXZv0lZjLlXtrMkLHup9uHB433ubJuCjPXtZNzwzjtkm4shg1o7KwVSNHYqC1hQbN0gGCmbqJoXioJ09LeGxQfmbQw2kwXJgc4G6bS8NxviPNp55GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":262,"cache_read_input_tokens":50091,"cache_creation":{"ephemeral_5m_input_tokens":262,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsE8gxN7JKTDbnzQM6Yi","type":"assistant","uuid":"196bb464-8ac0-4b1d-9649-40c39d92546d","timestamp":"2026-01-07T02:27:19.090Z"}
{"parentUuid":"196bb464-8ac0-4b1d-9649-40c39d92546d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011GsQtAi7dZJciQxwpPwfYS","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **email as matching key** for JIT reconciliation.\n\nProfileService flow:\n1. User authenticates → ProfileService has user email\n2. Query Salesforce Contact by email\n3. Match found → update Contact, return Salesforce Contact ID\n4. No match → create new Contact, return Salesforce Contact ID\n5. Mobile App caches Contact ID\n\n**Question 26:** What if a user **changes their email**?\n\n- **Option A:** ProfileService creates new Contact (duplicate risk)\n- **Option B:** Salesforce External ID field stores VCI (stable identifier) → match by VCI first, email second\n- **Option C:** Not a concern (email changes are rare, manual cleanup acceptable)\n\nWhich approach? Or should we use **VCI as the primary matching key** instead?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":262,"cache_read_input_tokens":50091,"cache_creation":{"ephemeral_5m_input_tokens":262,"ephemeral_1h_input_tokens":0},"output_tokens":315,"service_tier":"standard"}},"requestId":"req_011CWsE8gxN7JKTDbnzQM6Yi","type":"assistant","uuid":"21e787ba-8a3f-417a-be5d-2491fde5ed0b","timestamp":"2026-01-07T02:27:22.478Z"}
{"type":"file-history-snapshot","messageId":"86237c15-9f18-4459-b303-c8dcdfe2f458","snapshot":{"messageId":"86237c15-9f18-4459-b303-c8dcdfe2f458","trackedFileBackups":{},"timestamp":"2026-01-07T02:28:27.774Z"},"isSnapshotUpdate":false}
{"parentUuid":"21e787ba-8a3f-417a-be5d-2491fde5ed0b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"C"},"uuid":"86237c15-9f18-4459-b303-c8dcdfe2f458","timestamp":"2026-01-07T02:28:27.745Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"86237c15-9f18-4459-b303-c8dcdfe2f458","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Gv1GMEdB3ZKAwA3vepvwEo","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user says \"C\" - email changes are rare, manual cleanup is acceptable. So we stick with email as the primary matching key for ProfileService JIT reconciliation.\n\nLet me continue with the next question about Contact reconciliation/deduplication.","signature":"EqADCkYICxgCKkDx557BuBbuSRyt/OBqLge5fmm4iAE107YNVyMw/ir+KUIEMquaXzbJB8EJpYzDA9ju3J7OTfzgq5RuTdGTeRyVEgy6X7nK5uzmVjEy17EaDOS0TottHkcXutt63CIwI8vXSsTIzCrrmExUmC5iVDG0njYSPYegSJJ66lqY+MptsFB4Vf8Y/TIS5aWh7UkEKocCx0DIZfhAy9lfwiwqcqYhrnRlQN6FjXA/Gd6mvwy+lG0Jtag645kR2k4k6zxzmNgBcDD0i4GFp9ku5QKD1poOkhRZnBN4Xr8DaNYFHsDPRICafSUjLP+qVP8rS5mtvqDvYmi9KAkTr/3to24PMbtgxKEyel5QsMiyNd5Ru1D0rqD7vMMn8bZ4tYqdJwOwWMrSsPE2iEXkAs9bf9aPQTgsmsEl8FhMW2OhpasDy+B/CWQJlx9VQPTgsqctnbamXRnKpOB14UBkVf9hgXJsAAyP6zf4eZFAcLdMKPI1CC1tlziHFjLtD1E6ZgBq+WLF6QNQQmShn7Oblm6CWoDWK9qEf2aHKu8fpa8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":185,"cache_read_input_tokens":50353,"cache_creation":{"ephemeral_5m_input_tokens":185,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsEEHZcLsWXbtAyzxHf1","type":"assistant","uuid":"72eec458-c1fe-4c6a-893e-806a9dbd1980","timestamp":"2026-01-07T02:28:31.478Z"}
{"parentUuid":"72eec458-c1fe-4c6a-893e-806a9dbd1980","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Gv1GMEdB3ZKAwA3vepvwEo","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **email as primary matching key**, manual cleanup for rare email change scenarios.\n\nContact reconciliation covered:\n- ✅ Migration: Upsert with flexible matching (email, phone, VCI, etc.)\n- ✅ JIT: Match by email, create if not found\n- ✅ Email changes: Rare edge case, manual cleanup\n\nMoving to **#3: Case Data Model Mapping**.\n\n**Question 27:** What **information does the Mobile App submit** when creating feedback?\n\nFor example:\n- Description (free text)\n- Category/Type (App Issue, Transaction Dispute, Product Issue, Store Feedback)\n- Attachments (screenshots, photos)\n- Device metadata (OS version, app version, device model)\n- Location/Store ID (if relevant)\n- Transaction ID (for disputes)\n\nWhat fields does the feedback form capture?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":185,"cache_read_input_tokens":50353,"cache_creation":{"ephemeral_5m_input_tokens":185,"ephemeral_1h_input_tokens":0},"output_tokens":258,"service_tier":"standard"}},"requestId":"req_011CWsEEHZcLsWXbtAyzxHf1","type":"assistant","uuid":"a7de1300-5146-4c79-8a3e-f6dd989ec5b3","timestamp":"2026-01-07T02:28:36.267Z"}
{"type":"file-history-snapshot","messageId":"4fa56212-9e98-4fb9-a9bf-001e52937d00","snapshot":{"messageId":"4fa56212-9e98-4fb9-a9bf-001e52937d00","trackedFileBackups":{},"timestamp":"2026-01-07T02:29:29.703Z"},"isSnapshotUpdate":false}
{"parentUuid":"a7de1300-5146-4c79-8a3e-f6dd989ec5b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Category selection - App, Service, Order, Rewards, Refund, Delete Account"},"uuid":"4fa56212-9e98-4fb9-a9bf-001e52937d00","timestamp":"2026-01-07T02:29:29.673Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"4fa56212-9e98-4fb9-a9bf-001e52937d00","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LLNfidNn674djRXCCtqdfG","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so the feedback form has a category dropdown with 6 options:\n1. App\n2. Service\n3. Order\n4. Rewards\n5. Refund\n6. Delete Account\n\nThese are the user-facing categories. I need to understand what other data is captured.","signature":"EoQDCkYICxgCKkDomGhcFReT65+MmjhAm3n2kjnxtUK/TL0+vDaS4XFddCRUf4Nno6pk18S9M737ok4vRsXW8BPBKZanKNVMK8fsEgy0scQ7yqCfpCzerPUaDCtuXCLQo28H41HUuiIwb8bRB1QnfUh4PPFSyZAdIFNflgwF88tdIssPnmQETH5yn7LgkvdbSAFVPqG3LvfLKusBSdEBhhrdNa8TL5PGRWSfMiqCebi3SkrfhFEMEG7aYgUG6O7lor6+q0xKPjqHj0yndbXvppN1yAeAhB7Y7o3ARAmns9oxM5MA5Nn8gy2shacG9k8Z4z5L/BwB51AWhF6na8Nti1BonwIaH5sR4sjrGMynfmqOohmfDnxSMyM1ZOgGIo0gAsE6jjs13ADF9DRsVq21hOaMiKJzjwaNRn2WFsxsnSTXYczos4hGHyAycTa1sKEgk4CiSxoDzPycLeF3R3n7qgO9G/AWBBkOapdk4a0xaGry9cAjurl+GQVWPTPdkN8klN/C3AhWthgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":219,"cache_read_input_tokens":50538,"cache_creation":{"ephemeral_5m_input_tokens":219,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsEJrRA7GeSBJCRL1Wwi","type":"assistant","uuid":"f6aaa9b2-5803-424d-9226-59808465ffc7","timestamp":"2026-01-07T02:29:33.862Z"}
{"parentUuid":"f6aaa9b2-5803-424d-9226-59808465ffc7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LLNfidNn674djRXCCtqdfG","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **6 feedback categories**:\n1. App\n2. Service\n3. Order\n4. Rewards\n5. Refund\n6. Delete Account\n\n**Question 28:** Besides category, what other fields does the feedback form have?\n\n- Description/comments (free text)?\n- Attachments (screenshot upload)?\n- Related transaction/order ID?\n- Store location?\n- Contact preference (email/phone)?\n\nWhat else do users provide?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":219,"cache_read_input_tokens":50538,"cache_creation":{"ephemeral_5m_input_tokens":219,"ephemeral_1h_input_tokens":0},"output_tokens":176,"service_tier":"standard"}},"requestId":"req_011CWsEJrRA7GeSBJCRL1Wwi","type":"assistant","uuid":"94b46637-31ef-45a6-9e37-3fc956c9587f","timestamp":"2026-01-07T02:29:35.754Z"}
{"type":"file-history-snapshot","messageId":"0e30141f-10dd-45e9-ba4f-e5ea01ec344b","snapshot":{"messageId":"0e30141f-10dd-45e9-ba4f-e5ea01ec344b","trackedFileBackups":{},"timestamp":"2026-01-07T02:29:55.160Z"},"isSnapshotUpdate":false}
{"parentUuid":"94b46637-31ef-45a6-9e37-3fc956c9587f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Theres more, Store Name, Time of Visit, Contact Phone Number and free text message"},"uuid":"0e30141f-10dd-45e9-ba4f-e5ea01ec344b","timestamp":"2026-01-07T02:29:55.135Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"0e30141f-10dd-45e9-ba4f-e5ea01ec344b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013reiLNDpTtWQUiYi4VczLL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"So the feedback form has:\n1. Category (App, Service, Order, Rewards, Refund, Delete Account)\n2. Store Name\n3. Time of Visit\n4. Contact Phone Number\n5. Free text message/description\n\nI should ask how these map to Salesforce Case fields next.","signature":"EpcDCkYICxgCKkBjcazRMSS3f3o4SaqXcn6vbGziQc8nZ5UII+4//uxSNHwhDIo1TCWhJUgYSSQW3BVezhI3pZXo56V0XuvMNzINEgwmS5u+X7zECS0r9jIaDGtfBmBDydV9kvq9piIwZHpPlJzCAnGkBN+nfPoQATGs5QMtrmhfkHSVfWzyqFj/HB4WLbh260OMi5Lh2xoeKv4B+sfBNMIFZz7qIShKUiHgZqGAYoYg8XqkIikXg5gGyRCqLd+2wWPukeNXU6DCDuwjgy8VoKzYW7Nl5c0c6TzLWqLczf2CtQkJmEmp/cIca31p+A+S+NZz2oODBEKXeeyVR5gdj5oEUG8fNVx9+Yolm0HZaHk05C+qMv4hoMb67aKl+6LhbVNjZkeliPK3bfnza7WsswloxFMTb/xW3lFtr4Ag8qWwGjpPW8UD0m7nRnDFpGX2c8J1s5pvmRQV/FFHDaBGPaSaXPETqNnomwn71oqW2Vz+QomfzOndldmhRICVhdCxzxExs9nwRwTHsfU4xz7TLCNRr5a4qfFmLbUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":230,"cache_read_input_tokens":50757,"cache_creation":{"ephemeral_5m_input_tokens":230,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsELjMKC4afJZgRdhPrg","type":"assistant","uuid":"279f66c0-a5ed-439f-a5b0-e708b553588c","timestamp":"2026-01-07T02:30:00.096Z"}
{"parentUuid":"279f66c0-a5ed-439f-a5b0-e708b553588c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013reiLNDpTtWQUiYi4VczLL","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **feedback form fields**:\n1. Category (App, Service, Order, Rewards, Refund, Delete Account)\n2. Store Name\n3. Time of Visit\n4. Contact Phone Number\n5. Free text message/description\n\n**Question 29:** How do these fields map to **Salesforce Case fields**?\n\nStandard Salesforce Case object has fields like:\n- `Type` (e.g., \"Problem\", \"Question\", \"Feature Request\")\n- `Subject` (summary)\n- `Description` (details)\n- `Priority`\n- Custom fields\n\nDo we:\n- **Option A:** Map category → standard `Type` field\n- **Option B:** Create custom field `Feedback_Category__c` (preserve OTR-specific categories)\n- **Option C:** Map to Salesforce Case Record Types (App Issue, Service Issue, etc.)\n\nWhich approach for category mapping?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":230,"cache_read_input_tokens":50757,"cache_creation":{"ephemeral_5m_input_tokens":230,"ephemeral_1h_input_tokens":0},"output_tokens":282,"service_tier":"standard"}},"requestId":"req_011CWsELjMKC4afJZgRdhPrg","type":"assistant","uuid":"1f549fe5-4090-4d2a-a204-a87460f69f44","timestamp":"2026-01-07T02:30:03.924Z"}
{"type":"file-history-snapshot","messageId":"8338f558-4e7b-4261-984c-07c13520a030","snapshot":{"messageId":"8338f558-4e7b-4261-984c-07c13520a030","trackedFileBackups":{},"timestamp":"2026-01-07T02:30:22.983Z"},"isSnapshotUpdate":false}
{"parentUuid":"1f549fe5-4090-4d2a-a204-a87460f69f44","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Lets leave that unresolved"},"uuid":"8338f558-4e7b-4261-984c-07c13520a030","timestamp":"2026-01-07T02:30:22.936Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"8338f558-4e7b-4261-984c-07c13520a030","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016C8xAgLTqvg5EioQxWzVMs","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to leave the Salesforce field mapping unresolved - that's fine, it's an implementation detail that can be decided later. Let me move on to the next question about Case data.","signature":"EuUCCkYICxgCKkCNrKJ7tEClaL2ttcy9vm+QQlsAy2zCn1DBFFkKAgoDNQvd35Rkn3a6xCdOSLqYhndJqvMo+cS/IE62cXouLBJVEgyuKPv7Wkz/9fhMHpEaDJTrw8XCm2LnAJgRpSIw9EIWNMT7wzhllU5T8o6KF6t2ESYxlDWwIFRxoFv3GaiYfexR6s/qgAfUXVpMLfOjKswBmd/wF1zP+IHbdlpzwawvRawyBPlMRUg524F/eo13YudeCiOXk1rgEKyMhfT2Oc4BHeqHZywIAzEadx3JcshI7E9w7HswCp+x6zOPoqEdhmLf17ybvu4Jd2HuAxlw0cHhOQr48RHgEUCcJh/EYLANjj9k6HpJPfnoRebAxbavgIXBsv7ZpujI1diYym/7G8plEzrWtJyEydI3Wu5nNYSNvLaImSP7yhcxMatEDcKyKFbT72opfvHu9DQx6bqbcSm0bGYq0cETqJKHOri7GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":217,"cache_read_input_tokens":50987,"cache_creation":{"ephemeral_5m_input_tokens":217,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsENnNC5YbhftfdMyuKV","type":"assistant","uuid":"d0f4af76-7a18-4f51-8f91-71d67c292c4b","timestamp":"2026-01-07T02:30:27.254Z"}
{"parentUuid":"d0f4af76-7a18-4f51-8f91-71d67c292c4b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016C8xAgLTqvg5EioQxWzVMs","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **Salesforce field mapping = TBD** (implementation detail, work with Salesforce admin team).\n\nWe'll document that we're capturing these fields from Mobile App:\n- Category, Store Name, Time of Visit, Contact Phone Number, Free text message\n- Exact Salesforce Case field mapping to be determined\n\n**Question 30:** Does the feedback form support **attachments** (screenshots, photos)?\n\n- Yes, users can attach images\n- No attachments currently\n- Future enhancement"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":217,"cache_read_input_tokens":50987,"cache_creation":{"ephemeral_5m_input_tokens":217,"ephemeral_1h_input_tokens":0},"output_tokens":161,"service_tier":"standard"}},"requestId":"req_011CWsENnNC5YbhftfdMyuKV","type":"assistant","uuid":"72c7e13d-412a-4def-9c3d-c61f97a5545a","timestamp":"2026-01-07T02:30:30.275Z"}
{"type":"file-history-snapshot","messageId":"12503786-3851-41c8-bb2c-007ecf633eb7","snapshot":{"messageId":"12503786-3851-41c8-bb2c-007ecf633eb7","trackedFileBackups":{},"timestamp":"2026-01-07T02:30:45.325Z"},"isSnapshotUpdate":false}
{"parentUuid":"72c7e13d-412a-4def-9c3d-c61f97a5545a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Nope, and we're not considering adding it"},"uuid":"12503786-3851-41c8-bb2c-007ecf633eb7","timestamp":"2026-01-07T02:30:45.289Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"12503786-3851-41c8-bb2c-007ecf633eb7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QDe1tiLqfXut6HWaphhcNv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - no attachments. That simplifies the integration.\n\nSo Case data model mapping covered:\n- ✅ Feedback form fields: Category, Store Name, Time of Visit, Contact Phone Number, Free text message\n- ✅ No attachments\n- ✅ Salesforce field mapping: TBD (work with Salesforce admin team)\n\nMoving to #4: Multi-Tenant Data Isolation.","signature":"EvADCkYICxgCKkC9j6pOpkyazIpNItR7dPAHj9xlYQdhO06JTklxDabTPACAaiepLSCHJlg0X1eNHLADcrlOodzMmhM09oRic0leEgxhbyjv5AyPI6SYqNUaDO5CmHaeFlG8xhSHHCIwv4MpCHVIkgRSX75C1N3xcI3B3ih5nL4i7nuxR/PuvCwfsgzzMSuUyG2oNddDf61VKtcCdADPGk47RKemgTkU2lYwydQ1FKDJfobBXe+/9Jgp7Z+UxzNB3egGIGueAWKm1eFJDwpxTwCM/6FFfI9qUsGWqpbd0U0XOyVsNX1salZL+QVkXhwe9UuA3jzfqdRFs96TEUc+YeOVDHo5klGrES9UdAQa0Ef0fS26CmM0BcFww+zKmgy0UT03DCixevdTwG32/5vWcZ2Y/+ZyCn2YThpmNbwDvTTS4A5mU6Fu7vrkGDCC99sQLvixxzCQ3V/9ZNyrVwrbZZCnSMnD/nbM2AyjdLFLsuA0kkxD+6hC+PjvbMGcjav9vBCUMdSo2YW7bYk9aCIEUiAwGY9NGKfKaUUFxF4pf31x5F8tBsFzMAmVySbMP1rLK5OpVrMypl0ymstCqHv8g6zIdf1iqbISIQbjd0ADz0hFPXCtvSxzt/0IgCokE8/ze18cJRFGmHzar2wJfP1zVGmcrxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":125,"cache_read_input_tokens":51204,"cache_creation":{"ephemeral_5m_input_tokens":125,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsEQRj2QqjCtnnPP6Vgs","type":"assistant","uuid":"5fdd2dc4-5170-42ab-b9b5-bf0ae49e892e","timestamp":"2026-01-07T02:30:50.013Z"}
{"parentUuid":"5fdd2dc4-5170-42ab-b9b5-bf0ae49e892e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QDe1tiLqfXut6HWaphhcNv","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **no attachments**, simpler integration.\n\nCase data model covered:\n- ✅ Fields: Category, Store Name, Time of Visit, Contact Phone Number, Message\n- ✅ No attachments\n- ✅ Salesforce field mapping: TBD\n\nMoving to **#4: Multi-Tenant Data Isolation**.\n\n**Question 31:** In the **shared Salesforce instance**, how are OTR digital customer Cases isolated from Viva Energy wholesale/Shell Card Cases?\n\n- **Option A:** Salesforce Record Types (e.g., \"OTR Digital Support\" vs \"Fuel Wholesale\" vs \"Shell Card\")\n- **Option B:** Custom field to identify source channel/business unit\n- **Option C:** Separate queues/assignment rules (routing based on Case origin)\n- **Option D:** Not our concern (Salesforce admin team handles governance)\n\nWhich approach, or is this TBD?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":125,"cache_read_input_tokens":51204,"cache_creation":{"ephemeral_5m_input_tokens":125,"ephemeral_1h_input_tokens":0},"output_tokens":317,"service_tier":"standard"}},"requestId":"req_011CWsEQRj2QqjCtnnPP6Vgs","type":"assistant","uuid":"8e5f37cf-2aad-4dda-85c1-77931829a24b","timestamp":"2026-01-07T02:30:54.261Z"}
{"type":"file-history-snapshot","messageId":"fec28f6c-57bc-4bf4-a523-27f882604740","snapshot":{"messageId":"fec28f6c-57bc-4bf4-a523-27f882604740","trackedFileBackups":{},"timestamp":"2026-01-07T02:33:49.070Z"},"isSnapshotUpdate":false}
{"parentUuid":"8e5f37cf-2aad-4dda-85c1-77931829a24b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"I don't know, lets follow up"},"uuid":"fec28f6c-57bc-4bf4-a523-27f882604740","timestamp":"2026-01-07T02:33:49.048Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"fec28f6c-57bc-4bf4-a523-27f882604740","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xq1gzXavbgLbFhMQi5vcUA","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"User wants to defer this question - mark as TBD. I should continue to the next critical area.","signature":"EoUCCkYICxgCKkAGgi4O5woUcsKlAML1Pj1S5SRrZv9t2wL0ESe6OjphcCHB4+vJxBACMpqOMNm3l6bxqQdH6EUtLGNqXOTpoz8LEgwJeM5xFVTX1/k5588aDJ8z/czvBcbwounmAyIwqdX2CpO5IihfbUWeEOXDFROSQcJzDH4N/WIo2En2XQj81Z3ZWBbmDQU6njREl4tdKm3+0rmMkDwWmjN/+2raMseFRkm2e2XoSWtJwRMWKPgXkyZrELpRSK6NGRlO+Do05bfv/o/tabGq31w8LvVs1TbEU+FmZip1TyAa+dYN+RIfOYoRClTCFYQrmY7Es8ZmmFsh3SmiIz0OhAgX6iyfGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":329,"cache_read_input_tokens":51329,"cache_creation":{"ephemeral_5m_input_tokens":329,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsEdyVawzwmnMtwgoeL4","type":"assistant","uuid":"3c47ba02-6e5e-4026-8806-151c1515a5e0","timestamp":"2026-01-07T02:33:54.735Z"}
{"parentUuid":"3c47ba02-6e5e-4026-8806-151c1515a5e0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xq1gzXavbgLbFhMQi5vcUA","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **data isolation strategy = TBD** (follow up with Viva Energy Salesforce governance team).\n\nMulti-tenant covered:\n- ✅ Shared instance confirmed\n- ⚠️ Data isolation strategy: TBD (Record Types, custom fields, queues - to be confirmed)\n\nMoving to **#5: Salesforce Integration Specifics**.\n\n**Question 32:** Which **Salesforce API** does EngagementService use to create Cases?\n\n- **Option A:** Salesforce REST API (HTTPS, JSON, synchronous)\n- **Option B:** Salesforce Bulk API (batch processing, higher throughput)\n- **Option C:** Salesforce Platform Events (event-driven, publish to Salesforce)\n- **Option D:** Not decided yet\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":329,"cache_read_input_tokens":51329,"cache_creation":{"ephemeral_5m_input_tokens":329,"ephemeral_1h_input_tokens":0},"output_tokens":217,"service_tier":"standard"}},"requestId":"req_011CWsEdyVawzwmnMtwgoeL4","type":"assistant","uuid":"9a0b9fe3-717a-4f44-a880-f6bc2244ef41","timestamp":"2026-01-07T02:33:58.395Z"}
{"type":"file-history-snapshot","messageId":"fa437d45-7b47-4bed-b50c-063752be43da","snapshot":{"messageId":"fa437d45-7b47-4bed-b50c-063752be43da","trackedFileBackups":{},"timestamp":"2026-01-07T02:34:59.175Z"},"isSnapshotUpdate":false}
{"parentUuid":"9a0b9fe3-717a-4f44-a880-f6bc2244ef41","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Undecided but probably REST"},"uuid":"fa437d45-7b47-4bed-b50c-063752be43da","timestamp":"2026-01-07T02:34:59.150Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"fa437d45-7b47-4bed-b50c-063752be43da","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TvSv8gn7oUmW4RWQHJ7yZo","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - \"Undecided but probably REST\" - I'll note this as the likely approach but mark it as TBD for confirmation.\n\nMoving on to authentication next.","signature":"ErsCCkYICxgCKkAEaAyXVRIR6e1xa0Q7sF7afCD19FZZtjekxFOtCZnRIiMFZ7oN7/Ojk/QF1UBMDqN1JfkJlUMmJwuhuZ9vJlkEEgwqVJQhGS9estJ+FZMaDNRmThGN8l8k0Pk+fiIwxWlnhnoS7oZdmSYwVBvTMDwLkek2iU2KaTjA5DuAnzJoDXm0W1QiPfdJ+d8c7vjwKqIBdETq23z+lm4/eTmP8MsY5yXsfYZp+psZI8NOglKqs8On6w5KzyJo6PixZPrc/q/2eF32/8gFfSFRuFEOoJWioSZaeI7G3O52ktsoPTEnhK4ilKCdfn2IbhQnN1f0mTYL9gi5pRPTUFTGFcJTOXv1vsl0Z8jJw464b5IEgfMf94LYSXlGekPIPtDdZgLx9myiuzN7NINhd4glfuxD5qqdHWlZGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":197,"cache_read_input_tokens":51658,"cache_creation":{"ephemeral_5m_input_tokens":197,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsEj9CPB9i86BBd5iSi1","type":"assistant","uuid":"658e4fd2-acdd-4553-aaf9-68b77b8b61db","timestamp":"2026-01-07T02:35:03.589Z"}
{"parentUuid":"658e4fd2-acdd-4553-aaf9-68b77b8b61db","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TvSv8gn7oUmW4RWQHJ7yZo","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **REST API (likely)**, final decision TBD.\n\n**Question 33:** How does EngagementService **authenticate** to Salesforce?\n\n- **Option A:** OAuth 2.0 (service account, client credentials flow)\n- **Option B:** Named user license (username/password/security token)\n- **Option C:** Connected App with JWT bearer flow\n- **Option D:** Not decided yet\n\nWhich authentication approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":197,"cache_read_input_tokens":51658,"cache_creation":{"ephemeral_5m_input_tokens":197,"ephemeral_1h_input_tokens":0},"output_tokens":147,"service_tier":"standard"}},"requestId":"req_011CWsEj9CPB9i86BBd5iSi1","type":"assistant","uuid":"6d10f85c-157c-414d-8894-a4351349265a","timestamp":"2026-01-07T02:35:05.419Z"}
{"type":"file-history-snapshot","messageId":"8e09dbe4-c62f-4471-9a7e-cf4186232c85","snapshot":{"messageId":"8e09dbe4-c62f-4471-9a7e-cf4186232c85","trackedFileBackups":{},"timestamp":"2026-01-07T02:35:30.004Z"},"isSnapshotUpdate":false}
{"parentUuid":"6d10f85c-157c-414d-8894-a4351349265a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Undecided"},"uuid":"8e09dbe4-c62f-4471-9a7e-cf4186232c85","timestamp":"2026-01-07T02:35:29.970Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"8e09dbe4-c62f-4471-9a7e-cf4186232c85","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019HyPgc1eiPStFwm9kmHr4H","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, marking as TBD. Let me continue with the next question about API rate limits.","signature":"EvsBCkYICxgCKkCbGdrj43fZq2/4Vbe1VuWS/Rw+3GABCyZrg9lH3j7LMnMZCjdXOJtlPuCUr72qXG3MlBBlfn2Sv/UBXOIzSpPAEgyg5SWfGz2MADakTuIaDLiT6W+l3jtHRwZsAyIwbeBmaGnBrlDtlrM5MfOVHFy2fF2d3x5TmhTayBn3NGOH/L4PeddrgRBis38/cWc9KmPtC2Qc3r8pKMtm+dPIuwSvKn/RcRUamET640i1J8lgCEjOcyHrMxp/u4Dul/ZJsLAc9VFGlYQaxdHOkYW0xRQwCzBrlVceIRYZTUW/8r7+avOCvcsRu5O78FSWD90Xv/t9yxEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":109,"cache_read_input_tokens":51855,"cache_creation":{"ephemeral_5m_input_tokens":109,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsEmR4RUvkxck4tScUcg","type":"assistant","uuid":"009b7279-a61a-4744-97b1-e09398749cf9","timestamp":"2026-01-07T02:35:33.650Z"}
{"parentUuid":"009b7279-a61a-4744-97b1-e09398749cf9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019HyPgc1eiPStFwm9kmHr4H","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **Salesforce authentication = TBD**.\n\n**Question 34:** Are we concerned about **Salesforce API rate limits**?\n\nWhat's the expected volume of feedback submissions?\n- X cases per day/hour?\n- Peak periods (certain times of day)?\n- Do we need to consider throttling/rate limiting?\n\nOr is volume low enough that rate limits aren't a concern?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":109,"cache_read_input_tokens":51855,"cache_creation":{"ephemeral_5m_input_tokens":109,"ephemeral_1h_input_tokens":0},"output_tokens":118,"service_tier":"standard"}},"requestId":"req_011CWsEmR4RUvkxck4tScUcg","type":"assistant","uuid":"4e7318dc-ac87-445c-b8f3-843576289eb9","timestamp":"2026-01-07T02:35:35.685Z"}
{"type":"file-history-snapshot","messageId":"fc7a68db-12e7-478f-bf2d-f3a19c985176","snapshot":{"messageId":"fc7a68db-12e7-478f-bf2d-f3a19c985176","trackedFileBackups":{},"timestamp":"2026-01-07T02:42:02.455Z"},"isSnapshotUpdate":false}
{"parentUuid":"4e7318dc-ac87-445c-b8f3-843576289eb9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"I'm finding out numbers, but with the event based approach we can monitor it better"},"uuid":"fc7a68db-12e7-478f-bf2d-f3a19c985176","timestamp":"2026-01-07T02:42:02.419Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"fc7a68db-12e7-478f-bf2d-f3a19c985176","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P9wCafjW1gYX8YSrx9nUJC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good point - the async/event-based approach gives us natural buffering and ability to monitor queue depth, processing rate, etc. We can adjust workers/throughput as needed based on actual volume.\n\nLet's mark this as something to monitor but not a blocker for the architecture.","signature":"ErsDCkYICxgCKkD0xcjndpK4Fb9YnoIbc95WHK3+PIoqS7UxTmTm5rGjZp5awcGr9bVmpKCL0dPDD5CbL4tCw0BQVZbdsWeCYbJNEgz//z3ccbl2ht/0V+MaDOwYhs5tDdXNO1J9PyIwcEh5LvOxxVjoauyBC5sPIexHULnQZCpK8W0muj77R8Qu3DEswn+XnVM3sBtXUIT5KqICRCfQTKMf9J84/62hOKfUV48gsmCCJLE76TpzTKnrTWt2eH1qPoc/jHxQTJk0z1WW1M+dPDJ/bMy+CtO0j9UZ5KUnoL21Lz/m6z8l6MXl31VI3+DA+HOGPzeOWkq3SUr4Gl7ip+5YBrBKL+4PuM5N3NUYE9xom65h7rupuO7jbzTbEqNxcZEtfM5GsJK1F3lLxRczoUBkahEQ0vdZVOpKAAYcyA9BioejPGCFWhwxc0msYOLysdgvR9pEgh1IWSr0JcjjdMd/BnUCd6ufXVmuy67ULaQzVog+UoxNSgLKwOcKEnBnPGRhtV2I4r0uNkaMjwjhfeZkpRP1EHn36dHBM/soaV+5NXXRJjYp3adTP3ZVG3cqmbgNv7Xq+LtwCitkxkMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":52177,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":52177,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsFGMXA5zgZqimnYSJek","type":"assistant","uuid":"1fc76894-f3da-4316-811b-489a08952508","timestamp":"2026-01-07T02:42:08.125Z"}
{"parentUuid":"1fc76894-f3da-4316-811b-489a08952508","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P9wCafjW1gYX8YSrx9nUJC","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **event-based approach provides natural buffering**.\n\nBenefits:\n- Queue depth monitoring shows backlog\n- Can scale workers based on volume\n- Prevents overwhelming Salesforce API\n- Rate limit handling built into retry logic\n\nSalesforce integration covered:\n- ✅ REST API (likely)\n- ⚠️ Authentication method: TBD\n- ✅ Rate limits: Monitor via queue metrics, async processing provides natural throttling\n- ⚠️ Expected volume: TBD (gathering data)\n\nMoving to **#6: Case Routing & Customer Notifications**.\n\n**Question 35:** How do Cases get **assigned to the right support team** in Salesforce?\n\n- **Option A:** Salesforce assignment rules (auto-assign based on Case Type/Category)\n- **Option B:** Cases go to general queue, agents manually claim\n- **Option C:** EngagementService specifies owner/queue when creating Case\n- **Option D:** Not our concern (Salesforce admin team manages routing)\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":52177,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":52177,"ephemeral_1h_input_tokens":0},"output_tokens":305,"service_tier":"standard"}},"requestId":"req_011CWsFGMXA5zgZqimnYSJek","type":"assistant","uuid":"b7721232-d82b-4b05-aab9-b866b23cba8a","timestamp":"2026-01-07T02:42:13.347Z"}
{"type":"file-history-snapshot","messageId":"0685d86a-6edf-4990-9159-1aa1fdfb8680","snapshot":{"messageId":"0685d86a-6edf-4990-9159-1aa1fdfb8680","trackedFileBackups":{},"timestamp":"2026-01-07T02:43:05.622Z"},"isSnapshotUpdate":false}
{"parentUuid":"b7721232-d82b-4b05-aab9-b866b23cba8a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Not our concern"},"uuid":"0685d86a-6edf-4990-9159-1aa1fdfb8680","timestamp":"2026-01-07T02:43:05.588Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"0685d86a-6edf-4990-9159-1aa1fdfb8680","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VCTQ36GuYL1A9CbjrZVsbQ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - case routing is handled by Salesforce configuration, not our architecture concern.","signature":"EoECCkYICxgCKkBBCD8ST1I+Waur8J1r1KVf58bYMwRGgnLwQqFzEVzeOtp3BiqZkt2+V1O8wgg9kJoL8h0n4TXKjIUf/rseKYe9EgxUVCKndDzAIIPeI5QaDDePpAOSlJjGq+lSUSIw8PSFtuKyuaoPk0AeegBq3qONjDzu2HKE2AU7BpkGINvGBDYscWVqix3O8TekV+nJKmknAiJr6SjYoD1yxdIEgTdbjd74azbmNaieqKbMsUymLGqLYP2tKJ6E0eyrTFvM4uMq5mL6qJCV2uoC9Drw967jscsFIRT19g6iDddz2MNRa1uxkr8u1p0JjGEsh66u/Zyu4ZrzAcPYLicYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":244,"cache_read_input_tokens":52177,"cache_creation":{"ephemeral_5m_input_tokens":244,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsFM1CvH8ZyE38V769Wd","type":"assistant","uuid":"40239ae4-8cff-43e9-83a6-f3bff484d920","timestamp":"2026-01-07T02:43:09.547Z"}
{"parentUuid":"40239ae4-8cff-43e9-83a6-f3bff484d920","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VCTQ36GuYL1A9CbjrZVsbQ","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Case routing = Salesforce admin team responsibility** (assignment rules, queues, etc.).\n\n**Question 36:** When a support agent **updates or resolves a Case** in Salesforce, how does the customer get notified?\n\n- **Option A:** Email from Salesforce directly (standard Salesforce email templates)\n- **Option B:** Salesforce → webhook → EngagementService → Braze push notification\n- **Option C:** Customer can check Case status in-app (no proactive notification)\n- **Option D:** Not implemented (customers don't get status updates)\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":244,"cache_read_input_tokens":52177,"cache_creation":{"ephemeral_5m_input_tokens":244,"ephemeral_1h_input_tokens":0},"output_tokens":164,"service_tier":"standard"}},"requestId":"req_011CWsFM1CvH8ZyE38V769Wd","type":"assistant","uuid":"2df79f03-9486-480a-a8e9-8b56564cdbda","timestamp":"2026-01-07T02:43:12.315Z"}
{"type":"file-history-snapshot","messageId":"4d25c5b8-544e-462d-8551-ff34b19e6177","snapshot":{"messageId":"4d25c5b8-544e-462d-8551-ff34b19e6177","trackedFileBackups":{},"timestamp":"2026-01-07T02:43:36.706Z"},"isSnapshotUpdate":false}
{"parentUuid":"2df79f03-9486-480a-a8e9-8b56564cdbda","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"B "},"uuid":"4d25c5b8-544e-462d-8551-ff34b19e6177","timestamp":"2026-01-07T02:43:36.692Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"4d25c5b8-544e-462d-8551-ff34b19e6177","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017PLo4oXocE2F8ofDykSj8D","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so there's a bidirectional flow:\n\n**Outbound (Customer → Salesforce):**\nMobile App → EngagementService → Salesforce (Case creation)\n\n**Inbound (Salesforce → Customer):**\nSalesforce → webhook → EngagementService → Braze → push notification\n\nThis is an important architectural detail - EngagementService needs to:\n1. Receive webhooks from Salesforce (or poll for Case updates)\n2. Translate Salesforce Case updates into domain events\n3. Trigger Braze campaigns for customer notifications\n\nThis reinforces the ACL pattern - EngagementService acts as the translation layer in both directions.\n\nNext question should be about webhooks vs polling, and what Case status changes trigger notifications.","signature":"EukGCkYICxgCKkCLXVGers8zfwSdz4Smx+xFmstQkCn52ZjvbkVLbvNxdhCEFn81/Zv5xX0UVuSLfshyjS5S295fhHdXkkdnevG+Egy7A9r6DUuvyYj3FgIaDEXH508gNTJNJwlF9yIwrPIDFLqbtqpT/Ll+XnXjzCZjYljFChn1ogvWUHbsHKRodkbce2LPJH/sRxKIf18oKtAFbo1wPwoZhgVb/orZcWOmFD1nyY9iu2VyS0eM6mNORieDJgT/6bFbjpLmrTEAMK13eYFCD/GTDawD5ktqb79UeUww7W46Lxv/hzzav/qkYCrnXlFgCa05b3VZyT/AsZLd/tORO4ZxlnMt1/clCega9DB/F5W226RIZ/Im73ZW0Haw4FvWUdgfNqa4UC8/5Ot6bZoFVgtDaLFP1rv6cDfYcOPZU2GHSWpKvK4yM9hb342bbhxX2LcRzuEMWjNndx/MBq5SuSrWHoYuhKFRW4ZgG3PYbflbtZH/XKTCi3YtmwcCeMm5YkeFLuJ28rTUxY3ACI3QoyicIzAmjK2FcFbS6i+iuqqciyhYfEZuyfyTm8jX6P6GiUQ4h9dKpgJcvXdfjMwJ2je+9AkltaluiyPsmnR2aHAIMl6XOhNVXaA443WpOdrA4mcHCEFxnq1L/dqxiFc/TO91Pq+DxStWvy5x+7P+TkHtOXUcZamS+Z+KgBG6kcagvVIQscv0ItuyJ+IhhuypZPPp9OkiE85IEZKyFtSbqRKqvvVqYDHUbJjeW2b6HV9SJ+zL4NmIOw1reHUrS36CDL3ZXWZfrD6JSjBmQjpWtrBziATaTES2Rmqiq2p8Dl8u13H7j5NL5qiwj4cTZNBW7m6CFRO3mWhMwPEgU6ftJZTga0fm9e2PAOa9NtYrTLdOah7sfsNfU5Wyd8qOC3mQQPVv/GyY+tJHoesEg+cvF7xIgAhZvyWNM+AjwU1mXrCUWosFsBkLhtle43vN7+jptngtxrICwkxiJdS72QQvwZfckZKIReBVYoMRFoFU2bOn0kdRPAyS/jeo4W6SH7u2i20wlTx+BlVwbvfAuNjFxYVldv1CGE5/S+iMtFZi2h1/UB087FtGDALdO+BQrb9C69NdqUh1cei/FqP1Bla4uLefzlcKxhCGCvCHD/052dEHcThIZZ86LSlq8CfSGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":144,"cache_read_input_tokens":52421,"cache_creation":{"ephemeral_5m_input_tokens":144,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsFPJ2WQHhiYXM4qtitS","type":"assistant","uuid":"527294c4-ceec-4bc8-a850-a3fa39f4d278","timestamp":"2026-01-07T02:43:45.165Z"}
{"parentUuid":"527294c4-ceec-4bc8-a850-a3fa39f4d278","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017PLo4oXocE2F8ofDykSj8D","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **bidirectional integration** via EngagementService ACL.\n\n**Inbound flow:**\n1. Agent updates/resolves Case in Salesforce\n2. Salesforce webhook → EngagementService\n3. EngagementService publishes event (e.g., `SupportCaseUpdated`, `SupportCaseResolved`)\n4. EngagementService triggers Braze campaign → push notification to customer\n\n**Question 37:** What **Salesforce webhook mechanism**?\n\n- **Option A:** Salesforce Outbound Messages (SOAP, workflow rule triggered)\n- **Option B:** Salesforce Platform Events (publish/subscribe)\n- **Option C:** Salesforce Process Builder + HTTP callout\n- **Option D:** Not decided yet\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":144,"cache_read_input_tokens":52421,"cache_creation":{"ephemeral_5m_input_tokens":144,"ephemeral_1h_input_tokens":0},"output_tokens":365,"service_tier":"standard"}},"requestId":"req_011CWsFPJ2WQHhiYXM4qtitS","type":"assistant","uuid":"f97fb596-af8d-4b41-b2e0-780f39f14424","timestamp":"2026-01-07T02:43:48.783Z"}
{"type":"file-history-snapshot","messageId":"e9a18946-97ce-419e-b129-158dba71eebe","snapshot":{"messageId":"e9a18946-97ce-419e-b129-158dba71eebe","trackedFileBackups":{},"timestamp":"2026-01-07T02:44:17.225Z"},"isSnapshotUpdate":false}
{"parentUuid":"f97fb596-af8d-4b41-b2e0-780f39f14424","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Undecided"},"uuid":"e9a18946-97ce-419e-b129-158dba71eebe","timestamp":"2026-01-07T02:44:17.200Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"e9a18946-97ce-419e-b129-158dba71eebe","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018cRBNZSdnEKvqusJnJatuE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, another TBD for Salesforce webhook mechanism.\n\nLet me think about what's left:\n\nCase routing covered:\n- ✅ Assignment: Salesforce admin team responsibility\n- ✅ Customer notifications: Salesforce → webhook → EngagementService → Braze\n- ⚠️ Webhook mechanism: TBD (Outbound Messages, Platform Events, Process Builder)\n\nNow let me think about the last part - can customers view Case status in-app?","signature":"EsEECkYICxgCKkCb/gADUVutmz4sYgGy89bPYv/gH4n6Cd4ymbYu0iCb0gBwOs25YOpR4Er4gsaKE7XOyGSsQSR/zJpUqjfUiHxoEgzpU47Mt1ki54TFT34aDL+vN8qAst/+3t0g0CIwm/OBxenA9YhHWJRPhNFYKdp6cWRkP5+AhanVLCQp2IXqh9eYJrMDvh92kGRiGaAKKqgDOTI9fSrBQSVPyMzxcXdaYUm3Dnt+axXHeITSoJXiY1CbujmkMyPdSQusTNv9WcViYiSeTvnE4MRQDVDolPBCt3q0U+cDaqm6QlmBN4uXTDh18TzIk5k0f+uErbaXzpqBkKyMXHK0EX7plqPgdoOvQfZUEsWEccv0du1XyxCXulA3eBUI569AOfChsXkh27ZA3uEwgkpd2hKAitQ9uLzziQZFcjRxLjYNcfsrASREONPWJz4F6wd2rbLB9HnYGRiic3P9hsFgV6lecGK0g1lHq4dn1+nV6rwrTa7ee051ODx1YzASL+vNMA6lCEjxknP+g+iMbmbB+WaNQE+wAyV3hnF2BVgCIGXT4RVYkbGrb04FMz9zyCu6bogFOaaCK/DvyPnAFhYuJOKOV7q6mrHdkvjGz5lPhtu+rEshQUCGkOjsJF5aQdQZKBdC2Sl6dXNDKyWQFvQL4hzVK4R/8Mwx6z9K7YX40xPQ6hX0dXB8xWgHyX/5tBVCeNpUZ4RanTAiBuK39nhSvB70TQ7ybz30vJl8hr8KYWeD7IuzxDx+rnUI5D8hiN1EYBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":293,"cache_read_input_tokens":52565,"cache_creation":{"ephemeral_5m_input_tokens":293,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsFSHHSuvjCk9Eo4dKgp","type":"assistant","uuid":"43eeff16-67fe-4a73-8b2f-e0bba3cdbaff","timestamp":"2026-01-07T02:44:24.796Z"}
{"parentUuid":"43eeff16-67fe-4a73-8b2f-e0bba3cdbaff","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018cRBNZSdnEKvqusJnJatuE","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **Salesforce webhook mechanism = TBD**.\n\n**Question 38:** Can customers **view their Case status/history** in the Mobile App?\n\n- **Option A:** Yes - Mobile App → EngagementService → queries Salesforce Cases by Contact ID\n- **Option B:** No - customers only receive push notifications, can't view history\n- **Option C:** Future enhancement (not in scope)\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":293,"cache_read_input_tokens":52565,"cache_creation":{"ephemeral_5m_input_tokens":293,"ephemeral_1h_input_tokens":0},"output_tokens":216,"service_tier":"standard"}},"requestId":"req_011CWsFSHHSuvjCk9Eo4dKgp","type":"assistant","uuid":"c4ee3840-3529-4f4d-8c76-c4eb4e6feed4","timestamp":"2026-01-07T02:44:26.749Z"}
{"type":"file-history-snapshot","messageId":"2aa112f6-0e9f-4150-b383-c8ca775485ac","snapshot":{"messageId":"2aa112f6-0e9f-4150-b383-c8ca775485ac","trackedFileBackups":{},"timestamp":"2026-01-07T02:46:20.149Z"},"isSnapshotUpdate":false}
{"parentUuid":"c4ee3840-3529-4f4d-8c76-c4eb4e6feed4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Future enhancement "},"uuid":"2aa112f6-0e9f-4150-b383-c8ca775485ac","timestamp":"2026-01-07T02:46:20.105Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"2aa112f6-0e9f-4150-b383-c8ca775485ac","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WiVbrM5xA5xD1x5zfTLwmx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - future enhancement, so not in scope for this architecture.\n\nCase routing & notifications covered:\n- ✅ Case assignment: Salesforce admin team manages\n- ✅ Customer notifications: Salesforce webhook → EngagementService → Braze push\n- ⚠️ Webhook mechanism: TBD\n- ✅ Case status in-app: Future enhancement (out of scope)\n\nLet me check if there are any other critical areas we haven't covered from my original list:\n\n1. ✅ Error Handling & Resilience - covered\n2. ✅ Contact Reconciliation/Deduplication - covered\n3. ✅ Case Data Model Mapping - covered\n4. ⚠️ Multi-Tenant Data Isolation - TBD follow up\n5. ⚠️ Salesforce Integration Specifics - mostly TBD\n6. ✅ Case Routing & Customer Notifications - covered\n\nAre there any other gaps? Let me think:\n\n- Data migration specifics (how, when, validation)?\n- NFRs (performance, availability, security)?\n- ProfileService specifics (already creating Contacts for Flybuys, does this change anything)?\n- Event schemas (what fields in SupportCaseCreated, SupportCaseUpdated events)?\n- Testing strategy?\n- Rollback plan?\n- Monitoring/observability?\n\nI should ask if there are any other critical areas before we move to drafting sections.","signature":"EtIKCkYICxgCKkBrQ38kz+c7gUUNskXJVLRWOiHPSFXGlU3uY1Yq502yE4xU20QBaXm1obzkvRaWNV4z0KJ0TPMK2wTt3sWi2QyaEgyRcJGbQkQZtdxCHK8aDKDTZiEcuxEisFnZ8SIwY7CN6NFa2oiO/gWvBKBh8zueaPVFXGfNwrxcB1FhPS+d+vR5cQgvTQpt/5CFgfXqKrkJSQ4QYWNiYXzA1x5bwn6HVLZeGvdqwVJcjIP376CHkNMD0xy0Vz04klI914gChg1QXJu53D3zVymNmZ/BqklRBpXMn2DDXjrb6X+pOnU4g1Mo1CNxOOAxtOp76B+AkJqX3MJfkbnqVdMyJvuVqmjzu2vvipmK5AHsGvAhElMKOtlESxY9Gz9+VUEgXoOGDvVlwAvCpkkBX0AjHrKX5J56ioDONQvzqtCb65jxJOp4J5n6VTEz8fSfYXCAFikqLZNSMvpCjHgryMksPaI4/4LyQauz0n5nDuGCtOpL+RZ3B1BBp4LzR5+BlSQLqgmhkz+YKLfv6Y1euj6hHqwqRq539n5sw3/TfhwsDiYL9jbXj/B5/UfUIZrVusUxVbfmNLgEXfLdJOnkOlhEoUSQkFtyG6uiao2cbSAt8D2BK0L7UMqwSI0irxZOuow9Yp01YIKYuxCwrjawy1e7jhqczZQ6JqZ97thTxtuYuVPoi72lcAdToiFE5UTFAVN7iH3Sy2sbBR+M1t1UVUO5MAbi8R/3I0bBEUCvb8RK2fNnVNEl+nLzCNQuMlsvtpchzd2NEivrHAVUgD+CSiCGTEEhDfghEEueXbc5aJv6q3rvH8KfY3nZtz7HfAGHfd4qdo/VU5wvnHG8e8rFDede+HQgzM3a56nECTEjocYgLVYNkB320ObZek0h7VRzUd0JE4dsbF61NFAueTldVLBkMRA87Ia0sOqmEuLF0txn5gbk8k8xXAv5rx9mz8r9ZnzHVcQknBBzF+qcgpYG2yEhc1eeQCAId58Hdmx+vJwUBJXK2FcU7tlfEhOa63cQKeK1x/xK5BboeuEAjeaJNrDhIdBuQusMGExPshAn7MVPKS20LA+v5Gs+0WEoJKNyY7yGBcruz8CuH71jtAwlDvXylFGBimWANsWbc8FqflebpPd0cA8OJGfctEG/ptdB1AIZtsZv+HQ/CXdP1ykF//eQaKHtfVM/FPD24IIziVEf9FgZQzLK8EdGIi6+p79b9e2ltEyJzzl0kkurtriH7pTayM0M8qVPsshDTx0aUkiVmZ6nvXZsSL5L1Th1EUdwk4EkmeCcdVhwDVy6Zqy5qiFbbGKwhC44tBJGin1Pzn8y+QlNAv6Oqk85ZvV0Xkpe85fYj+8NrUZSQIZcEPa3X4ny/yum6BeHoQqcO02W9m24xc907Xkke8ydnYTCJgd2EMASpEtFmWQGyVZA7sSPrnKiSEynfyQ6DhyuT0UOrXJtSF6GVowR6ChdTMjbUMmea1tf5kT/MgIiBg/mHgFRIq3gxqtO84nq8RrCy/bD+cK0/2fMy4sG6CvFOo66SdsLDbArY/zJyHtQfjq1MGQv4OLKum+uwpTn/mMKFjVb1gLGLng2xHjuTimSiKwDauOjLj7BLydJpx2VVR2tT2Y2jp5r3mFeFFGuEZVvhh5xuHz0O+yqfDjPqQPVVtF+U8ZO8L5DBdco3O3g2zKrMrwqjYSPqwTOkHD5z0szGWShY3Ra1aCWjJErHYmjb2hTDqfOK3f378WcCdSSFEZ7sx+3fgrCwR8m7e5YwUi9OLEXQQmmVnOtY2GXLKKv8zkksew/vB9l4QReI1BtkQgqKPrQOgtbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":103,"cache_read_input_tokens":52858,"cache_creation":{"ephemeral_5m_input_tokens":103,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsFbM2RaFEDNcaWA6L13","type":"assistant","uuid":"7ea48512-5dae-4513-83bb-12d0c81ef7a0","timestamp":"2026-01-07T02:46:31.865Z"}
{"parentUuid":"7ea48512-5dae-4513-83bb-12d0c81ef7a0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WiVbrM5xA5xD1x5zfTLwmx","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Case status view = future enhancement**, out of scope for this migration.\n\nCase routing & notifications covered:\n- ✅ Case assignment: Salesforce admin responsibility\n- ✅ Customer notifications: Salesforce webhook → EngagementService → Braze\n- ⚠️ Webhook mechanism: TBD\n- ✅ In-app Case history: Future enhancement (out of scope)\n\n---\n\nWe've covered the **6 critical gaps** I identified. Let me check if there are **any other areas** we should address:\n\n**Other potential gaps:**\n- **Contact migration logistics** (when, how, validation strategy?)\n- **ProfileService changes** (already handles Contact reconciliation for Flybuys - does this add complexity?)\n- **Event schemas** (what fields in `SupportCaseCreated`, `SupportCaseUpdated` events?)\n- **Rollback plan** (if cutover fails, how do we revert to D365 CE?)\n- **Testing approach** (UAT, integration testing with Salesforce sandbox?)\n\nShould we cover any of these, or are we ready to **draft the Executive Summary** section?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":103,"cache_read_input_tokens":52858,"cache_creation":{"ephemeral_5m_input_tokens":103,"ephemeral_1h_input_tokens":0},"output_tokens":614,"service_tier":"standard"}},"requestId":"req_011CWsFbM2RaFEDNcaWA6L13","type":"assistant","uuid":"bd191894-a76f-4c3e-b537-384dc0787be6","timestamp":"2026-01-07T02:46:36.838Z"}
{"type":"file-history-snapshot","messageId":"287274db-44b7-4774-817c-9e837774575a","snapshot":{"messageId":"287274db-44b7-4774-817c-9e837774575a","trackedFileBackups":{},"timestamp":"2026-01-07T02:49:49.024Z"},"isSnapshotUpdate":false}
{"parentUuid":"bd191894-a76f-4c3e-b537-384dc0787be6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Event Schema can come later, testing approach would be good to touch on later, rollback plan is unnecessary, outlining the ProfileSevice is good"},"uuid":"287274db-44b7-4774-817c-9e837774575a","timestamp":"2026-01-07T02:49:48.981Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"287274db-44b7-4774-817c-9e837774575a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015Dg7KSYsNEQZmecyGfQGY4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to:\n1. Cover ProfileService changes (how this fits with existing Contact reconciliation for Flybuys)\n2. Skip event schemas for now\n3. Touch on testing approach later\n4. Skip rollback plan (no need since it's big bang and we're deprecating D365 CE anyway)\n\nLet me ask about ProfileService and how this Salesforce Contact reconciliation interacts with existing capabilities.","signature":"EqgECkYICxgCKkBYNt3E72CQuorCW4Phs6IO5ta5Up7iSAs1VreIeU4gTFn7HvV0Wt6JuNB1pv04TS8zk1xNARBxgfKvDOXfgYesEgygx9RRqX8Q/qB0W1UaDD3Y0eoJWe6VpFuGJSIwYSptv1q55fPkWsVokh7hHCA1Avd1Ma7Cf9wDFEqCkoEYHa7DVBQ/Lw0joUwshR2YKo8D9+PcGtqOIW/txQSabI9nRqwFEr1fAxprgPHsiGg/sGsdVu9lYXRA3/ZwCwQ9woL4qiPZJTOxNiH9CWbKWCNuC9VdQnzwWtYDpJFXtSvEo+VK/Rni/Dkm/FVh0AA+rQJZep9SOUhYg3SGoO6MENt8jdwb+o6RtNxUfFQTo6xjLi+0OcS2fnRFcV1t7sQrI5czolRl9TyDBH+wsGnb+FgNIi1E5bHcnCN84Th4XlgWirq8mkQETlbpor03zv94AhvYxvHRkHi1JH+qOfq/iDsssZUgwNbK8R78TXHByy++eoUNKGC3Ou6Ti9Jq3SkD9cfgwAU3pBSDgqrU1Lbh9V7M3OPmCiD3mCtJSH/6TbdJbyLzwPf0CJZVwf7O1nOg5f5ZP2Jd6VCDaiwAuXakqrprc9NHpGY/0mk+HR9B4sqJfh8jKdSP6ZvZAT6hFrnvD4HqWV50jc0mzvvLXLFmJO8ubeMeIdZEKL71iJbe4pK7+YZ8STi0uuplnI0fFxpZoJd+KApXMPWgvPtnPuBSzZBrGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":300,"cache_read_input_tokens":52961,"cache_creation":{"ephemeral_5m_input_tokens":300,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWsFrjyxyTeZWGPibVU4H","type":"assistant","uuid":"ac9c8082-98f1-4e4f-9403-ac2b7668e0d6","timestamp":"2026-01-07T02:49:53.761Z"}
{"parentUuid":"ac9c8082-98f1-4e4f-9403-ac2b7668e0d6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015Dg7KSYsNEQZmecyGfQGY4","type":"message","role":"assistant","content":[{"type":"text","text":"Good - let's clarify **ProfileService changes**.\n\n**Question 39:** ProfileService already handles **JIT Contact reconciliation** for the Flybuys integration (reconciles app users as Salesforce Contacts).\n\nFor this Salesforce Customer Support migration, is ProfileService:\n\n- **Option A:** Already doing what we need (Contact reconciliation already exists, no changes required)\n- **Option B:** Needs enhancement (add new reconciliation logic specific to support use cases)\n- **Option C:** New capability (Contact reconciliation doesn't exist yet, Flybuys uses different pattern)\n\nWhich scenario?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":300,"cache_read_input_tokens":52961,"cache_creation":{"ephemeral_5m_input_tokens":300,"ephemeral_1h_input_tokens":0},"output_tokens":235,"service_tier":"standard"}},"requestId":"req_011CWsFrjyxyTeZWGPibVU4H","type":"assistant","uuid":"f8e30147-afbd-4c67-8d11-bb3d886c4af4","timestamp":"2026-01-07T02:49:57.444Z"}
{"type":"file-history-snapshot","messageId":"e2b683d7-89f5-45b5-b460-77f3c535ba18","snapshot":{"messageId":"e2b683d7-89f5-45b5-b460-77f3c535ba18","trackedFileBackups":{},"timestamp":"2026-01-07T02:54:47.035Z"},"isSnapshotUpdate":false}
{"parentUuid":"f8e30147-afbd-4c67-8d11-bb3d886c4af4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"New, this will be deployed before the Flybuys project"},"uuid":"e2b683d7-89f5-45b5-b460-77f3c535ba18","timestamp":"2026-01-07T02:54:46.999Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"e2b683d7-89f5-45b5-b460-77f3c535ba18","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017v1TopKgJA3Fc6cobHfHYk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ah! This is important context. The Salesforce Customer Support migration happens BEFORE the Flybuys integration.\n\nSo:\n- Salesforce Customer Support is happening NOW\n- Flybuys integration comes LATER\n- ProfileService Contact reconciliation is being built for THIS project\n- Flybuys will leverage the same ProfileService capability\n\nThis changes the sequencing and means:\n1. ProfileService Contact reconciliation is a NEW capability we're building\n2. This project establishes the ProfileService → Salesforce integration pattern\n3. Flybuys will reuse this pattern later\n\nI should clarify this timeline/dependency.","signature":"EoAGCkYICxgCKkCVOzDdVGXp0FI7dwvRR1CDwA+V4pJj8uXLVCv+jLaqQA047DP836W7VnjRHftjDQhExSirtjSffblii6K05n+eEgwAym1UYqvg5irLg7kaDFwYoNiip6IoRonPJiIwoycKgFyuIZfD3HVmEPCeMGoKUZ6xNL9tlFxYnyRZD1sgkrhbecP2eJgbj/dEY2RJKucEOLLNzfiNgUeBUKX/DateV9krTVibdatjHmffIFvPV3i2//K4Inlcp2JuaSdWGqh9YAC+04Cki/Ts6ivANk7WF/5tpHfaFmBroXLHUyMpq32fbgPt0Sc1TQzA4xkFNoleAJuLXg0/9b7tvnIAmqX1zYCJJ+OQAdWoT53qg9zUpOAWVjfsTOSDYphNSq0ZWLtOmfFdlZ048zeiIfQwMO1umIjdtOdL7669rw1ObBhugRGPidxqv2fxfCmp41dysrCYLE1gfkm4hIZLE9BD+qAMFXXdVaHCyvWCDI/iFXHEiEsZvNOZN8bqr/lbpU9oCvMLF64p5FHMYBQ98s++dL5Lx8d0jp9S8opvzqJ/4Zf+oEBYMqdOowCvFI0V/k68sP6bf44p69c1wihQ1w/s1GrwTM34+V0dlhnXtLgIhyD5fh0dTBx65XZdZaD3R5AsOsJhA6VvBGJNgqndA/l6xO/2MvJpLcWHlxKI2zCe8lhtQ07KeD2up8AMfOTbHARawebsmwxnuWNoNkp7WzkY3g7GJ4BXc4CN3P57ut+qgF1GoEUSaSEwAmjz0VSXbKuzhqXV9yyhzfmNs/0O/hpLKvUxgx4azptg64bOMBuQJ9NvXlb3jzQkJwxEJ/7EUQIYlf470JBdVxKbwarzVEyRoSL+Jmm0vva3embU0rOVjluOVslAgTsbZlgtLti8V2dNbJTJGREeVEJgggjtK66gCm4cq4DedCdtGQ0GDKvs61O1KptcbtatN16m6XsDWads71HE9quHm42wfYLqS9CsAeyrlzyHLgNcxogjD05cqNFGrEMJxln4yiXlGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":255,"cache_read_input_tokens":53261,"cache_creation":{"ephemeral_5m_input_tokens":255,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWsGEi9CkrHUBF4ufcRur","type":"assistant","uuid":"2627f868-2fe3-4dee-a717-1bad0961e478","timestamp":"2026-01-07T02:54:53.773Z"}
{"parentUuid":"2627f868-2fe3-4dee-a717-1bad0961e478","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017v1TopKgJA3Fc6cobHfHYk","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent context - **this is the FIRST use case** for ProfileService Contact reconciliation!\n\nSo the timeline is:\n1. **Salesforce Customer Support migration** (this project) - builds ProfileService → Salesforce Contact reconciliation\n2. **Flybuys integration** (later) - reuses ProfileService Contact reconciliation\n\n**Question 40:** Does ProfileService exist at all currently, or are we creating it as part of this migration?\n\n- **Option A:** ProfileService exists (different capabilities), we're adding Contact reconciliation\n- **Option B:** ProfileService is brand new, being created for this project\n- **Option C:** ProfileService is conceptual (from DDD target architecture), this is first implementation\n\nWhich scenario?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":255,"cache_read_input_tokens":53261,"cache_creation":{"ephemeral_5m_input_tokens":255,"ephemeral_1h_input_tokens":0},"output_tokens":308,"service_tier":"standard"}},"requestId":"req_011CWsGEi9CkrHUBF4ufcRur","type":"assistant","uuid":"3b8fb7a1-a957-4179-a252-9cba7bb144ab","timestamp":"2026-01-07T02:54:57.226Z"}
{"type":"file-history-snapshot","messageId":"cee1aafb-543e-4c6b-91a8-f093aa84a68c","snapshot":{"messageId":"cee1aafb-543e-4c6b-91a8-f093aa84a68c","trackedFileBackups":{},"timestamp":"2026-01-07T02:55:50.282Z"},"isSnapshotUpdate":false}
{"parentUuid":"3b8fb7a1-a957-4179-a252-9cba7bb144ab","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"C"},"uuid":"cee1aafb-543e-4c6b-91a8-f093aa84a68c","timestamp":"2026-01-07T02:55:50.253Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"cee1aafb-543e-4c6b-91a8-f093aa84a68c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HBc4tXZGASvcqLPPzPvX6T","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Excellent - this is a critical architectural clarification. ProfileService is part of the target DDD architecture (documented in the CML files and bounded context definitions), but this Salesforce Customer Support migration is the **first actual implementation** of ProfileService.\n\nThis changes the scope significantly - we're not just migrating D365 CE to Salesforce, we're:\n1. **Building ProfileService** from scratch (new bounded context)\n2. Implementing Contact reconciliation (JIT pattern)\n3. Migrating app database Contacts → Salesforce\n4. Building EngagementService integration with Salesforce\n\nThis is much bigger than just \"switching support backends\" - it's implementing foundational DDD bounded contexts.\n\nLet me confirm the ProfileService scope for THIS project.","signature":"EqsHCkYICxgCKkC2QaxyaaOxsouuBG2EN+d79ZdW6J6x3Amu01VJ1s1GgqWMRu8ZN7XW70ly2cLgS68mKURq7n8CCPnbWWBEIJ/DEgyYcPHCTSU/Ng9EquoaDBKHjoA5gh8wHp2OziIwhuKYxMOYqP7nto3mJ4ABzX3pmv6uuZ6X5s1+Kysk9CZcrUivMo24qupJ0CCsz6w0KpIGmP8GT779Jn8g51EPs8f2YOo2/zoTy7X2SYkl4MwZckEUCWHhXU/hFFXY6n0W4esBLTiVsDXNh4qIxXTFFH9syp8L+6ZqaXpmQCOvNz4uHxXZ1NPMw2rupHFnj1E4UU7Yua13UH5utvfYuJJ4ZvvKwnju4Bcrij4grak32swAfKaoxCJdpULh5Xl7z+Rc7Pxdnx8Q/+/guEC7TLhHLkNCuWiGPFWM9tGT+Ilg8sNws8q8dLE7DO1y2pEex4zJXndX2qxzQk33GiZ6ZkYDztHdM4AA8UAxl9CaKK7LPqH7yY40yrYtSipw/t/Qv4iFfzj03uIyTh7g9zhL7cLZeVGC783G83hhEqRMd7Bni2RlRjhsEJ/jDZ5xknPN0OJnQCXbDyShC7G4PIYn1UO8Gn/FVEmypO/UZOEU9PIqFHbf0RfTofkLPG/CduONsOoIniDztzTVxHh6h6T4Gh6XBsNWNAoC/uspqqlu7O+yDl+y3Fwu7a85O4OvPRihQ0uDUxTK+IzdsWPWQzOfYyHyXZpizQA321ut54SWKcmjx75URf2FGHBbEvl2ZwAdS4FRkwwS//P8G/tGgBY3FArr3h/ncFWng/qfNPiBsDrHbQH8Bcsf4lAywymhmavd/uWS95j+oRMkNq7674f/7qdAE1ZTCXNgFB6o85/kmUMNF6vKgqE21kK/K5uOo5p00SHVUbt0jIZYszs6WRJEJ4IopdOFSo7DtTRFLG1h3DIy5EyabthsqwMcc6bpOb0gm6bJtlBOh8WvPgY64UZojbXxnx+McNVvZ64JkgRzB3MqDCtiIFXZcgKSsVoHe1Z6s72OIf4hP3V3ljffuxOpFZK3qIclCYniu42HI31CEsLo8cJVK9pL3rkYj1HYvrU5ZUeYf4l7VlAoezm2DyzhBVF4sglrkMbKI7zA5Jn5/3pGTev2VD9PR+Wv79WiHrRm8aDfbEq0PZjYlIDWf5nS6zwuCRNtuCXqwyFviS70WI3ZPoRhYJgUEvcIHOxZVBUe3vlUmELWGF6fFlqJdBR/+sZCsWnfdvWbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":167,"cache_read_input_tokens":53516,"cache_creation":{"ephemeral_5m_input_tokens":167,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWsGKNSv95jiW1EvYqC2T","type":"assistant","uuid":"0bc01221-5257-4ff2-90c6-5ee04328dab6","timestamp":"2026-01-07T02:55:59.021Z"}
{"parentUuid":"0bc01221-5257-4ff2-90c6-5ee04328dab6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HBc4tXZGASvcqLPPzPvX6T","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **ProfileService is the first bounded context** being implemented from the target DDD architecture!\n\nThis migration is actually:\n- **Building ProfileService** (new bounded context)\n- Implementing Contact reconciliation with Salesforce\n- Updating EngagementService to integrate with Salesforce via ACL\n- Migrating app database → Salesforce\n\n**Question 41:** For this **first implementation of ProfileService**, what capabilities are in scope?\n\n- ✅ JIT Contact reconciliation with Salesforce (upsert by email)\n- ✅ Contact migration (one-time app database → Salesforce)\n- ❓ Partner account linking (OAuth for Flybuys) - or is that added later?\n- ❓ Reward preference management - or is that added later?\n- ❓ Canonical customer identity (VCI management) - or is that added later?\n\nWhat's the **minimal ProfileService** for this migration?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":167,"cache_read_input_tokens":53516,"cache_creation":{"ephemeral_5m_input_tokens":167,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWsGKNSv95jiW1EvYqC2T","type":"assistant","uuid":"1da2c88e-0b0d-4151-9deb-b4e7d60954ad","timestamp":"2026-01-07T02:56:03.761Z"}
{"type":"file-history-snapshot","messageId":"2ceb1a51-bf9f-4fe2-b07d-59afa9815269","snapshot":{"messageId":"2ceb1a51-bf9f-4fe2-b07d-59afa9815269","trackedFileBackups":{},"timestamp":"2026-01-07T02:58:09.063Z"},"isSnapshotUpdate":false}
{"parentUuid":"1da2c88e-0b0d-4151-9deb-b4e7d60954ad","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"You're right"},"uuid":"2ceb1a51-bf9f-4fe2-b07d-59afa9815269","timestamp":"2026-01-07T02:58:09.034Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"2ceb1a51-bf9f-4fe2-b07d-59afa9815269","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PmQzLeHULAKEHFhDrHWbxV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is confirming that I'm right - so for this Salesforce Customer Support migration, we're building a **minimal ProfileService** with just:\n\n1. JIT Contact reconciliation with Salesforce (upsert by email)\n2. Contact migration (one-time app database → Salesforce)\n\nAnd later capabilities (for Flybuys integration) include:\n- Partner account linking (OAuth for Flybuys)\n- Reward preference management\n- Canonical customer identity (VCI management)\n\nThis is important because it means this migration is the **foundation** that enables future capabilities.\n\nLet me confirm this understanding.","signature":"EvcFCkYICxgCKkDzqzfHLExB78Ea13GlzjpPOmXAoATsDFL+EQuv58ldQvNsJnlmp+FZTTjC/1SszxzbWJV5y85p4JzVqh0qQaA+EgwGKtka4WhwZuTpipMaDO7Um+vQ95IkQQg3gyIw7P3GrgDJ5DU00tb9s+DvBFgm4aHPCWi3kwljNx734y3F12WdzJXVGOkoeazt3Ha/Kt4Ei0KhvKOy0tGQbqIshi5W9JTTzpHo3CyQXtCZGfu9dy9Yo5skb/C9bGfSYzg13JTjCJiqVoNdlgv76TsmLpSAxQptJRYN22DaTjYELx1tVtVFNUdxyT3qBIVO7Lo6zwTx458mGCwdVMFaBa4heznUKspS99GLcYUlA82qKDxvQi1HMnEh/qaaW2mhgbvtVqk9AijNSKeEZlA++HAyTsTbTxTAeu1soR9crX2xEXOqyYHiik/dWswRgq6KspuIkUra3TjYZJHsxmTeJdMxSVVRYC/R+Y9LS6yr8ctN6/S3AurrWU3hyxb/JNq5xyr9xaAuq5CoLc4vfKCvnWAQg20zHP8PYloh8T9U4BaxAsWy+17FJmyU+Xv97OE8SD79ti1Nv2WAGMoOA1nJM53ke2vIJcs/CDZ4e/29DwDATSaNjnJCJkOxnVpp0P1Fqtv+kg6VSF9Rfl6PwduhuKvJ7cI1ngF1IKW3I37MD07oZWRL56LNWeltRAEG0ObbAxbqICWZmSwbLbFKlZYWnk8B2gL9fdd5A00jrKbpLSbDxC+iC3rsxUqDz8lFQpUKxO9qxLwRNvd9QNum5Z7EauQm3+L/FEgykomiFCkHt0NmhpiQcVV+vipkAdBdOly9DTZFGxVs+pGCuBJvx/8LBfN+ejxAMp+08pVtfAmS8wwc7H30IOL4+xJy1SkEzIBxBC8IC3G+xbdKSQRUWq8mPyoh02Wyr99BMeAy9hSxpqpOWmvYsm1TQsawbmOBwaloK/oy/4rIt9+cORVLwk15jOaJ0XlfDjfSyTtb9QTNmIiuh8PJGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":225,"cache_read_input_tokens":53683,"cache_creation":{"ephemeral_5m_input_tokens":225,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWsGVbiuq9nxKWB3bWS1Q","type":"assistant","uuid":"ef14efd0-ed32-4de8-875c-849e2ad2a6e4","timestamp":"2026-01-07T02:58:14.270Z"}
{"parentUuid":"ef14efd0-ed32-4de8-875c-849e2ad2a6e4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PmQzLeHULAKEHFhDrHWbxV","type":"message","role":"assistant","content":[{"type":"text","text":"Got it - **minimal ProfileService** for this migration:\n\n**In scope (Salesforce Customer Support migration):**\n- ✅ JIT Contact reconciliation with Salesforce (upsert by email)\n- ✅ Contact migration (one-time app database → Salesforce)\n- ✅ Return Salesforce Contact ID to Mobile App\n\n**Out of scope (added later for Flybuys):**\n- ❌ Partner account linking (OAuth)\n- ❌ Reward preference management\n- ❌ VCI canonical identity management\n\nSo this migration is the **foundation** that establishes ProfileService, which will be enhanced for Flybuys integration.\n\n**Question 42:** Does EngagementService already exist, or are we creating it as part of this migration too?\n\n- **Option A:** EngagementService exists (manages Braze integration), we're adding Salesforce Case creation\n- **Option B:** EngagementService is brand new, being created for this project\n- **Option C:** EngagementService exists but doesn't handle feedback yet (different capabilities)\n\nWhich scenario?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":225,"cache_read_input_tokens":53683,"cache_creation":{"ephemeral_5m_input_tokens":225,"ephemeral_1h_input_tokens":0},"output_tokens":403,"service_tier":"standard"}},"requestId":"req_011CWsGVbiuq9nxKWB3bWS1Q","type":"assistant","uuid":"186c55d7-f584-438f-a69e-279fe839fdfb","timestamp":"2026-01-07T02:58:18.157Z"}
{"type":"file-history-snapshot","messageId":"3c2f27a2-9f2e-41e3-9197-1fdbb89bb6e0","snapshot":{"messageId":"3c2f27a2-9f2e-41e3-9197-1fdbb89bb6e0","trackedFileBackups":{},"timestamp":"2026-01-07T02:58:25.989Z"},"isSnapshotUpdate":false}
{"parentUuid":"186c55d7-f584-438f-a69e-279fe839fdfb","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"B"},"uuid":"3c2f27a2-9f2e-41e3-9197-1fdbb89bb6e0","timestamp":"2026-01-07T02:58:25.959Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"3c2f27a2-9f2e-41e3-9197-1fdbb89bb6e0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0178i5UrZJyE3NQfoytZiKko","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect - so BOTH ProfileService and EngagementService are brand new bounded contexts being created for this migration. This is a significant first step in implementing the target DDD architecture.\n\nThis changes the framing considerably:\n- This isn't just a \"D365 CE to Salesforce migration\"\n- It's the **foundation for the target DDD architecture**\n- First two bounded contexts: ProfileService and EngagementService\n- Sets the pattern for future bounded context implementations (like LoyaltyService for Flybuys)\n\nLet me confirm the scope.","signature":"EsIFCkYICxgCKkD1VhpQWjESAlh9V930jrPpoxNNw75IV0XzbtzsqQ1cGTxF8q5Cz4Tjg6ZQ1siH4qiAqpQijTk5SygjXVdY3/2+EgyaBF/p842C92+uk8caDJAFmfhVluTZrbwjNSIwYwMd6mmrm/rjMvqfYHvyWZPPj2Gw+WMq13vA1RpOrydFFHKMzlkRO6gb6gh3ISW4KqkEoc8JXlvAUz7qoG5NuM2D0pgtcC6ev0ZOKwfAZbMoF6y5kn44e179/fO5/U7bPvpNNVZ0+7aQeVapHzzsXAGaRvWtKGnJ8xN3JMSCTrIXx6QI1HM/pLOMT31ZVPGmLnsQZAhSNOFsgPmGe0BG7cBS07Vla/NqXlqUYHCHvC739N2xFpESCpdiIbWhk9zIxLNExxRN1p9RrFyyLFoaf1QnPh9ASYwjjaAEZdbUopxC4JeIJt2McAgASJfv9aAtUmtCYS3LN3PhWubWeHQM4VG5+YXn2kEJNfAfaups01ZT1caycXkPqU2AMuvVzFF+mGYLfTOq+1YbqJgDlUmujkvI86aatL3d9jgOaAS4EiBskP/Fo0O6T6COSF4Qyywoq+TZoNQ/KRa3Hfqq1LJ5RGmGYhWRWVhKRNr1ido39/g9466XzcRd9/LrYbnoEK8/yqbBjc4JEae0QZ13z1GEQleU/Guf8mX+2hQlN2tXfNgoRfXKaz0ZI4zc7D1hfv6AZcZ9nSQ7Rbn2yS3WSbj85OuRX5DHPkkJm0wGiDF/4vCJdQiXXBQ4tl5+SAGF3xtMIL1DbAFVwPP/MUc++UMt+d6ljpabPB2XDZb2i37Ak9JDRevaYHXbRBK4pTpPV9hxcCLQZFb9fHlvkcxK/yHfHBMqINOYEYFPaq+Ra529RDkeCkSaVtLmSAJ0R4ivlKthEicNAZ6lyAVEXgrQtMam364lxH5rMFHrTnXSfBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":365,"cache_read_input_tokens":53908,"cache_creation":{"ephemeral_5m_input_tokens":365,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGWqzBVvVMFBUXfE7VP","type":"assistant","uuid":"32221da7-93c5-4577-91e3-56dd787b7f95","timestamp":"2026-01-07T02:58:32.454Z"}
{"parentUuid":"32221da7-93c5-4577-91e3-56dd787b7f95","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0178i5UrZJyE3NQfoytZiKko","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **both ProfileService and EngagementService are brand new** bounded contexts!\n\nThis migration is actually **much bigger** than just switching from D365 CE to Salesforce. It's:\n\n**Creating the foundational DDD architecture:**\n1. **ProfileService** (new) - Contact reconciliation with Salesforce\n2. **EngagementService** (new) - Customer feedback/support facade, Salesforce ACL, Braze integration\n3. **Event Bus** infrastructure (new or existing?) - Domain event publishing\n4. **Retiring D365 CE** - Legacy support system\n\nThis is the **first implementation** of the target DDD architecture from your context maps!\n\n**Question 43:** Does the **Event Bus infrastructure** already exist, or are we building that too?\n\n- **Option A:** Event Bus exists (used by other services)\n- **Option B:** Event Bus is new (first implementation)\n- **Option C:** Using existing AWS infrastructure (SNS+SQS, EventBridge, Kinesis - already available)\n\nWhich scenario?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":365,"cache_read_input_tokens":53908,"cache_creation":{"ephemeral_5m_input_tokens":365,"ephemeral_1h_input_tokens":0},"output_tokens":372,"service_tier":"standard"}},"requestId":"req_011CWsGWqzBVvVMFBUXfE7VP","type":"assistant","uuid":"23c8f588-236e-4512-804e-262de5069751","timestamp":"2026-01-07T02:58:36.972Z"}
{"type":"file-history-snapshot","messageId":"a983c879-1b73-4358-b608-541c1425e139","snapshot":{"messageId":"a983c879-1b73-4358-b608-541c1425e139","trackedFileBackups":{},"timestamp":"2026-01-07T02:59:02.127Z"},"isSnapshotUpdate":false}
{"parentUuid":"23c8f588-236e-4512-804e-262de5069751","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"B & C"},"uuid":"a983c879-1b73-4358-b608-541c1425e139","timestamp":"2026-01-07T02:59:02.096Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"a983c879-1b73-4358-b608-541c1425e139","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GXyPSHUWyLcWS9RYyLVjMW","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is saying both B and C - so the Event Bus is new (first implementation) AND they're using existing AWS infrastructure (SNS+SQS, EventBridge, Kinesis).\n\nThis makes sense - the Event Bus as a pattern/concept is new for the DDD architecture, but they're leveraging existing AWS messaging services to implement it.","signature":"EuYDCkYICxgCKkBYqaQMwd37aLzq8f0y+Cxe++U+zefTBO2NvsPyy5wBMhmjKyqxnYmhKHQL+NV2mS9cCtu5bod181a+33SFwW2MEgznamiJ5ESXyDjuP5EaDCF1jAiYVlyI2ErhZiIwkf9Z3lTh8rMCzuSWbH8698wp1WWy1mvlFEgH7PVXq9h3qYyscqwRquBIyE7hK/CAKs0CPvEW/1W8b6y73af470GnxdKVfuUG2JeA6+fK5DGa0xb23k/Gw1y+ylSWL2y+keOIV2q1NlgNTNyBRAMW88xQPjpOsyyH4QGVMXlzPgya9Upu6rwcbt+cjhcqoAK5YF9FcI4rdFHMC7wRfEzwYyO/UhVNTKAHJblBL/Qk2ZOdl1Clf1sJFQFVg9Rv6IsXKgDmVlmSnI9Ipym0d3t0+dC/ygB9jo9wzZITepOTdaZuwuahsJyV8/aXqeeIWAGeW7U5Ce0EaI5Y3h1Nielj42CBUjsdNl9iP0h9+p4vO1BcFT9ypWZY5c7iBRO3I3r/wQV3PMq+nREori2/JXS6zPf9RZSByLXpNLK72JxJtQdIxW3Ts/KEb7gX6WL8xuHLAyncFr3Tm9jBt2aUndhKkmxUsF4THKEg7usqdnXWEzeHR0BGTqMg9/UrcD1F0owFGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":247,"cache_read_input_tokens":54273,"cache_creation":{"ephemeral_5m_input_tokens":247,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsGZWUkdugtTug1S4SWS","type":"assistant","uuid":"3ca80bdc-613d-445b-947e-04c72599359d","timestamp":"2026-01-07T02:59:07.650Z"}
{"parentUuid":"3ca80bdc-613d-445b-947e-04c72599359d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GXyPSHUWyLcWS9RYyLVjMW","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **Event Bus is conceptually new** (first DDD domain event implementation) but **leverages existing AWS infrastructure** (SNS+SQS, EventBridge, or Kinesis).\n\nSo this migration is establishing the **foundational event-driven architecture pattern** for the target state.\n\n**Massive scope:**\n1. ✅ Build ProfileService (new bounded context)\n2. ✅ Build EngagementService (new bounded context)\n3. ✅ Implement Event Bus pattern (using existing AWS infrastructure)\n4. ✅ Migrate Contacts (app database → Salesforce)\n5. ✅ Retire D365 CE\n6. ✅ Mobile App integration updates\n\n**Question 44:** Given this is the **first DDD bounded context implementation**, is there:\n\n- **Option A:** Existing shared infrastructure/libraries (authentication, logging, API gateway, service templates)?\n- **Option B:** Building everything from scratch (first microservices)?\n- **Option C:** Mix (some shared infrastructure exists, some new)?\n\nWhat's the platform maturity?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":247,"cache_read_input_tokens":54273,"cache_creation":{"ephemeral_5m_input_tokens":247,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsGZWUkdugtTug1S4SWS","type":"assistant","uuid":"8a2fadbd-21cb-4e6b-b341-2ad08c883f6d","timestamp":"2026-01-07T02:59:12.413Z"}
{"type":"file-history-snapshot","messageId":"152ca5e9-af34-4d91-b91c-38c09ab7d383","snapshot":{"messageId":"152ca5e9-af34-4d91-b91c-38c09ab7d383","trackedFileBackups":{},"timestamp":"2026-01-07T02:59:35.813Z"},"isSnapshotUpdate":false}
{"parentUuid":"8a2fadbd-21cb-4e6b-b341-2ad08c883f6d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"C"},"uuid":"152ca5e9-af34-4d91-b91c-38c09ab7d383","timestamp":"2026-01-07T02:59:35.776Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"152ca5e9-af34-4d91-b91c-38c09ab7d383","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xdj18gL2zU2LHuYqqa8czw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good - so there's some existing platform infrastructure but this is still a greenfield bounded context implementation. This is important context.\n\nLet me think about what we've covered now:\n\n1. ✅ Error Handling & Resilience - covered\n2. ✅ Contact Reconciliation - covered\n3. ✅ Case Data Model - covered (fields captured, mapping TBD)\n4. ⚠️ Multi-Tenant Data Isolation - TBD\n5. ⚠️ Salesforce Integration - mostly TBD (REST API likely, auth TBD, webhook TBD)\n6. ✅ Case Routing & Notifications - covered\n7. ✅ ProfileService scope clarification - CRITICAL discovery: both ProfileService and EngagementService are brand new!\n\nI think we have enough to draft the Executive Summary now. But let me think about what else might be missing...\n\n**Contact Migration logistics** - we haven't covered:\n- When does migration happen? (before cutover, during, after?)\n- How long will it take?\n- Validation strategy?\n- Data quality issues?\n\nThis could be important for the Migration Strategy section.\n\nShould I ask about this now, or is it better to move forward with drafting the Executive Summary and come back to migration logistics later when we tackle the Migration Strategy section?\n\nI think the user wants to work through this methodically, so maybe I should ask one more question about migration timing, then suggest we're ready to draft the Executive Summary.","signature":"EvsLCkYICxgCKkAznp0nDIcbOqWxlfN8sgPIDSYXfAFooLSLIMFOL3VKPCzJvJka9ak15rUxJiBFMDTgMYC5+T4kVAwMldyKizi/Egzie8jRkH9zFYc7hNAaDCw9JLaktXdAnizH9iIw3QDg0PnZavs51FJqF8yuQmMlCyn6d1a9EL5KWt9RL/rKjwnD2XKezS77I4WOTLTMKuIKQxNP1yKiHVq7l5RzHX2jnO5qtJCI++Y2VInY5GeKLr3/tApcWOZ20cnc5TNlsEjcREZE8aIzXEa6eO5QMETKhp5nMTtsoXeS8gcc2f64e9UcLq6EIiGW2NhzozabylU6K1OXjHIPDWAJZikCk6UQ/YiDLWcGAdpxzcplauIzdw56eQoP2KJeTVmkRSs3EF820gEI7cKGCfDyabxza6mGENOrmpcWvmDb8HRNOqeoqZ76x/8JUVNEPUEFK3i2HskAR2swMVWoxUrttBOfjifSzyoGNtJG4/efgYEE5KstmcNXyUU/QkIS2KdkoFCcA4qSmtpZ5rDt4X9eQQTLaldYItxVX8y3JQGWtZpNZqwJfIVsFARuW4GFGaFaNsYBaQdx8r3OCLvb/3mx+iOmsaX4JPG/v+5UTlkGeu1HYKhukccqSnF5gMSlBzchS4xPpbnlQLSOxHBcS1PpsMwAt0Qh3JR3FUpKRtx2OSXVrCQb4yWYjOMVGBOUnRQn+2j6o8cqqO9PsQkn2IG4MZ/Xpja21Ha8t++cVtWTi5p4teghsEkfqL9kJa1bIdyg94UZ4W4FlzeBZ89VT2NQeO5b/C6pq16VDKGCpv+4Q/gCa/adI4xddThZXQmwU4Mn6EB2kXVOV81/u/d/9YVmqqStZGvMefpPdJII+9aVLEQQY5irN2idNDx3bBAcSKpoaqerJN1UpGsgmyWcU8hZBoJHlaMJZ933sV4pSJwZie5J3ptURd1yIVIcJtu5DFSr5J162YQEbeN878aN4MpXIr+2c+kF0fiRES5YYEMJx4+SpQok1e0aMAFkSve3SNIMrFHcq75CuVQ+rwlAvECDF9zuIHNvE1EV8Rk6UBJ6/YFcW+KfpztU3AjWbFEkokSXgsuuVY2HW8BeI+dUhk77vo8k4Po19x+PRWTaxBDHap6N9ZrnoXhQYXrnmUSnIg19yXJkVTzhwvWp/MYtNiZhJN8Knr0l29sVTzOpozppbBjpWcKXTHQvUETEO9cFAMdp6ETc5Yp2ZdRKGzC5SOzXxGk9GAr+IhVF3pGKeZYonTO9wkNPt4YrowcaocyH4i/Vglj7ZyqKPIC8eUf2jzyfBtO7vzlO5yhyNJBrZ5+DG1kx20xUccSL+SfXoqnH8zj299mxdkReiSpbDOxD3LytIQCOSGjp+b6qoFTgrKEUKKRtcqrOi7U+yHdL1G5daPqcJpZTYArJRqZ/eKVpE7Dn6O59LbUTgftqylqMPDbVZ7jtVDDMQ7Lcnbj25Z6o346J9hQFID72J+72la3GPe5KWnl7PktD/8Cq9ZwCvtHwwummzjdVn+Ci1ggNhxkDkbpBxcf3bZFsRt/40S1LR6wx3A4DYsFk/Hvi4hm9fDdoYkk4yUqBi/t1TStt5iDd/C1/U9R1ed8/4LHHsuYGoTN/IxFoexmJX+A6kzPPM7hjjDjvj2jLbt9eYrdjAUyG40j3qCLV3S6saAUpv+C2iF5nxKibKznPEx8a1Aly/kgW4Fcg3MPFbMjo527rZ9QMSeVZFVhxpoGWz/W6g4+KJRsTY2/w6Q6g4wnfdzLWflNQwiRJEruejvfXcvuazGf1EVbPv7WO6lQuSWBuSRajj1hbHLOGTF4lEQ+NmmDMcY967D49hHg/JXwy0tYnLWyvF6iqRXmdxsoAqeEBGJpb1P6QpiFOmQmg8ORoaCoXVbIxZUZH4lG+1kUu1RK0wpLuLQceYClnNyIq0iNE7+3g8WPX3IY30WMuAJ0vj/H4FjnAIt/0IY7F+tYBYpQWarcrN0bDnLyWxCGwqJSb4VKX9p8iW2RBMWk0XaSu3GAre6xYPPJmlxAZOu9zEBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":255,"cache_read_input_tokens":54520,"cache_creation":{"ephemeral_5m_input_tokens":255,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGbzV3TVwndotdJR6uS","type":"assistant","uuid":"9950946c-bab7-464a-8737-0434e10ac464","timestamp":"2026-01-07T02:59:47.734Z"}
{"parentUuid":"9950946c-bab7-464a-8737-0434e10ac464","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xdj18gL2zU2LHuYqqa8czw","type":"message","role":"assistant","content":[{"type":"text","text":"Good - **mix of shared and new infrastructure**.\n\nWe now understand the **true scope**:\n- First DDD bounded context implementation (ProfileService, EngagementService)\n- First event-driven domain event pattern\n- Leveraging some existing platform infrastructure\n- Building new microservices\n- Retiring D365 CE\n\n**Question 45:** One last question before we draft Executive Summary - **when does Contact migration happen**?\n\n- **Option A:** Before cutover (migrate all Contacts first, then switch Mobile App)\n- **Option B:** During cutover (parallel: migrate + switch Mobile App)\n- **Option C:** After cutover (ProfileService JIT creates most, backfill historical Contacts later)\n\nWhich approach?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":255,"cache_read_input_tokens":54520,"cache_creation":{"ephemeral_5m_input_tokens":255,"ephemeral_1h_input_tokens":0},"output_tokens":512,"service_tier":"standard"}},"requestId":"req_011CWsGbzV3TVwndotdJR6uS","type":"assistant","uuid":"4f9069d9-b8ca-4663-8c5f-dbf4dc0ba6a2","timestamp":"2026-01-07T02:59:51.469Z"}
{"type":"file-history-snapshot","messageId":"98a337e2-4baf-4cbe-885c-58974bd9f686","snapshot":{"messageId":"98a337e2-4baf-4cbe-885c-58974bd9f686","trackedFileBackups":{},"timestamp":"2026-01-07T03:00:16.524Z"},"isSnapshotUpdate":false}
{"parentUuid":"4f9069d9-b8ca-4663-8c5f-dbf4dc0ba6a2","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"A"},"uuid":"98a337e2-4baf-4cbe-885c-58974bd9f686","timestamp":"2026-01-07T03:00:16.494Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"98a337e2-4baf-4cbe-885c-58974bd9f686","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019gTZaFrzt4aNJJL6BpBuRD","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect - **Contact migration before cutover**. This makes sense:\n1. Migrate all Contacts from app database → Salesforce\n2. Validate migration\n3. Deploy ProfileService + EngagementService\n4. Switch Mobile App to use new services\n5. Retire D365 CE\n\nNow I have all the information I need to draft the Executive Summary. Let me create a comprehensive summary that captures:\n- The challenge (fragmentation, D365 CE issues, post-merger consolidation)\n- The solution (new bounded contexts, event-driven architecture, Salesforce consolidation)\n- The scope (this is the FIRST DDD implementation - foundational!)\n- Success criteria\n\nI should also use the TodoWrite tool to track what we're working on since the system reminders keep telling me to use it.","signature":"EowHCkYICxgCKkDEsSFOr1BuPkLTI2UXgmw/VZlGauWxxHmoJk/32mbXeJ+/Ct6spv8A7uRr2do+atR4OAReOqUYVeZSLBg+FOowEgxNxMtVwOk8bJnX7AAaDKjYccYiMUv/QfezqiIwbKZI87TrBTTcJvXq4G2txNXDlZ6/9z+c+kkJZfDFf1ZCjIu2W5DTMWrLlwrPpp3aKvMFaa8yxuOPgUO4JJ/aS/8zcl79/h2cEjMv3bZhVirKSrJsCPCEuegJZmHul7zSG/h2c+xW7NGmIZz4WREzY6YH0WOvy88vZA4c63r7wM0NrtVit3ymI2MKiHLgAMH+D0kEgcMCTjJxRXy/hE5P+/8esUU93RfizKiLR4CETB883hVSi89TWimqVLAXzwxyEse0PbtNIvCQspDtDZXVv+zjI38Yp6jQKybQe7jun1/YIFfse32uWQC34CWOJy/pMU2aulaqkLBaVbA6EVY5ItjE8NLL0tUg1OElpt9ezJSAOxoZ+YUHM9kT3m4P6JTqhg+/PzsWW7n5bxVZhKlOScmEfOVhNYJMrycMXyErbPKZ8eY8JNJJ77yndNdn4THP9IVC3YWcAAuVKVXjfaUBhZVkGMfjXTcN9jSH18/zk0E0EzJrqTZXv8kQ+nU3Hm7G40GhcrmwU0Atz0R2aDESObaROx2xPyAOZCWq84QZS/8uk19cqIK0Y69GLeO8yK7ZTazPekwYDrWBcvi4GugouZ2jYIlv4FgP2HqczJrKaoLuYFr+iCiK8jrJh8v6/aPlEXAUv6dOKlSNNvSOFIpTPce8a0nzMataATzcFUsjOuYPND/Se7iMQONHnoXHa+VI6HyuFwvvkHM3FyRJJ8iwzIr0OCEl/wByuaFvYRBjlulfVfO8VExxIWlzMivHsN+kD4XZ/S1gDC+/3odCJbSU/KBI8MGy8NLne15Z1r2jYpW4VHiZfnPyWuH/Y3U+g4Q4uZAYCe9Sxcd0gCoWCv4SrcdwUa31Y7VHFAxTlA6ww9OWP2HmesAIIsfSKb+881rLJuFca4C5J7R6+1yQe5VfpSAxxnboKBNTZSOi87zRMxJRkXnzUvWCcqKYyiKAazQFX5tgqrKwJ8AkJad6jBRd1lVT3+R7uvuaVR8fo40D6nroi1w/uJZJZyr1G9Tx49px6XQac4wMYEwJH1UtEM4dGMwwqMNAqu35Cte2QKSSAzb+FT14ZSYYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":272,"cache_read_input_tokens":54775,"cache_creation":{"ephemeral_5m_input_tokens":272,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGezZqiFvsRT1ofKvvH","type":"assistant","uuid":"0dd3d5de-a376-484e-8009-d362d5196839","timestamp":"2026-01-07T03:00:23.600Z"}
{"parentUuid":"0dd3d5de-a376-484e-8009-d362d5196839","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019gTZaFrzt4aNJJL6BpBuRD","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect - **migration before cutover** ensures data is ready.\n\nMigration sequence:\n1. Build ProfileService + EngagementService\n2. **Migrate Contacts** (app database → Salesforce)\n3. Validate migration\n4. **Cutover:** Switch Mobile App to new services\n5. Retire D365 CE\n\n---\n\nI now have everything I need to draft the **Executive Summary**. Let me also create a todo list to track our progress through this document."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":272,"cache_read_input_tokens":54775,"cache_creation":{"ephemeral_5m_input_tokens":272,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGezZqiFvsRT1ofKvvH","type":"assistant","uuid":"53f145aa-6827-4ede-baed-cf7327d4baed","timestamp":"2026-01-07T03:00:25.926Z"}
{"parentUuid":"53f145aa-6827-4ede-baed-cf7327d4baed","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019gTZaFrzt4aNJJL6BpBuRD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VpQeJRA7c483Sotss6Y4KJ","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"in_progress"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"pending"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"pending"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"pending"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"pending"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"pending"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"pending"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":272,"cache_read_input_tokens":54775,"cache_creation":{"ephemeral_5m_input_tokens":272,"ephemeral_1h_input_tokens":0},"output_tokens":722,"service_tier":"standard"}},"requestId":"req_011CWsGezZqiFvsRT1ofKvvH","type":"assistant","uuid":"e98060f0-7198-4ebe-b37b-641c179d04b9","timestamp":"2026-01-07T03:00:32.034Z"}
{"parentUuid":"e98060f0-7198-4ebe-b37b-641c179d04b9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VpQeJRA7c483Sotss6Y4KJ","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"1a946825-af3a-45ca-a0cf-c106695f4422","timestamp":"2026-01-07T03:00:32.150Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Complete Executive Summary section","status":"in_progress","activeForm":"Completing Executive Summary section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"1a946825-af3a-45ca-a0cf-c106695f4422","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SJfgFWyiBWhLdhQ2KNzmhP","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, I've created a todo list. Now let me draft the Executive Summary section based on all the information gathered.","signature":"Ep4CCkYICxgCKkDEfQkHzEyr+ukugAh5vEUnTNezbCeP1EPzT9NaVwpapDdnPp4OAk+pSUYwX65LX8Dc7+l2XGxk8dr9k5U3nD45EgyDtSu+tym0nhSXAKYaDLMgiNqEC3lRl+W2mCIwe0ojBxjrurt6aEZdrkV6MVAtsEu9Bx3epiSRpMDnISvmlPgvn3wzkOH4ocL6Ylx/KoUBbPjTWX4x3JHZ79PzUfu48L3TE8c8pyp0mXt2RbvLt2zUGZODi3o4YyHC3dx10YFTnyiPmwtu0a5yij85g2nEh3W1H0eMIqmOSnCCToZNFmO5D2dJMy2CuKafXYd94DFcSGK58KeScfISEgZnoxtAicvLnQ1hB0wwYAAfmf4IzQgo1ujaLBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":663,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":663,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGgALFAME2vVp2ghebg","type":"assistant","uuid":"448f74d7-892e-46d4-8bf7-de34880fb17f","timestamp":"2026-01-07T03:00:38.397Z"}
{"parentUuid":"448f74d7-892e-46d4-8bf7-de34880fb17f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SJfgFWyiBWhLdhQ2KNzmhP","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll draft the **Executive Summary** section:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":663,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":663,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGgALFAME2vVp2ghebg","type":"assistant","uuid":"aeb87f06-4f96-4bd6-a7e1-981dc01fadfe","timestamp":"2026-01-07T03:00:38.653Z"}
{"parentUuid":"aeb87f06-4f96-4bd6-a7e1-981dc01fadfe","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SJfgFWyiBWhLdhQ2KNzmhP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017PMZCVkwgSCDpR55zR2H8W","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"== Executive Summary\n\n=== Challenge\n\nMigrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.\n\n=== Solution\n- Replace D365 Customer Engagement with Salesforce for customer feedback and support\n- Consolidate customer data into unified profiles via Profile Service\n- Leverage event-driven architecture for seamless data synchronisation\n- Migrate existing customer and case data from D365 CE to Salesforce\n- Ensure minimal disruption to existing support operations during migration","new_string":"== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":663,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":663,"ephemeral_1h_input_tokens":0},"output_tokens":1458,"service_tier":"standard"}},"requestId":"req_011CWsGgALFAME2vVp2ghebg","type":"assistant","uuid":"16080369-f7c2-4c0f-9199-4d0af97239cc","timestamp":"2026-01-07T03:01:15.033Z"}
{"type":"file-history-snapshot","messageId":"16080369-f7c2-4c0f-9199-4d0af97239cc","snapshot":{"messageId":"98a337e2-4baf-4cbe-885c-58974bd9f686","trackedFileBackups":{"architecture_definitions/salesforce_customer_support.adoc":{"backupFileName":"b48130ecf45d961e@v1","version":1,"backupTime":"2026-01-07T03:01:37.206Z"}},"timestamp":"2026-01-07T03:00:16.524Z"},"isSnapshotUpdate":true}
{"parentUuid":"16080369-f7c2-4c0f-9199-4d0af97239cc","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017PMZCVkwgSCDpR55zR2H8W","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   103→\n   104→\n   105→==== Key Architectural Patterns\n   106→\n   107→== Executive Summary\n   108→\n   109→=== Challenge\n   110→\n   111→OTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n   112→\n   113→* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n   114→* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n   115→* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n   116→* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n   117→\n   118→=== Solution\n   119→\n   120→This architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n   121→\n   122→==== New Bounded Contexts\n   123→\n   124→* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n   125→* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n   126→* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n   127→\n   128→==== Integration Architecture\n   129→\n   130→* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n   131→* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n   132→* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n   133→* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n   134→* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n   135→\n   136→==== Migration Approach\n   137→\n   138→* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n   139→* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n   140→* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n   141→* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n   142→\n   143→=== Key Architectural Significance\n   144→\n   145→This migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n   146→\n   147→* First bounded contexts implemented (ProfileService, EngagementService)\n   148→* First event-driven domain event pattern (foundation for future bounded contexts)\n   149→* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n   150→* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n   151→\n   152→=== Success Criteria\n   153→\n   154→* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n   155→* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n   156→* D365 Customer Engagement decommissioned within 90 days post-cutover\n   157→* Customer satisfaction score improves by 15% within 6 months\n   158→* Average case resolution time decreases by 20% within 6 months\n   159→* Zero data loss during Contact migration (100% validation pass rate)\n   160→* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n   161→\n   162→=== Technical Constraints\n   163→\n   164→* Shared Salesforce instance (Viva Energy multi-tenant environment)\n   165→* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n   166→* Contact migration must complete before cutover (no parallel run)\n   167→* Async Case creation mandatory (non-blocking user experience)\n   168→\n   169→=== Open Technical Decisions (TBD)\n   170→\n   171→* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n   172→* Salesforce data isolation strategy (Record Types, custom fields, queues)\n   173→* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n   174→* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n   175→* Retry policy configuration (attempts, backoff intervals)\n   176→* Expected feedback volume and Salesforce API rate limit strategy\n   177→\n   178→== Technical Requirements\n   179→\n   180→== Technical Architecture"}]},"uuid":"da411b6a-f5ed-4c13-9249-02938a10a984","timestamp":"2026-01-07T03:01:37.178Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"== Executive Summary\n\n=== Challenge\n\nMigrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.\n\n=== Solution\n- Replace D365 Customer Engagement with Salesforce for customer feedback and support\n- Consolidate customer data into unified profiles via Profile Service\n- Leverage event-driven architecture for seamless data synchronisation\n- Migrate existing customer and case data from D365 CE to Salesforce\n- Ensure minimal disruption to existing support operations during migration","newString":"== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nThe purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n\n=== Vision\n\n> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n\n=== Architectural Approach\n\nThis architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n== Executive Summary\n\n=== Challenge\n\nMigrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.\n\n=== Solution\n- Replace D365 Customer Engagement with Salesforce for customer feedback and support\n- Consolidate customer data into unified profiles via Profile Service\n- Leverage event-driven architecture for seamless data synchronisation\n- Migrate existing customer and case data from D365 CE to Salesforce\n- Ensure minimal disruption to existing support operations during migration\n\n== Technical Requirements\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":108,"oldLines":15,"newStart":108,"newLines":73,"lines":[" "," === Challenge"," ","-Migrate from D365 Customer Engagement to Salesforce for customer feedback and support, ensuring seamless data synchronisation, unifying and reconciling customer profiles, with minimal disruption to existing support operations.","+OTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:"," ","+* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels","+* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs","+* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times","+* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform","+"," === Solution","-- Replace D365 Customer Engagement with Salesforce for customer feedback and support","-- Consolidate customer data into unified profiles via Profile Service","-- Leverage event-driven architecture for seamless data synchronisation","-- Migrate existing customer and case data from D365 CE to Salesforce","-- Ensure minimal disruption to existing support operations during migration"," ","+This architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:","+","+==== New Bounded Contexts","+","+* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App","+* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus","+* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern","+","+==== Integration Architecture","+","+* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data","+* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts","+* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce","+* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases","+* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates","+","+==== Migration Approach","+","+* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)","+* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)","+* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run","+* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover","+","+=== Key Architectural Significance","+","+This migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:","+","+* First bounded contexts implemented (ProfileService, EngagementService)","+* First event-driven domain event pattern (foundation for future bounded contexts)","+* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)","+* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services","+","+=== Success Criteria","+","+* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch","+* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)","+* D365 Customer Engagement decommissioned within 90 days post-cutover","+* Customer satisfaction score improves by 15% within 6 months","+* Average case resolution time decreases by 20% within 6 months","+* Zero data loss during Contact migration (100% validation pass rate)","+* Mobile App feedback submission success rate > 99.5% (including async Case creation)","+","+=== Technical Constraints","+","+* Shared Salesforce instance (Viva Energy multi-tenant environment)","+* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)","+* Contact migration must complete before cutover (no parallel run)","+* Async Case creation mandatory (non-blocking user experience)","+","+=== Open Technical Decisions (TBD)","+","+* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)","+* Salesforce data isolation strategy (Record Types, custom fields, queues)","+* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)","+* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)","+* Retry policy configuration (attempts, backoff intervals)","+* Expected feedback volume and Salesforce API rate limit strategy","+"," == Technical Requirements"," "," == Technical Architecture"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"da411b6a-f5ed-4c13-9249-02938a10a984","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01L8xv3idnbx6RqZHkNnQBfD","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! I've drafted a comprehensive Executive Summary that captures:\n\n1. The challenge - fragmentation, D365 CE issues, post-merger consolidation\n2. The solution - two new bounded contexts, event-driven architecture\n3. Key architectural significance - this is the FIRST DDD implementation, foundational for future work\n4. Success criteria - specific measurable outcomes\n5. Technical constraints - shared Salesforce instance, conformist pattern\n6. Open technical decisions - things we identified as TBD\n\nNow let me update the todo list and check if the user wants to review this or move on to the next section.","signature":"EoUGCkYICxgCKkCgKmC3LdTrzJzGZzJ0XBA/IHK8KiLGVgguHjgCUIf8YWvZNfM3ENWqITHqOKLfAkioXloktPN+PBWjhoAD2cauEgwYFjdR68QqoMYRM/8aDJv5esNvd/YSxM+ctSIwUrb/ymCdy7CDs1scjRmJiz/wADCksu+ZzL+Qwy3x4VggeSFTRjvg5m2o1uA0qUO6KuwEUfjNH9INe5DwE3BnMqdqAO8gUQ0LMtpPqBhonkypUFKKb4tgwEHcyE5uunMIT090Ss0B98tIaCljM5nCbtK75Vb721u81db23pvNFnHDfdB7qX7Yx9pY2UcgntZVQw4SGVmQ2cWuS1WE379974LIYKutVSJVljd1C1+6GgQdpCDb29b9uxJgDBo+IswE8isSuCI13Xnc3SFv3e0Mg2db7rfDTZehCm4Bkk/lrw9z/nSfnlcgr15+1yTxgmjaImipynuVBDNKCZXhDmurKQIcNgPdWKGJIPXCTBNQt7eiUDcrA8lnUAYk2vdhnDHtuYnQ20uVfErNp+kJa0dSfTBMtFrU1WWyPtuUQrFreKQKjd9/nTCb9EOY1h1O8CU+N4WBqskYPn+dcE1VHw4XIAFmei9yWvRNIltYwple2G5kl2DJaqJUkWcc/VHVzINjKiSrWCY7orxHRWzEau+ke7fc5jjHCr4/Iy6YMo9hezHD72ia9U5d9ejoElFc8d7G3xS0giif1IV2IMBB7j27wq095ueVTsH9eEPJEKFGeO8AM8LXqr2ERG6db4VA/u0MzMSp6vR6JGGsKalSe9ZjshHMLD/Hxw2j0um0mTJNCBtpF8u23kl79rwlnb2C0D4pqTSzBvr5s4MBdBqbyZSGEd6z+o6JAZU4mHc6KWYRvdIH0mjJnwoxaB60MXotesroJRp1fjR4+A3xPUGBODFB9Y0Ahugpk9Q4TiImvBS/D/s9wEno6JSs1YttN3HLKOU9hYYjaNsjP7twsEdGIrdH+OrGfy2aSYn5+LR/nhZtlrjYlt4lrry4B338CfZfAj8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":2973,"cache_read_input_tokens":55710,"cache_creation":{"ephemeral_5m_input_tokens":2973,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGkyPZovxcQXuKheip9","type":"assistant","uuid":"51516978-1488-4784-9bc7-5c9ad1598d20","timestamp":"2026-01-07T03:01:44.300Z"}
{"parentUuid":"51516978-1488-4784-9bc7-5c9ad1598d20","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01L8xv3idnbx6RqZHkNnQBfD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CpbTrSXzYhbZ5wv9owjFyf","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"pending"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"pending"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"pending"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"pending"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"pending"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"pending"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":2973,"cache_read_input_tokens":55710,"cache_creation":{"ephemeral_5m_input_tokens":2973,"ephemeral_1h_input_tokens":0},"output_tokens":464,"service_tier":"standard"}},"requestId":"req_011CWsGkyPZovxcQXuKheip9","type":"assistant","uuid":"6f8833ff-b29d-4a79-9b1f-2a90e8092814","timestamp":"2026-01-07T03:01:48.811Z"}
{"parentUuid":"6f8833ff-b29d-4a79-9b1f-2a90e8092814","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CpbTrSXzYhbZ5wv9owjFyf","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"18a5eb45-2452-49a7-b617-6f3888790923","timestamp":"2026-01-07T03:01:49.046Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"in_progress","activeForm":"Completing Executive Summary section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"18a5eb45-2452-49a7-b617-6f3888790923","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017hH1u9LBC3tmwd1SaoLvsx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, I've marked the Executive Summary as completed. Now I should show the user what I've written and ask if they want to review it or proceed to the next section.","signature":"Es0CCkYICxgCKkB1gHmzB7sUn6DkuiJULy9UrkfFPFUHCL5OyQ8qRWHJ+iu7y7TWl1AP3rrTE9Msybxwzb+NwD6eYVG5DM1yD6UEEgxOJtr2o3w3vYXFf6MaDAHC5kvUg9qOKENWbiIwnKkifhwjJU2YHbhzarIESpOol/AmhNSqBo5PnDpAwBye3RMEHs4rZDiQqihahPtMKrQBT9GXhQQrhmFr0k8H8Lfl/+kON+GNlciVynmU72ICzhQ6Vwboq7WPwj41W/f5Iaa+LoJkDqEsOz3wa8oYhvPwPd3Sl4pOEnUghhtHmIbzoUzzpDJ7sH6xUoQlXNfN1BtU6GG2ZxI8aX2AwKcx0O8jTzVY6sd45MlhlmP8I55f7YOEpiK5BDTj6DGz3n6LNrsnaOvzNrLYccYh1FZ32nS5fFFqnk7ZYJL6dxSeCdvVycfvzkEEGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":510,"cache_read_input_tokens":58683,"cache_creation":{"ephemeral_5m_input_tokens":510,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsGmqKRMAPzJ6NvmdW89","type":"assistant","uuid":"9b808a63-4874-4566-a6bc-934a5974e887","timestamp":"2026-01-07T03:01:53.570Z"}
{"parentUuid":"9b808a63-4874-4566-a6bc-934a5974e887","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017hH1u9LBC3tmwd1SaoLvsx","type":"message","role":"assistant","content":[{"type":"text","text":"I've drafted the **Executive Summary** section. It captures:\n\n✅ **Challenge** - Fragmentation, D365 CE issues, post-merger consolidation opportunity\n✅ **Solution** - Two new bounded contexts (ProfileService, EngagementService) with event-driven architecture\n✅ **Key Architectural Significance** - This is the FIRST DDD implementation, foundational for Flybuys and future services\n✅ **Success Criteria** - 6 specific measurable outcomes (unified view, decommissioning timeline, satisfaction improvements)\n✅ **Technical Constraints** - Shared Salesforce instance, conformist pattern, async Case creation\n✅ **Open Technical Decisions** - 6 items marked as TBD (field mapping, authentication, webhooks, etc.)\n\nWould you like to:\n1. **Review the Executive Summary** (I can read it back to you)\n2. **Proceed to next section** - Technical Requirements\n3. **Make changes** to the Executive Summary first\n\nWhich would you prefer?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":510,"cache_read_input_tokens":58683,"cache_creation":{"ephemeral_5m_input_tokens":510,"ephemeral_1h_input_tokens":0},"output_tokens":282,"service_tier":"standard"}},"requestId":"req_011CWsGmqKRMAPzJ6NvmdW89","type":"assistant","uuid":"65bad408-0deb-45cb-9474-62f9ff2cc2ec","timestamp":"2026-01-07T03:01:57.437Z"}
{"type":"file-history-snapshot","messageId":"0158b7ca-7b51-4ae2-a7ce-c38772b28801","snapshot":{"messageId":"0158b7ca-7b51-4ae2-a7ce-c38772b28801","trackedFileBackups":{"architecture_definitions/salesforce_customer_support.adoc":{"backupFileName":"b48130ecf45d961e@v1","version":1,"backupTime":"2026-01-07T03:01:37.206Z"}},"timestamp":"2026-01-07T03:05:07.357Z"},"isSnapshotUpdate":false}
{"parentUuid":"65bad408-0deb-45cb-9474-62f9ff2cc2ec","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Don't just constrain this to the exec summary, use this context across the whole doc"},"uuid":"0158b7ca-7b51-4ae2-a7ce-c38772b28801","timestamp":"2026-01-07T03:05:07.322Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}
{"parentUuid":"0158b7ca-7b51-4ae2-a7ce-c38772b28801","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011V29xmBSNzKrfPcEcsKZRb","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is right - I should update the entire document with the context we've gathered, not just the Executive Summary. Let me think about what needs updating:\n\n1. **Introduction & Vision** section - needs to reflect that this is the first DDD bounded context implementation, foundation for Flybuys\n2. **Architecture Overview diagram** - looks good, already shows the key components\n3. **Key Architectural Patterns** section - currently empty, should be populated\n4. **Technical Requirements** section - needs to be populated with specific requirements\n5. **Baseline Architecture** - should acknowledge D365 CE deprecation (minimal documentation since it's being retired)\n6. **Gap Analysis** - what's missing between current state and target\n7. **Target State Architecture** - detailed ProfileService and EngagementService architecture\n8. **Architecture Decisions** - the ADRs we discussed\n9. **Migration Strategy** - Contact migration, cutover approach\n10. **Technical Risks** - the error handling, resilience, etc.\n\nThe user wants me to use all the context we gathered across the entire document. Let me work through these sections systematically.\n\nLet me start by updating the sections that come before the Executive Summary, then continue with the sections after.","signature":"EpULCkYICxgCKkC9f9YQe/2bp0C3lKq29Rb8e0aKzUU4j9FcPVy4+PskcWBYEV34pi5WysuzcSDWsJ7VkZdZQX6toWaeYTsmdkSZEgzl1CYd5iH/+eQ/8I8aDEl8kCVIyaFWglrUPyIw+Ibz070ZZWacZvh6rjuTxSu4kdVa4b6UTOCWmCGHJTwtmSX/H6v9OvhjqG0s6D54KvwJ7F82CajAXkrtb3CQ0qQpe+ZOSvalOoIMT5StZAwsjWZuXx9QMvNM3bL4l8/IP1ABot952ORAl7mRvGJZqmvA+oq/AKK2mLau9hpJHXcya1jp6ZWey1O7I2sAJhqkJ532RzDhyLICVRPH6bQP7hxyZJxIPwYBLWMkShjDMEPON6wPycNLG5hSW9Bdj0sipJvXhbG+vhC8SybVaHuyV8K25nlA6vegw6vUrdOhDBcIvWHKOFQAXLDTazGDCcGJpqkIWhHvsOaCefXOwc8FmvTNDVEXw7I1Az9KGIn7kfDs6LcKUMKlNCK/WYMeWmkpRsDuHprykscyovwDBXsa3HdKzFmXisrAP0hYWQygYwf7u6zTvEH0jm6fJ/x9s9qtEQAOjGaq0BSlnqRAP3o8qaiiUjDsRq0J6PtNXbOnH53qmO6PocHqKIkfHB2x5KaL1YBSwFPIJJSWZPGvEYVeFD1GLX60vchmf0Eqat84WyBSWk2apge1qgzXngMCzgMzEoIAcY+DdJNLJUSrzJXXwLTmoV8gWnWc50DVgiIFdPf5oCfQ2HZ7WiQFVuv1x1OFcGFk1/Pjc8HSGUqPq7zu4r9qTxMep8I3n5DlYPVwxIcUZcMdVZ3+Ldqy4aQZSQHU1PYoZyng9pti/qjQaYVMiPwq4+BgSCdn2a1OHQwkvQC6zASpA19/VaJa3YsxRRpjoZUynOITHnySjf+9gndME2UG9J/EY6Q+nNtIV0D1s7gfNczmzwdhaZVZ5sQxKU7fJ6+HPo9mfj16Yj13iMEhVNEfm+qDFldSd1fYk3PJvghW11t7AXNrkn/67hgAIH3mGH8Y0U0X/aPnNeErFb8QqvzHb90RN1s6gammv98PWMiBs3NRv2If1QIefKnNz6xiSaCzMGsfIHqIpTxaZEJ1HvOZ2TLpOChJQUERXeffA8ud4fnyUG7/UTk/cv8w0R3y3JrybglFbl6AlFpbVgP9FBTdej367hwl9S2KUukUcmKxXlZzD1wgx5W6YETvOU3T13rlW08MB7Reu2FdzU7nmrs74+vmA7hro90HarsSY3LaBEFCYXbGEHu2ybk24Nhpp6b1HJ4ByaowowFN9IQETqvPhwMOXa9BEweo/dViqmVnot0UOGsYkenUJSQ7GzO9pJM+yEpu03L9LC64JL9HBdbX48iXWy6gZhY5pKoXkC/DApphWm3K+tR01U5HqD2gwatoJ98y7ztifCz0Ii4dR/siXYhyy0X0HAcfxhpC9EO257LL+zw51dcbQQegZid08c+niRDxIkHrY5c34viu9PqrEbZlinRhgCSw+olBulas8Urhvl3hd+Nez4TCMu0HogC7sSuQPNWCdmAjPba84bU3yryz2IQ0wad2S35OEhHZ+6T5FWMU6qVAQz+N9T4S1rxjwBr7SlbUxuYkQveIbrOTC9Itw4Y4dRxX0nxL+a2mX5Tz1xgtJ7ST5cNkEruG+dzro2Iufj9bfR4pNi2c4gXAvwIA34r/rR5Akv2Q+ae02UdsZJH41EwYjA2PTVo3lqDd9e9ih37PwfjLrjqtx/R9EbpgjD5E2hR4BMFwts8XPvAZvsmmTcSdLjqKfpUaUvpbxDOwBCPh1EBEJxt8yxH+2dFGAXS8OrDCj1qkM/Q4gEOoitsyU/eUG3ucNS4ARVN9F/lpPX95KDFHZY3kkil16DwzCLB28FkjQg4M2hgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4035,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":4035,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsH2S56Z8xHn2fhuxjPp","type":"assistant","uuid":"48c4f1a3-abab-4ca9-934a-4d1062d0793e","timestamp":"2026-01-07T03:05:18.240Z"}
{"parentUuid":"48c4f1a3-abab-4ca9-934a-4d1062d0793e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011V29xmBSNzKrfPcEcsKZRb","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent point - I should apply all the context we've gathered throughout the entire document. Let me update the key sections systematically."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4035,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":4035,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsH2S56Z8xHn2fhuxjPp","type":"assistant","uuid":"30f4d759-2867-4034-967d-fb4d9cecb237","timestamp":"2026-01-07T03:05:18.967Z"}
{"parentUuid":"30f4d759-2867-4034-967d-fb4d9cecb237","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011V29xmBSNzKrfPcEcsKZRb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FihchhKtjM3D4vkxZ6cZTD","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"in_progress"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"pending"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"pending"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"pending"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"pending"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"pending"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"pending"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"pending"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4035,"cache_read_input_tokens":55047,"cache_creation":{"ephemeral_5m_input_tokens":4035,"ephemeral_1h_input_tokens":0},"output_tokens":693,"service_tier":"standard"}},"requestId":"req_011CWsH2S56Z8xHn2fhuxjPp","type":"assistant","uuid":"8069a7ad-91e0-4fc5-9d1b-a7d9942ac288","timestamp":"2026-01-07T03:05:22.159Z"}
{"parentUuid":"8069a7ad-91e0-4fc5-9d1b-a7d9942ac288","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FihchhKtjM3D4vkxZ6cZTD","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"6e933c84-a1e0-4b67-81a7-9d0f66eb7120","timestamp":"2026-01-07T03:05:22.382Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"in_progress","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"pending","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"6e933c84-a1e0-4b67-81a7-9d0f66eb7120","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017tV3dgNzUHfWjrRbtAqfnJ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me update the Introduction & Vision section to reflect the full context we've gathered.","signature":"EoMCCkYICxgCKkBsV/YxqoPcVTGTkKyksjpLaABHqVvcaYKLM9pY5zl3fzbdLvyIzoTZfqGUNTsZ6Am5nDc+dpsjhfo7S35TY2lZEgwGFvIUKnNa2qPtW9caDCmDIG+pttnivO2jSyIws6EteMZSM2FjNuVImkVvA9ki3v4a0JNtrEBDXuVbwTlkketYntKCRL9NjdYOTmIkKmsa9W0R+wvzIfKDrtQ0RVI0y4hYxdTIW9hgjCuxzRkjFOmjCOF/dmb3T+ePZ3ETzHbTiJ+cYMGutwl7ArfKRtc+55c4d4lUoZ6zvSq1V2Vrotw47yWI0M+6nO37p6580W7TFc8+xYlezoOHlBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":733,"cache_read_input_tokens":59082,"cache_creation":{"ephemeral_5m_input_tokens":733,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsH3ZDEwpfnJJQMjhyxc","type":"assistant","uuid":"7a7e168a-3433-4396-9093-de4f71aa947d","timestamp":"2026-01-07T03:05:25.985Z"}
{"parentUuid":"7a7e168a-3433-4396-9093-de4f71aa947d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017tV3dgNzUHfWjrRbtAqfnJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CYQ6tBaNVF3LNAbBTTTVjZ","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Purpose\n\nThe purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n\n=== Vision\n\n> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n\n=== Architectural Approach\n\nThis architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])","new_string":"=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":733,"cache_read_input_tokens":59082,"cache_creation":{"ephemeral_5m_input_tokens":733,"ephemeral_1h_input_tokens":0},"output_tokens":1002,"service_tier":"standard"}},"requestId":"req_011CWsH3ZDEwpfnJJQMjhyxc","type":"assistant","uuid":"2e35f86f-9e7c-47ec-a801-8548190dcf73","timestamp":"2026-01-07T03:05:49.061Z"}
{"parentUuid":"2e35f86f-9e7c-47ec-a801-8548190dcf73","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CYQ6tBaNVF3LNAbBTTTVjZ","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    20→:keywords:\n    21→\n    22→== Introduction & Vision\n    23→\n    24→=== Purpose\n    25→\n    26→OTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n    27→\n    28→This architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n    29→\n    30→=== Vision\n    31→\n    32→> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n    33→\n    34→=== Architectural Approach\n    35→\n    36→This architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n    37→\n    38→* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n    39→* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n    40→* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n    41→* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n    42→* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n    43→* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n    44→\n    45→=== Scope\n    46→\n    47→==== In Scope"}]},"uuid":"94979ef2-53c5-4042-b72e-2f2b6706fbd4","timestamp":"2026-01-07T03:05:49.557Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Purpose\n\nThe purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n\n=== Vision\n\n> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n\n=== Architectural Approach\n\nThis architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])","newString":"=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nThe purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.\n\n=== Vision\n\n> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.\n\n=== Architectural Approach\n\nThis architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.\n\n* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce\n* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning\n* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer\n* *Event-driven integration*: Loose coupling via Event Bus with published domain events\n* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":23,"oldLines":21,"newStart":23,"newLines":24,"lines":[" "," === Purpose"," ","-The purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.","+OTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency."," ","+This architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).","+"," === Vision"," ","-> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.","+> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history."," "," === Architectural Approach"," ","-This architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.","+This architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:"," ","-* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce","-* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning","-* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer","-* *Event-driven integration*: Loose coupling via Event Bus with published domain events","-* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])","+* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking","+* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus","+* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts","+* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API","+* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)","+* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover"," "," === Scope"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"94979ef2-53c5-4042-b72e-2f2b6706fbd4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TWKeFJq75PLUJrW3P7WrMe","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, now let me update the Key Architectural Patterns section which is currently empty.","signature":"EoACCkYICxgCKkDKiXBHfdMtALrYHpLVOafZG9DSa2V8EhwnzmCZvspq6lmLNIE9feEU2nnEIQnFM5N1t2eNcHibX7cOqIeNCFspEgw8CBo4EZSf5ySIXXAaDLN6eaXGQ4pDUeJjGyIwFS2d2kxVP6xy44lmLLaxtOnzsFS5Wk//mglUGCLVGDIlFdoOQxGRHZwzfEu91K91KmjLjmJoWTlykezAC8eNUZsabJUMKPTdsK3CNkQkbVqwunse/iahV/cEzC4/Z7oGTsspkHAsh7M3jQS/hCjm8Oh1klBZ0gGPtNfcdCtDr1rzMUFIDIhPIitzY9Lb4L0GallqiOxRaX6bYBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1705,"cache_read_input_tokens":59815,"cache_creation":{"ephemeral_5m_input_tokens":1705,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsH5bPm7BxgKY9SAgVFk","type":"assistant","uuid":"43d25d35-e293-4c70-8413-a20b9555bd92","timestamp":"2026-01-07T03:05:54.138Z"}
{"parentUuid":"43d25d35-e293-4c70-8413-a20b9555bd92","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TWKeFJq75PLUJrW3P7WrMe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DYRbkd5FvBx7nCopytiaZV","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"==== Key Architectural Patterns","new_string":"==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|==="}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1705,"cache_read_input_tokens":59815,"cache_creation":{"ephemeral_5m_input_tokens":1705,"ephemeral_1h_input_tokens":0},"output_tokens":600,"service_tier":"standard"}},"requestId":"req_011CWsH5bPm7BxgKY9SAgVFk","type":"assistant","uuid":"54d72ff3-7d6b-401b-8c95-cfee835f4b4d","timestamp":"2026-01-07T03:06:05.159Z"}
{"parentUuid":"54d72ff3-7d6b-401b-8c95-cfee835f4b4d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DYRbkd5FvBx7nCopytiaZV","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   104→    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n   105→----\n   106→\n   107→\n   108→==== Key Architectural Patterns\n   109→\n   110→[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n   111→|===\n   112→|Pattern |Application |Rationale\n   113→\n   114→|*Anti-Corruption Layer (ACL)*\n   115→|EngagementService → Salesforce Service Cloud\n   116→|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n   117→\n   118→|*Conformist*\n   119→|ProfileService → Salesforce, EngagementService → Salesforce\n   120→|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n   121→\n   122→|*Backend-for-Frontend (BFF)*\n   123→|EngagementService\n   124→|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n   125→\n   126→|*Event-Driven Architecture (OHS+PL)*\n   127→|Event Bus (SNS+SQS/EventBridge/Kinesis)\n   128→|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n   129→\n   130→|*Just-In-Time (JIT) Integration*\n   131→|ProfileService → Salesforce Contact reconciliation\n   132→|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n   133→\n   134→|*Async Processing*\n   135→|EngagementService Case creation via Event Bus\n   136→|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n   137→\n   138→|*Strangler Fig*\n   139→|Not applicable\n   140→|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n   141→\n   142→|===\n   143→\n   144→== Executive Summary\n   145→\n   146→=== Challenge"}]},"uuid":"f9388a7b-072c-4ee0-b262-a8830ee6fcb2","timestamp":"2026-01-07T03:06:05.698Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"==== Key Architectural Patterns","newString":"==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":107,"oldLines":6,"newStart":107,"newLines":40,"lines":[" "," ==== Key Architectural Patterns"," ","+[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]","+|===","+|Pattern |Application |Rationale","+","+|*Anti-Corruption Layer (ACL)*","+|EngagementService → Salesforce Service Cloud","+|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model","+","+|*Conformist*","+|ProfileService → Salesforce, EngagementService → Salesforce","+|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)","+","+|*Backend-for-Frontend (BFF)*","+|EngagementService","+|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients","+","+|*Event-Driven Architecture (OHS+PL)*","+|Event Bus (SNS+SQS/EventBridge/Kinesis)","+|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts","+","+|*Just-In-Time (JIT) Integration*","+|ProfileService → Salesforce Contact reconciliation","+|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data","+","+|*Async Processing*","+|EngagementService Case creation via Event Bus","+|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention","+","+|*Strangler Fig*","+|Not applicable","+|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled","+","+|===","+"," == Executive Summary"," "," === Challenge"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"f9388a7b-072c-4ee0-b262-a8830ee6fcb2","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019ds741H3XTSfKMTQdUU36t","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good. Now let me move to the Technical Requirements section and populate it based on our conversation.","signature":"Eo4CCkYICxgCKkBdDE5Mp8/I6TDCCbg23hRinyu3FET9BXUdfJFCVtYoDYMe3CP5eZCpz1WrpgDsDEUWj5qk1S92k/O/fzRcOW4pEgxD3cwKTU/HmCA+HG0aDMnBsaVFLN+Y3OjnmSIwQZnQJF9xhD2TEFAfrC8TiNPIkYJzrjmh8tgrxbXNsRa+jOKzPA8Vcc1HHihc3RLyKnZ7Vch1ixTGOo9lCWXeTRDMlz/LntNIhvnvU1sHQNSJBSK7GT/MtJIbBjHlAHBLfoD5wdE9p6KDWftrFDkLTwl39hcaycWnvD3eibJKX7mWo6O5Je4Sn12w6gAFSEErExqEIdaEU25+rphj+fAeCgQ+yNWlc3YrGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1294,"cache_read_input_tokens":61520,"cache_creation":{"ephemeral_5m_input_tokens":1294,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsH6nABzTdLeeZCWgrnt","type":"assistant","uuid":"cb902c42-c4a6-400e-9537-c7ab870c19cf","timestamp":"2026-01-07T03:06:10.417Z"}
{"parentUuid":"cb902c42-c4a6-400e-9537-c7ab870c19cf","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019ds741H3XTSfKMTQdUU36t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018axiiproJRcUb9s7xT2gEf","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"completed"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"in_progress"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"pending"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"pending"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"pending"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"pending"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"pending"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1294,"cache_read_input_tokens":61520,"cache_creation":{"ephemeral_5m_input_tokens":1294,"ephemeral_1h_input_tokens":0},"output_tokens":415,"service_tier":"standard"}},"requestId":"req_011CWsH6nABzTdLeeZCWgrnt","type":"assistant","uuid":"cba61b4a-9f05-4356-a255-9a99dedc5267","timestamp":"2026-01-07T03:06:15.601Z"}
{"parentUuid":"cba61b4a-9f05-4356-a255-9a99dedc5267","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018axiiproJRcUb9s7xT2gEf","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"e6b81b09-2c8f-4bfb-804b-f9543b71ed90","timestamp":"2026-01-07T03:06:15.857Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"in_progress","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"pending","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"pending","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"in_progress","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"e6b81b09-2c8f-4bfb-804b-f9543b71ed90","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HRvZzhCRhpmt1JMykQjWKR","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me populate the Technical Requirements section with the requirements we've gathered.","signature":"EoQCCkYICxgCKkB4qvt5qPVZEOpOKGIE/+oUhREkNanZTBoihNFkm3O5kIUmBO4LPu0p0pbYBHzujkDjKldiB/aCob6Re/s2TnCGEgzPhOLzeNAo/HxfqAQaDLl9WgTRqasSHlDXWSIwrImTKxu7yHqr/Uaoh1HeFdbd56KYkoeDdUSqXUQEcBCmjUWltuQ5aHfdgf7YxXwqKmz8+oVjIYerxM0dVcXXstiP23huEuhRuA1vWxN0ccusChfUsxd733XyanCldS7ePB9bCQi1dYeG7j1dzj/a+qw7GceuZdKsp36mv+83DGE0xEfz9yOh1AIvs5OSja8P8nRofEdGQtG8H0lgEwEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":464,"cache_read_input_tokens":62814,"cache_creation":{"ephemeral_5m_input_tokens":464,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWsH7WQBbm6X8aRQDiMSx","type":"assistant","uuid":"2ea548b6-1377-4a5f-8f64-7dc12ff54b5a","timestamp":"2026-01-07T03:06:19.605Z"}
{"parentUuid":"2ea548b6-1377-4a5f-8f64-7dc12ff54b5a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HRvZzhCRhpmt1JMykQjWKR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EPHJorYkkXE683EPqFX1vz","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"== Technical Requirements","new_string":"== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|==="}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":464,"cache_read_input_tokens":62814,"cache_creation":{"ephemeral_5m_input_tokens":464,"ephemeral_1h_input_tokens":0},"output_tokens":857,"service_tier":"standard"}},"requestId":"req_011CWsH7WQBbm6X8aRQDiMSx","type":"assistant","uuid":"eb2cb1fb-907a-476a-a3b7-4dbf90b7c27f","timestamp":"2026-01-07T03:06:36.245Z"}
{"parentUuid":"eb2cb1fb-907a-476a-a3b7-4dbf90b7c27f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EPHJorYkkXE683EPqFX1vz","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   211→* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n   212→* Retry policy configuration (attempts, backoff intervals)\n   213→* Expected feedback volume and Salesforce API rate limit strategy\n   214→\n   215→== Technical Requirements\n   216→\n   217→[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n   218→|===\n   219→|ID |Description\n   220→\n   221→|TR-CS-001\n   222→|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n   223→\n   224→|TR-CS-002\n   225→|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n   226→\n   227→|TR-CS-003\n   228→|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n   229→\n   230→|TR-CS-004\n   231→|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n   232→\n   233→|TR-CS-005\n   234→|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n   235→\n   236→|TR-CS-006\n   237→|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n   238→\n   239→|TR-CS-007\n   240→|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n   241→\n   242→|TR-CS-008\n   243→|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n   244→\n   245→|TR-CS-009\n   246→|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n   247→\n   248→|TR-CS-010\n   249→|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n   250→\n   251→|TR-CS-011\n   252→|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n   253→\n   254→|TR-CS-012\n   255→|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n   256→\n   257→|TR-CS-013\n   258→|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n   259→\n   260→|TR-CS-014\n   261→|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n   262→\n   263→|TR-CS-015\n   264→|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n   265→\n   266→|TR-CS-016\n   267→|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n   268→\n   269→|TR-CS-017\n   270→|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n   271→\n   272→|TR-CS-018\n   273→|Contact migration must achieve 100% validation pass rate (zero data loss)\n   274→\n   275→|TR-CS-019\n   276→|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n   277→\n   278→|===\n   279→\n   280→== Technical Architecture\n   281→\n   282→=== Technical Capability Requirements"}]},"uuid":"eac47a30-ea45-4a97-adae-58ea2acfdaca","timestamp":"2026-01-07T03:06:36.661Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"== Technical Requirements","newString":"== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":214,"oldLines":6,"newStart":214,"newLines":69,"lines":[" "," == Technical Requirements"," ","+[width=\"100%\",cols=\"8%,92%\",options=\"header\",]","+|===","+|ID |Description","+","+|TR-CS-001","+|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)","+","+|TR-CS-002","+|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address","+","+|TR-CS-003","+|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission","+","+|TR-CS-004","+|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message","+","+|TR-CS-005","+|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)","+","+|TR-CS-006","+|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)","+","+|TR-CS-007","+|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce","+","+|TR-CS-008","+|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention","+","+|TR-CS-009","+|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)","+","+|TR-CS-010","+|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)","+","+|TR-CS-011","+|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)","+","+|TR-CS-012","+|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts","+","+|TR-CS-013","+|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents","+","+|TR-CS-014","+|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)","+","+|TR-CS-015","+|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)","+","+|TR-CS-016","+|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)","+","+|TR-CS-017","+|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)","+","+|TR-CS-018","+|Contact migration must achieve 100% validation pass rate (zero data loss)","+","+|TR-CS-019","+|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover","+","+|===","+"," == Technical Architecture"," "," === Technical Capability Requirements"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"eac47a30-ea45-4a97-adae-58ea2acfdaca","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RC7q2NGz3hq7ERHGZH7L1C","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good. Now let me work on the Baseline Architecture and Gap Analysis sections.","signature":"EvUBCkYICxgCKkCBlAQ5FwyojMZk9OqVKx6bdksI+qSQk+nK1p6AFdhnb0+5Hxz+RVmtSiSB/tRe6E8ZsYI9GoXdohhkmF2G0cR4Egw93RreAsiHKYzRJDIaDC4qsb882LY2+s6h7iIwYFATDBO3HQfWpmRCt9Uu/DlLJ3CNPcdf0bEvtg5bK2TtAeIkuI+DiGOIkciD8c02Kl3GAEywpwCJA0wEhcFDTcc5UR7lG08ZhiB7ZLQqX0RgJx+x/azG+wNx4+wVna+QEcyV/fexxhzKV0EZdEHaIia/mzBaMWHMAZ4qgLaNkDKKLi4TANw8HCbHgfLs3I0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1944,"cache_read_input_tokens":63278,"cache_creation":{"ephemeral_5m_input_tokens":1944,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsH94eh2rwLkTAtYMst3","type":"assistant","uuid":"f1d52f21-7055-4cb0-8930-04d3dddf4d59","timestamp":"2026-01-07T03:06:41.271Z"}
{"parentUuid":"f1d52f21-7055-4cb0-8930-04d3dddf4d59","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RC7q2NGz3hq7ERHGZH7L1C","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HWZGJ1vhbtcSK3MR1i284j","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns","new_string":"=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|==="}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1944,"cache_read_input_tokens":63278,"cache_creation":{"ephemeral_5m_input_tokens":1944,"ephemeral_1h_input_tokens":0},"output_tokens":1498,"service_tier":"standard"}},"requestId":"req_011CWsH94eh2rwLkTAtYMst3","type":"assistant","uuid":"77eaaddf-9701-47ff-9462-6335480c24df","timestamp":"2026-01-07T03:07:11.781Z"}
{"parentUuid":"77eaaddf-9701-47ff-9462-6335480c24df","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HWZGJ1vhbtcSK3MR1i284j","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   292→==== Feature Flag Register\n   293→\n   294→==== Data Entity Catalogue\n   295→\n   296→=== Baseline Architecture\n   297→\n   298→==== Existing System Components\n   299→\n   300→[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n   301→|===\n   302→|Component |Current State |Status\n   303→\n   304→|*D365 Customer Engagement*\n   305→|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n   306→|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n   307→\n   308→|*App-Specific Customer Database*\n   309→|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n   310→|**MIGRATING** - One-time migration to Salesforce, then deprecated\n   311→\n   312→|*Mobile App*\n   313→|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n   314→|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n   315→\n   316→|*Salesforce Service Cloud*\n   317→|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n   318→|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n   319→\n   320→|*Existing AWS Infrastructure*\n   321→|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n   322→|**REUSING** - Event Bus implementation leverages existing infrastructure\n   323→\n   324→|===\n   325→\n   326→==== Integration Architecture\n   327→\n   328→*Current state:*\n   329→\n   330→* Mobile App → D365 Customer Engagement (direct integration)\n   331→* App-specific customer database → standalone (no Salesforce integration)\n   332→* No event-driven architecture (synchronous, tightly coupled)\n   333→* No Anti-Corruption Layer protecting digital channels\n   334→* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n   335→\n   336→==== Technical Debt\n   337→\n   338→*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n   339→\n   340→*New technical debt introduced by this migration:*\n   341→\n   342→* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n   343→* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n   344→* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n   345→* Expected feedback volume unknown (gathering data for rate limit planning)\n   346→\n   347→=== Gap Analysis\n   348→\n   349→==== Missing Capabilities\n   350→\n   351→[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n   352→|===\n   353→|Missing Capability |Description\n   354→\n   355→|*ProfileService bounded context*\n   356→|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n   357→\n   358→|*EngagementService bounded context*\n   359→|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n   360→\n   361→|*Event Bus domain event pattern*\n   362→|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n   363→\n   364→|*Async Case creation workflow*\n   365→|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n   366→\n   367→|*Salesforce webhook integration*\n   368→|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n   369→\n   370→|*Braze push notification orchestration*\n   371→|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n   372→\n   373→|*Contact migration tooling*\n   374→|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n   375→\n   376→|*Feedback form enhancements*\n   377→|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n   378→\n   379→|===\n   380→\n   381→==== Missing Bounded Contexts\n   382→\n   383→[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n   384→|===\n   385→|Bounded Context |Responsibilities |Implementation Status\n   386→\n   387→|*link:../bounded_context/profile.adoc[ProfileService]*\n   388→|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n   389→|**NEW** - First bounded context implementation\n   390→\n   391→|*link:../bounded_context/engagement.adoc[EngagementService]*\n   392→|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n   393→|**NEW** - First bounded context implementation\n   394→\n   395→|===\n   396→\n   397→==== Missing Integration Patterns\n   398→\n   399→[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n   400→|===\n   401→|Integration Pattern |Description\n   402→\n   403→|*Anti-Corruption Layer (ACL)*\n   404→|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n   405→\n   406→|*Conformist*\n   407→|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n   408→\n   409→|*Event-Driven Architecture (OHS+PL)*\n   410→|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n   411→\n   412→|*Just-In-Time (JIT) Integration*\n   413→|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n   414→\n   415→|*Async Processing*\n   416→|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n   417→\n   418→|===\n   419→\n   420→=== Target State Architecture\n   421→\n   422→==== Architectural Building Blocks (ABB)"}]},"uuid":"a84efd86-455c-4d88-9c03-39bd1eca67a8","timestamp":"2026-01-07T03:07:12.318Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns","newString":"=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n==== Integration Architecture\n\n==== Technical Debt\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n==== Missing Bounded Contexts\n\n==== Missing Integration Patterns\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":297,"oldLines":18,"newStart":297,"newLines":126,"lines":[" "," ==== Existing System Components"," ","+[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]","+|===","+|Component |Current State |Status","+","+|*D365 Customer Engagement*","+|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management","+|**DEPRECATED** - Being replaced by Salesforce Service Cloud","+","+|*App-Specific Customer Database*","+|Stores customer contact data for Mobile App users, separate from Viva Energy systems","+|**MIGRATING** - One-time migration to Salesforce, then deprecated","+","+|*Mobile App*","+|iOS/Android native apps with feedback submission form (free text only, no category selection currently)","+|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs","+","+|*Salesforce Service Cloud*","+|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels","+|**EXPANDING** - Adding OTR digital customer support Cases and Contacts","+","+|*Existing AWS Infrastructure*","+|SNS+SQS / EventBridge / Kinesis available for event-driven architecture","+|**REUSING** - Event Bus implementation leverages existing infrastructure","+","+|===","+"," ==== Integration Architecture"," ","+*Current state:*","+","+* Mobile App → D365 Customer Engagement (direct integration)","+* App-specific customer database → standalone (no Salesforce integration)","+* No event-driven architecture (synchronous, tightly coupled)","+* No Anti-Corruption Layer protecting digital channels","+* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)","+"," ==== Technical Debt"," ","+*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.","+","+*New technical debt introduced by this migration:*","+","+* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)","+* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)","+* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)","+* Expected feedback volume unknown (gathering data for rate limit planning)","+"," === Gap Analysis"," "," ==== Missing Capabilities"," ","+[width=\"100%\",cols=\"30%,70%\",options=\"header\",]","+|===","+|Missing Capability |Description","+","+|*ProfileService bounded context*","+|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID","+","+|*EngagementService bounded context*","+|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus","+","+|*Event Bus domain event pattern*","+|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)","+","+|*Async Case creation workflow*","+|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue","+","+|*Salesforce webhook integration*","+|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications","+","+|*Braze push notification orchestration*","+|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService","+","+|*Contact migration tooling*","+|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)","+","+|*Feedback form enhancements*","+|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates","+","+|===","+"," ==== Missing Bounded Contexts"," ","+[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]","+|===","+|Bounded Context |Responsibilities |Implementation Status","+","+|*link:../bounded_context/profile.adoc[ProfileService]*","+|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking","+|**NEW** - First bounded context implementation","+","+|*link:../bounded_context/engagement.adoc[EngagementService]*","+|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates","+|**NEW** - First bounded context implementation","+","+|===","+"," ==== Missing Integration Patterns"," ","+[width=\"100%\",cols=\"30%,70%\",options=\"header\",]","+|===","+|Integration Pattern |Description","+","+|*Anti-Corruption Layer (ACL)*","+|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce","+","+|*Conformist*","+|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)","+","+|*Event-Driven Architecture (OHS+PL)*","+|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts","+","+|*Just-In-Time (JIT) Integration*","+|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)","+","+|*Async Processing*","+|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue","+","+|===","+"," === Target State Architecture"," "," ==== Architectural Building Blocks (ABB)"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"a84efd86-455c-4d88-9c03-39bd1eca67a8","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EXZrANKemoSDYf53JnmGCu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good progress. Now let me continue with the Target State Architecture and Architecture Decisions sections.","signature":"EpICCkYICxgCKkCBoJKf33LOnv1RBLYEviDnmyhsqNnMPezfHVL7KEwNuM57cKkzpCllijpzw0XJ+QC6l4pVDl1G7MZ96RgbhNEOEgyUfx1Mz7zp/djepNUaDNZshx7s9KOJT5oZkyIwosmDf0TbY29zVCthSjWyTZqWutyDX7M8wmxF3x18Rxs7rF3XXr6zA4nYiQ8F/LgwKnoA15f6oWIWpzpYg8zM9TCcdwFZz3WCWLF0dZ8rWdZINRMW2Ph2xeMQrxZAkXY2f+4ZX7sr7hL+ySe7A9GTo2LdFx7m/dDeEfDlZBLQUpW7Zq6xT2alAJdRiOG/lmvFy5jlWBqZ1Br0eqR3muEbOvEv8YqGEPnqUCt21BgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3348,"cache_read_input_tokens":65222,"cache_creation":{"ephemeral_5m_input_tokens":3348,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHBi23fEba8Q5a6hJSd","type":"assistant","uuid":"0b0ea696-22e3-4f8d-ab06-51fb091c93fc","timestamp":"2026-01-07T03:07:17.919Z"}
{"parentUuid":"0b0ea696-22e3-4f8d-ab06-51fb091c93fc","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EXZrANKemoSDYf53JnmGCu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019AkYyeAowxcuVex9GvHV1o","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"completed"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"completed"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"completed"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"completed"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"in_progress"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"pending"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"pending"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3348,"cache_read_input_tokens":65222,"cache_creation":{"ephemeral_5m_input_tokens":3348,"ephemeral_1h_input_tokens":0},"output_tokens":414,"service_tier":"standard"}},"requestId":"req_011CWsHBi23fEba8Q5a6hJSd","type":"assistant","uuid":"e1803267-4e67-4ccf-ae5e-fd62e8e9698b","timestamp":"2026-01-07T03:07:23.196Z"}
{"parentUuid":"e1803267-4e67-4ccf-ae5e-fd62e8e9698b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019AkYyeAowxcuVex9GvHV1o","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"1b1fce08-6515-4bbe-9669-b8ee8d904c98","timestamp":"2026-01-07T03:07:23.746Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"in_progress","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"pending","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"pending","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"pending","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"in_progress","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"1b1fce08-6515-4bbe-9669-b8ee8d904c98","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013MpjU4Ybjxne6eUVzo9DmS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me populate the Target State Architecture section with detailed information about ProfileService and EngagementService.","signature":"EqgCCkYICxgCKkD19qrDmMm8TC4NrnrHoGcsIJsF40tjhSXT5FWjEjI3d8/cGNPo8jETMhMCqSYuLFxO3i4lyyKarX5oa7/2H4H6EgwuTHA9ZIeakT+01e8aDC4RjHQyY1zB3SBESCIwWbFNayYghXvLualFbDzP49zl5lewXtlYs9ZuUhS1nrO7IVUoX9qCqU11uuy6kd+1Ko8BhUjr9mnj9467DzU+1bmIrn0pweM542Jruiw//0oGobRfJydp2IgL3oN6C+w41ByVwLKbVqKWQnvUz8K414gbI/gl/eIYKtzyiexAPgWgVFTwTk7dW9W9yPnvICJ1+3s6MDJr+qykL9hb7x92ulKynDCAZVgIqJ8JSVv3RxffIv1BXIn6F5H40a61gi2NefMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":463,"cache_read_input_tokens":68570,"cache_creation":{"ephemeral_5m_input_tokens":463,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHCXfyEMKBVCcBNvAZ2","type":"assistant","uuid":"57a68a01-3aa5-4a86-9acd-ff5ec1f5d91a","timestamp":"2026-01-07T03:07:27.894Z"}
{"parentUuid":"57a68a01-3aa5-4a86-9acd-ff5ec1f5d91a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013MpjU4Ybjxne6eUVzo9DmS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Jgs8kMSayiWn7enfKx6amm","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store","new_string":"=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":463,"cache_read_input_tokens":68570,"cache_creation":{"ephemeral_5m_input_tokens":463,"ephemeral_1h_input_tokens":0},"output_tokens":1608,"service_tier":"standard"}},"requestId":"req_011CWsHCXfyEMKBVCcBNvAZ2","type":"assistant","uuid":"9bf9c971-3de1-4f94-86f0-58fe10fb82de","timestamp":"2026-01-07T03:08:00.372Z"}
{"parentUuid":"9bf9c971-3de1-4f94-86f0-58fe10fb82de","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Jgs8kMSayiWn7enfKx6amm","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   416→|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n   417→\n   418→|===\n   419→\n   420→=== Target State Architecture\n   421→\n   422→==== Architectural Building Blocks (ABB)\n   423→\n   424→[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n   425→|===\n   426→|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n   427→\n   428→|ABB-CS-001\n   429→|*link:../bounded_context/profile.adoc[ProfileService]*\n   430→|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n   431→|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n   432→\n   433→|ABB-CS-002\n   434→|*link:../bounded_context/engagement.adoc[EngagementService]*\n   435→|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n   436→|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n   437→\n   438→|ABB-CS-003\n   439→|*Event Bus*\n   440→|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n   441→|AWS SNS+SQS / EventBridge / Kinesis\n   442→\n   443→|ABB-CS-004\n   444→|*Salesforce Service Cloud*\n   445→|System of Record for Contact and Case data (shared Viva Energy instance)\n   446→|Salesforce Service Cloud (external SaaS)\n   447→\n   448→|ABB-CS-005\n   449→|*Braze*\n   450→|Marketing automation platform for push notifications\n   451→|Braze (external SaaS) - existing integration\n   452→\n   453→|ABB-CS-006\n   454→|*Mobile App*\n   455→|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n   456→|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n   457→\n   458→|ABB-CS-007\n   459→|*Contact Migration Tool*\n   460→|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n   461→|Script/tool (.NET/Python/Node.js)\n   462→\n   463→|===\n   464→\n   465→==== Integration Architecture\n   466→\n   467→===== Integration Flows\n   468→\n   469→*Customer Feedback Submission (Async):*\n   470→\n   471→1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n   472→2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n   473→3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n   474→4. *EngagementService* → Event Bus: Publish work item for async Case creation\n   475→5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n   476→6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n   477→7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n   478→8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n   479→\n   480→*Case Update Notification (Bidirectional):*\n   481→\n   482→1. *Support Agent* updates/resolves Case in Salesforce\n   483→2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n   484→3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n   485→4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n   486→\n   487→*Contact Reconciliation (JIT):*\n   488→\n   489→1. *Mobile App user* authenticates\n   490→2. *Mobile App* → ProfileService: GET /profile/contact-id\n   491→3. *ProfileService* → Salesforce: Query Contact by email\n   492→4. *Match found*: Return existing Salesforce Contact ID\n   493→5. *No match*: Create new Contact in Salesforce, return new Contact ID\n   494→6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n   495→\n   496→===== System of Record Boundaries\n   497→\n   498→[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n   499→|===\n   500→|Data Entity |System of Record |Rationale\n   501→\n   502→|*Contact*\n   503→|Salesforce Service Cloud\n   504→|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n   505→\n   506→|*Case*\n   507→|Salesforce Service Cloud\n   508→|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n   509→\n   510→|*Feedback Submission (transient)*\n   511→|None (no persistence)\n   512→|EngagementService processes feedback and creates Case in Salesforce, no local storage\n   513→\n   514→|*Domain Events*\n   515→|Event Bus (ephemeral)\n   516→|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n   517→\n   518→|===\n   519→\n   520→==== Data Architecture Principles\n   521→\n   522→===== Aggregate Persistence\n   523→\n   524→*ProfileService:*\n   525→\n   526→* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n   527→* Salesforce Contact is the aggregate root (owned by Salesforce)\n   528→* ProfileService acts as facade/translator, not system of record\n   529→\n   530→*EngagementService:*\n   531→\n   532→* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n   533→* Salesforce Case is the aggregate root (owned by Salesforce)\n   534→* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n   535→* Async processing state managed via Event Bus (work items in queue, not database)\n   536→\n   537→===== Event Store\n   538→\n   539→* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n   540→* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n   541→* No Event Store implementation in this architecture (future enhancement if needed)\n   542→* Event schema versioning TBD in Solution Architecture\n   543→\n   544→=== Architecture Decisions\n   545→\n   546→=== Migration Strategy"}]},"uuid":"d4c19204-d9e8-47e1-9c18-5be3354f6b5f","timestamp":"2026-01-07T03:08:00.854Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store","newString":"=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n==== Integration Architecture\n\n===== System of Record Boundaries\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n===== Event Store\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":421,"oldLines":16,"newStart":421,"newLines":126,"lines":[" "," ==== Architectural Building Blocks (ABB)"," ","+[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]","+|===","+|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)","+","+|ABB-CS-001","+|*link:../bounded_context/profile.adoc[ProfileService]*","+|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking","+|Microservice (.NET/Node.js), REST API, Salesforce REST API client","+","+|ABB-CS-002","+|*link:../bounded_context/engagement.adoc[EngagementService]*","+|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver","+|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver","+","+|ABB-CS-003","+|*Event Bus*","+|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)","+|AWS SNS+SQS / EventBridge / Kinesis","+","+|ABB-CS-004","+|*Salesforce Service Cloud*","+|System of Record for Contact and Case data (shared Viva Energy instance)","+|Salesforce Service Cloud (external SaaS)","+","+|ABB-CS-005","+|*Braze*","+|Marketing automation platform for push notifications","+|Braze (external SaaS) - existing integration","+","+|ABB-CS-006","+|*Mobile App*","+|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)","+|Kotlin Multiplatform, SwiftUI, Jetpack Compose","+","+|ABB-CS-007","+|*Contact Migration Tool*","+|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)","+|Script/tool (.NET/Python/Node.js)","+","+|===","+"," ==== Integration Architecture"," ","+===== Integration Flows","+","+*Customer Feedback Submission (Async):*","+","+1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)","+2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)","+3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")","+4. *EngagementService* → Event Bus: Publish work item for async Case creation","+5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API","+6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event","+7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")","+8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert","+","+*Case Update Notification (Bidirectional):*","+","+1. *Support Agent* updates/resolves Case in Salesforce","+2. *Salesforce* → EngagementService: Webhook notification (Case updated)","+3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event","+4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")","+","+*Contact Reconciliation (JIT):*","+","+1. *Mobile App user* authenticates","+2. *Mobile App* → ProfileService: GET /profile/contact-id","+3. *ProfileService* → Salesforce: Query Contact by email","+4. *Match found*: Return existing Salesforce Contact ID","+5. *No match*: Create new Contact in Salesforce, return new Contact ID","+6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)","+"," ===== System of Record Boundaries"," ","+[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]","+|===","+|Data Entity |System of Record |Rationale","+","+|*Contact*","+|Salesforce Service Cloud","+|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)","+","+|*Case*","+|Salesforce Service Cloud","+|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL","+","+|*Feedback Submission (transient)*","+|None (no persistence)","+|EngagementService processes feedback and creates Case in Salesforce, no local storage","+","+|*Domain Events*","+|Event Bus (ephemeral)","+|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)","+","+|===","+"," ==== Data Architecture Principles"," "," ===== Aggregate Persistence"," ","+*ProfileService:*","+","+* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand","+* Salesforce Contact is the aggregate root (owned by Salesforce)","+* ProfileService acts as facade/translator, not system of record","+","+*EngagementService:*","+","+* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL","+* Salesforce Case is the aggregate root (owned by Salesforce)","+* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)","+* Async processing state managed via Event Bus (work items in queue, not database)","+"," ===== Event Store"," ","+* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing","+* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)","+* No Event Store implementation in this architecture (future enhancement if needed)","+* Event schema versioning TBD in Solution Architecture","+"," === Architecture Decisions"," "," === Migration Strategy"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"d4c19204-d9e8-47e1-9c18-5be3354f6b5f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XuRr8FD53xHfqPsTPt1sHe","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good. Now let me create the Architecture Decisions (ADRs) section based on all our discussions.","signature":"EocCCkYICxgCKkBBOpKmqBtRH1Vyez+5hNJUAK/TEuo0tLBISWMWzPJDBmJ5A3YWfl0Fj1QEB4Qs/lFXA2cZoTisP0XsDbptZw/oEgwY3p1xiLecloGVWVkaDDh9sRjne2m9bip8iCIw2O7n8c1I5ZAGkV1UVyh5W1iDgy3PXnCZTGjhlIzGvBfsJkUXgw8h1JYccnVpxgvcKm839xXOHwPTmfSJUUeP3OA4sHi+KEaACu1UVURpgTZkcOKIifUTlirjXOiCZkvYcAS0Ez3EP1A4q7kmDr+KwZsiVTsg7mwOQawZAi5u3XZ9BADkgiTAqWzxZSQwxFNYNdrvJxY2EJCnhj5vaBjV530YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3561,"cache_read_input_tokens":69033,"cache_creation":{"ephemeral_5m_input_tokens":3561,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHFH9Bnrt5Rvga4CnsP","type":"assistant","uuid":"e577d1c7-51dc-486f-aa4d-242dc45e10ae","timestamp":"2026-01-07T03:08:07.956Z"}
{"parentUuid":"e577d1c7-51dc-486f-aa4d-242dc45e10ae","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XuRr8FD53xHfqPsTPt1sHe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RyvVzKUNGybs5fnNKpbgH4","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Architecture Decisions","new_string":"=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3561,"cache_read_input_tokens":69033,"cache_creation":{"ephemeral_5m_input_tokens":3561,"ephemeral_1h_input_tokens":0},"output_tokens":2605,"service_tier":"standard"}},"requestId":"req_011CWsHFH9Bnrt5Rvga4CnsP","type":"assistant","uuid":"19256c94-efb8-4151-b985-ee2c2f2073f4","timestamp":"2026-01-07T03:09:02.337Z"}
{"parentUuid":"19256c94-efb8-4151-b985-ee2c2f2073f4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RyvVzKUNGybs5fnNKpbgH4","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   540→* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n   541→* No Event Store implementation in this architecture (future enhancement if needed)\n   542→* Event schema versioning TBD in Solution Architecture\n   543→\n   544→=== Architecture Decisions\n   545→\n   546→==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n   547→\n   548→*Status*: Accepted\n   549→\n   550→*Context*:\n   551→\n   552→* D365 Customer Engagement not working well for digital customer support\n   553→* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n   554→* Post-merger opportunity to consolidate onto single platform\n   555→* Alternative: Build custom support platform or use different SaaS\n   556→\n   557→*Decision*:\n   558→\n   559→Consolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n   560→\n   561→*Rationale*:\n   562→\n   563→* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n   564→* **Platform consolidation**: Single support platform reduces operational overhead and costs\n   565→* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n   566→* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n   567→* **Avoid custom development**: Building custom support platform would be costly and high-risk\n   568→\n   569→*Consequences*:\n   570→\n   571→* ✅ Unified customer support across Viva Energy Group\n   572→* ✅ Reduced operational complexity (single platform vs two)\n   573→* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n   574→* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n   575→* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n   576→* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n   577→\n   578→==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n   579→\n   580→*Status*: Accepted\n   581→\n   582→*Context*:\n   583→\n   584→* OTR target architecture uses Domain-Driven Design with bounded contexts\n   585→* This migration is opportunity to establish first implementation\n   586→* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n   587→* Alternative: Single monolithic service for all customer-facing APIs\n   588→\n   589→*Decision*:\n   590→\n   591→Implement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n   592→\n   593→*Rationale*:\n   594→\n   595→* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n   596→* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n   597→* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n   598→* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n   599→* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n   600→\n   601→*Consequences*:\n   602→\n   603→* ✅ Establishes DDD architecture foundation for OTR\n   604→* ✅ Reusable ProfileService for Flybuys and future integrations\n   605→* ✅ Digital channels protected from Salesforce API changes (ACL)\n   606→* ✅ Clear bounded context boundaries and responsibilities\n   607→* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n   608→* ⚠️ Requires Event Bus infrastructure implementation\n   609→* ⚠️ Team must learn DDD patterns and bounded context design\n   610→\n   611→==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n   612→\n   613→*Status*: Accepted\n   614→\n   615→*Context*:\n   616→\n   617→* Current D365 CE integration is synchronous (user waits for Case creation)\n   618→* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n   619→* Salesforce API may experience downtime or latency\n   620→\n   621→*Decision*:\n   622→\n   623→Implement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n   624→\n   625→*Rationale*:\n   626→\n   627→* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n   628→* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n   629→* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n   630→* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n   631→* **Scalability**: Queue buffering handles traffic spikes\n   632→\n   633→*Consequences*:\n   634→\n   635→* ✅ Better user experience (no waiting for Salesforce API)\n   636→* ✅ Resilient to Salesforce downtime (queue buffers work)\n   637→* ✅ Automatic retry reduces manual intervention\n   638→* ✅ Queue depth monitoring provides operational visibility\n   639→* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n   640→* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n   641→* ⚠️ Requires monitoring and alerting for DLQ\n   642→\n   643→==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n   644→\n   645→*Status*: Accepted\n   646→\n   647→*Context*:\n   648→\n   649→* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n   650→* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n   651→* Email changes are rare but possible\n   652→\n   653→*Decision*:\n   654→\n   655→Use email address as primary matching key for Contact reconciliation (JIT upsert by email).\n   656→\n   657→*Rationale*:\n   658→\n   659→* **Availability**: Email always available for authenticated users\n   660→* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n   661→* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n   662→* **Simplicity**: Single matching key simplifies upsert logic\n   663→* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n   664→\n   665→*Consequences*:\n   666→\n   667→* ✅ Simple upsert logic (query by email, create if not found)\n   668→* ✅ Leverages Salesforce standard email field\n   669→* ✅ Email always available from authentication\n   670→* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n   671→* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n   672→\n   673→==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n   674→\n   675→*Status*: Accepted\n   676→\n   677→*Context*:\n   678→\n   679→* D365 CE contains historical customer support Cases\n   680→* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n   681→* Alternative: Archive D365 CE Cases separately (read-only access)\n   682→\n   683→*Decision*:\n   684→\n   685→Do not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n   686→\n   687→*Rationale*:\n   688→\n   689→* **Limited value**: Historical D365 CE Cases not critical for future support\n   690→* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n   691→* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n   692→* **Cost-benefit**: Migration effort outweighs value of historical data\n   693→* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n   694→\n   695→*Consequences*:\n   696→\n   697→* ✅ Simpler migration (Contacts only, no Case migration)\n   698→* ✅ Faster time to value (no Case migration delay)\n   699→* ✅ Clean start in Salesforce (no legacy data quality issues)\n   700→* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n   701→* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n   702→* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n   703→\n   704→==== ADR-CS-006: Big bang cutover (not phased rollout)\n   705→\n   706→*Status*: Accepted\n   707→\n   708→*Context*:\n   709→\n   710→* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n   711→* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n   712→* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n   713→\n   714→*Decision*:\n   715→\n   716→Big bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n   717→\n   718→*Rationale*:\n   719→\n   720→* **Simplicity**: No parallel run complexity, no feature flag management\n   721→* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n   722→* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n   723→* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n   724→* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n   725→\n   726→*Consequences*:\n   727→\n   728→* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n   729→* ✅ Faster D365 CE retirement (no extended parallel run)\n   730→* ✅ No feature flag complexity or pilot user management\n   731→* ⚠️ Higher cutover risk (all users switch at once)\n   732→* ⚠️ Requires comprehensive testing before cutover\n   733→* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n   734→\n   735→==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n   736→\n   737→*Status*: Accepted\n   738→\n   739→*Context*:\n   740→\n   741→* Support agents update/resolve Cases in Salesforce\n   742→* Need to notify customers of Case status changes via push notifications\n   743→* Alternative: Poll Salesforce API for Case updates (inefficient)\n   744→* Alternative: No customer notifications (agents contact customers directly)\n   745→\n   746→*Decision*:\n   747→\n   748→Salesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n   749→\n   750→*Rationale*:\n   751→\n   752→* **Real-time notifications**: Customer notified immediately when agent resolves Case\n   753→* **Efficient**: Webhook push model (not polling)\n   754→* **Event-driven**: Aligns with event-driven architecture pattern\n   755→* **Better customer experience**: Proactive notification vs waiting for agent contact\n   756→\n   757→*Consequences*:\n   758→\n   759→* ✅ Real-time customer notifications for Case updates\n   760→* ✅ Efficient push model (no polling overhead)\n   761→* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n   762→* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n   763→* ⚠️ Webhook authentication and security required\n   764→* ⚠️ EngagementService must handle webhook retries and failures\n   765→\n   766→=== Migration Strategy\n   767→\n   768→=== Architectural Scope Boundaries"}]},"uuid":"da317141-d0f4-45aa-b9c3-dd5b0be3d809","timestamp":"2026-01-07T03:09:02.653Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Architecture Decisions","newString":"=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture\n\n=== Architecture Decisions\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":543,"oldLines":6,"newStart":543,"newLines":226,"lines":[" "," === Architecture Decisions"," ","+==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)","+","+*Status*: Accepted","+","+*Context*:","+","+* D365 Customer Engagement not working well for digital customer support","+* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels","+* Post-merger opportunity to consolidate onto single platform","+* Alternative: Build custom support platform or use different SaaS","+","+*Decision*:","+","+Consolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).","+","+*Rationale*:","+","+* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)","+* **Platform consolidation**: Single support platform reduces operational overhead and costs","+* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported","+* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms","+* **Avoid custom development**: Building custom support platform would be costly and high-risk","+","+*Consequences*:","+","+* ✅ Unified customer support across Viva Energy Group","+* ✅ Reduced operational complexity (single platform vs two)","+* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)","+* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)","+* ⚠️ Multi-tenant governance needed (data isolation, security, queues)","+* ❌ Less control over platform evolution (SaaS vendor, shared instance)","+","+==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts","+","+*Status*: Accepted","+","+*Context*:","+","+* OTR target architecture uses Domain-Driven Design with bounded contexts","+* This migration is opportunity to establish first implementation","+* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)","+* Alternative: Single monolithic service for all customer-facing APIs","+","+*Decision*:","+","+Implement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.","+","+*Rationale*:","+","+* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)","+* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)","+* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes","+* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration","+* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts","+","+*Consequences*:","+","+* ✅ Establishes DDD architecture foundation for OTR","+* ✅ Reusable ProfileService for Flybuys and future integrations","+* ✅ Digital channels protected from Salesforce API changes (ACL)","+* ✅ Clear bounded context boundaries and responsibilities","+* ⚠️ Increased initial complexity (two new microservices vs direct integration)","+* ⚠️ Requires Event Bus infrastructure implementation","+* ⚠️ Team must learn DDD patterns and bounded context design","+","+==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)","+","+*Status*: Accepted","+","+*Context*:","+","+* Current D365 CE integration is synchronous (user waits for Case creation)","+* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)","+* Salesforce API may experience downtime or latency","+","+*Decision*:","+","+Implement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.","+","+*Rationale*:","+","+* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API","+* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers","+* **Retry logic**: Automatic retry with exponential backoff handles transient failures","+* **Operational visibility**: Dead letter queue alerts ops team to persistent failures","+* **Scalability**: Queue buffering handles traffic spikes","+","+*Consequences*:","+","+* ✅ Better user experience (no waiting for Salesforce API)","+* ✅ Resilient to Salesforce downtime (queue buffers work)","+* ✅ Automatic retry reduces manual intervention","+* ✅ Queue depth monitoring provides operational visibility","+* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)","+* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)","+* ⚠️ Requires monitoring and alerting for DLQ","+","+==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)","+","+*Status*: Accepted","+","+*Context*:","+","+* ProfileService needs to reconcile Mobile App users as Salesforce Contacts","+* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID","+* Email changes are rare but possible","+","+*Decision*:","+","+Use email address as primary matching key for Contact reconciliation (JIT upsert by email).","+","+*Rationale*:","+","+* **Availability**: Email always available for authenticated users","+* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App","+* **Salesforce standard**: Salesforce Contact uses email as standard lookup field","+* **Simplicity**: Single matching key simplifies upsert logic","+* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable","+","+*Consequences*:","+","+* ✅ Simple upsert logic (query by email, create if not found)","+* ✅ Leverages Salesforce standard email field","+* ✅ Email always available from authentication","+* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)","+* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching","+","+==== ADR-CS-005: No Case migration from D365 CE (fresh start)","+","+*Status*: Accepted","+","+*Context*:","+","+* D365 CE contains historical customer support Cases","+* Alternative: Migrate historical Cases to Salesforce (preserve support history)","+* Alternative: Archive D365 CE Cases separately (read-only access)","+","+*Decision*:","+","+Do not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.","+","+*Rationale*:","+","+* **Limited value**: Historical D365 CE Cases not critical for future support","+* **Data quality**: D365 CE Case data may be inconsistent or incomplete","+* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation","+* **Cost-benefit**: Migration effort outweighs value of historical data","+* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)","+","+*Consequences*:","+","+* ✅ Simpler migration (Contacts only, no Case migration)","+* ✅ Faster time to value (no Case migration delay)","+* ✅ Clean start in Salesforce (no legacy data quality issues)","+* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)","+* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)","+* ❌ Loss of historical Case insights (reporting, analytics on old Cases)","+","+==== ADR-CS-006: Big bang cutover (not phased rollout)","+","+*Status*: Accepted","+","+*Context*:","+","+* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)","+* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)","+* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)","+","+*Decision*:","+","+Big bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.","+","+*Rationale*:","+","+* **Simplicity**: No parallel run complexity, no feature flag management","+* **Faster D365 CE retirement**: No extended transition period maintaining two systems","+* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible","+* **User base manageable**: OTR digital customers smaller than Flybuys integration scope","+* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler","+","+*Consequences*:","+","+* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)","+* ✅ Faster D365 CE retirement (no extended parallel run)","+* ✅ No feature flag complexity or pilot user management","+* ⚠️ Higher cutover risk (all users switch at once)","+* ⚠️ Requires comprehensive testing before cutover","+* ⚠️ Rollback plan required (revert to D365 CE if critical issues)","+","+==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates","+","+*Status*: Accepted","+","+*Context*:","+","+* Support agents update/resolve Cases in Salesforce","+* Need to notify customers of Case status changes via push notifications","+* Alternative: Poll Salesforce API for Case updates (inefficient)","+* Alternative: No customer notifications (agents contact customers directly)","+","+*Decision*:","+","+Salesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.","+","+*Rationale*:","+","+* **Real-time notifications**: Customer notified immediately when agent resolves Case","+* **Efficient**: Webhook push model (not polling)","+* **Event-driven**: Aligns with event-driven architecture pattern","+* **Better customer experience**: Proactive notification vs waiting for agent contact","+","+*Consequences*:","+","+* ✅ Real-time customer notifications for Case updates","+* ✅ Efficient push model (no polling overhead)","+* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)","+* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)","+* ⚠️ Webhook authentication and security required","+* ⚠️ EngagementService must handle webhook retries and failures","+"," === Migration Strategy"," "," === Architectural Scope Boundaries"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"da317141-d0f4-45aa-b9c3-dd5b0be3d809","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01A2mVM3NHhV89tc1n6kLwoW","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Excellent progress. Now let me complete the Migration Strategy and Technical Risks sections.","signature":"EoQCCkYICxgCKkBtgdLHSXI2ZZEc2HWoqLZ6+VjJAs4JQgkC2r01NTjJoXwzOF4MfsqVgpa6TbkACFD+5T2XZsWmoRhFbVLKWoiwEgx1RdZqPK3AUMnqG5UaDH3d/IEz+5G1ueylTyIwgwBnjMyyqT7abYBGCfH2CA5CljHMId/upY31lJKuJ7DgqiFk2cgC5CX+JJC5jiytKmzkzMb0O2kSBHzRjJbJhkheucThXeZOzFJhs566JuX0sT4JySVPP+ozlmmzs1X6O9Lah6y4+048fvuj03lzS92NksPPKNdFfMVnfWlqvpFCF73pD4kyqJPktP8FR6f22wgoHVml57zSxgue3L0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":5956,"cache_read_input_tokens":72594,"cache_creation":{"ephemeral_5m_input_tokens":5956,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsHKqdQe85VwubMMkD7b","type":"assistant","uuid":"c5aba159-23a9-416a-b3c8-2f373b2d76db","timestamp":"2026-01-07T03:09:09.696Z"}
{"parentUuid":"c5aba159-23a9-416a-b3c8-2f373b2d76db","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01A2mVM3NHhV89tc1n6kLwoW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VdENxfJStdfbQfuaRXE6NG","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"completed"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"completed"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"completed"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"completed"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"completed"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"completed"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"in_progress"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"pending"},{"content":"Document Testing Approach","activeForm":"Documenting Testing Approach","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":5956,"cache_read_input_tokens":72594,"cache_creation":{"ephemeral_5m_input_tokens":5956,"ephemeral_1h_input_tokens":0},"output_tokens":413,"service_tier":"standard"}},"requestId":"req_011CWsHKqdQe85VwubMMkD7b","type":"assistant","uuid":"be28b502-3497-4be1-a289-a1a526669ca1","timestamp":"2026-01-07T03:09:16.872Z"}
{"parentUuid":"be28b502-3497-4be1-a289-a1a526669ca1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VdENxfJStdfbQfuaRXE6NG","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"773e2d52-053f-45dd-8886-f8217e34c682","timestamp":"2026-01-07T03:09:17.058Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"in_progress","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"pending","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"pending","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"completed","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"completed","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"in_progress","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}]}}
{"parentUuid":"773e2d52-053f-45dd-8886-f8217e34c682","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SvB6HUomnxUXuox6z2X7Ku","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me populate the Migration Strategy section.","signature":"EtsBCkYICxgCKkCVIQyLUUSn6r2xUgYHs8O8x7a18NwFJasHoR4ovkH3pQfczzT1DwgcRlZ7+sj/3L1931ZTO7u+fswBLwjhGtPGEgw6HXlB3MXWPTxmUOIaDOibrwse/e8m8jg4HyIwyHMTLlPJu105P8z357qzCMLOFTbJBPlXkIreTqFFk6wmuS/RbzGv/Sdj9ts1pwppKkPVs+GdcC2TB3Q3y26EQeekguwxUqbHud20qWvkInTz4jo13Uh6dt6FHkLxB256xgwAEpnasAzEonz46EzILh/Yh+d9GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":462,"cache_read_input_tokens":78550,"cache_creation":{"ephemeral_5m_input_tokens":462,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHLrp8Z6x8qzWeK5hcE","type":"assistant","uuid":"5056af95-6eb9-4dc5-8a72-5ae53181dd0c","timestamp":"2026-01-07T03:09:21.059Z"}
{"parentUuid":"5056af95-6eb9-4dc5-8a72-5ae53181dd0c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SvB6HUomnxUXuox6z2X7Ku","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011XN5qwMyfUvr6EqxgPC3wU","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Migration Strategy","new_string":"=== Migration Strategy\n\n==== Migration Phases\n\n*Phase 1: Build & Test (Weeks 1-8)*\n\n* Build ProfileService microservice (JIT Contact reconciliation API)\n* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n* UAT with test Salesforce sandbox environment\n\n*Phase 2: Contact Migration (Week 9)*\n\n* Execute Contact migration (app database → Salesforce production)\n* Validation: 100% data integrity check (email/phone/VCI matching)\n* Reconciliation report: New Contacts created vs existing Contacts updated\n* Freeze app database Contact updates during migration window\n* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n\n*Phase 3: Cutover (Week 10)*\n\n* Deploy ProfileService to production\n* Deploy EngagementService to production\n* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n* Configure Salesforce webhook (Case update notifications → EngagementService)\n* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n* **Go/No-Go decision**: Validate success criteria before final cutover\n\n*Phase 4: D365 CE Retirement (Weeks 11-22)*\n\n* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n* D365 CE read-only access (historical Case lookups if needed)\n* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n* Archive D365 CE data for compliance/auditing\n\n==== Migration Dependencies\n\n[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n|===\n|Dependency |Owner/Status\n\n|*Salesforce production access*\n|Viva Energy Salesforce admin team - TBD\n\n|*Salesforce Case field mapping*\n|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n\n|*Salesforce data isolation strategy*\n|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n\n|*Salesforce webhook configuration*\n|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n\n|*Event Bus infrastructure*\n|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Braze integration*\n|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n\n|*Mobile App release window*\n|OTR Mobile team - Coordinate cutover timing with app release schedule\n\n|*App database access*\n|OTR Platform team - Read access for Contact migration\n\n|===\n\n==== Migration Validation Criteria\n\n*Contact Migration Validation:*\n\n* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n\n*Cutover Validation:*\n\n* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n* ✅ Braze push notifications delivered for Case creation and Case resolution\n* ✅ Event Bus queue depth within normal range (no backlog)\n* ✅ Dead letter queue empty (no failed Case creations)\n* ✅ Salesforce API rate limits not exceeded\n\n*Production Monitoring (30 days):*\n\n* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n* ✅ Support agents confirm unified customer view across all channels\n* ✅ Zero critical incidents (P1 outages, data loss)\n\n==== Rollback Plan\n\n*Rollback Trigger:*\n\n* Feedback submission success rate < 95% (below acceptable threshold)\n* Data loss or corruption detected in Salesforce\n* Salesforce API rate limits exceeded (Cases not created within SLA)\n* Critical bug blocking customer feedback submission\n\n*Rollback Procedure:*\n\n1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n3. **Re-enable D365 CE** for customer feedback submission\n4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n5. **Fix and re-test** in sandbox environment\n6. **Retry cutover** when issues resolved\n\n*Rollback Limitations:*\n\n* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n* Contacts migrated to Salesforce remain (no rollback to app database)\n* Rollback only affects Mobile App integration (not data migration)"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":462,"cache_read_input_tokens":78550,"cache_creation":{"ephemeral_5m_input_tokens":462,"ephemeral_1h_input_tokens":0},"output_tokens":1556,"service_tier":"standard"}},"requestId":"req_011CWsHLrp8Z6x8qzWeK5hcE","type":"assistant","uuid":"5a4af70d-cf97-4fdd-ab66-493022627740","timestamp":"2026-01-07T03:09:55.433Z"}
{"parentUuid":"5a4af70d-cf97-4fdd-ab66-493022627740","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011XN5qwMyfUvr6EqxgPC3wU","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   762→* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n   763→* ⚠️ Webhook authentication and security required\n   764→* ⚠️ EngagementService must handle webhook retries and failures\n   765→\n   766→=== Migration Strategy\n   767→\n   768→==== Migration Phases\n   769→\n   770→*Phase 1: Build & Test (Weeks 1-8)*\n   771→\n   772→* Build ProfileService microservice (JIT Contact reconciliation API)\n   773→* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n   774→* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n   775→* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n   776→* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n   777→* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n   778→* UAT with test Salesforce sandbox environment\n   779→\n   780→*Phase 2: Contact Migration (Week 9)*\n   781→\n   782→* Execute Contact migration (app database → Salesforce production)\n   783→* Validation: 100% data integrity check (email/phone/VCI matching)\n   784→* Reconciliation report: New Contacts created vs existing Contacts updated\n   785→* Freeze app database Contact updates during migration window\n   786→* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n   787→\n   788→*Phase 3: Cutover (Week 10)*\n   789→\n   790→* Deploy ProfileService to production\n   791→* Deploy EngagementService to production\n   792→* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n   793→* Configure Salesforce webhook (Case update notifications → EngagementService)\n   794→* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n   795→* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n   796→* **Go/No-Go decision**: Validate success criteria before final cutover\n   797→\n   798→*Phase 4: D365 CE Retirement (Weeks 11-22)*\n   799→\n   800→* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n   801→* D365 CE read-only access (historical Case lookups if needed)\n   802→* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n   803→* Archive D365 CE data for compliance/auditing\n   804→\n   805→==== Migration Dependencies\n   806→\n   807→[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n   808→|===\n   809→|Dependency |Owner/Status\n   810→\n   811→|*Salesforce production access*\n   812→|Viva Energy Salesforce admin team - TBD\n   813→\n   814→|*Salesforce Case field mapping*\n   815→|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n   816→\n   817→|*Salesforce data isolation strategy*\n   818→|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n   819→\n   820→|*Salesforce webhook configuration*\n   821→|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n   822→\n   823→|*Event Bus infrastructure*\n   824→|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n   825→\n   826→|*Braze integration*\n   827→|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n   828→\n   829→|*Mobile App release window*\n   830→|OTR Mobile team - Coordinate cutover timing with app release schedule\n   831→\n   832→|*App database access*\n   833→|OTR Platform team - Read access for Contact migration\n   834→\n   835→|===\n   836→\n   837→==== Migration Validation Criteria\n   838→\n   839→*Contact Migration Validation:*\n   840→\n   841→* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n   842→* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n   843→* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n   844→* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n   845→\n   846→*Cutover Validation:*\n   847→\n   848→* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n   849→* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n   850→* ✅ Braze push notifications delivered for Case creation and Case resolution\n   851→* ✅ Event Bus queue depth within normal range (no backlog)\n   852→* ✅ Dead letter queue empty (no failed Case creations)\n   853→* ✅ Salesforce API rate limits not exceeded\n   854→\n   855→*Production Monitoring (30 days):*\n   856→\n   857→* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n   858→* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n   859→* ✅ Support agents confirm unified customer view across all channels\n   860→* ✅ Zero critical incidents (P1 outages, data loss)\n   861→\n   862→==== Rollback Plan\n   863→\n   864→*Rollback Trigger:*\n   865→\n   866→* Feedback submission success rate < 95% (below acceptable threshold)\n   867→* Data loss or corruption detected in Salesforce\n   868→* Salesforce API rate limits exceeded (Cases not created within SLA)\n   869→* Critical bug blocking customer feedback submission\n   870→\n   871→*Rollback Procedure:*\n   872→\n   873→1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n   874→2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n   875→3. **Re-enable D365 CE** for customer feedback submission\n   876→4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n   877→5. **Fix and re-test** in sandbox environment\n   878→6. **Retry cutover** when issues resolved\n   879→\n   880→*Rollback Limitations:*\n   881→\n   882→* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n   883→* Contacts migrated to Salesforce remain (no rollback to app database)\n   884→* Rollback only affects Mobile App integration (not data migration)\n   885→\n   886→=== Architectural Scope Boundaries\n   887→\n   888→==== Capabilities Included"}]},"uuid":"2ccd4698-0bad-4456-a6ee-8538faa362d3","timestamp":"2026-01-07T03:09:55.961Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Migration Strategy","newString":"=== Migration Strategy\n\n==== Migration Phases\n\n*Phase 1: Build & Test (Weeks 1-8)*\n\n* Build ProfileService microservice (JIT Contact reconciliation API)\n* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n* UAT with test Salesforce sandbox environment\n\n*Phase 2: Contact Migration (Week 9)*\n\n* Execute Contact migration (app database → Salesforce production)\n* Validation: 100% data integrity check (email/phone/VCI matching)\n* Reconciliation report: New Contacts created vs existing Contacts updated\n* Freeze app database Contact updates during migration window\n* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n\n*Phase 3: Cutover (Week 10)*\n\n* Deploy ProfileService to production\n* Deploy EngagementService to production\n* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n* Configure Salesforce webhook (Case update notifications → EngagementService)\n* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n* **Go/No-Go decision**: Validate success criteria before final cutover\n\n*Phase 4: D365 CE Retirement (Weeks 11-22)*\n\n* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n* D365 CE read-only access (historical Case lookups if needed)\n* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n* Archive D365 CE data for compliance/auditing\n\n==== Migration Dependencies\n\n[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n|===\n|Dependency |Owner/Status\n\n|*Salesforce production access*\n|Viva Energy Salesforce admin team - TBD\n\n|*Salesforce Case field mapping*\n|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n\n|*Salesforce data isolation strategy*\n|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n\n|*Salesforce webhook configuration*\n|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n\n|*Event Bus infrastructure*\n|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Braze integration*\n|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n\n|*Mobile App release window*\n|OTR Mobile team - Coordinate cutover timing with app release schedule\n\n|*App database access*\n|OTR Platform team - Read access for Contact migration\n\n|===\n\n==== Migration Validation Criteria\n\n*Contact Migration Validation:*\n\n* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n\n*Cutover Validation:*\n\n* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n* ✅ Braze push notifications delivered for Case creation and Case resolution\n* ✅ Event Bus queue depth within normal range (no backlog)\n* ✅ Dead letter queue empty (no failed Case creations)\n* ✅ Salesforce API rate limits not exceeded\n\n*Production Monitoring (30 days):*\n\n* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n* ✅ Support agents confirm unified customer view across all channels\n* ✅ Zero critical incidents (P1 outages, data loss)\n\n==== Rollback Plan\n\n*Rollback Trigger:*\n\n* Feedback submission success rate < 95% (below acceptable threshold)\n* Data loss or corruption detected in Salesforce\n* Salesforce API rate limits exceeded (Cases not created within SLA)\n* Critical bug blocking customer feedback submission\n\n*Rollback Procedure:*\n\n1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n3. **Re-enable D365 CE** for customer feedback submission\n4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n5. **Fix and re-test** in sandbox environment\n6. **Retry cutover** when issues resolved\n\n*Rollback Limitations:*\n\n* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n* Contacts migrated to Salesforce remain (no rollback to app database)\n* Rollback only affects Mobile App integration (not data migration)","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture\n\n=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures\n\n=== Migration Strategy\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":765,"oldLines":6,"newStart":765,"newLines":124,"lines":[" "," === Migration Strategy"," ","+==== Migration Phases","+","+*Phase 1: Build & Test (Weeks 1-8)*","+","+* Build ProfileService microservice (JIT Contact reconciliation API)","+* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)","+* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)","+* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)","+* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)","+* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)","+* UAT with test Salesforce sandbox environment","+","+*Phase 2: Contact Migration (Week 9)*","+","+* Execute Contact migration (app database → Salesforce production)","+* Validation: 100% data integrity check (email/phone/VCI matching)","+* Reconciliation report: New Contacts created vs existing Contacts updated","+* Freeze app database Contact updates during migration window","+* ProfileService smoke testing (verify Contact lookups work in Salesforce production)","+","+*Phase 3: Cutover (Week 10)*","+","+* Deploy ProfileService to production","+* Deploy EngagementService to production","+* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)","+* Configure Salesforce webhook (Case update notifications → EngagementService)","+* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)","+* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits","+* **Go/No-Go decision**: Validate success criteria before final cutover","+","+*Phase 4: D365 CE Retirement (Weeks 11-22)*","+","+* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)","+* D365 CE read-only access (historical Case lookups if needed)","+* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)","+* Archive D365 CE data for compliance/auditing","+","+==== Migration Dependencies","+","+[width=\"100%\",cols=\"40%,60%\",options=\"header\",]","+|===","+|Dependency |Owner/Status","+","+|*Salesforce production access*","+|Viva Energy Salesforce admin team - TBD","+","+|*Salesforce Case field mapping*","+|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)","+","+|*Salesforce data isolation strategy*","+|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)","+","+|*Salesforce webhook configuration*","+|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)","+","+|*Event Bus infrastructure*","+|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)","+","+|*Braze integration*","+|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns","+","+|*Mobile App release window*","+|OTR Mobile team - Coordinate cutover timing with app release schedule","+","+|*App database access*","+|OTR Platform team - Read access for Contact migration","+","+|===","+","+==== Migration Validation Criteria","+","+*Contact Migration Validation:*","+","+* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)","+* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)","+* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)","+* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated","+","+*Cutover Validation:*","+","+* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)","+* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created","+* ✅ Braze push notifications delivered for Case creation and Case resolution","+* ✅ Event Bus queue depth within normal range (no backlog)","+* ✅ Dead letter queue empty (no failed Case creations)","+* ✅ Salesforce API rate limits not exceeded","+","+*Production Monitoring (30 days):*","+","+* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)","+* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)","+* ✅ Support agents confirm unified customer view across all channels","+* ✅ Zero critical incidents (P1 outages, data loss)","+","+==== Rollback Plan","+","+*Rollback Trigger:*","+","+* Feedback submission success rate < 95% (below acceptable threshold)","+* Data loss or corruption detected in Salesforce","+* Salesforce API rate limits exceeded (Cases not created within SLA)","+* Critical bug blocking customer feedback submission","+","+*Rollback Procedure:*","+","+1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)","+2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)","+3. **Re-enable D365 CE** for customer feedback submission","+4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)","+5. **Fix and re-test** in sandbox environment","+6. **Retry cutover** when issues resolved","+","+*Rollback Limitations:*","+","+* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)","+* Contacts migrated to Salesforce remain (no rollback to app database)","+* Rollback only affects Mobile App integration (not data migration)","+"," === Architectural Scope Boundaries"," "," ==== Capabilities Included"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"2ccd4698-0bad-4456-a6ee-8538faa362d3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TzatW1L9i4GDAdghaiFmKX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good. Now let me populate the Technical Risks and Mitigation section.","signature":"Eu0BCkYICxgCKkBgPWHxW6k6B7XLo5lTGpj/bbTNKzDmxg+l+SfwpifbStvkHkKS0beb/y90N818cw41CooX3BfrkYc5/8BgoRjTEgxlsymweNUf6m7+tK0aDACHl+RlB04b9h7+vSIwXGIEIhugdfHl9oRz2nubXcAZbat9KLPskO4M0/cqCxmJC7A9gHzWGBfKyUokeeK9KlXyliK5C7ezgXjuuyXauktpsHn4hOLff8E6L+fljJ1mVZ6wvsuS11P6GkqPmS5R7ShNQPykPBnBzZ4W7AuGjNyhFM6oU0mNhuj8ohyM5GZtpAQyolVSGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3545,"cache_read_input_tokens":79012,"cache_creation":{"ephemeral_5m_input_tokens":3545,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHPmErPyKjhVcdT7x4n","type":"assistant","uuid":"7f02a669-3db4-4d23-b361-7b8f99aaa56c","timestamp":"2026-01-07T03:10:02.378Z"}
{"parentUuid":"7f02a669-3db4-4d23-b361-7b8f99aaa56c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TzatW1L9i4GDAdghaiFmKX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011s71RPbyz97bqdjWVm4uCB","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"=== Technical Risks and Mitigation","new_string":"=== Technical Risks and Mitigation\n\n[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]\n|===\n|ID |Risk |Impact |Likelihood |Mitigation\n\n|RISK-CS-001\n|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created\n|HIGH (customers don't receive Case confirmation, support tickets lost)\n|MEDIUM (volume unknown, rate limits TBD)\n|• Gather expected feedback volume data before cutover +\n• Implement Event Bus queue throttling/rate limiting +\n• Monitor queue depth and API usage +\n• Scale background workers based on queue depth +\n• Alert ops team when approaching rate limits\n\n|RISK-CS-002\n|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation\n|MEDIUM (Cases delayed but queued, customers wait for confirmation)\n|LOW (Salesforce SLA 99.9% uptime)\n|• Async Case creation with retry logic +\n• Event Bus queues buffer work during outage +\n• Customers get immediate \"Feedback submitted\" (not blocked) +\n• Monitor Salesforce status page, alert ops team +\n• Automatic retry when Salesforce recovers\n\n|RISK-CS-003\n|*Contact migration data quality issues*: App database Contact data incomplete or invalid\n|HIGH (migration fails validation, cutover delayed)\n|MEDIUM (legacy data quality unknown)\n|• Pre-migration data quality assessment +\n• Flexible upsert logic (match by email/phone/VCI) +\n• Validation report identifies data issues before production migration +\n• Manual cleanup for invalid records +\n• Dry-run migration in sandbox environment\n\n|RISK-CS-004\n|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts\n|MEDIUM (support agents see multiple profiles for same customer)\n|MEDIUM (email changes, data quality issues)\n|• Salesforce duplicate detection rules (if available) +\n• ProfileService logs Contact creation for audit trail +\n• Manual duplicate cleanup process (support team) +\n• Future enhancement: VCI as Salesforce External ID for stable matching\n\n|RISK-CS-005\n|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows\n|HIGH (customers don't receive Case confirmation, feedback lost)\n|LOW (retry logic handles most failures)\n|• Dead letter queue monitoring and alerting +\n• Ops team dashboard showing DLQ depth +\n• Manual intervention process (investigate and reprocess) +\n• Automated alerts when DLQ depth exceeds threshold +\n• Root cause analysis for recurring failures\n\n|RISK-CS-006\n|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService\n|MEDIUM (customers don't get push notifications for Case resolution)\n|LOW (webhook mechanism reliable)\n|• Webhook retry logic and exponential backoff +\n• EngagementService logs webhook deliveries +\n• Monitor webhook delivery success rate +\n• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +\n• Alert ops team when webhook delivery rate drops\n\n|RISK-CS-007\n|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams\n|HIGH (privacy violation, compliance risk)\n|LOW (Salesforce governance controls)\n|• Work with Viva Energy Salesforce admin team on data isolation strategy +\n• Test data visibility in Salesforce sandbox (UAT with different user roles) +\n• Validate Record Types, queues, field-level security before production +\n• Audit Salesforce user permissions and sharing rules\n\n|RISK-CS-008\n|*Mobile App release coordination*: App release delayed, cutover window missed\n|MEDIUM (cutover delayed, D365 CE retirement delayed)\n|MEDIUM (release schedule conflicts)\n|• Coordinate cutover timing with Mobile team early +\n• Buffer time in migration plan (2-week contingency) +\n• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +\n• Feature flag for feedback submission (enable when ready)\n\n|RISK-CS-009\n|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration\n|HIGH (Case creation blocked, domain events not published)\n|LOW (AWS SLA 99.99% uptime)\n|• Leverage existing AWS infrastructure (proven, reliable) +\n• Infrastructure as Code (IaC) for Event Bus configuration +\n• Integration testing in non-production environment +\n• Monitor Event Bus metrics (queue depth, throughput, errors) +\n• Alert ops team on Event Bus failures\n\n|RISK-CS-010\n|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture\n|MEDIUM (implementation delays, architectural inconsistencies)\n|HIGH (first DDD implementation)\n|• DDD training for development team (workshops, documentation) +\n• Architecture review sessions (validate bounded context design) +\n• Pair programming with experienced DDD practitioners +\n• Incremental implementation (start small, iterate) +\n• Document architectural patterns in CLAUDE.md\n\n|==="}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3545,"cache_read_input_tokens":79012,"cache_creation":{"ephemeral_5m_input_tokens":3545,"ephemeral_1h_input_tokens":0},"output_tokens":1363,"service_tier":"standard"}},"requestId":"req_011CWsHPmErPyKjhVcdT7x4n","type":"assistant","uuid":"19f2385f-695b-4430-a65d-6bf02572b05a","timestamp":"2026-01-07T03:10:32.772Z"}
{"parentUuid":"19f2385f-695b-4430-a65d-6bf02572b05a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011s71RPbyz97bqdjWVm4uCB","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   890→==== Capabilities Excluded\n   891→\n   892→==== Architectural Dependencies on Future Initiatives\n   893→\n   894→=== Technical Risks and Mitigation\n   895→\n   896→[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]\n   897→|===\n   898→|ID |Risk |Impact |Likelihood |Mitigation\n   899→\n   900→|RISK-CS-001\n   901→|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created\n   902→|HIGH (customers don't receive Case confirmation, support tickets lost)\n   903→|MEDIUM (volume unknown, rate limits TBD)\n   904→|• Gather expected feedback volume data before cutover +\n   905→• Implement Event Bus queue throttling/rate limiting +\n   906→• Monitor queue depth and API usage +\n   907→• Scale background workers based on queue depth +\n   908→• Alert ops team when approaching rate limits\n   909→\n   910→|RISK-CS-002\n   911→|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation\n   912→|MEDIUM (Cases delayed but queued, customers wait for confirmation)\n   913→|LOW (Salesforce SLA 99.9% uptime)\n   914→|• Async Case creation with retry logic +\n   915→• Event Bus queues buffer work during outage +\n   916→• Customers get immediate \"Feedback submitted\" (not blocked) +\n   917→• Monitor Salesforce status page, alert ops team +\n   918→• Automatic retry when Salesforce recovers\n   919→\n   920→|RISK-CS-003\n   921→|*Contact migration data quality issues*: App database Contact data incomplete or invalid\n   922→|HIGH (migration fails validation, cutover delayed)\n   923→|MEDIUM (legacy data quality unknown)\n   924→|• Pre-migration data quality assessment +\n   925→• Flexible upsert logic (match by email/phone/VCI) +\n   926→• Validation report identifies data issues before production migration +\n   927→• Manual cleanup for invalid records +\n   928→• Dry-run migration in sandbox environment\n   929→\n   930→|RISK-CS-004\n   931→|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts\n   932→|MEDIUM (support agents see multiple profiles for same customer)\n   933→|MEDIUM (email changes, data quality issues)\n   934→|• Salesforce duplicate detection rules (if available) +\n   935→• ProfileService logs Contact creation for audit trail +\n   936→• Manual duplicate cleanup process (support team) +\n   937→• Future enhancement: VCI as Salesforce External ID for stable matching\n   938→\n   939→|RISK-CS-005\n   940→|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows\n   941→|HIGH (customers don't receive Case confirmation, feedback lost)\n   942→|LOW (retry logic handles most failures)\n   943→|• Dead letter queue monitoring and alerting +\n   944→• Ops team dashboard showing DLQ depth +\n   945→• Manual intervention process (investigate and reprocess) +\n   946→• Automated alerts when DLQ depth exceeds threshold +\n   947→• Root cause analysis for recurring failures\n   948→\n   949→|RISK-CS-006\n   950→|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService\n   951→|MEDIUM (customers don't get push notifications for Case resolution)\n   952→|LOW (webhook mechanism reliable)\n   953→|• Webhook retry logic and exponential backoff +\n   954→• EngagementService logs webhook deliveries +\n   955→• Monitor webhook delivery success rate +\n   956→• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +\n   957→• Alert ops team when webhook delivery rate drops\n   958→\n   959→|RISK-CS-007\n   960→|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams\n   961→|HIGH (privacy violation, compliance risk)\n   962→|LOW (Salesforce governance controls)\n   963→|• Work with Viva Energy Salesforce admin team on data isolation strategy +\n   964→• Test data visibility in Salesforce sandbox (UAT with different user roles) +\n   965→• Validate Record Types, queues, field-level security before production +\n   966→• Audit Salesforce user permissions and sharing rules\n   967→\n   968→|RISK-CS-008\n   969→|*Mobile App release coordination*: App release delayed, cutover window missed\n   970→|MEDIUM (cutover delayed, D365 CE retirement delayed)\n   971→|MEDIUM (release schedule conflicts)\n   972→|• Coordinate cutover timing with Mobile team early +\n   973→• Buffer time in migration plan (2-week contingency) +\n   974→• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +\n   975→• Feature flag for feedback submission (enable when ready)\n   976→\n   977→|RISK-CS-009\n   978→|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration\n   979→|HIGH (Case creation blocked, domain events not published)\n   980→|LOW (AWS SLA 99.99% uptime)\n   981→|• Leverage existing AWS infrastructure (proven, reliable) +\n   982→• Infrastructure as Code (IaC) for Event Bus configuration +\n   983→• Integration testing in non-production environment +\n   984→• Monitor Event Bus metrics (queue depth, throughput, errors) +\n   985→• Alert ops team on Event Bus failures\n   986→\n   987→|RISK-CS-010\n   988→|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture\n   989→|MEDIUM (implementation delays, architectural inconsistencies)\n   990→|HIGH (first DDD implementation)\n   991→|• DDD training for development team (workshops, documentation) +\n   992→• Architecture review sessions (validate bounded context design) +\n   993→• Pair programming with experienced DDD practitioners +\n   994→• Incremental implementation (start small, iterate) +\n   995→• Document architectural patterns in CLAUDE.md\n   996→\n   997→|===\n   998→\n   999→== Assumptions and Constraints\n  1000→\n  1001→=== Assumptions"}]},"uuid":"51663e25-23e7-4f90-9dd1-0a440e68c651","timestamp":"2026-01-07T03:10:33.317Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"=== Technical Risks and Mitigation","newString":"=== Technical Risks and Mitigation\n\n[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]\n|===\n|ID |Risk |Impact |Likelihood |Mitigation\n\n|RISK-CS-001\n|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created\n|HIGH (customers don't receive Case confirmation, support tickets lost)\n|MEDIUM (volume unknown, rate limits TBD)\n|• Gather expected feedback volume data before cutover +\n• Implement Event Bus queue throttling/rate limiting +\n• Monitor queue depth and API usage +\n• Scale background workers based on queue depth +\n• Alert ops team when approaching rate limits\n\n|RISK-CS-002\n|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation\n|MEDIUM (Cases delayed but queued, customers wait for confirmation)\n|LOW (Salesforce SLA 99.9% uptime)\n|• Async Case creation with retry logic +\n• Event Bus queues buffer work during outage +\n• Customers get immediate \"Feedback submitted\" (not blocked) +\n• Monitor Salesforce status page, alert ops team +\n• Automatic retry when Salesforce recovers\n\n|RISK-CS-003\n|*Contact migration data quality issues*: App database Contact data incomplete or invalid\n|HIGH (migration fails validation, cutover delayed)\n|MEDIUM (legacy data quality unknown)\n|• Pre-migration data quality assessment +\n• Flexible upsert logic (match by email/phone/VCI) +\n• Validation report identifies data issues before production migration +\n• Manual cleanup for invalid records +\n• Dry-run migration in sandbox environment\n\n|RISK-CS-004\n|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts\n|MEDIUM (support agents see multiple profiles for same customer)\n|MEDIUM (email changes, data quality issues)\n|• Salesforce duplicate detection rules (if available) +\n• ProfileService logs Contact creation for audit trail +\n• Manual duplicate cleanup process (support team) +\n• Future enhancement: VCI as Salesforce External ID for stable matching\n\n|RISK-CS-005\n|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows\n|HIGH (customers don't receive Case confirmation, feedback lost)\n|LOW (retry logic handles most failures)\n|• Dead letter queue monitoring and alerting +\n• Ops team dashboard showing DLQ depth +\n• Manual intervention process (investigate and reprocess) +\n• Automated alerts when DLQ depth exceeds threshold +\n• Root cause analysis for recurring failures\n\n|RISK-CS-006\n|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService\n|MEDIUM (customers don't get push notifications for Case resolution)\n|LOW (webhook mechanism reliable)\n|• Webhook retry logic and exponential backoff +\n• EngagementService logs webhook deliveries +\n• Monitor webhook delivery success rate +\n• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +\n• Alert ops team when webhook delivery rate drops\n\n|RISK-CS-007\n|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams\n|HIGH (privacy violation, compliance risk)\n|LOW (Salesforce governance controls)\n|• Work with Viva Energy Salesforce admin team on data isolation strategy +\n• Test data visibility in Salesforce sandbox (UAT with different user roles) +\n• Validate Record Types, queues, field-level security before production +\n• Audit Salesforce user permissions and sharing rules\n\n|RISK-CS-008\n|*Mobile App release coordination*: App release delayed, cutover window missed\n|MEDIUM (cutover delayed, D365 CE retirement delayed)\n|MEDIUM (release schedule conflicts)\n|• Coordinate cutover timing with Mobile team early +\n• Buffer time in migration plan (2-week contingency) +\n• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +\n• Feature flag for feedback submission (enable when ready)\n\n|RISK-CS-009\n|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration\n|HIGH (Case creation blocked, domain events not published)\n|LOW (AWS SLA 99.99% uptime)\n|• Leverage existing AWS infrastructure (proven, reliable) +\n• Infrastructure as Code (IaC) for Event Bus configuration +\n• Integration testing in non-production environment +\n• Monitor Event Bus metrics (queue depth, throughput, errors) +\n• Alert ops team on Event Bus failures\n\n|RISK-CS-010\n|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture\n|MEDIUM (implementation delays, architectural inconsistencies)\n|HIGH (first DDD implementation)\n|• DDD training for development team (workshops, documentation) +\n• Architecture review sessions (validate bounded context design) +\n• Pair programming with experienced DDD practitioners +\n• Incremental implementation (start small, iterate) +\n• Document architectural patterns in CLAUDE.md\n\n|===","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture\n\n=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures\n\n=== Migration Strategy\n\n==== Migration Phases\n\n*Phase 1: Build & Test (Weeks 1-8)*\n\n* Build ProfileService microservice (JIT Contact reconciliation API)\n* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n* UAT with test Salesforce sandbox environment\n\n*Phase 2: Contact Migration (Week 9)*\n\n* Execute Contact migration (app database → Salesforce production)\n* Validation: 100% data integrity check (email/phone/VCI matching)\n* Reconciliation report: New Contacts created vs existing Contacts updated\n* Freeze app database Contact updates during migration window\n* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n\n*Phase 3: Cutover (Week 10)*\n\n* Deploy ProfileService to production\n* Deploy EngagementService to production\n* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n* Configure Salesforce webhook (Case update notifications → EngagementService)\n* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n* **Go/No-Go decision**: Validate success criteria before final cutover\n\n*Phase 4: D365 CE Retirement (Weeks 11-22)*\n\n* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n* D365 CE read-only access (historical Case lookups if needed)\n* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n* Archive D365 CE data for compliance/auditing\n\n==== Migration Dependencies\n\n[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n|===\n|Dependency |Owner/Status\n\n|*Salesforce production access*\n|Viva Energy Salesforce admin team - TBD\n\n|*Salesforce Case field mapping*\n|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n\n|*Salesforce data isolation strategy*\n|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n\n|*Salesforce webhook configuration*\n|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n\n|*Event Bus infrastructure*\n|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Braze integration*\n|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n\n|*Mobile App release window*\n|OTR Mobile team - Coordinate cutover timing with app release schedule\n\n|*App database access*\n|OTR Platform team - Read access for Contact migration\n\n|===\n\n==== Migration Validation Criteria\n\n*Contact Migration Validation:*\n\n* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n\n*Cutover Validation:*\n\n* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n* ✅ Braze push notifications delivered for Case creation and Case resolution\n* ✅ Event Bus queue depth within normal range (no backlog)\n* ✅ Dead letter queue empty (no failed Case creations)\n* ✅ Salesforce API rate limits not exceeded\n\n*Production Monitoring (30 days):*\n\n* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n* ✅ Support agents confirm unified customer view across all channels\n* ✅ Zero critical incidents (P1 outages, data loss)\n\n==== Rollback Plan\n\n*Rollback Trigger:*\n\n* Feedback submission success rate < 95% (below acceptable threshold)\n* Data loss or corruption detected in Salesforce\n* Salesforce API rate limits exceeded (Cases not created within SLA)\n* Critical bug blocking customer feedback submission\n\n*Rollback Procedure:*\n\n1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n3. **Re-enable D365 CE** for customer feedback submission\n4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n5. **Fix and re-test** in sandbox environment\n6. **Retry cutover** when issues resolved\n\n*Rollback Limitations:*\n\n* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n* Contacts migrated to Salesforce remain (no rollback to app database)\n* Rollback only affects Mobile App integration (not data migration)\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":893,"oldLines":6,"newStart":893,"newLines":109,"lines":[" "," === Technical Risks and Mitigation"," ","+[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]","+|===","+|ID |Risk |Impact |Likelihood |Mitigation","+","+|RISK-CS-001","+|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created","+|HIGH (customers don't receive Case confirmation, support tickets lost)","+|MEDIUM (volume unknown, rate limits TBD)","+|• Gather expected feedback volume data before cutover +","+• Implement Event Bus queue throttling/rate limiting +","+• Monitor queue depth and API usage +","+• Scale background workers based on queue depth +","+• Alert ops team when approaching rate limits","+","+|RISK-CS-002","+|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation","+|MEDIUM (Cases delayed but queued, customers wait for confirmation)","+|LOW (Salesforce SLA 99.9% uptime)","+|• Async Case creation with retry logic +","+• Event Bus queues buffer work during outage +","+• Customers get immediate \"Feedback submitted\" (not blocked) +","+• Monitor Salesforce status page, alert ops team +","+• Automatic retry when Salesforce recovers","+","+|RISK-CS-003","+|*Contact migration data quality issues*: App database Contact data incomplete or invalid","+|HIGH (migration fails validation, cutover delayed)","+|MEDIUM (legacy data quality unknown)","+|• Pre-migration data quality assessment +","+• Flexible upsert logic (match by email/phone/VCI) +","+• Validation report identifies data issues before production migration +","+• Manual cleanup for invalid records +","+• Dry-run migration in sandbox environment","+","+|RISK-CS-004","+|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts","+|MEDIUM (support agents see multiple profiles for same customer)","+|MEDIUM (email changes, data quality issues)","+|• Salesforce duplicate detection rules (if available) +","+• ProfileService logs Contact creation for audit trail +","+• Manual duplicate cleanup process (support team) +","+• Future enhancement: VCI as Salesforce External ID for stable matching","+","+|RISK-CS-005","+|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows","+|HIGH (customers don't receive Case confirmation, feedback lost)","+|LOW (retry logic handles most failures)","+|• Dead letter queue monitoring and alerting +","+• Ops team dashboard showing DLQ depth +","+• Manual intervention process (investigate and reprocess) +","+• Automated alerts when DLQ depth exceeds threshold +","+• Root cause analysis for recurring failures","+","+|RISK-CS-006","+|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService","+|MEDIUM (customers don't get push notifications for Case resolution)","+|LOW (webhook mechanism reliable)","+|• Webhook retry logic and exponential backoff +","+• EngagementService logs webhook deliveries +","+• Monitor webhook delivery success rate +","+• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +","+• Alert ops team when webhook delivery rate drops","+","+|RISK-CS-007","+|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams","+|HIGH (privacy violation, compliance risk)","+|LOW (Salesforce governance controls)","+|• Work with Viva Energy Salesforce admin team on data isolation strategy +","+• Test data visibility in Salesforce sandbox (UAT with different user roles) +","+• Validate Record Types, queues, field-level security before production +","+• Audit Salesforce user permissions and sharing rules","+","+|RISK-CS-008","+|*Mobile App release coordination*: App release delayed, cutover window missed","+|MEDIUM (cutover delayed, D365 CE retirement delayed)","+|MEDIUM (release schedule conflicts)","+|• Coordinate cutover timing with Mobile team early +","+• Buffer time in migration plan (2-week contingency) +","+• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +","+• Feature flag for feedback submission (enable when ready)","+","+|RISK-CS-009","+|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration","+|HIGH (Case creation blocked, domain events not published)","+|LOW (AWS SLA 99.99% uptime)","+|• Leverage existing AWS infrastructure (proven, reliable) +","+• Infrastructure as Code (IaC) for Event Bus configuration +","+• Integration testing in non-production environment +","+• Monitor Event Bus metrics (queue depth, throughput, errors) +","+• Alert ops team on Event Bus failures","+","+|RISK-CS-010","+|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture","+|MEDIUM (implementation delays, architectural inconsistencies)","+|HIGH (first DDD implementation)","+|• DDD training for development team (workshops, documentation) +","+• Architecture review sessions (validate bounded context design) +","+• Pair programming with experienced DDD practitioners +","+• Incremental implementation (start small, iterate) +","+• Document architectural patterns in CLAUDE.md","+","+|===","+"," == Assumptions and Constraints"," "," === Assumptions"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"51663e25-23e7-4f90-9dd1-0a440e68c651","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012cDGYt8WEYzSfv8T45HEww","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me now complete the final sections and mark the task as complete.","signature":"Eu0BCkYICxgCKkB6Q84qEToFKHPKBvSEK2s59AsXAeQJ3stE033z6iQRxMJKGkJdmyn84zpW5S+hf0IvfIKNxQv6fQZ7mqhRUKTeEgwwKLehHceueemlstkaDOgaj6B15RR50VWDXyIwzSRVBc+7HdHX3kyaFQU7UqcARugD8RIuUcFqhVsvyv0Urz8FpWJ0iWE/y+SLXG0yKlXyK00NVeG4MmO3hTO86mJQAcuRCEYTqOCAG/WueQ79nsSRxENduhYzDrtrG0heJqiMz+4jyOUHQW+Swyi/7d6b+Q0tXzeRSjp4daD+CvGEyV2pwwXhGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3033,"cache_read_input_tokens":82557,"cache_creation":{"ephemeral_5m_input_tokens":3033,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsHSXJHbNd6NQKf7NnUp","type":"assistant","uuid":"f7640ed0-22b8-4089-bd6a-8133efd1f493","timestamp":"2026-01-07T03:10:38.305Z"}
{"parentUuid":"f7640ed0-22b8-4089-bd6a-8133efd1f493","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012cDGYt8WEYzSfv8T45HEww","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0153JY4jbgdc6XeCoDsdRyj3","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"completed"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"completed"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"completed"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"completed"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"completed"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"completed"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"completed"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"completed"},{"content":"Review and finalize document","activeForm":"Reviewing and finalizing document","status":"in_progress"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":3033,"cache_read_input_tokens":82557,"cache_creation":{"ephemeral_5m_input_tokens":3033,"ephemeral_1h_input_tokens":0},"output_tokens":411,"service_tier":"standard"}},"requestId":"req_011CWsHSXJHbNd6NQKf7NnUp","type":"assistant","uuid":"09a45842-74a9-405b-858f-89fa19428caa","timestamp":"2026-01-07T03:10:43.468Z"}
{"parentUuid":"09a45842-74a9-405b-858f-89fa19428caa","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0153JY4jbgdc6XeCoDsdRyj3","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"d6b88467-994c-4558-a2ab-58b738db5d47","timestamp":"2026-01-07T03:10:43.744Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"completed","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"completed","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"in_progress","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"pending","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Document Testing Approach","status":"pending","activeForm":"Documenting Testing Approach"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"completed","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"completed","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"completed","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"completed","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Review and finalize document","status":"in_progress","activeForm":"Reviewing and finalizing document"}]}}
{"parentUuid":"d6b88467-994c-4558-a2ab-58b738db5d47","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CbDa2TaGkUexGHemz9ExEg","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me add content to the Assumptions section as well to round out the document.","signature":"EvgBCkYICxgCKkBRCUyyQMvTXLuIFP1QfRD3wMJKyeHYpS6muUfotyCEaNqWfZFyRsAMKt5pIPmR+abIgBX9asiZ+P/sJpIS7P2PEgzTiifokGqMO/HWo9kaDBy4eGC3uKIOMQQJqSIwnxCqeYF81SOfjaPgVn1kJ/37InRqsMHSpP7i//p8tVHg5/G1N+5Mobws1oG6SmmpKmD/VADuEGSToebqc1DtOJRkNKchqOMYQd28IQ0UPOkoti6uOTzEZ2uv8bBuG6l2LXBH7yjoUR0Cz0kQeQYPtotKbmePB+s3wTXyIRymnYGCH4TUrTz9vqT8/E5YzgUweuUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":460,"cache_read_input_tokens":85590,"cache_creation":{"ephemeral_5m_input_tokens":460,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHTFck6NXNfQznxi66F","type":"assistant","uuid":"023bbe15-6734-446c-bb5b-2f29d7f9e95e","timestamp":"2026-01-07T03:10:48.112Z"}
{"parentUuid":"023bbe15-6734-446c-bb5b-2f29d7f9e95e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CbDa2TaGkUexGHemz9ExEg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RBtXkCsbA8id6uwwiSoBqw","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints","new_string":"== Assumptions and Constraints\n\n=== Assumptions\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Assumption\n\n|ASM-CS-001\n|Viva Energy Salesforce admin team will provide Salesforce production access, sandbox environment, and support for Case field mapping and data isolation configuration\n\n|ASM-CS-002\n|App database Contact data is sufficiently complete for migration (email/phone/VCI available for matching)\n\n|ASM-CS-003\n|Expected customer feedback volume is within Salesforce API rate limits (to be validated with feedback volume data)\n\n|ASM-CS-004\n|Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) is sufficient for Event Bus implementation (no additional infrastructure provisioning required)\n\n|ASM-CS-005\n|Braze integration already exists and can be extended for Case-related push notifications (no new Braze account or major configuration changes)\n\n|ASM-CS-006\n|Mobile App users have email addresses associated with their accounts (required for ProfileService Contact reconciliation)\n\n|ASM-CS-007\n|D365 Customer Engagement historical Cases have limited business value and do not require migration to Salesforce\n\n|ASM-CS-008\n|Support agents are trained on Salesforce Service Cloud and require minimal additional training for OTR digital customer Cases\n\n|ASM-CS-009\n|Salesforce Service Cloud shared instance has capacity for OTR digital customer Contacts and Cases (no additional licensing or storage costs)\n\n|ASM-CS-010\n|Mobile App release schedule can accommodate cutover timing (Week 10 in migration plan)\n\n|===\n\n=== Constraints\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Constraint\n\n|CON-CS-001\n|Must use shared Viva Energy Salesforce Service Cloud instance (cannot deploy separate OTR-specific instance)\n\n|CON-CS-002\n|Must conform to existing Salesforce configuration and governance (Record Types, custom fields, queues, data isolation strategy defined by Viva Energy admin team)\n\n|CON-CS-003\n|Contact migration must complete before Mobile App cutover (no parallel run of D365 CE and Salesforce)\n\n|CON-CS-004\n|Big bang cutover only (no phased rollout with feature flags or pilot users)\n\n|CON-CS-005\n|Salesforce API rate limits and authentication method constrained by Viva Energy Salesforce configuration (TBD)\n\n|CON-CS-006\n|Event Bus implementation must use existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis - cannot introduce new infrastructure components)\n\n|CON-CS-007\n|Mobile App feedback form must include specific fields: Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message (no attachments)\n\n|CON-CS-008\n|D365 Customer Engagement must be decommissioned within 90 days post-cutover (ADR-CS-006)\n\n|CON-CS-009\n|ProfileService and EngagementService must be stateless (no local aggregate persistence, Salesforce is System of Record)\n\n|CON-CS-010\n|First DDD bounded context implementation (team learning curve, architectural patterns must be documented for future bounded contexts)\n\n|==="}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":460,"cache_read_input_tokens":85590,"cache_creation":{"ephemeral_5m_input_tokens":460,"ephemeral_1h_input_tokens":0},"output_tokens":937,"service_tier":"standard"}},"requestId":"req_011CWsHTFck6NXNfQznxi66F","type":"assistant","uuid":"6593f93a-11fa-4cd9-8814-2ce3b0b8207e","timestamp":"2026-01-07T03:11:09.631Z"}
{"parentUuid":"6593f93a-11fa-4cd9-8814-2ce3b0b8207e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RBtXkCsbA8id6uwwiSoBqw","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   995→• Document architectural patterns in CLAUDE.md\n   996→\n   997→|===\n   998→\n   999→== Assumptions and Constraints\n  1000→\n  1001→=== Assumptions\n  1002→\n  1003→[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n  1004→|===\n  1005→|ID |Assumption\n  1006→\n  1007→|ASM-CS-001\n  1008→|Viva Energy Salesforce admin team will provide Salesforce production access, sandbox environment, and support for Case field mapping and data isolation configuration\n  1009→\n  1010→|ASM-CS-002\n  1011→|App database Contact data is sufficiently complete for migration (email/phone/VCI available for matching)\n  1012→\n  1013→|ASM-CS-003\n  1014→|Expected customer feedback volume is within Salesforce API rate limits (to be validated with feedback volume data)\n  1015→\n  1016→|ASM-CS-004\n  1017→|Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) is sufficient for Event Bus implementation (no additional infrastructure provisioning required)\n  1018→\n  1019→|ASM-CS-005\n  1020→|Braze integration already exists and can be extended for Case-related push notifications (no new Braze account or major configuration changes)\n  1021→\n  1022→|ASM-CS-006\n  1023→|Mobile App users have email addresses associated with their accounts (required for ProfileService Contact reconciliation)\n  1024→\n  1025→|ASM-CS-007\n  1026→|D365 Customer Engagement historical Cases have limited business value and do not require migration to Salesforce\n  1027→\n  1028→|ASM-CS-008\n  1029→|Support agents are trained on Salesforce Service Cloud and require minimal additional training for OTR digital customer Cases\n  1030→\n  1031→|ASM-CS-009\n  1032→|Salesforce Service Cloud shared instance has capacity for OTR digital customer Contacts and Cases (no additional licensing or storage costs)\n  1033→\n  1034→|ASM-CS-010\n  1035→|Mobile App release schedule can accommodate cutover timing (Week 10 in migration plan)\n  1036→\n  1037→|===\n  1038→\n  1039→=== Constraints\n  1040→\n  1041→[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n  1042→|===\n  1043→|ID |Constraint\n  1044→\n  1045→|CON-CS-001\n  1046→|Must use shared Viva Energy Salesforce Service Cloud instance (cannot deploy separate OTR-specific instance)\n  1047→\n  1048→|CON-CS-002\n  1049→|Must conform to existing Salesforce configuration and governance (Record Types, custom fields, queues, data isolation strategy defined by Viva Energy admin team)\n  1050→\n  1051→|CON-CS-003\n  1052→|Contact migration must complete before Mobile App cutover (no parallel run of D365 CE and Salesforce)\n  1053→\n  1054→|CON-CS-004\n  1055→|Big bang cutover only (no phased rollout with feature flags or pilot users)\n  1056→\n  1057→|CON-CS-005\n  1058→|Salesforce API rate limits and authentication method constrained by Viva Energy Salesforce configuration (TBD)\n  1059→\n  1060→|CON-CS-006\n  1061→|Event Bus implementation must use existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis - cannot introduce new infrastructure components)\n  1062→\n  1063→|CON-CS-007\n  1064→|Mobile App feedback form must include specific fields: Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message (no attachments)\n  1065→\n  1066→|CON-CS-008\n  1067→|D365 Customer Engagement must be decommissioned within 90 days post-cutover (ADR-CS-006)\n  1068→\n  1069→|CON-CS-009\n  1070→|ProfileService and EngagementService must be stateless (no local aggregate persistence, Salesforce is System of Record)\n  1071→\n  1072→|CON-CS-010\n  1073→|First DDD bounded context implementation (team learning curve, architectural patterns must be documented for future bounded contexts)\n  1074→\n  1075→|===\n  1076→\n  1077→== Non-Functional Requirements\n  1078→\n  1079→== Monitoring and Observability"}]},"uuid":"cb6b81a0-8c12-4042-ba2d-b2471c5c920a","timestamp":"2026-01-07T03:11:10.118Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints","newString":"== Assumptions and Constraints\n\n=== Assumptions\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Assumption\n\n|ASM-CS-001\n|Viva Energy Salesforce admin team will provide Salesforce production access, sandbox environment, and support for Case field mapping and data isolation configuration\n\n|ASM-CS-002\n|App database Contact data is sufficiently complete for migration (email/phone/VCI available for matching)\n\n|ASM-CS-003\n|Expected customer feedback volume is within Salesforce API rate limits (to be validated with feedback volume data)\n\n|ASM-CS-004\n|Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) is sufficient for Event Bus implementation (no additional infrastructure provisioning required)\n\n|ASM-CS-005\n|Braze integration already exists and can be extended for Case-related push notifications (no new Braze account or major configuration changes)\n\n|ASM-CS-006\n|Mobile App users have email addresses associated with their accounts (required for ProfileService Contact reconciliation)\n\n|ASM-CS-007\n|D365 Customer Engagement historical Cases have limited business value and do not require migration to Salesforce\n\n|ASM-CS-008\n|Support agents are trained on Salesforce Service Cloud and require minimal additional training for OTR digital customer Cases\n\n|ASM-CS-009\n|Salesforce Service Cloud shared instance has capacity for OTR digital customer Contacts and Cases (no additional licensing or storage costs)\n\n|ASM-CS-010\n|Mobile App release schedule can accommodate cutover timing (Week 10 in migration plan)\n\n|===\n\n=== Constraints\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Constraint\n\n|CON-CS-001\n|Must use shared Viva Energy Salesforce Service Cloud instance (cannot deploy separate OTR-specific instance)\n\n|CON-CS-002\n|Must conform to existing Salesforce configuration and governance (Record Types, custom fields, queues, data isolation strategy defined by Viva Energy admin team)\n\n|CON-CS-003\n|Contact migration must complete before Mobile App cutover (no parallel run of D365 CE and Salesforce)\n\n|CON-CS-004\n|Big bang cutover only (no phased rollout with feature flags or pilot users)\n\n|CON-CS-005\n|Salesforce API rate limits and authentication method constrained by Viva Energy Salesforce configuration (TBD)\n\n|CON-CS-006\n|Event Bus implementation must use existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis - cannot introduce new infrastructure components)\n\n|CON-CS-007\n|Mobile App feedback form must include specific fields: Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message (no attachments)\n\n|CON-CS-008\n|D365 Customer Engagement must be decommissioned within 90 days post-cutover (ADR-CS-006)\n\n|CON-CS-009\n|ProfileService and EngagementService must be stateless (no local aggregate persistence, Salesforce is System of Record)\n\n|CON-CS-010\n|First DDD bounded context implementation (team learning curve, architectural patterns must be documented for future bounded contexts)\n\n|===","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture\n\n=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures\n\n=== Migration Strategy\n\n==== Migration Phases\n\n*Phase 1: Build & Test (Weeks 1-8)*\n\n* Build ProfileService microservice (JIT Contact reconciliation API)\n* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n* UAT with test Salesforce sandbox environment\n\n*Phase 2: Contact Migration (Week 9)*\n\n* Execute Contact migration (app database → Salesforce production)\n* Validation: 100% data integrity check (email/phone/VCI matching)\n* Reconciliation report: New Contacts created vs existing Contacts updated\n* Freeze app database Contact updates during migration window\n* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n\n*Phase 3: Cutover (Week 10)*\n\n* Deploy ProfileService to production\n* Deploy EngagementService to production\n* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n* Configure Salesforce webhook (Case update notifications → EngagementService)\n* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n* **Go/No-Go decision**: Validate success criteria before final cutover\n\n*Phase 4: D365 CE Retirement (Weeks 11-22)*\n\n* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n* D365 CE read-only access (historical Case lookups if needed)\n* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n* Archive D365 CE data for compliance/auditing\n\n==== Migration Dependencies\n\n[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n|===\n|Dependency |Owner/Status\n\n|*Salesforce production access*\n|Viva Energy Salesforce admin team - TBD\n\n|*Salesforce Case field mapping*\n|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n\n|*Salesforce data isolation strategy*\n|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n\n|*Salesforce webhook configuration*\n|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n\n|*Event Bus infrastructure*\n|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Braze integration*\n|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n\n|*Mobile App release window*\n|OTR Mobile team - Coordinate cutover timing with app release schedule\n\n|*App database access*\n|OTR Platform team - Read access for Contact migration\n\n|===\n\n==== Migration Validation Criteria\n\n*Contact Migration Validation:*\n\n* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n\n*Cutover Validation:*\n\n* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n* ✅ Braze push notifications delivered for Case creation and Case resolution\n* ✅ Event Bus queue depth within normal range (no backlog)\n* ✅ Dead letter queue empty (no failed Case creations)\n* ✅ Salesforce API rate limits not exceeded\n\n*Production Monitoring (30 days):*\n\n* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n* ✅ Support agents confirm unified customer view across all channels\n* ✅ Zero critical incidents (P1 outages, data loss)\n\n==== Rollback Plan\n\n*Rollback Trigger:*\n\n* Feedback submission success rate < 95% (below acceptable threshold)\n* Data loss or corruption detected in Salesforce\n* Salesforce API rate limits exceeded (Cases not created within SLA)\n* Critical bug blocking customer feedback submission\n\n*Rollback Procedure:*\n\n1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n3. **Re-enable D365 CE** for customer feedback submission\n4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n5. **Fix and re-test** in sandbox environment\n6. **Retry cutover** when issues resolved\n\n*Rollback Limitations:*\n\n* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n* Contacts migrated to Salesforce remain (no rollback to app database)\n* Rollback only affects Mobile App integration (not data migration)\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]\n|===\n|ID |Risk |Impact |Likelihood |Mitigation\n\n|RISK-CS-001\n|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created\n|HIGH (customers don't receive Case confirmation, support tickets lost)\n|MEDIUM (volume unknown, rate limits TBD)\n|• Gather expected feedback volume data before cutover +\n• Implement Event Bus queue throttling/rate limiting +\n• Monitor queue depth and API usage +\n• Scale background workers based on queue depth +\n• Alert ops team when approaching rate limits\n\n|RISK-CS-002\n|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation\n|MEDIUM (Cases delayed but queued, customers wait for confirmation)\n|LOW (Salesforce SLA 99.9% uptime)\n|• Async Case creation with retry logic +\n• Event Bus queues buffer work during outage +\n• Customers get immediate \"Feedback submitted\" (not blocked) +\n• Monitor Salesforce status page, alert ops team +\n• Automatic retry when Salesforce recovers\n\n|RISK-CS-003\n|*Contact migration data quality issues*: App database Contact data incomplete or invalid\n|HIGH (migration fails validation, cutover delayed)\n|MEDIUM (legacy data quality unknown)\n|• Pre-migration data quality assessment +\n• Flexible upsert logic (match by email/phone/VCI) +\n• Validation report identifies data issues before production migration +\n• Manual cleanup for invalid records +\n• Dry-run migration in sandbox environment\n\n|RISK-CS-004\n|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts\n|MEDIUM (support agents see multiple profiles for same customer)\n|MEDIUM (email changes, data quality issues)\n|• Salesforce duplicate detection rules (if available) +\n• ProfileService logs Contact creation for audit trail +\n• Manual duplicate cleanup process (support team) +\n• Future enhancement: VCI as Salesforce External ID for stable matching\n\n|RISK-CS-005\n|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows\n|HIGH (customers don't receive Case confirmation, feedback lost)\n|LOW (retry logic handles most failures)\n|• Dead letter queue monitoring and alerting +\n• Ops team dashboard showing DLQ depth +\n• Manual intervention process (investigate and reprocess) +\n• Automated alerts when DLQ depth exceeds threshold +\n• Root cause analysis for recurring failures\n\n|RISK-CS-006\n|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService\n|MEDIUM (customers don't get push notifications for Case resolution)\n|LOW (webhook mechanism reliable)\n|• Webhook retry logic and exponential backoff +\n• EngagementService logs webhook deliveries +\n• Monitor webhook delivery success rate +\n• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +\n• Alert ops team when webhook delivery rate drops\n\n|RISK-CS-007\n|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams\n|HIGH (privacy violation, compliance risk)\n|LOW (Salesforce governance controls)\n|• Work with Viva Energy Salesforce admin team on data isolation strategy +\n• Test data visibility in Salesforce sandbox (UAT with different user roles) +\n• Validate Record Types, queues, field-level security before production +\n• Audit Salesforce user permissions and sharing rules\n\n|RISK-CS-008\n|*Mobile App release coordination*: App release delayed, cutover window missed\n|MEDIUM (cutover delayed, D365 CE retirement delayed)\n|MEDIUM (release schedule conflicts)\n|• Coordinate cutover timing with Mobile team early +\n• Buffer time in migration plan (2-week contingency) +\n• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +\n• Feature flag for feedback submission (enable when ready)\n\n|RISK-CS-009\n|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration\n|HIGH (Case creation blocked, domain events not published)\n|LOW (AWS SLA 99.99% uptime)\n|• Leverage existing AWS infrastructure (proven, reliable) +\n• Infrastructure as Code (IaC) for Event Bus configuration +\n• Integration testing in non-production environment +\n• Monitor Event Bus metrics (queue depth, throughput, errors) +\n• Alert ops team on Event Bus failures\n\n|RISK-CS-010\n|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture\n|MEDIUM (implementation delays, architectural inconsistencies)\n|HIGH (first DDD implementation)\n|• DDD training for development team (workshops, documentation) +\n• Architecture review sessions (validate bounded context design) +\n• Pair programming with experienced DDD practitioners +\n• Incremental implementation (start small, iterate) +\n• Document architectural patterns in CLAUDE.md\n\n|===\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n=== Constraints\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":1000,"oldLines":8,"newStart":1000,"newLines":80,"lines":[" "," === Assumptions"," ","+[width=\"100%\",cols=\"8%,92%\",options=\"header\",]","+|===","+|ID |Assumption","+","+|ASM-CS-001","+|Viva Energy Salesforce admin team will provide Salesforce production access, sandbox environment, and support for Case field mapping and data isolation configuration","+","+|ASM-CS-002","+|App database Contact data is sufficiently complete for migration (email/phone/VCI available for matching)","+","+|ASM-CS-003","+|Expected customer feedback volume is within Salesforce API rate limits (to be validated with feedback volume data)","+","+|ASM-CS-004","+|Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) is sufficient for Event Bus implementation (no additional infrastructure provisioning required)","+","+|ASM-CS-005","+|Braze integration already exists and can be extended for Case-related push notifications (no new Braze account or major configuration changes)","+","+|ASM-CS-006","+|Mobile App users have email addresses associated with their accounts (required for ProfileService Contact reconciliation)","+","+|ASM-CS-007","+|D365 Customer Engagement historical Cases have limited business value and do not require migration to Salesforce","+","+|ASM-CS-008","+|Support agents are trained on Salesforce Service Cloud and require minimal additional training for OTR digital customer Cases","+","+|ASM-CS-009","+|Salesforce Service Cloud shared instance has capacity for OTR digital customer Contacts and Cases (no additional licensing or storage costs)","+","+|ASM-CS-010","+|Mobile App release schedule can accommodate cutover timing (Week 10 in migration plan)","+","+|===","+"," === Constraints"," ","+[width=\"100%\",cols=\"8%,92%\",options=\"header\",]","+|===","+|ID |Constraint","+","+|CON-CS-001","+|Must use shared Viva Energy Salesforce Service Cloud instance (cannot deploy separate OTR-specific instance)","+","+|CON-CS-002","+|Must conform to existing Salesforce configuration and governance (Record Types, custom fields, queues, data isolation strategy defined by Viva Energy admin team)","+","+|CON-CS-003","+|Contact migration must complete before Mobile App cutover (no parallel run of D365 CE and Salesforce)","+","+|CON-CS-004","+|Big bang cutover only (no phased rollout with feature flags or pilot users)","+","+|CON-CS-005","+|Salesforce API rate limits and authentication method constrained by Viva Energy Salesforce configuration (TBD)","+","+|CON-CS-006","+|Event Bus implementation must use existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis - cannot introduce new infrastructure components)","+","+|CON-CS-007","+|Mobile App feedback form must include specific fields: Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message (no attachments)","+","+|CON-CS-008","+|D365 Customer Engagement must be decommissioned within 90 days post-cutover (ADR-CS-006)","+","+|CON-CS-009","+|ProfileService and EngagementService must be stateless (no local aggregate persistence, Salesforce is System of Record)","+","+|CON-CS-010","+|First DDD bounded context implementation (team learning curve, architectural patterns must be documented for future bounded contexts)","+","+|===","+"," == Non-Functional Requirements"," "," == Monitoring and Observability"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"cb6b81a0-8c12-4042-ba2d-b2471c5c920a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SjfgW3wZ6SFw9pzTwFND24","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Excellent. Now let me update the Monitoring and Observability section which is mentioned but not yet populated, and then mark the work as complete.","signature":"ErwCCkYICxgCKkAcCpaElDrtgD1qAxva8MSEQlApq5IyvgAMBQIpOkqZ1ImXZnl7qTovBGmPp+7WhVA0tJyewqZNtxGkYeYbCECVEgyiL0IAE9PsbwrcpzQaDP58QGTwoDMcf1kcryIwfA1iV46rBQcTbeV23/gh6TH/OUE4Rs0hYwxCz1vLHYxXju3Uzi/kXCXkkt3a1aaGKqMBqvTw6lpgePTO1dhd7SigS34eqAQdFLjRIsirjOtBoo1mlF53gUCGeyw+vQ+79eh975DMLuBKxa7YpujcRsZ0nvc/DXLWQgT0fkQoiajhheJMH913LH/NaS9Erq4zG/+5Bz/ETJWjxEa23IDY1HC2mpS5/J4Q6VzmHyaGsEr2vLm8IxJBG3FKw7qTrqaNMci4SktZQ9Lfbubz5seDexoPgn3vJBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":2183,"cache_read_input_tokens":86050,"cache_creation":{"ephemeral_5m_input_tokens":2183,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWsHVDkS2J1N1zcFgFLZq","type":"assistant","uuid":"79a760d9-40ee-4214-8608-39badb8d55b0","timestamp":"2026-01-07T03:11:16.674Z"}
{"parentUuid":"79a760d9-40ee-4214-8608-39badb8d55b0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SjfgW3wZ6SFw9pzTwFND24","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KEdLR6mALsfgKG6CfnGy1f","name":"Edit","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","old_string":"== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","new_string":"== Monitoring and Observability\n\n=== Key Metrics\n\n[width=\"100%\",cols=\"25%,40%,35%\",options=\"header\",]\n|===\n|Metric Category |Metric |Target/Threshold\n\n|*Feedback Submission*\n|Feedback submission success rate (Mobile App → EngagementService)\n|> 99.5%\n\n|*Async Case Creation*\n|Case creation success rate (EngagementService → Salesforce)\n|> 99%\n\n|*Async Case Creation*\n|Case creation latency (time from feedback submission to Case created in Salesforce)\n|p95 < 5 minutes\n\n|*Event Bus*\n|Event Bus queue depth (pending Case creations)\n|< 100 messages\n\n|*Event Bus*\n|Dead letter queue depth (failed Case creations)\n|= 0 (alert on any failures)\n\n|*Salesforce API*\n|Salesforce API error rate\n|< 1%\n\n|*Salesforce API*\n|Salesforce API latency (Case creation)\n|p95 < 2 seconds\n\n|*Salesforce API*\n|Salesforce API rate limit utilization\n|< 80% of limit\n\n|*ProfileService*\n|Contact reconciliation success rate (JIT lookups)\n|> 99.5%\n\n|*ProfileService*\n|Contact reconciliation latency\n|p95 < 500ms\n\n|*Braze Notifications*\n|Push notification delivery rate (Case created/updated)\n|> 95%\n\n|*Salesforce Webhook*\n|Webhook delivery success rate (Salesforce → EngagementService)\n|> 99%\n\n|*Customer Satisfaction*\n|Customer satisfaction score (CSAT)\n|> 4.0/5.0 (improve by 15% from D365 CE baseline)\n\n|*Support Operations*\n|Average case resolution time\n|Decrease by 20% from D365 CE baseline\n\n|===\n\n=== Alerting Thresholds\n\n[width=\"100%\",cols=\"25%,50%,25%\",options=\"header\",]\n|===\n|Alert |Condition |Severity\n\n|*Feedback submission failures*\n|Feedback submission success rate < 95% over 5-minute window\n|P1 - Critical\n\n|*Dead letter queue accumulation*\n|Dead letter queue depth > 0 (any failed Case creations)\n|P2 - High\n\n|*Event Bus queue backlog*\n|Event Bus queue depth > 100 messages for > 15 minutes\n|P2 - High\n\n|*Salesforce API errors*\n|Salesforce API error rate > 5% over 5-minute window\n|P1 - Critical\n\n|*Salesforce API rate limits*\n|Salesforce API rate limit utilization > 90%\n|P2 - High\n\n|*Contact reconciliation failures*\n|ProfileService Contact reconciliation failure rate > 5% over 5-minute window\n|P2 - High\n\n|*Braze notification failures*\n|Braze push notification delivery rate < 80% over 15-minute window\n|P3 - Medium\n\n|*Salesforce webhook failures*\n|Salesforce webhook delivery success rate < 90% over 15-minute window\n|P2 - High\n\n|*Case creation latency*\n|Case creation latency p95 > 10 minutes\n|P3 - Medium\n\n|===\n\n=== Dashboards\n\n*ProfileService Dashboard:*\n\n* Contact reconciliation success rate (JIT lookups)\n* Contact reconciliation latency (p50, p95, p99)\n* Contact creation vs update ratio (new Contacts created vs existing Contacts updated)\n* Salesforce API error rate (Contact queries and creates)\n* Request rate and throughput\n\n*EngagementService Dashboard:*\n\n* Feedback submission success rate\n* Case creation success rate (async workflow)\n* Case creation latency (p50, p95, p99)\n* Event Bus queue depth (pending Case creations)\n* Dead letter queue depth (failed Case creations)\n* Salesforce API error rate (Case creation)\n* Salesforce API latency\n* Salesforce API rate limit utilization\n* Braze push notification delivery rate\n* Salesforce webhook delivery success rate\n\n*Event Bus Dashboard:*\n\n* Queue depth (pending messages)\n* Throughput (messages published/consumed per minute)\n* Dead letter queue depth (failed messages)\n* Consumer lag (time between publish and consume)\n\n*Customer Support Dashboard (Business Metrics):*\n\n* Total feedback submissions per day/week/month\n* Feedback category breakdown (App, Service, Order, Rewards, Refund, Delete Account)\n* Customer satisfaction score (CSAT) trend\n* Average case resolution time trend\n* Case volume by support team/queue\n* Unified customer view adoption (support agent feedback)"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":2183,"cache_read_input_tokens":86050,"cache_creation":{"ephemeral_5m_input_tokens":2183,"ephemeral_1h_input_tokens":0},"output_tokens":1324,"service_tier":"standard"}},"requestId":"req_011CWsHVDkS2J1N1zcFgFLZq","type":"assistant","uuid":"97295e37-83a0-4964-b930-6b7692b49acd","timestamp":"2026-01-07T03:11:40.207Z"}
{"parentUuid":"97295e37-83a0-4964-b930-6b7692b49acd","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KEdLR6mALsfgKG6CfnGy1f","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1075→|===\n  1076→\n  1077→== Non-Functional Requirements\n  1078→\n  1079→== Monitoring and Observability\n  1080→\n  1081→=== Key Metrics\n  1082→\n  1083→[width=\"100%\",cols=\"25%,40%,35%\",options=\"header\",]\n  1084→|===\n  1085→|Metric Category |Metric |Target/Threshold\n  1086→\n  1087→|*Feedback Submission*\n  1088→|Feedback submission success rate (Mobile App → EngagementService)\n  1089→|> 99.5%\n  1090→\n  1091→|*Async Case Creation*\n  1092→|Case creation success rate (EngagementService → Salesforce)\n  1093→|> 99%\n  1094→\n  1095→|*Async Case Creation*\n  1096→|Case creation latency (time from feedback submission to Case created in Salesforce)\n  1097→|p95 < 5 minutes\n  1098→\n  1099→|*Event Bus*\n  1100→|Event Bus queue depth (pending Case creations)\n  1101→|< 100 messages\n  1102→\n  1103→|*Event Bus*\n  1104→|Dead letter queue depth (failed Case creations)\n  1105→|= 0 (alert on any failures)\n  1106→\n  1107→|*Salesforce API*\n  1108→|Salesforce API error rate\n  1109→|< 1%\n  1110→\n  1111→|*Salesforce API*\n  1112→|Salesforce API latency (Case creation)\n  1113→|p95 < 2 seconds\n  1114→\n  1115→|*Salesforce API*\n  1116→|Salesforce API rate limit utilization\n  1117→|< 80% of limit\n  1118→\n  1119→|*ProfileService*\n  1120→|Contact reconciliation success rate (JIT lookups)\n  1121→|> 99.5%\n  1122→\n  1123→|*ProfileService*\n  1124→|Contact reconciliation latency\n  1125→|p95 < 500ms\n  1126→\n  1127→|*Braze Notifications*\n  1128→|Push notification delivery rate (Case created/updated)\n  1129→|> 95%\n  1130→\n  1131→|*Salesforce Webhook*\n  1132→|Webhook delivery success rate (Salesforce → EngagementService)\n  1133→|> 99%\n  1134→\n  1135→|*Customer Satisfaction*\n  1136→|Customer satisfaction score (CSAT)\n  1137→|> 4.0/5.0 (improve by 15% from D365 CE baseline)\n  1138→\n  1139→|*Support Operations*\n  1140→|Average case resolution time\n  1141→|Decrease by 20% from D365 CE baseline\n  1142→\n  1143→|===\n  1144→\n  1145→=== Alerting Thresholds\n  1146→\n  1147→[width=\"100%\",cols=\"25%,50%,25%\",options=\"header\",]\n  1148→|===\n  1149→|Alert |Condition |Severity\n  1150→\n  1151→|*Feedback submission failures*\n  1152→|Feedback submission success rate < 95% over 5-minute window\n  1153→|P1 - Critical\n  1154→\n  1155→|*Dead letter queue accumulation*\n  1156→|Dead letter queue depth > 0 (any failed Case creations)\n  1157→|P2 - High\n  1158→\n  1159→|*Event Bus queue backlog*\n  1160→|Event Bus queue depth > 100 messages for > 15 minutes\n  1161→|P2 - High\n  1162→\n  1163→|*Salesforce API errors*\n  1164→|Salesforce API error rate > 5% over 5-minute window\n  1165→|P1 - Critical\n  1166→\n  1167→|*Salesforce API rate limits*\n  1168→|Salesforce API rate limit utilization > 90%\n  1169→|P2 - High\n  1170→\n  1171→|*Contact reconciliation failures*\n  1172→|ProfileService Contact reconciliation failure rate > 5% over 5-minute window\n  1173→|P2 - High\n  1174→\n  1175→|*Braze notification failures*\n  1176→|Braze push notification delivery rate < 80% over 15-minute window\n  1177→|P3 - Medium\n  1178→\n  1179→|*Salesforce webhook failures*\n  1180→|Salesforce webhook delivery success rate < 90% over 15-minute window\n  1181→|P2 - High\n  1182→\n  1183→|*Case creation latency*\n  1184→|Case creation latency p95 > 10 minutes\n  1185→|P3 - Medium\n  1186→\n  1187→|===\n  1188→\n  1189→=== Dashboards\n  1190→\n  1191→*ProfileService Dashboard:*\n  1192→\n  1193→* Contact reconciliation success rate (JIT lookups)\n  1194→* Contact reconciliation latency (p50, p95, p99)\n  1195→* Contact creation vs update ratio (new Contacts created vs existing Contacts updated)\n  1196→* Salesforce API error rate (Contact queries and creates)\n  1197→* Request rate and throughput\n  1198→\n  1199→*EngagementService Dashboard:*\n  1200→\n  1201→* Feedback submission success rate\n  1202→* Case creation success rate (async workflow)\n  1203→* Case creation latency (p50, p95, p99)\n  1204→* Event Bus queue depth (pending Case creations)\n  1205→* Dead letter queue depth (failed Case creations)\n  1206→* Salesforce API error rate (Case creation)\n  1207→* Salesforce API latency\n  1208→* Salesforce API rate limit utilization\n  1209→* Braze push notification delivery rate\n  1210→* Salesforce webhook delivery success rate\n  1211→\n  1212→*Event Bus Dashboard:*\n  1213→\n  1214→* Queue depth (pending messages)\n  1215→* Throughput (messages published/consumed per minute)\n  1216→* Dead letter queue depth (failed messages)\n  1217→* Consumer lag (time between publish and consume)\n  1218→\n  1219→*Customer Support Dashboard (Business Metrics):*\n  1220→\n  1221→* Total feedback submissions per day/week/month\n  1222→* Feedback category breakdown (App, Service, Order, Rewards, Refund, Delete Account)\n  1223→* Customer satisfaction score (CSAT) trend\n  1224→* Average case resolution time trend\n  1225→* Case volume by support team/queue\n  1226→* Unified customer view adoption (support agent feedback)"}]},"uuid":"57e1a1ca-2138-4397-8c97-a0e5487469bf","timestamp":"2026-01-07T03:11:40.836Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/architecture_definitions/salesforce_customer_support.adoc","oldString":"== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","newString":"== Monitoring and Observability\n\n=== Key Metrics\n\n[width=\"100%\",cols=\"25%,40%,35%\",options=\"header\",]\n|===\n|Metric Category |Metric |Target/Threshold\n\n|*Feedback Submission*\n|Feedback submission success rate (Mobile App → EngagementService)\n|> 99.5%\n\n|*Async Case Creation*\n|Case creation success rate (EngagementService → Salesforce)\n|> 99%\n\n|*Async Case Creation*\n|Case creation latency (time from feedback submission to Case created in Salesforce)\n|p95 < 5 minutes\n\n|*Event Bus*\n|Event Bus queue depth (pending Case creations)\n|< 100 messages\n\n|*Event Bus*\n|Dead letter queue depth (failed Case creations)\n|= 0 (alert on any failures)\n\n|*Salesforce API*\n|Salesforce API error rate\n|< 1%\n\n|*Salesforce API*\n|Salesforce API latency (Case creation)\n|p95 < 2 seconds\n\n|*Salesforce API*\n|Salesforce API rate limit utilization\n|< 80% of limit\n\n|*ProfileService*\n|Contact reconciliation success rate (JIT lookups)\n|> 99.5%\n\n|*ProfileService*\n|Contact reconciliation latency\n|p95 < 500ms\n\n|*Braze Notifications*\n|Push notification delivery rate (Case created/updated)\n|> 95%\n\n|*Salesforce Webhook*\n|Webhook delivery success rate (Salesforce → EngagementService)\n|> 99%\n\n|*Customer Satisfaction*\n|Customer satisfaction score (CSAT)\n|> 4.0/5.0 (improve by 15% from D365 CE baseline)\n\n|*Support Operations*\n|Average case resolution time\n|Decrease by 20% from D365 CE baseline\n\n|===\n\n=== Alerting Thresholds\n\n[width=\"100%\",cols=\"25%,50%,25%\",options=\"header\",]\n|===\n|Alert |Condition |Severity\n\n|*Feedback submission failures*\n|Feedback submission success rate < 95% over 5-minute window\n|P1 - Critical\n\n|*Dead letter queue accumulation*\n|Dead letter queue depth > 0 (any failed Case creations)\n|P2 - High\n\n|*Event Bus queue backlog*\n|Event Bus queue depth > 100 messages for > 15 minutes\n|P2 - High\n\n|*Salesforce API errors*\n|Salesforce API error rate > 5% over 5-minute window\n|P1 - Critical\n\n|*Salesforce API rate limits*\n|Salesforce API rate limit utilization > 90%\n|P2 - High\n\n|*Contact reconciliation failures*\n|ProfileService Contact reconciliation failure rate > 5% over 5-minute window\n|P2 - High\n\n|*Braze notification failures*\n|Braze push notification delivery rate < 80% over 15-minute window\n|P3 - Medium\n\n|*Salesforce webhook failures*\n|Salesforce webhook delivery success rate < 90% over 15-minute window\n|P2 - High\n\n|*Case creation latency*\n|Case creation latency p95 > 10 minutes\n|P3 - Medium\n\n|===\n\n=== Dashboards\n\n*ProfileService Dashboard:*\n\n* Contact reconciliation success rate (JIT lookups)\n* Contact reconciliation latency (p50, p95, p99)\n* Contact creation vs update ratio (new Contacts created vs existing Contacts updated)\n* Salesforce API error rate (Contact queries and creates)\n* Request rate and throughput\n\n*EngagementService Dashboard:*\n\n* Feedback submission success rate\n* Case creation success rate (async workflow)\n* Case creation latency (p50, p95, p99)\n* Event Bus queue depth (pending Case creations)\n* Dead letter queue depth (failed Case creations)\n* Salesforce API error rate (Case creation)\n* Salesforce API latency\n* Salesforce API rate limit utilization\n* Braze push notification delivery rate\n* Salesforce webhook delivery success rate\n\n*Event Bus Dashboard:*\n\n* Queue depth (pending messages)\n* Throughput (messages published/consumed per minute)\n* Dead letter queue depth (failed messages)\n* Consumer lag (time between publish and consume)\n\n*Customer Support Dashboard (Business Metrics):*\n\n* Total feedback submissions per day/week/month\n* Feedback category breakdown (App, Service, Order, Rewards, Refund, Delete Account)\n* Customer satisfaction score (CSAT) trend\n* Average case resolution time trend\n* Case volume by support team/queue\n* Unified customer view adoption (support agent feedback)","originalFile":"= Salesforce Customer Support\n:project-name: Salesforce Customer Support\n:togaf-adm-phase: Phase C: Information Systems Architectures\n:last-updated: 2026-01-07\n:document-type: Architecture Definition Document\n:status: Discovery\n:version: 0.1\n:programme-lead:\n:domain-architect: O.Young@otr.com.au\n:doctype: article\n:toc: left\n:toclevels: 4\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n:description:\n:keywords:\n\n== Introduction & Vision\n\n=== Purpose\n\nOTR digital customers currently submit feedback and support requests through D365 Customer Engagement, while Viva Energy's broader business units use Salesforce Service Cloud. This fragmentation prevents support agents from having a unified view of customer interactions and creates operational inefficiency.\n\nThis architecture definition documents the **first implementation of OTR's target Domain-Driven Design (DDD) architecture** by establishing two new bounded contexts (ProfileService and EngagementService), consolidating customer support onto Salesforce Service Cloud, and implementing event-driven integration patterns that will serve as the foundation for future bounded contexts (including Flybuys integration).\n\n=== Vision\n\n> Unify customer support across all Viva Energy channels by consolidating OTR digital customer feedback onto Salesforce Service Cloud, establishing the foundational DDD architecture with ProfileService and EngagementService bounded contexts that protect digital channels from external system changes while enabling support agents to deliver exceptional customer experiences with complete interaction history.\n\n=== Architectural Approach\n\nThis architecture establishes OTR's **first bounded context implementation** using Domain-Driven Design strategic patterns:\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW bounded context): Just-In-Time Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to digital channels - foundation for future Flybuys partner linking\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW bounded context): Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing via Event Bus\n* *Event-driven integration* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation establishing pattern for future bounded contexts\n* *Anti-Corruption Layer*: EngagementService isolates digital channels from Salesforce API changes, translates between OTR domain language and Salesforce Service Cloud API\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration (shared Viva Energy instance, multi-tenant governance)\n* *Big bang cutover*: Single deployment after Contact migration, no phased rollout, D365 CE retirement post-cutover\n\n=== Scope\n\n==== In Scope\n\n- Solution Building Blocks (SBBs) - specific technology products and versions\n- Interface specifications (APIs, events, data formats)\n- Data architecture and schema specifications\n- Deployment architecture and infrastructure configuration\n- Transition architecture with phased implementation states\n- Technical validation criteria and testing approach\n- External system integration specifications\n\n=== Out Of Scope (covered in Architecture Definition):\n- Business requirements and stakeholder analysis\n- Architecture decisions and rationale (ADRs)\n- Bounded context definitions and responsibilities\n- High-level integration patterns (ACL, Conformist, OHS+PL)\n- Business capability mapping and value streams\n- Non-functional requirements (referenced, not duplicated)\n- Architecture principles and governance\n\n=== Architecture Overview\n\n[mermaid]\n----\n---\nconfig:\n  layout: elk\n---\nflowchart TB\n    Customer([\"Customer\"]) -- Uses --> MobileApp[\"Mobile App<br>iOS/Android\"]\n    Customer -- Shops at --> POS[\"OTR/OTR+ POS<br>D365 Commerce\"]\n    MobileApp -- Authenticate --> EntraID[\"Microsoft Entra\"]\n    MobileApp -- Identifies & Reconciles --> ProfileService[\"ProfileService\"]\n    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce[\"Salesforce\"]\n    ProfileService -- On Create --> EventBus[\"EventBus\"]\n    EventBus -- Emits CreateUser Event --> LoyaltyService[\"LoyaltyService\"] & EngagementService[\"EngagementService\"]\n    LoyaltyService -- Reconcile Wallet --> EagleEye[\"EagleEye\"]\n    EngagementService -- Reconcile Braze Profile --> Braze[\"Braze\"]\n    EngagementService --> Salesforce\n    D365CE[\"D365CE\"] -- Data Migration --> Salesforce\n    MobileApp -- Submits Feedback --> EngagementService\n\n    Customer:::customer\n    MobileApp:::presentation\n    POS:::presentation\n    EntraID:::external\n    ProfileService:::newService\n    Salesforce:::external\n    EventBus:::infrastructure\n    LoyaltyService:::newService\n    EngagementService:::newService\n    EagleEye:::external\n    Braze:::external\n    D365CE:::external\n    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff\n    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff\n    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff\n    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff\n----\n\n\n==== Key Architectural Patterns\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Pattern |Application |Rationale\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud\n|Protects digital channels (Mobile App, Web) from Salesforce API changes, translates between OTR domain language and Salesforce Case/Contact model, enables independent evolution of internal domain model\n\n|*Conformist*\n|ProfileService → Salesforce, EngagementService → Salesforce\n|Shared Viva Energy Salesforce instance - we conform to existing configuration, governance, and API contracts (external system we don't control)\n\n|*Backend-for-Frontend (BFF)*\n|EngagementService\n|Aggregates customer feedback submission, Contact lookup, async Case creation, and Braze notification orchestration for digital channel clients\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus (SNS+SQS/EventBridge/Kinesis)\n|Loose coupling between bounded contexts, async domain event publishing (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`), foundation for future bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation\n|Reconcile app users as Salesforce Contacts on-demand (upsert by email), no pre-sync required, ensures Salesforce has current Contact data\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus\n|Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for operations team intervention\n\n|*Strangler Fig*\n|Not applicable\n|Big bang cutover (no gradual migration) - D365 CE fully replaced, not incrementally strangled\n\n|===\n\n== Executive Summary\n\n=== Challenge\n\nOTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:\n\n* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels\n* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs\n* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times\n* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform\n\n=== Solution\n\nThis architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:\n\n==== New Bounded Contexts\n\n* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App\n* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus\n* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern\n\n==== Integration Architecture\n\n* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data\n* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts\n* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases\n* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates\n\n==== Migration Approach\n\n* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)\n* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)\n* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run\n* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover\n\n=== Key Architectural Significance\n\nThis migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:\n\n* First bounded contexts implemented (ProfileService, EngagementService)\n* First event-driven domain event pattern (foundation for future bounded contexts)\n* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)\n* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services\n\n=== Success Criteria\n\n* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch\n* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)\n* D365 Customer Engagement decommissioned within 90 days post-cutover\n* Customer satisfaction score improves by 15% within 6 months\n* Average case resolution time decreases by 20% within 6 months\n* Zero data loss during Contact migration (100% validation pass rate)\n* Mobile App feedback submission success rate > 99.5% (including async Case creation)\n\n=== Technical Constraints\n\n* Shared Salesforce instance (Viva Energy multi-tenant environment)\n* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)\n* Contact migration must complete before cutover (no parallel run)\n* Async Case creation mandatory (non-blocking user experience)\n\n=== Open Technical Decisions (TBD)\n\n* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)\n* Salesforce data isolation strategy (Record Types, custom fields, queues)\n* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)\n* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)\n* Retry policy configuration (attempts, backoff intervals)\n* Expected feedback volume and Salesforce API rate limit strategy\n\n== Technical Requirements\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Description\n\n|TR-CS-001\n|Every Mobile App user must have a Salesforce Contact record in Salesforce Service Cloud (shared Viva Energy instance)\n\n|TR-CS-002\n|ProfileService must reconcile Mobile App users as Salesforce Contacts using Just-In-Time (JIT) upsert by email address\n\n|TR-CS-003\n|ProfileService must return Salesforce Contact ID to Mobile App for feedback submission\n\n|TR-CS-004\n|Mobile App must support customer feedback submission with fields: Category (App, Service, Order, Rewards, Refund, Delete Account), Store Name, Time of Visit, Contact Phone Number, Free Text Message\n\n|TR-CS-005\n|EngagementService must create Salesforce Cases asynchronously via Event Bus (non-blocking user experience)\n\n|TR-CS-006\n|EngagementService must acknowledge feedback submission immediately to Mobile App user (\"Feedback submitted\" confirmation)\n\n|TR-CS-007\n|EngagementService must send push notification to customer via Braze when Case is successfully created in Salesforce\n\n|TR-CS-008\n|EngagementService must retry failed Case creation with configurable exponential backoff and dead letter queue for operations team intervention\n\n|TR-CS-009\n|Salesforce must be the System of Record for Contact and Case data (no local persistence in ProfileService or EngagementService)\n\n|TR-CS-010\n|Contact migration from app-specific database to Salesforce must complete before Mobile App cutover (upsert with flexible matching by email/phone/VCI)\n\n|TR-CS-011\n|No Case migration from D365 Customer Engagement to Salesforce (fresh start, historical Cases not migrated)\n\n|TR-CS-012\n|EngagementService must publish domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) to Event Bus for consumption by other bounded contexts\n\n|TR-CS-013\n|EngagementService must receive Salesforce webhook notifications when Cases are updated/resolved by support agents\n\n|TR-CS-014\n|EngagementService must trigger Braze push notifications to customers when Cases are updated/resolved (via Salesforce webhook → EngagementService → Braze)\n\n|TR-CS-015\n|ProfileService and EngagementService must conform to existing Salesforce configuration and API contracts (Conformist pattern)\n\n|TR-CS-016\n|All changes must be communicated using event-driven architecture via Event Bus (using existing AWS infrastructure: SNS+SQS/EventBridge/Kinesis)\n\n|TR-CS-017\n|Mobile App feedback submission success rate must exceed 99.5% (including async Case creation completion)\n\n|TR-CS-018\n|Contact migration must achieve 100% validation pass rate (zero data loss)\n\n|TR-CS-019\n|D365 Customer Engagement must be fully decommissioned within 90 days post-cutover\n\n|===\n\n== Technical Architecture\n\n=== Technical Capability Requirements\n\n==== Requirements Traceability\n\n=== Service Catalogues\n\n==== Application Portfolio Catalogue\n\n==== Technology Capability Requirements\n\n==== Feature Flag Register\n\n==== Data Entity Catalogue\n\n=== Baseline Architecture\n\n==== Existing System Components\n\n[width=\"100%\",cols=\"25%,35%,40%\",options=\"header\",]\n|===\n|Component |Current State |Status\n\n|*D365 Customer Engagement*\n|Customer support platform for OTR digital customers (Mobile App, Web), handles feedback submission and case management\n|**DEPRECATED** - Being replaced by Salesforce Service Cloud\n\n|*App-Specific Customer Database*\n|Stores customer contact data for Mobile App users, separate from Viva Energy systems\n|**MIGRATING** - One-time migration to Salesforce, then deprecated\n\n|*Mobile App*\n|iOS/Android native apps with feedback submission form (free text only, no category selection currently)\n|**REQUIRES UPDATE** - Add feedback form fields (Category, Store Name, Time of Visit, Contact Phone Number), integrate with ProfileService and EngagementService APIs\n\n|*Salesforce Service Cloud*\n|Shared Viva Energy instance handling customer support for fuel wholesale, Shell Card customers, other retail channels\n|**EXPANDING** - Adding OTR digital customer support Cases and Contacts\n\n|*Existing AWS Infrastructure*\n|SNS+SQS / EventBridge / Kinesis available for event-driven architecture\n|**REUSING** - Event Bus implementation leverages existing infrastructure\n\n|===\n\n==== Integration Architecture\n\n*Current state:*\n\n* Mobile App → D365 Customer Engagement (direct integration)\n* App-specific customer database → standalone (no Salesforce integration)\n* No event-driven architecture (synchronous, tightly coupled)\n* No Anti-Corruption Layer protecting digital channels\n* Viva Energy support teams use Salesforce, OTR digital support uses D365 CE (fragmented)\n\n==== Technical Debt\n\n*No longer relevant* - D365 CE being deprecated, not documenting technical debt of system being retired.\n\n*New technical debt introduced by this migration:*\n\n* Salesforce field mapping TBD (requires coordination with Viva Energy Salesforce admin team)\n* Data isolation strategy TBD (Record Types, custom fields, queues - multi-tenant governance)\n* Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* Expected feedback volume unknown (gathering data for rate limit planning)\n\n=== Gap Analysis\n\n==== Missing Capabilities\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Missing Capability |Description\n\n|*ProfileService bounded context*\n|No existing service for Contact reconciliation with Salesforce - requires new microservice implementing JIT upsert by email, returning Salesforce Contact ID\n\n|*EngagementService bounded context*\n|No existing service for customer feedback facade - requires new microservice implementing Anti-Corruption Layer for Salesforce Case creation, Braze integration, async processing via Event Bus\n\n|*Event Bus domain event pattern*\n|No existing domain event publishing infrastructure - requires implementing event-driven architecture pattern using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Async Case creation workflow*\n|Current D365 CE integration is synchronous - requires implementing async processing with retry logic, exponential backoff, dead letter queue\n\n|*Salesforce webhook integration*\n|No existing capability to receive Salesforce notifications - requires implementing webhook receiver in EngagementService for Case update notifications\n\n|*Braze push notification orchestration*\n|No existing integration for Case-related push notifications - requires implementing Braze campaign triggers from EngagementService\n\n|*Contact migration tooling*\n|No existing tooling for app database → Salesforce Contact migration with upsert logic (match by email/phone/VCI)\n\n|*Feedback form enhancements*\n|Mobile App feedback form lacks structured fields (Category, Store Name, Time of Visit, Contact Phone Number) - requires UI updates\n\n|===\n\n==== Missing Bounded Contexts\n\n[width=\"100%\",cols=\"30%,30%,40%\",options=\"header\",]\n|===\n|Bounded Context |Responsibilities |Implementation Status\n\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID to digital channels, foundation for future Flybuys partner linking\n|**NEW** - First bounded context implementation\n\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, Anti-Corruption Layer for Salesforce Case creation, Braze integration for push notifications, async Case processing, webhook receiver for Case updates\n|**NEW** - First bounded context implementation\n\n|===\n\n==== Missing Integration Patterns\n\n[width=\"100%\",cols=\"30%,70%\",options=\"header\",]\n|===\n|Integration Pattern |Description\n\n|*Anti-Corruption Layer (ACL)*\n|EngagementService → Salesforce Service Cloud - protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce\n\n|*Conformist*\n|ProfileService/EngagementService → Salesforce - conform to existing Salesforce configuration and API contracts (shared Viva Energy instance)\n\n|*Event-Driven Architecture (OHS+PL)*\n|Event Bus publishing domain events (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`) for loose coupling between bounded contexts\n\n|*Just-In-Time (JIT) Integration*\n|ProfileService → Salesforce Contact reconciliation on-demand (no pre-sync)\n\n|*Async Processing*\n|EngagementService Case creation via Event Bus with retry, exponential backoff, dead letter queue\n\n|===\n\n=== Target State Architecture\n\n==== Architectural Building Blocks (ABB)\n\n[width=\"100%\",cols=\"20%,25%,30%,25%\",options=\"header\",]\n|===\n|ABB ID |Bounded Context |Responsibilities |Technology (TBD in Solution Architecture)\n\n|ABB-CS-001\n|*link:../bounded_context/profile.adoc[ProfileService]*\n|JIT Contact reconciliation with Salesforce (upsert by email), return Salesforce Contact ID, foundation for Flybuys partner linking\n|Microservice (.NET/Node.js), REST API, Salesforce REST API client\n\n|ABB-CS-002\n|*link:../bounded_context/engagement.adoc[EngagementService]*\n|Customer feedback submission facade, ACL for Salesforce Case creation, Braze integration, async processing, webhook receiver\n|Microservice (.NET/Node.js), REST API, Event Bus publisher/subscriber, Salesforce webhook receiver\n\n|ABB-CS-003\n|*Event Bus*\n|Domain event publishing infrastructure (`SupportCaseCreated`, `SupportCaseUpdated`, `CustomerFeedbackSubmitted`)\n|AWS SNS+SQS / EventBridge / Kinesis\n\n|ABB-CS-004\n|*Salesforce Service Cloud*\n|System of Record for Contact and Case data (shared Viva Energy instance)\n|Salesforce Service Cloud (external SaaS)\n\n|ABB-CS-005\n|*Braze*\n|Marketing automation platform for push notifications\n|Braze (external SaaS) - existing integration\n\n|ABB-CS-006\n|*Mobile App*\n|iOS/Android native apps with enhanced feedback form (Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message)\n|Kotlin Multiplatform, SwiftUI, Jetpack Compose\n\n|ABB-CS-007\n|*Contact Migration Tool*\n|One-time migration app database → Salesforce with upsert logic (match by email/phone/VCI)\n|Script/tool (.NET/Python/Node.js)\n\n|===\n\n==== Integration Architecture\n\n===== Integration Flows\n\n*Customer Feedback Submission (Async):*\n\n1. *Mobile App* → ProfileService: Authenticate user, get Salesforce Contact ID (JIT reconciliation)\n2. *Mobile App* → EngagementService: Submit feedback (POST /feedback with Contact ID, Category, Store Name, Time of Visit, Phone, Message)\n3. *EngagementService* → Mobile App: Immediate acknowledgment (\"Feedback submitted\")\n4. *EngagementService* → Event Bus: Publish work item for async Case creation\n5. *Background Worker* (EngagementService) → Salesforce: Create Case via REST API\n6. *Success*: EngagementService → Event Bus: Publish `SupportCaseCreated` event\n7. *EngagementService* → Braze: Trigger push notification campaign (\"Your feedback has been received, Case #12345\")\n8. *Failure*: Retry with exponential backoff → Dead Letter Queue → Ops team alert\n\n*Case Update Notification (Bidirectional):*\n\n1. *Support Agent* updates/resolves Case in Salesforce\n2. *Salesforce* → EngagementService: Webhook notification (Case updated)\n3. *EngagementService* → Event Bus: Publish `SupportCaseUpdated` or `SupportCaseResolved` event\n4. *EngagementService* → Braze: Trigger push notification campaign (\"Your case has been resolved\")\n\n*Contact Reconciliation (JIT):*\n\n1. *Mobile App user* authenticates\n2. *Mobile App* → ProfileService: GET /profile/contact-id\n3. *ProfileService* → Salesforce: Query Contact by email\n4. *Match found*: Return existing Salesforce Contact ID\n5. *No match*: Create new Contact in Salesforce, return new Contact ID\n6. *ProfileService* → Mobile App: Return Salesforce Contact ID (cached by Mobile App)\n\n===== System of Record Boundaries\n\n[width=\"100%\",cols=\"30%,35%,35%\",options=\"header\",]\n|===\n|Data Entity |System of Record |Rationale\n\n|*Contact*\n|Salesforce Service Cloud\n|Shared Viva Energy instance, unified customer profile across all channels (digital, wholesale, Shell Card, retail)\n\n|*Case*\n|Salesforce Service Cloud\n|Support agents manage Cases in Salesforce, digital channels submit via EngagementService ACL\n\n|*Feedback Submission (transient)*\n|None (no persistence)\n|EngagementService processes feedback and creates Case in Salesforce, no local storage\n\n|*Domain Events*\n|Event Bus (ephemeral)\n|Events published to Event Bus, consumed by subscribers, not persisted long-term (event sourcing not in scope)\n\n|===\n\n==== Data Architecture Principles\n\n===== Aggregate Persistence\n\n*ProfileService:*\n\n* **No local aggregate persistence** - ProfileService is stateless, queries Salesforce on-demand\n* Salesforce Contact is the aggregate root (owned by Salesforce)\n* ProfileService acts as facade/translator, not system of record\n\n*EngagementService:*\n\n* **No local aggregate persistence** - EngagementService is stateless, creates Cases in Salesforce via ACL\n* Salesforce Case is the aggregate root (owned by Salesforce)\n* EngagementService maintains no local Case state (Conformist pattern - trust Salesforce as source of truth)\n* Async processing state managed via Event Bus (work items in queue, not database)\n\n===== Event Store\n\n* **Event Bus** (SNS+SQS/EventBridge/Kinesis) handles domain event publishing\n* Events are **ephemeral** (consumed and discarded, not persisted for event sourcing)\n* No Event Store implementation in this architecture (future enhancement if needed)\n* Event schema versioning TBD in Solution Architecture\n\n=== Architecture Decisions\n\n==== ADR-CS-001: Consolidate onto Salesforce Service Cloud (not build custom solution)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 Customer Engagement not working well for digital customer support\n* Viva Energy already uses Salesforce Service Cloud for fuel wholesale, Shell Card, other retail channels\n* Post-merger opportunity to consolidate onto single platform\n* Alternative: Build custom support platform or use different SaaS\n\n*Decision*:\n\nConsolidate OTR digital customer support onto Salesforce Service Cloud (shared Viva Energy instance).\n\n*Rationale*:\n\n* **Unified customer view**: Support agents see all interactions across channels (digital, wholesale, Shell Card, retail)\n* **Platform consolidation**: Single support platform reduces operational overhead and costs\n* **Proven solution**: Salesforce Service Cloud is established, feature-rich, well-supported\n* **Post-merger alignment**: Strategic decision to standardize on Viva Energy platforms\n* **Avoid custom development**: Building custom support platform would be costly and high-risk\n\n*Consequences*:\n\n* ✅ Unified customer support across Viva Energy Group\n* ✅ Reduced operational complexity (single platform vs two)\n* ✅ Leverage Salesforce capabilities (case routing, knowledge base, AI, omnichannel)\n* ⚠️ Conformist pattern required (shared instance, conform to existing configuration)\n* ⚠️ Multi-tenant governance needed (data isolation, security, queues)\n* ❌ Less control over platform evolution (SaaS vendor, shared instance)\n\n==== ADR-CS-002: Implement ProfileService and EngagementService as first DDD bounded contexts\n\n*Status*: Accepted\n\n*Context*:\n\n* OTR target architecture uses Domain-Driven Design with bounded contexts\n* This migration is opportunity to establish first implementation\n* Alternative: Direct Mobile App → Salesforce integration (no bounded contexts)\n* Alternative: Single monolithic service for all customer-facing APIs\n\n*Decision*:\n\nImplement ProfileService and EngagementService as separate bounded contexts following DDD strategic patterns.\n\n*Rationale*:\n\n* **Foundation for target architecture**: First implementation of DDD pattern for future bounded contexts (Flybuys, LocationService, PaymentService)\n* **Separation of concerns**: ProfileService handles identity/Contact reconciliation, EngagementService handles support/feedback (different responsibilities, different change rates)\n* **Anti-Corruption Layer**: EngagementService protects digital channels from Salesforce API changes\n* **Reusability**: ProfileService Contact reconciliation reused for Flybuys integration\n* **Event-driven architecture**: Establishes pattern for loose coupling between bounded contexts\n\n*Consequences*:\n\n* ✅ Establishes DDD architecture foundation for OTR\n* ✅ Reusable ProfileService for Flybuys and future integrations\n* ✅ Digital channels protected from Salesforce API changes (ACL)\n* ✅ Clear bounded context boundaries and responsibilities\n* ⚠️ Increased initial complexity (two new microservices vs direct integration)\n* ⚠️ Requires Event Bus infrastructure implementation\n* ⚠️ Team must learn DDD patterns and bounded context design\n\n==== ADR-CS-003: Async Case creation via Event Bus (not synchronous)\n\n*Status*: Accepted\n\n*Context*:\n\n* Current D365 CE integration is synchronous (user waits for Case creation)\n* Alternative: Keep synchronous integration (Mobile App → EngagementService → Salesforce synchronously)\n* Salesforce API may experience downtime or latency\n\n*Decision*:\n\nImplement async Case creation via Event Bus with immediate user acknowledgment, retry logic, exponential backoff, and dead letter queue.\n\n*Rationale*:\n\n* **Non-blocking user experience**: User gets immediate \"Feedback submitted\" confirmation, not waiting for Salesforce API\n* **Resilience**: If Salesforce is down, feedback still accepted, Case created when Salesforce recovers\n* **Retry logic**: Automatic retry with exponential backoff handles transient failures\n* **Operational visibility**: Dead letter queue alerts ops team to persistent failures\n* **Scalability**: Queue buffering handles traffic spikes\n\n*Consequences*:\n\n* ✅ Better user experience (no waiting for Salesforce API)\n* ✅ Resilient to Salesforce downtime (queue buffers work)\n* ✅ Automatic retry reduces manual intervention\n* ✅ Queue depth monitoring provides operational visibility\n* ⚠️ Eventual consistency (user gets success notification after Case created, not immediately)\n* ⚠️ Increased complexity (Event Bus, background workers, retry logic, DLQ)\n* ⚠️ Requires monitoring and alerting for DLQ\n\n==== ADR-CS-004: ProfileService uses email as primary matching key (not VCI)\n\n*Status*: Accepted\n\n*Context*:\n\n* ProfileService needs to reconcile Mobile App users as Salesforce Contacts\n* Alternative matching keys: VCI (Viva Consumer ID), email, phone, Salesforce External ID\n* Email changes are rare but possible\n\n*Decision*:\n\nUse email address as primary matching key for Contact reconciliation (JIT upsert by email).\n\n*Rationale*:\n\n* **Availability**: Email always available for authenticated users\n* **Uniqueness**: Email is unique identifier in Salesforce and Mobile App\n* **Salesforce standard**: Salesforce Contact uses email as standard lookup field\n* **Simplicity**: Single matching key simplifies upsert logic\n* **Edge case acceptable**: Email changes are rare, manual cleanup acceptable\n\n*Consequences*:\n\n* ✅ Simple upsert logic (query by email, create if not found)\n* ✅ Leverages Salesforce standard email field\n* ✅ Email always available from authentication\n* ⚠️ Email changes create duplicate Contacts (rare edge case, manual cleanup)\n* ⚠️ Future enhancement: Add VCI as Salesforce External ID for stable matching\n\n==== ADR-CS-005: No Case migration from D365 CE (fresh start)\n\n*Status*: Accepted\n\n*Context*:\n\n* D365 CE contains historical customer support Cases\n* Alternative: Migrate historical Cases to Salesforce (preserve support history)\n* Alternative: Archive D365 CE Cases separately (read-only access)\n\n*Decision*:\n\nDo not migrate historical Cases from D365 CE to Salesforce. Start fresh in Salesforce.\n\n*Rationale*:\n\n* **Limited value**: Historical D365 CE Cases not critical for future support\n* **Data quality**: D365 CE Case data may be inconsistent or incomplete\n* **Complexity**: Case migration requires mapping D365 CE schema to Salesforce, data transformation, validation\n* **Cost-benefit**: Migration effort outweighs value of historical data\n* **Archive option**: D365 CE Cases can be archived separately if needed (read-only access for auditing)\n\n*Consequences*:\n\n* ✅ Simpler migration (Contacts only, no Case migration)\n* ✅ Faster time to value (no Case migration delay)\n* ✅ Clean start in Salesforce (no legacy data quality issues)\n* ⚠️ Historical Cases not visible in Salesforce (support agents can't see old Cases)\n* ⚠️ D365 CE must remain accessible temporarily for historical Case lookups (if needed)\n* ❌ Loss of historical Case insights (reporting, analytics on old Cases)\n\n==== ADR-CS-006: Big bang cutover (not phased rollout)\n\n*Status*: Accepted\n\n*Context*:\n\n* Alternative: Phased rollout with feature flags (pilot users first, gradual enablement)\n* Alternative: Parallel run (submit to both D365 CE and Salesforce temporarily)\n* Flybuys integration uses phased rollout (AS-1, AS-2, AS-3 architecture states)\n\n*Decision*:\n\nBig bang cutover - migrate Contacts, deploy ProfileService and EngagementService, switch Mobile App, retire D365 CE.\n\n*Rationale*:\n\n* **Simplicity**: No parallel run complexity, no feature flag management\n* **Faster D365 CE retirement**: No extended transition period maintaining two systems\n* **Limited risk**: Customer support not mission-critical (not payment processing), rollback possible\n* **User base manageable**: OTR digital customers smaller than Flybuys integration scope\n* **Different use case**: Flybuys phased rollout manages points accrual complexity, support feedback is simpler\n\n*Consequences*:\n\n* ✅ Simpler deployment (single cutover, no AS-1/AS-2/AS-3 states)\n* ✅ Faster D365 CE retirement (no extended parallel run)\n* ✅ No feature flag complexity or pilot user management\n* ⚠️ Higher cutover risk (all users switch at once)\n* ⚠️ Requires comprehensive testing before cutover\n* ⚠️ Rollback plan required (revert to D365 CE if critical issues)\n\n==== ADR-CS-007: EngagementService receives Salesforce webhooks for Case updates\n\n*Status*: Accepted\n\n*Context*:\n\n* Support agents update/resolve Cases in Salesforce\n* Need to notify customers of Case status changes via push notifications\n* Alternative: Poll Salesforce API for Case updates (inefficient)\n* Alternative: No customer notifications (agents contact customers directly)\n\n*Decision*:\n\nSalesforce sends webhook notifications to EngagementService when Cases are updated/resolved. EngagementService triggers Braze push notifications.\n\n*Rationale*:\n\n* **Real-time notifications**: Customer notified immediately when agent resolves Case\n* **Efficient**: Webhook push model (not polling)\n* **Event-driven**: Aligns with event-driven architecture pattern\n* **Better customer experience**: Proactive notification vs waiting for agent contact\n\n*Consequences*:\n\n* ✅ Real-time customer notifications for Case updates\n* ✅ Efficient push model (no polling overhead)\n* ✅ Bidirectional integration (Mobile App → Salesforce → Mobile App)\n* ⚠️ Salesforce webhook mechanism TBD (Outbound Messages vs Platform Events vs Process Builder)\n* ⚠️ Webhook authentication and security required\n* ⚠️ EngagementService must handle webhook retries and failures\n\n=== Migration Strategy\n\n==== Migration Phases\n\n*Phase 1: Build & Test (Weeks 1-8)*\n\n* Build ProfileService microservice (JIT Contact reconciliation API)\n* Build EngagementService microservice (feedback submission API, ACL for Salesforce Case creation, Braze integration, webhook receiver)\n* Implement Event Bus infrastructure (SNS+SQS/EventBridge/Kinesis)\n* Develop Contact migration tool (app database → Salesforce upsert by email/phone/VCI)\n* Update Mobile App feedback form (add Category, Store Name, Time of Visit, Contact Phone Number fields)\n* Integration testing (ProfileService ↔ Salesforce, EngagementService ↔ Salesforce, EngagementService ↔ Braze)\n* UAT with test Salesforce sandbox environment\n\n*Phase 2: Contact Migration (Week 9)*\n\n* Execute Contact migration (app database → Salesforce production)\n* Validation: 100% data integrity check (email/phone/VCI matching)\n* Reconciliation report: New Contacts created vs existing Contacts updated\n* Freeze app database Contact updates during migration window\n* ProfileService smoke testing (verify Contact lookups work in Salesforce production)\n\n*Phase 3: Cutover (Week 10)*\n\n* Deploy ProfileService to production\n* Deploy EngagementService to production\n* Deploy Mobile App updates (new feedback form, ProfileService + EngagementService API integration)\n* Configure Salesforce webhook (Case update notifications → EngagementService)\n* Smoke testing: End-to-end feedback submission (Mobile App → EngagementService → Salesforce → Braze notification)\n* Monitor Event Bus queue depth, dead letter queue, Salesforce API rate limits\n* **Go/No-Go decision**: Validate success criteria before final cutover\n\n*Phase 4: D365 CE Retirement (Weeks 11-22)*\n\n* Monitor production for 30 days (validate success criteria: >99.5% feedback submission rate, no data loss)\n* D365 CE read-only access (historical Case lookups if needed)\n* Decommission D365 CE after 90 days (ADR-CS-006 big bang cutover timeline)\n* Archive D365 CE data for compliance/auditing\n\n==== Migration Dependencies\n\n[width=\"100%\",cols=\"40%,60%\",options=\"header\",]\n|===\n|Dependency |Owner/Status\n\n|*Salesforce production access*\n|Viva Energy Salesforce admin team - TBD\n\n|*Salesforce Case field mapping*\n|Viva Energy Salesforce admin team - TBD (map OTR feedback categories to Salesforce fields)\n\n|*Salesforce data isolation strategy*\n|Viva Energy Salesforce admin team - TBD (Record Types, queues, custom fields)\n\n|*Salesforce webhook configuration*\n|Viva Energy Salesforce admin team - TBD (Outbound Messages vs Platform Events)\n\n|*Event Bus infrastructure*\n|OTR Platform team - Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis)\n\n|*Braze integration*\n|OTR Marketing team - Existing Braze account, EngagementService creates new campaigns\n\n|*Mobile App release window*\n|OTR Mobile team - Coordinate cutover timing with app release schedule\n\n|*App database access*\n|OTR Platform team - Read access for Contact migration\n\n|===\n\n==== Migration Validation Criteria\n\n*Contact Migration Validation:*\n\n* ✅ 100% of app database Contacts migrated to Salesforce (zero data loss)\n* ✅ Email/phone/VCI matching accuracy > 95% (minimize duplicate Contacts)\n* ✅ ProfileService JIT lookups return correct Salesforce Contact IDs (smoke test sample)\n* ✅ Reconciliation report shows: X new Contacts created, Y existing Contacts updated\n\n*Cutover Validation:*\n\n* ✅ Mobile App feedback submission success rate > 99.5% (including async Case creation)\n* ✅ End-to-end flow validated: Mobile App → ProfileService → EngagementService → Salesforce Case created\n* ✅ Braze push notifications delivered for Case creation and Case resolution\n* ✅ Event Bus queue depth within normal range (no backlog)\n* ✅ Dead letter queue empty (no failed Case creations)\n* ✅ Salesforce API rate limits not exceeded\n\n*Production Monitoring (30 days):*\n\n* ✅ Customer satisfaction score improves by 15% (compared to D365 CE baseline)\n* ✅ Average case resolution time decreases by 20% (Salesforce vs D365 CE)\n* ✅ Support agents confirm unified customer view across all channels\n* ✅ Zero critical incidents (P1 outages, data loss)\n\n==== Rollback Plan\n\n*Rollback Trigger:*\n\n* Feedback submission success rate < 95% (below acceptable threshold)\n* Data loss or corruption detected in Salesforce\n* Salesforce API rate limits exceeded (Cases not created within SLA)\n* Critical bug blocking customer feedback submission\n\n*Rollback Procedure:*\n\n1. **Revert Mobile App** to previous version (remove ProfileService/EngagementService integration, restore D365 CE integration)\n2. **Stop EngagementService** Case creation (prevent duplicate Cases in Salesforce)\n3. **Re-enable D365 CE** for customer feedback submission\n4. **Investigate root cause** (EngagementService logs, Salesforce API errors, Event Bus queue issues)\n5. **Fix and re-test** in sandbox environment\n6. **Retry cutover** when issues resolved\n\n*Rollback Limitations:*\n\n* Cases created in Salesforce during cutover period remain in Salesforce (no reverse migration)\n* Contacts migrated to Salesforce remain (no rollback to app database)\n* Rollback only affects Mobile App integration (not data migration)\n\n=== Architectural Scope Boundaries\n\n==== Capabilities Included\n\n==== Capabilities Excluded\n\n==== Architectural Dependencies on Future Initiatives\n\n=== Technical Risks and Mitigation\n\n[width=\"100%\",cols=\"5%,20%,25%,25%,25%\",options=\"header\",]\n|===\n|ID |Risk |Impact |Likelihood |Mitigation\n\n|RISK-CS-001\n|*Salesforce API rate limits exceeded*: High feedback volume exceeds Salesforce API limits, Cases not created\n|HIGH (customers don't receive Case confirmation, support tickets lost)\n|MEDIUM (volume unknown, rate limits TBD)\n|• Gather expected feedback volume data before cutover +\n• Implement Event Bus queue throttling/rate limiting +\n• Monitor queue depth and API usage +\n• Scale background workers based on queue depth +\n• Alert ops team when approaching rate limits\n\n|RISK-CS-002\n|*Salesforce downtime*: Salesforce Service Cloud outage prevents Case creation\n|MEDIUM (Cases delayed but queued, customers wait for confirmation)\n|LOW (Salesforce SLA 99.9% uptime)\n|• Async Case creation with retry logic +\n• Event Bus queues buffer work during outage +\n• Customers get immediate \"Feedback submitted\" (not blocked) +\n• Monitor Salesforce status page, alert ops team +\n• Automatic retry when Salesforce recovers\n\n|RISK-CS-003\n|*Contact migration data quality issues*: App database Contact data incomplete or invalid\n|HIGH (migration fails validation, cutover delayed)\n|MEDIUM (legacy data quality unknown)\n|• Pre-migration data quality assessment +\n• Flexible upsert logic (match by email/phone/VCI) +\n• Validation report identifies data issues before production migration +\n• Manual cleanup for invalid records +\n• Dry-run migration in sandbox environment\n\n|RISK-CS-004\n|*Duplicate Contacts created*: Email matching fails, ProfileService creates duplicate Contacts\n|MEDIUM (support agents see multiple profiles for same customer)\n|MEDIUM (email changes, data quality issues)\n|• Salesforce duplicate detection rules (if available) +\n• ProfileService logs Contact creation for audit trail +\n• Manual duplicate cleanup process (support team) +\n• Future enhancement: VCI as Salesforce External ID for stable matching\n\n|RISK-CS-005\n|*Dead letter queue accumulation*: Failed Case creations not processed, queue grows\n|HIGH (customers don't receive Case confirmation, feedback lost)\n|LOW (retry logic handles most failures)\n|• Dead letter queue monitoring and alerting +\n• Ops team dashboard showing DLQ depth +\n• Manual intervention process (investigate and reprocess) +\n• Automated alerts when DLQ depth exceeds threshold +\n• Root cause analysis for recurring failures\n\n|RISK-CS-006\n|*Salesforce webhook failures*: Salesforce can't deliver Case update notifications to EngagementService\n|MEDIUM (customers don't get push notifications for Case resolution)\n|LOW (webhook mechanism reliable)\n|• Webhook retry logic and exponential backoff +\n• EngagementService logs webhook deliveries +\n• Monitor webhook delivery success rate +\n• Fallback: Poll Salesforce API for Case updates (if webhook fails persistently) +\n• Alert ops team when webhook delivery rate drops\n\n|RISK-CS-007\n|*Multi-tenant data isolation breach*: OTR digital Cases visible to other Viva Energy support teams\n|HIGH (privacy violation, compliance risk)\n|LOW (Salesforce governance controls)\n|• Work with Viva Energy Salesforce admin team on data isolation strategy +\n• Test data visibility in Salesforce sandbox (UAT with different user roles) +\n• Validate Record Types, queues, field-level security before production +\n• Audit Salesforce user permissions and sharing rules\n\n|RISK-CS-008\n|*Mobile App release coordination*: App release delayed, cutover window missed\n|MEDIUM (cutover delayed, D365 CE retirement delayed)\n|MEDIUM (release schedule conflicts)\n|• Coordinate cutover timing with Mobile team early +\n• Buffer time in migration plan (2-week contingency) +\n• Decouple backend deployment from Mobile App release (backend deployed first, app follows) +\n• Feature flag for feedback submission (enable when ready)\n\n|RISK-CS-009\n|*Event Bus infrastructure issues*: SNS/SQS/EventBridge downtime or misconfiguration\n|HIGH (Case creation blocked, domain events not published)\n|LOW (AWS SLA 99.99% uptime)\n|• Leverage existing AWS infrastructure (proven, reliable) +\n• Infrastructure as Code (IaC) for Event Bus configuration +\n• Integration testing in non-production environment +\n• Monitor Event Bus metrics (queue depth, throughput, errors) +\n• Alert ops team on Event Bus failures\n\n|RISK-CS-010\n|*Team DDD knowledge gap*: Team unfamiliar with DDD patterns, bounded contexts, event-driven architecture\n|MEDIUM (implementation delays, architectural inconsistencies)\n|HIGH (first DDD implementation)\n|• DDD training for development team (workshops, documentation) +\n• Architecture review sessions (validate bounded context design) +\n• Pair programming with experienced DDD practitioners +\n• Incremental implementation (start small, iterate) +\n• Document architectural patterns in CLAUDE.md\n\n|===\n\n== Assumptions and Constraints\n\n=== Assumptions\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Assumption\n\n|ASM-CS-001\n|Viva Energy Salesforce admin team will provide Salesforce production access, sandbox environment, and support for Case field mapping and data isolation configuration\n\n|ASM-CS-002\n|App database Contact data is sufficiently complete for migration (email/phone/VCI available for matching)\n\n|ASM-CS-003\n|Expected customer feedback volume is within Salesforce API rate limits (to be validated with feedback volume data)\n\n|ASM-CS-004\n|Existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) is sufficient for Event Bus implementation (no additional infrastructure provisioning required)\n\n|ASM-CS-005\n|Braze integration already exists and can be extended for Case-related push notifications (no new Braze account or major configuration changes)\n\n|ASM-CS-006\n|Mobile App users have email addresses associated with their accounts (required for ProfileService Contact reconciliation)\n\n|ASM-CS-007\n|D365 Customer Engagement historical Cases have limited business value and do not require migration to Salesforce\n\n|ASM-CS-008\n|Support agents are trained on Salesforce Service Cloud and require minimal additional training for OTR digital customer Cases\n\n|ASM-CS-009\n|Salesforce Service Cloud shared instance has capacity for OTR digital customer Contacts and Cases (no additional licensing or storage costs)\n\n|ASM-CS-010\n|Mobile App release schedule can accommodate cutover timing (Week 10 in migration plan)\n\n|===\n\n=== Constraints\n\n[width=\"100%\",cols=\"8%,92%\",options=\"header\",]\n|===\n|ID |Constraint\n\n|CON-CS-001\n|Must use shared Viva Energy Salesforce Service Cloud instance (cannot deploy separate OTR-specific instance)\n\n|CON-CS-002\n|Must conform to existing Salesforce configuration and governance (Record Types, custom fields, queues, data isolation strategy defined by Viva Energy admin team)\n\n|CON-CS-003\n|Contact migration must complete before Mobile App cutover (no parallel run of D365 CE and Salesforce)\n\n|CON-CS-004\n|Big bang cutover only (no phased rollout with feature flags or pilot users)\n\n|CON-CS-005\n|Salesforce API rate limits and authentication method constrained by Viva Energy Salesforce configuration (TBD)\n\n|CON-CS-006\n|Event Bus implementation must use existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis - cannot introduce new infrastructure components)\n\n|CON-CS-007\n|Mobile App feedback form must include specific fields: Category, Store Name, Time of Visit, Contact Phone Number, Free Text Message (no attachments)\n\n|CON-CS-008\n|D365 Customer Engagement must be decommissioned within 90 days post-cutover (ADR-CS-006)\n\n|CON-CS-009\n|ProfileService and EngagementService must be stateless (no local aggregate persistence, Salesforce is System of Record)\n\n|CON-CS-010\n|First DDD bounded context implementation (team learning curve, architectural patterns must be documented for future bounded contexts)\n\n|===\n\n== Non-Functional Requirements\n\n== Monitoring and Observability\n\n=== Key Metrics\n\n=== Alerting Thresholds\n\n=== Dashboards","structuredPatch":[{"oldStart":1080,"oldLines":6,"newStart":1080,"newLines":147,"lines":[" "," === Key Metrics"," ","+[width=\"100%\",cols=\"25%,40%,35%\",options=\"header\",]","+|===","+|Metric Category |Metric |Target/Threshold","+","+|*Feedback Submission*","+|Feedback submission success rate (Mobile App → EngagementService)","+|> 99.5%","+","+|*Async Case Creation*","+|Case creation success rate (EngagementService → Salesforce)","+|> 99%","+","+|*Async Case Creation*","+|Case creation latency (time from feedback submission to Case created in Salesforce)","+|p95 < 5 minutes","+","+|*Event Bus*","+|Event Bus queue depth (pending Case creations)","+|< 100 messages","+","+|*Event Bus*","+|Dead letter queue depth (failed Case creations)","+|= 0 (alert on any failures)","+","+|*Salesforce API*","+|Salesforce API error rate","+|< 1%","+","+|*Salesforce API*","+|Salesforce API latency (Case creation)","+|p95 < 2 seconds","+","+|*Salesforce API*","+|Salesforce API rate limit utilization","+|< 80% of limit","+","+|*ProfileService*","+|Contact reconciliation success rate (JIT lookups)","+|> 99.5%","+","+|*ProfileService*","+|Contact reconciliation latency","+|p95 < 500ms","+","+|*Braze Notifications*","+|Push notification delivery rate (Case created/updated)","+|> 95%","+","+|*Salesforce Webhook*","+|Webhook delivery success rate (Salesforce → EngagementService)","+|> 99%","+","+|*Customer Satisfaction*","+|Customer satisfaction score (CSAT)","+|> 4.0/5.0 (improve by 15% from D365 CE baseline)","+","+|*Support Operations*","+|Average case resolution time","+|Decrease by 20% from D365 CE baseline","+","+|===","+"," === Alerting Thresholds"," ","-=== Dashboards","\\ No newline at end of file","+[width=\"100%\",cols=\"25%,50%,25%\",options=\"header\",]","+|===","+|Alert |Condition |Severity","+","+|*Feedback submission failures*","+|Feedback submission success rate < 95% over 5-minute window","+|P1 - Critical","+","+|*Dead letter queue accumulation*","+|Dead letter queue depth > 0 (any failed Case creations)","+|P2 - High","+","+|*Event Bus queue backlog*","+|Event Bus queue depth > 100 messages for > 15 minutes","+|P2 - High","+","+|*Salesforce API errors*","+|Salesforce API error rate > 5% over 5-minute window","+|P1 - Critical","+","+|*Salesforce API rate limits*","+|Salesforce API rate limit utilization > 90%","+|P2 - High","+","+|*Contact reconciliation failures*","+|ProfileService Contact reconciliation failure rate > 5% over 5-minute window","+|P2 - High","+","+|*Braze notification failures*","+|Braze push notification delivery rate < 80% over 15-minute window","+|P3 - Medium","+","+|*Salesforce webhook failures*","+|Salesforce webhook delivery success rate < 90% over 15-minute window","+|P2 - High","+","+|*Case creation latency*","+|Case creation latency p95 > 10 minutes","+|P3 - Medium","+","+|===","+","+=== Dashboards","+","+*ProfileService Dashboard:*","+","+* Contact reconciliation success rate (JIT lookups)","+* Contact reconciliation latency (p50, p95, p99)","+* Contact creation vs update ratio (new Contacts created vs existing Contacts updated)","+* Salesforce API error rate (Contact queries and creates)","+* Request rate and throughput","+","+*EngagementService Dashboard:*","+","+* Feedback submission success rate","+* Case creation success rate (async workflow)","+* Case creation latency (p50, p95, p99)","+* Event Bus queue depth (pending Case creations)","+* Dead letter queue depth (failed Case creations)","+* Salesforce API error rate (Case creation)","+* Salesforce API latency","+* Salesforce API rate limit utilization","+* Braze push notification delivery rate","+* Salesforce webhook delivery success rate","+","+*Event Bus Dashboard:*","+","+* Queue depth (pending messages)","+* Throughput (messages published/consumed per minute)","+* Dead letter queue depth (failed messages)","+* Consumer lag (time between publish and consume)","+","+*Customer Support Dashboard (Business Metrics):*","+","+* Total feedback submissions per day/week/month","+* Feedback category breakdown (App, Service, Order, Rewards, Refund, Delete Account)","+* Customer satisfaction score (CSAT) trend","+* Average case resolution time trend","+* Case volume by support team/queue","+* Unified customer view adoption (support agent feedback)","\\ No newline at end of file"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"57e1a1ca-2138-4397-8c97-a0e5487469bf","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016EqP2N6Ht3MkSeXChVD38C","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect. Now let me complete the final task and mark everything as done.","signature":"EvABCkYICxgCKkDcbC36mmSfYvrJOhIL6Fzvtmxly9TGpXut6KRlZt5jCk+hMUhZHAXMqR1U5jHI43w84rHqYC9PqaOeCLUYM+rgEgyCy6kkaVseyQ7TqsUaDGx7Xt+8rLg3qfFNmCIwsvEsCg5Hm2MWyev3CPQ7ep7mJN/WtJnW0I2DkJoQ/RMIx1UHd9Vf1AV4TRXsCku6KlgGYCBLTX8MxqfjIbwN5s4xUjbVjzfJj0Srazv/tp/h8fLG7v4kjsa00ZcoFuTplMZGrxyHzJV3VxESt7zWNJQMczML8D6GqFdzDpRZT85nhOti7q2rgNpZGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":3196,"cache_read_input_tokens":88233,"cache_creation":{"ephemeral_5m_input_tokens":3196,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWsHXWW4N12rRpyLhcrtN","type":"assistant","uuid":"2dd67d03-326a-4564-b032-5464c34daed7","timestamp":"2026-01-07T03:11:47.113Z"}
{"parentUuid":"2dd67d03-326a-4564-b032-5464c34daed7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016EqP2N6Ht3MkSeXChVD38C","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Fge4egxNLv9vxUqX6owao1","name":"TodoWrite","input":{"todos":[{"content":"Complete Executive Summary section","activeForm":"Completing Executive Summary section","status":"completed"},{"content":"Update Introduction & Vision sections","activeForm":"Updating Introduction & Vision sections","status":"completed"},{"content":"Complete Key Architectural Patterns section","activeForm":"Completing Key Architectural Patterns section","status":"completed"},{"content":"Define Technical Requirements","activeForm":"Defining Technical Requirements","status":"completed"},{"content":"Document Baseline Architecture (D365 CE deprecation)","activeForm":"Documenting Baseline Architecture","status":"completed"},{"content":"Document Gap Analysis","activeForm":"Documenting Gap Analysis","status":"completed"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","activeForm":"Documenting Target State Architecture","status":"completed"},{"content":"Document Architecture Decisions (ADRs)","activeForm":"Documenting Architecture Decisions","status":"completed"},{"content":"Document Migration Strategy","activeForm":"Documenting Migration Strategy","status":"completed"},{"content":"Document Technical Risks and Mitigation","activeForm":"Documenting Technical Risks and Mitigation","status":"completed"},{"content":"Review and finalize document","activeForm":"Reviewing and finalizing document","status":"completed"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":3196,"cache_read_input_tokens":88233,"cache_creation":{"ephemeral_5m_input_tokens":3196,"ephemeral_1h_input_tokens":0},"output_tokens":410,"service_tier":"standard"}},"requestId":"req_011CWsHXWW4N12rRpyLhcrtN","type":"assistant","uuid":"18955b6d-6629-4c17-83e7-4abb1dc74b80","timestamp":"2026-01-07T03:11:52.378Z"}
{"parentUuid":"18955b6d-6629-4c17-83e7-4abb1dc74b80","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Fge4egxNLv9vxUqX6owao1","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"25396c9b-cc6e-4d32-9b41-dad1b22bcc21","timestamp":"2026-01-07T03:11:52.752Z","toolUseResult":{"oldTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"completed","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"completed","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"completed","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"completed","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Review and finalize document","status":"in_progress","activeForm":"Reviewing and finalizing document"}],"newTodos":[{"content":"Complete Executive Summary section","status":"completed","activeForm":"Completing Executive Summary section"},{"content":"Update Introduction & Vision sections","status":"completed","activeForm":"Updating Introduction & Vision sections"},{"content":"Complete Key Architectural Patterns section","status":"completed","activeForm":"Completing Key Architectural Patterns section"},{"content":"Define Technical Requirements","status":"completed","activeForm":"Defining Technical Requirements"},{"content":"Document Baseline Architecture (D365 CE deprecation)","status":"completed","activeForm":"Documenting Baseline Architecture"},{"content":"Document Gap Analysis","status":"completed","activeForm":"Documenting Gap Analysis"},{"content":"Document Target State Architecture (ProfileService, EngagementService)","status":"completed","activeForm":"Documenting Target State Architecture"},{"content":"Document Architecture Decisions (ADRs)","status":"completed","activeForm":"Documenting Architecture Decisions"},{"content":"Document Migration Strategy","status":"completed","activeForm":"Documenting Migration Strategy"},{"content":"Document Technical Risks and Mitigation","status":"completed","activeForm":"Documenting Technical Risks and Mitigation"},{"content":"Review and finalize document","status":"completed","activeForm":"Reviewing and finalizing document"}]}}
{"parentUuid":"25396c9b-cc6e-4d32-9b41-dad1b22bcc21","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JXHC6iwYPriq4UVLeUUQq2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! I've completed all the major sections of the Salesforce Customer Support architecture definition document. Let me provide a summary to the user of what has been completed.","signature":"Et0CCkYICxgCKkB70Y0JQ6LzIG6TfFVRF+e93cimNz+1TZ2fM9sCwQ+vC7fg5JYO2l1n01cl3HKiwt//6yWNFXli3uq0+pUTR9alEgxyU3RN2Zehj/pY4FgaDA2uqRAO8UinZVjjviIw1C9knUVUvW1oRxoFIg/Vuz+U4WtxOqAIj4pCz1gdslXlbbAlDwnFB8TMtl4LQc0hKsQBVxT0yDwwQ4+MihSc8GrrCI+hJWtUl/DCoS78YQCbEHhU/y7V7lPMpDDbCT6aDxsDXQEbBTOSa3xCYzpf63m8K6dIT0okrrpR+cns5j4VC+HLJMTulsiAkF+GX0aee3XM8tGYnvNP3lxgEPMStXDe+5RvCh/YFAWkPWBgj97sK+XZB3Lu6XzyKK75XrG3TWPGqpZywRO9OSix8/hg3uioXfhONaHmgLWNQ5mEXkVx5N5ICH9zGApMZVT9wvl8iNmnNZKSnxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":459,"cache_read_input_tokens":91429,"cache_creation":{"ephemeral_5m_input_tokens":459,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CWsHYLMe1qfg9UGH23ybp","type":"assistant","uuid":"904ac9ef-aa0b-49f4-9b14-9a214f068c1b","timestamp":"2026-01-07T03:11:56.797Z"}
{"parentUuid":"904ac9ef-aa0b-49f4-9b14-9a214f068c1b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JXHC6iwYPriq4UVLeUUQq2","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I've completed a comprehensive Salesforce Customer Support architecture definition document using all the context we gathered. Here's what I've documented:\n\n## Document Summary\n\n**Sections Completed:**\n\n✅ **Introduction & Vision** - Emphasizes this is the first DDD bounded context implementation, foundation for Flybuys  \n✅ **Architecture Overview** - Updated diagram and architectural patterns table  \n✅ **Executive Summary** - Challenge, solution, architectural significance, success criteria, constraints, TBD items  \n✅ **Technical Requirements** - 19 specific requirements (TR-CS-001 through TR-CS-019)  \n✅ **Baseline Architecture** - Current state components, deprecation status  \n✅ **Gap Analysis** - Missing capabilities, bounded contexts, integration patterns  \n✅ **Target State Architecture** - ABBs, integration flows, system of record boundaries, data architecture principles  \n✅ **Architecture Decisions** - 7 comprehensive ADRs covering all major decisions  \n✅ **Migration Strategy** - 4-phase migration plan, dependencies, validation criteria, rollback plan  \n✅ **Technical Risks** - 10 risks with impact, likelihood, and mitigation strategies  \n✅ **Assumptions & Constraints** - 10 assumptions, 10 constraints  \n✅ **Monitoring & Observability** - Key metrics, alerting thresholds, dashboards\n\n## Key Themes Throughout:\n\n1. **First DDD Implementation** - Consistently emphasized this establishes the foundation\n2. **Reusability** - ProfileService Contact reconciliation reused for Flybuys\n3. **Event-Driven Architecture** - First implementation of event pattern\n4. **Anti-Corruption Layer** - Protects digital channels from Salesforce changes\n5. **Async Resilience** - Non-blocking UX, retry logic, DLQ monitoring\n6. **Big Bang Cutover** - Simple approach vs phased rollout\n7. **TBD Items Tracked** - Salesforce field mapping, authentication, webhooks clearly marked as TBD\n\nThe document is ready for review and can serve as the architecture definition for the Salesforce Customer Support migration!"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":459,"cache_read_input_tokens":91429,"cache_creation":{"ephemeral_5m_input_tokens":459,"ephemeral_1h_input_tokens":0},"output_tokens":542,"service_tier":"standard"}},"requestId":"req_011CWsHYLMe1qfg9UGH23ybp","type":"assistant","uuid":"2b7e3e1e-674f-4c14-894f-61230462f8a6","timestamp":"2026-01-07T03:12:08.919Z"}
{"type":"file-history-snapshot","messageId":"a8f13a39-64cf-429a-a746-a3faf0e781e6","snapshot":{"messageId":"a8f13a39-64cf-429a-a746-a3faf0e781e6","trackedFileBackups":{"architecture_definitions/salesforce_customer_support.adoc":{"backupFileName":null,"version":2,"backupTime":"2026-01-07T03:14:54.123Z"}},"timestamp":"2026-01-07T03:14:54.122Z"},"isSnapshotUpdate":false}
{"parentUuid":"2b7e3e1e-674f-4c14-894f-61230462f8a6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to."},"isMeta":true,"uuid":"a54e0b4e-e09f-4c3a-9690-60aed2a3406b","timestamp":"2026-01-07T03:14:54.100Z"}
{"parentUuid":"a54e0b4e-e09f-4c3a-9690-60aed2a3406b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"<command-name>/exit</command-name>\n            <command-message>exit</command-message>\n            <command-args></command-args>"},"uuid":"a8f13a39-64cf-429a-a746-a3faf0e781e6","timestamp":"2026-01-07T03:14:54.095Z"}
{"parentUuid":"a8f13a39-64cf-429a-a746-a3faf0e781e6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd","version":"2.0.76","gitBranch":"main","slug":"bright-booping-valley","type":"user","message":{"role":"user","content":"<local-command-stdout>Catch you later!</local-command-stdout>"},"uuid":"c68890b7-dc2a-43ca-b3b3-b24e2626de3e","timestamp":"2026-01-07T03:14:54.095Z"}
{"type":"summary","summary":"Salesforce Customer Support Migration Solution Design","leafUuid":"c68890b7-dc2a-43ca-b3b3-b24e2626de3e"}
