{"type":"summary","summary":"Replicate AsciiDoc Structure Between Initiative Documents","leafUuid":"62876042-bb66-45a0-bb86-125d3832ec50"}
{"type":"summary","summary":"Replicate AsciiDoc Initiative Document Structure Template","leafUuid":"22be6299-2dd6-4a71-a9f6-ebe1cf5dec40"}
{"type":"summary","summary":"Replicate Document Structure Across Initiative Files","leafUuid":"e2423384-f9d7-4e95-9026-8d892d94e57a"}
{"type":"summary","summary":"Replicate & Templatize Initiative Document Structure","leafUuid":"baf3afa0-a95c-48f2-bbf3-97f3a877c5ae"}
{"type":"summary","summary":"Replicate Document Structure, Create Initiative Template","leafUuid":"1177dfd9-c057-43a9-9ff3-2a2752e948c4"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure Template","leafUuid":"97394ef3-1249-481f-a6a0-de5e8ef7b521"}
{"type":"summary","summary":"Replicate Document Structure & Create Initiative Template","leafUuid":"313f3d55-25a8-4126-a9a3-a8858c497ff0"}
{"type":"summary","summary":"Replicate Initiative Document Structure and Create Template","leafUuid":"ac8b48d6-0250-4c7d-92af-b573370fe3b3"}
{"type":"summary","summary":"Replicate Document Structure Into Flybuys Initiative File","leafUuid":"64d8edec-426f-4ff9-b94f-6fb776885ef8"}
{"type":"summary","summary":"Replicate Document Structure into Flybuys Initiative","leafUuid":"30b83e6a-0289-48b1-b88b-497cc038f126"}
{"type":"summary","summary":"Replicate document structure to Flybuys initiative","leafUuid":"911d1f4c-dec6-4d99-8e1d-645f5c69173a"}
{"type":"summary","summary":"Replicate Document Structure, Create Initiative Template","leafUuid":"98d40552-3f12-4c3d-832c-9d5d6afc7aea"}
{"type":"summary","summary":"Replicate Document Structure to Initiative Template","leafUuid":"4cdc7c63-aaaf-47c1-b86b-a3ef946b2965"}
{"type":"summary","summary":"Replicate Document Structure for Flybuys Initiative","leafUuid":"129515bd-152d-443e-bbf2-54a57647ba11"}
{"type":"summary","summary":"Replicate Document Structure Into Flybuys Initiative File","leafUuid":"88443195-63e6-4733-b0a8-0d134af62a92"}
{"type":"summary","summary":"Replicate Document Structure into Flybuys Initiative","leafUuid":"6377723a-2bd9-46ce-a222-833f5ca5874e"}
{"type":"summary","summary":"Replicate Document Structure into Flybuys Initiative File","leafUuid":"1e759019-0d9d-4456-aae1-fd3eb42f6f06"}
{"type":"summary","summary":"Replicate Document Structure into Flybuys Initiative","leafUuid":"dbb480da-299a-48de-9b93-27f09fb0e7e5"}
{"type":"summary","summary":"Replicate DMB structure to Flybuys doc","leafUuid":"823c596b-feb8-4ee8-a1fb-32d4d5bf4548"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys","leafUuid":"80c63f0e-6f7e-42c1-8d57-2fb7198316a9"}
{"type":"summary","summary":"Replicate Digital Menu Board Doc Structure to Flybuys","leafUuid":"18bee72c-6acb-4dd8-bc2a-988bb1d35c57"}
{"type":"summary","summary":"Replicate Structure, Create Initiative Template","leafUuid":"a951dc31-f852-479a-a8c5-8bb98a0fcff7"}
{"type":"summary","summary":"Replicate Document Structure and Create Initiative Template","leafUuid":"9a78bcd4-2f3d-4fee-b237-8ed4bd9ad600"}
{"type":"summary","summary":"Replicate Document Structure, Create Initiative Template","leafUuid":"ed38ef97-eb48-420c-9292-ef90ab3589c7"}
{"type":"summary","summary":"Replicate Initiative Document Structure Template","leafUuid":"3260c891-3b84-4773-a4e8-8ed7d3acc1d6"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys Initiative","leafUuid":"962b2e56-47bf-4a30-a97a-00cc9080e1ff"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys Initiative","leafUuid":"f954ce38-fa16-4a2f-990e-801f6696a55a"}
{"type":"summary","summary":"Replicate digital menu board structure to Flybuys","leafUuid":"b9e1ac7d-39b1-4191-9db7-15f5dda5fa6d"}
{"type":"summary","summary":"Replicate Document Structure to Initiative Template","leafUuid":"14b0c6ac-cb62-4dcc-b96f-d049823d74cc"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys Doc","leafUuid":"bea22ca4-6d4b-4ef3-b89b-8cbb71bfee9e"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys Document","leafUuid":"e2f68714-154e-4bae-8006-c3af952772c4"}
{"type":"summary","summary":"Replicate Document Structure to Initiative Template","leafUuid":"cba89750-046f-4410-82d3-9136a713069e"}
{"type":"summary","summary":"Retrospective Flybuys Data Integration Initiative Documentation","leafUuid":"f85584a7-0826-479f-b904-86e94c8385b4"}
{"type":"summary","summary":"Replicate Document Structure to Flybuys Initiative File","leafUuid":"37b64325-3436-4aab-850d-5c2314d13cc8"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys","leafUuid":"649e39ce-dddc-412a-90b3-2f3a2b63002b"}
{"type":"summary","summary":"Replicate document structure, create template, populate Flybuys initiative","leafUuid":"8a74c330-3f27-45dd-baee-70282b2e18fe"}
{"type":"summary","summary":"Replicate Digital Menu Board Structure to Flybuys Document","leafUuid":"1abf5cd4-2b67-44da-93ef-7b70cc00bcd3"}
{"type":"summary","summary":"Replicate Document Structure & Create Initiative Template","leafUuid":"7db438c6-f3cf-4877-a1b6-6532660c7369"}
{"type":"summary","summary":"Replicate Document Structure & Create Initiative Template","leafUuid":"2132c181-539a-46ab-a34b-3805038fc162"}
{"type":"summary","summary":"Replicate & Template Document Structure Initiative","leafUuid":"bc3ea0de-7d5b-4298-a170-d3b8a4f357cb"}
{"type":"summary","summary":"Replicate Document Structure & Create Initiative Template","leafUuid":"1b2f7d79-7d09-423d-a3f6-00788796dca6"}
{"type":"summary","summary":"Replicate Document Structure, Create Template","leafUuid":"ca099b10-0e05-4d7c-9610-c1d05a27cfaf"}
{"type":"summary","summary":"Replicate Document Structure Into Flybuys Initiative","leafUuid":"021a881c-4a75-4050-b7e2-f63eb51677ab"}
{"type":"summary","summary":"Replicate Document Structure, Create Template, Document Production Data Integration","leafUuid":"b19337e4-38d0-4ccd-b5d4-c412d24c5fc5"}
{"type":"summary","summary":"Replicate & Template Flybuys Data Initiative Doc","leafUuid":"7ec4dac9-2b79-4abd-b6ff-c2e24f82e966"}
{"type":"summary","summary":"Replicate initiative structure, create template, document Flybuys data integration","leafUuid":"84cbe179-b213-4832-9872-7adff5210d3b"}
{"type":"summary","summary":"Replicate DMB structure to Flybuys initiative doc","leafUuid":"c775f9e8-c45f-4f24-8fa7-7204ed6fcc98"}
{"type":"summary","summary":"Replicate & Extend Flybuys Data Initiative Structure","leafUuid":"d011f6e2-af0b-446a-9654-bcd2f9ab1463"}
{"type":"summary","summary":"Replicate & Templatize Initiative Document Structure","leafUuid":"1ad44587-8d20-4156-80a0-d2b636e18186"}
{"type":"summary","summary":"Replicate Document Structure into Flybuys Initiative","leafUuid":"31f742a6-0989-4e76-996d-4994d93e912a"}
{"type":"file-history-snapshot","messageId":"e7fcf33d-6db0-44a5-a708-276818d9bf30","snapshot":{"messageId":"e7fcf33d-6db0-44a5-a708-276818d9bf30","trackedFileBackups":{},"timestamp":"2026-01-16T04:10:01.423Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","type":"user","message":{"role":"user","content":"Through \"initiatives\\flybuys_strategic_data.adoc\" we refer to Phase 1 changing to daily, but in implementation phases, it's considerd TS-2, make this consistent"},"uuid":"e7fcf33d-6db0-44a5-a708-276818d9bf30","timestamp":"2026-01-16T04:10:01.390Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"e7fcf33d-6db0-44a5-a708-276818d9bf30","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011HpdbkHVkqiLGKzgj8hH3o","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is asking me to make a consistency fix in the file `initiatives/flybuys_strategic_data.adoc`. They're saying that there's an inconsistency where:\n1. Through the document, Phase 1 is referred to as changing to daily\n2. But in the implementation phases section, this is considered TS-2 (not TS-1/Phase 1)\n\nThis seems like a straightforward task - I need to:\n1. Read the file first to understand the inconsistency\n2. Fix the inconsistency to make it clear throughout\n\nThis is a simple, single-file fix so I don't need to use TodoWrite or EnterPlanMode. Let me read the file first.","signature":"Eu8FCkYICxgCKkCYoSMSbhKIr/nVbf09jXcDc17JINKC3qNV0pwb1F8XpAQkBJd9g8xUc3fz91Ln9FRhGizzm7QOM2PEmtmrFDLEEgxersafsKyuy3Tb9PgaDEfg/eXiD3jAwxAUlSIwdhZmDJCdESo7k+9T5lGYaUFdgXH3Rw5UQgcsWb5jq6EbnKgF9ZXi76mYrg2HgPg4KtYEFVBNDGaRwhHxI0wbgX8aSdvsWnCH5AFkn6zTM3rDR3HNhUxZWLUlpuc72Qrb4dXzpLUUDmZixnzLMmDyNhICwBmF6ZpzBLX/UmKqo+uyAqIVPfxK3eo4vUChvc+EyXWRxBI5XZ3v+RuhBmexatn++tqG5z9ch7eo5ZIkNlFrjrpkFuaS9aUI1gpnlJ3T4b460VfiZ/PaCjCpa6q8GVoUuD6FWSz1eJh4dbAF1UxuvNdbXv1wm/2c7BrL2Ss+z2wrhjK1sSqXEsO6bkLeIMy8qPBFoMThKgsclxIVBfrw/LZ1W9XA5+z/FxZPt1GJ4H6zeo9KVEgdgFzQrdDstKrlnZ7PK7TxR8j1IKVHcpmW1vZkvTvEFOS1oZ6ubCVXX6SwjgR7wnNdrLWhwymSd8DDQhsO+9S0xRaBqdruAGorhpZSmyUSOASQ3mo+KmpPqPw4EywBaz5MJa1GDXmSXKfQnIdBFIcWu9MZQoJ/R+GN7+JEoYl8t4Lyxk8eOuyCdx+MDFeR8095OJn1NjqGWRbIG+Cc+UbMRM2hzY0V6SOxoOysTd7pHikM6wkm+n4+WTyd1UVNICOPs2W7GtO7fWK79dQ9yOtepwDe7NCw7fe3hd3kb0Xk0Mg5zDkEdXECi7zPABcJMbuBe2bMEjxmUUTFQv4/oaMMSjm99hlBUTpLpf3xA3vblcz7OVyOGAz1cNYxCaf9gnidQ5rm4rMTcVfQDO+M6hlJkkw0oSO1IGwFtwfOjcKvpqJKqjWhrrAig8Csjlf6ftdxWKOFeTZTNBdsWfVxLdtvcxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25824,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25824,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXAQFj5XrJsr5V1p9Ev7N","type":"assistant","uuid":"f2e1ea6c-8f59-4fac-bbd6-679457921c98","timestamp":"2026-01-16T04:10:06.823Z"}
{"parentUuid":"f2e1ea6c-8f59-4fac-bbd6-679457921c98","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011HpdbkHVkqiLGKzgj8hH3o","type":"message","role":"assistant","content":[{"type":"text","text":"I'll read the file to identify the inconsistency between Phase 1 references and the TS-2 implementation phase."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25824,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25824,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXAQFj5XrJsr5V1p9Ev7N","type":"assistant","uuid":"949a53a8-8736-491e-9b4d-df1d43db195c","timestamp":"2026-01-16T04:10:07.380Z"}
{"parentUuid":"949a53a8-8736-491e-9b4d-df1d43db195c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011HpdbkHVkqiLGKzgj8hH3o","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014TmxREvGztVg3idXGbdgQd","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25824,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25824,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXAQFj5XrJsr5V1p9Ev7N","type":"assistant","uuid":"39d45bc1-317b-47fb-b29b-cf375133fe84","timestamp":"2026-01-16T04:10:08.278Z"}
{"parentUuid":"39d45bc1-317b-47fb-b29b-cf375133fe84","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014TmxREvGztVg3idXGbdgQd","type":"tool_result","content":"     1→= Flybuys Strategic Data Integration\n     2→:domain: Loyalty\n     3→:domain-architect: O.Young@otr.com.au\n     4→:project: OTR-2026-04\n     5→:doctype: article\n     6→:toc: left\n     7→:toclevels: 3\n     8→:sectanchors:\n     9→:sectlinks:\n    10→:sectnums:\n    11→:icons: font\n    12→:source-highlighter: highlightjs\n    13→:experimental:\n    14→\n    15→<<<\n    16→== What This Initiative Covers\n    17→\n    18→An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).\n    19→\n    20→[cols=\"1,3\"]\n    21→|===\n    22→| Feature | Description\n    23→\n    24→| Daily transaction file export\n    25→| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n    26→\n    27→| Product hierarchy file export\n    28→| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n    29→\n    30→| SFTP secure transfer\n    31→| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n    32→\n    33→| Pause/resume capability\n    34→| Ability to pause daily transfers during promotional periods or operational maintenance windows\n    35→\n    36→| Multi-brand expansion ready\n    37→| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n    38→\n    39→| Outbound metadata framework\n    40→| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n    41→|===\n    42→\n    43→<<<\n    44→== Architecture Approach\n    45→\n    46→This is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n    47→\n    48→The current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n    49→\n    50→=== Design Principles\n    51→\n    52→==== Back-office native tooling\n    53→\n    54→Uses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n    55→\n    56→==== Conform to partner requirements\n    57→\n    58→Flybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n    59→\n    60→==== Daily batch is sufficient\n    61→\n    62→Promotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.\n    63→\n    64→==== Metadata-driven configuration\n    65→\n    66→Uses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n    67→\n    68→==== Encrypted transfer\n    69→\n    70→Applies PGP encryption for files in transit to meet data security requirements for member transaction data.\n    71→\n    72→=== Microsoft Fabric Data Pipeline\n    73→\n    74→Transaction and product data extraction pipeline (currently operational)\n    75→\n    76→- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n    77→- Joins with member lookup table to enrich with full Flybuys card numbers\n    78→- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n    79→- Generates two files per run: Transaction File and Product Hierarchy File\n    80→- Stores files in ADLS before SFTP transfer\n    81→- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n    82→\n    83→=== Azure Data Factory SFTP Integration\n    84→\n    85→Secure file transfer orchestration (currently operational)\n    86→\n    87→- Monitors ADLS locations for new transaction and product hierarchy files\n    88→- Encrypts files using PGP before transfer\n    89→- Transfers files to Flybuys SFTP server via secure connection\n    90→- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n    91→- Pause/resume control mechanism using ADF control flow activities\n    92→- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n    93→\n    94→=== Transaction Data Scope\n    95→\n    96→Flybuys member transactions only\n    97→\n    98→- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n    99→- Includes posted transactions (`entrystatus in (0,2)`)\n   100→- Sales transactions only (`type = 2`)\n   101→- Enriched with member lookup to provide full Flybuys card number\n   102→- Captures discounts, GST, returns, tender types, and basket quantities\n   103→\n   104→=== Product Hierarchy Data\n   105→\n   106→Reddy Express product categorisation structure\n   107→\n   108→- 4-level category hierarchy from D365 EcoRes product taxonomy\n   109→- Maps Reddy Express products to Retail Product Category hierarchy\n   110→- Provides category codes and names at each level\n   111→- Supports Flybuys promotional analytics and category-based offers\n   112→\n   113→=== Integration Points\n   114→\n   115→[cols=\"1,3\"]\n   116→|===\n   117→| Integration | Description\n   118→\n   119→| D365 Commerce\n   120→| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n   121→\n   122→| Microsoft Fabric\n   123→| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n   124→\n   125→| Azure Data Lake Storage (ADLS)\n   126→| Staging location for transaction and product hierarchy files before SFTP transfer\n   127→\n   128→| Azure Data Factory (ADF)\n   129→| SFTP orchestration, file encryption, scheduling, and control flow management\n   130→\n   131→| Flybuys SFTP Server\n   132→| Destination for daily transaction and product hierarchy files (external partner system)\n   133→\n   134→| Member Lookup Table\n   135→| OTRG member data joined to enrich Flybuys barcode with full card number\n   136→|===\n   137→\n   138→<<<\n   139→== Key Capabilities Delivered\n   140→\n   141→[cols=\"1,2,2\"]\n   142→|===\n   143→| Capability | How It Works | Business Value\n   144→\n   145→| *Daily Transaction Sharing*\n   146→| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n   147→| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n   148→\n   149→| *Product Hierarchy Export*\n   150→| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n   151→| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n   152→\n   153→| *Pause/Resume Control*\n   154→| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n   155→| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n   156→\n   157→| *Encrypted File Transfer*\n   158→| PGP encryption applied before SFTP transfer to Flybuys server\n   159→| Protects member transaction data in transit, meeting data security and privacy requirements\n   160→\n   161→| *Multi-Brand Foundation*\n   162→| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n   163→| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n   164→\n   165→| *Transaction Data Enrichment*\n   166→| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n   167→| Ensures Flybuys receives complete member identifiers for accurate points attribution\n   168→\n   169→| *Audit Trail & Monitoring*\n   170→| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n   171→| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n   172→|===\n   173→\n   174→<<<\n   175→== Customer Journey\n   176→\n   177→=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n   178→\n   179→. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n   180→. Transaction recorded in D365 Commerce with Flybuys barcode linked\n   181→. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n   182→. Pipeline joins with member lookup table to enrich with full Flybuys card number\n   183→. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n   184→. ADF monitors ADLS for new files\n   185→. ADF encrypts files with PGP\n   186→. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n   187→. Flybuys ingests files and attributes transactions to member accounts\n   188→. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n   189→\n   190→[mermaid]\n   191→----\n   192→sequenceDiagram\n   193→    actor Customer as Flybuys Member\n   194→    participant POS as D365 Commerce<br/>POS Channel\n   195→    participant Fabric as Microsoft Fabric<br/>Pipeline\n   196→    participant ADLS as Azure Data Lake<br/>Storage\n   197→    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n   198→    participant SFTP as Flybuys<br/>SFTP Server\n   199→    participant Flybuys as Flybuys<br/>Platform\n   200→\n   201→    Note over Customer,Flybuys: Daily Transaction Data Flow\n   202→\n   203→    Customer ->> POS: Scan Flybuys barcode at checkout\n   204→    POS ->> POS: Record transaction with Flybuys barcode\n   205→\n   206→    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n   207→    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n   208→    Fabric ->> Fabric: Join with member lookup table\n   209→    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n   210→    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n   211→\n   212→    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n   213→    ADF ->> ADF: PGP encrypt files\n   214→    ADF ->> SFTP: Transfer encrypted files via SFTP\n   215→    SFTP ->> Flybuys: Ingest transaction and product data\n   216→    Flybuys ->> Flybuys: Attribute transactions to member accounts\n   217→    Flybuys -->> Customer: Award coalition loyalty points\n   218→----\n   219→\n   220→=== Pause/Resume Control Flow\n   221→\n   222→. Flybuys or OTRG operations team requests pause of daily transfers\n   223→. Operations team accesses ADF control mechanism\n   224→. *Daily SFTP transfer schedule paused* via ADF control flow activity\n   225→. No files transferred during pause period (previous day's data held in ADLS)\n   226→. Operations team resumes transfers when ready\n   227→. *ADF pipeline resumes daily schedule*\n   228→. Backlog of files transferred (if applicable)\n   229→\n   230→[mermaid]\n   231→----\n   232→sequenceDiagram\n   233→    actor Ops as Operations Team\n   234→    participant ADF as Azure Data Factory<br/>Control Flow\n   235→    participant ADLS as Azure Data Lake<br/>Storage\n   236→    participant SFTP as Flybuys<br/>SFTP Server\n   237→\n   238→    Note over Ops,SFTP: Pause Request Scenario\n   239→    Ops ->> ADF: Request pause of daily transfers\n   240→    ADF ->> ADF: Update control flag (pause=true)\n   241→    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n   242→    ADF ->> ADLS: Files continue to accumulate\n   243→\n   244→    Note over Ops,SFTP: Resume Request Scenario\n   245→    Ops ->> ADF: Request resume of daily transfers\n   246→    ADF ->> ADF: Update control flag (pause=false)\n   247→    ADF ->> ADLS: Check for backlog files\n   248→    alt Backlog exists\n   249→        ADF ->> SFTP: Transfer backlog files (catch-up)\n   250→    end\n   251→    ADF ->> SFTP: Resume daily scheduled transfers\n   252→----\n   253→\n   254→<<<\n   255→== Implementation Phases\n   256→\n   257→Current production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n   258→\n   259→[cols=\"2,2,1,2\"]\n   260→|===\n   261→| Phase | Capability Enabled | Users | Success Criteria\n   262→\n   263→| *TS-0: Foundation (COMPLETE)*\n   264→| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n   265→| Development team\n   266→| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n   267→\n   268→| *TS-1: Reddy Express Production (COMPLETE)*\n   269→| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n   270→| Reddy Express stores\n   271→| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n   272→\n   273→| *TS-2: SFTP Configuration Changes (PLANNED)*\n   274→| Update SFTP target location and change cadence from weekly (Monday) to daily\n   275→| Reddy Express stores\n   276→| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n   277→\n   278→| *TS-3: OTR Store Integration (PLANNED)*\n   279→| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n   280→| Reddy Express stores + OTR convenience stores\n   281→| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n   282→\n   283→| *TS-4: Full Rollout Validation (PLANNED)*\n   284→| All Reddy Express stores and OTR convenience stores operational with daily transfers\n   285→| All OTRG stores (Reddy Express + convenience)\n   286→| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n   287→\n   288→| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n   289→| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n   290→| All loyalty partners\n   291→| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n   292→|===\n   293→\n   294→*Planned Rollout Strategy*:\n   295→- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n   296→- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n   297→\n   298→<<<\n   299→== Non-Functional Requirements (Current & Target)\n   300→\n   301→[cols=\"1,2,2\"]\n   302→|===\n   303→| Requirement | Target | How We Achieve It\n   304→\n   305→| *Data Freshness*\n   306→| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n   307→| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n   308→\n   309→| *Data Completeness*\n   310→| 100% of Flybuys member transactions captured (zero data loss)\n   311→| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n   312→\n   313→| *SFTP Transfer Success Rate*\n   314→| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n   315→| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n   316→\n   317→| *Data Security*\n   318→| Encrypted in transit, secure SFTP access, member data protected\n   319→| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n   320→\n   321→| *Scalability*\n   322→| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n   323→| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n   324→\n   325→| *Operational Flexibility*\n   326→| Pause/resume capability, manual re-run of failed transfers\n   327→| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n   328→\n   329→| *Monitoring & Alerting*\n   330→| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n   331→| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n   332→\n   333→| *Data Residency*\n   334→| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n   335→| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n   336→|===\n   337→\n   338→<<<\n   339→== Risks & Mitigation (Current & Planned)\n   340→\n   341→[cols=\"1,1,2\"]\n   342→|===\n   343→| Risk | Impact | Mitigation\n   344→\n   345→| *D365 Commerce data quality issues*\n   346→| Incomplete or incorrect transaction data sent to Flybuys\n   347→| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n   348→\n   349→| *Fabric pipeline failures*\n   350→| Transfer missed, Flybuys members don't receive points timely\n   351→| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n   352→\n   353→| *SFTP connectivity issues*\n   354→| Files not delivered to Flybuys server\n   355→| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n   356→\n   357→| *Member lookup table data lag*\n   358→| New Flybuys members missing from enrichment join, incomplete card numbers\n   359→| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n   360→\n   361→| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n   362→| OTR convenience products not correctly categorised for Flybuys promotions\n   363→| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n   364→\n   365→| *SFTP target migration failures (Phase 1 risk)*\n   366→| Data loss or duplication during SFTP location cutover\n   367→| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n   368→\n   369→| *Pause mechanism misconfiguration*\n   370→| Transfers paused unintentionally, or resume forgotten\n   371→| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n   372→\n   373→| *Data volume growth exceeding SFTP limits*\n   374→| Large file sizes cause SFTP transfer timeouts or failures\n   375→| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n   376→|===\n   377→\n   378→<<<\n   379→== Key Decisions Made\n   380→\n   381→[cols=\"1,2,2\"]\n   382→|===\n   383→| Decision | Rationale | Trade-off Accepted\n   384→\n   385→| *Azure/Fabric platform (not AWS)*\n   386→| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n   387→| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n   388→\n   389→| *SFTP delivery mechanism (not API)*\n   390→| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n   391→| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n   392→\n   393→| *Daily batch (not real-time)*\n   394→| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n   395→| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n   396→\n   397→| *Metadata-driven pipeline (not hardcoded)*\n   398→| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n   399→| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n   400→\n   401→| *PGP encryption (not TLS-only)*\n   402→| Flybuys requires PGP-encrypted files for data security compliance\n   403→| Operational overhead of PGP key management; acceptable for member transaction data protection\n   404→\n   405→| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n   406→| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n   407→| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n   408→\n   409→| *Customer-Supplier with Conformist pattern*\n   410→| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n   411→| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n   412→\n   413→| *No Anti-Corruption Layer*\n   414→| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n   415→| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n   416→|===\n   417→\n   418→<<<\n   419→== Future Capacity Delivered\n   420→\n   421→[cols=\"1,3\"]\n   422→|===\n   423→| Stream | Capacity\n   424→\n   425→| *Multi-Partner Data Sharing Pattern*\n   426→| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n   427→\n   428→| *OTR Store Transaction Visibility*\n   429→| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n   430→\n   431→| *Cross-Brand Product Hierarchy*\n   432→| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n   433→\n   434→| *Data Export Foundation*\n   435→| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n   436→\n   437→| *Partner Integration Playbook*\n   438→| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n   439→\n   440→| *Azure-AWS Cross-Cloud Pattern*\n   441→| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n   442→\n   443→| *Coalition Loyalty Expansion*\n   444→| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n   445→|===\n   446→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0d0e08cb-4486-492e-98c4-cabaefeb812f","timestamp":"2026-01-16T04:10:08.451Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","content":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","numLines":446,"startLine":1,"totalLines":446}},"sourceToolAssistantUUID":"39d45bc1-317b-47fb-b29b-cf375133fe84"}
{"parentUuid":"0d0e08cb-4486-492e-98c4-cabaefeb812f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018mcSJSDYekUDcCb9qvMPnG","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I can see the inconsistency. Let me trace through the file:\n\n1. Line 18: \"transitioning to daily transfers with updated SFTP configuration (Phase 1)\" - refers to Phase 1\n2. Line 62: \"Daily overnight batch processing (planned for Phase 1)\" - refers to Phase 1\n3. Line 90: \"Current schedule: weekly on Mondays (Phase 1 changes to daily)\" - refers to Phase 1\n4. Line 177: \"=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\" - refers to Phase 1\n5. Line 181: \"(as-is: weekly Monday; Phase 1: daily)\" - refers to Phase 1\n6. Line 187: \"(as-is: current location; Phase 1: new SFTP target)\" - refers to Phase 1\n7. Line 273-276: \"*TS-2: SFTP Configuration Changes (PLANNED)*\" - this is the actual implementation phase\n\nSo throughout the document, \"Phase 1\" is used to refer to changing from weekly to daily and updating SFTP configuration. But in the implementation phases table, this is labeled as \"TS-2\".\n\nAdditionally, line 295 says \"Phase 1 (TS-2)\" which acknowledges this mapping.\n\nThe user wants consistency. The options are:\n1. Change all \"Phase 1\" references to \"TS-2\"\n2. Change \"TS-2\" to \"TS-1\" or \"Phase 1\"\n3. Establish a clear mapping\n\nLooking at line 295, it already says \"Phase 1 (TS-2)\" which suggests they want to keep the TS numbering but clarify the mapping.\n\nLooking more carefully at the implementation phases:\n- TS-0: Foundation (COMPLETE)\n- TS-1: Reddy Express Production (COMPLETE) - this is the current weekly state\n- TS-2: SFTP Configuration Changes (PLANNED) - this is moving to daily\n\n\n- TS-3: OTR Store Integration (PLANNED)\n\nSo the \"Phase 1\" being referred to throughout the document is the same as TS-2. The best approach is to standardize by replacing all \"Phase 1\" references with \"TS-2\" and all \"Phase 2\" references with \"TS-3\" to align with the authoritative implementation phase naming scheme. This maintains consistency across the document while preserving the TS numbering structure.\n\nThe changes needed are scattered across multiple lines: updating references at lines 18, 62, 90, 177, 181, 187, 306 (twice), 307, and 314 from \"Phase 1\" to \"TS-2\", while keeping the already-correct \"Phase 1 (TS-2)\" and \"Phase 2 (TS-3)\" formats at lines 295-296 intact. level term, while TS-2/3 represent the actual technical phases. The inconsistency arises because \"Phase 1\" appears alone in many places without the TS-2 designation. I should standardize on TS numbering throughout the document since that's what the implementation phases table uses, while preserving the Phase/TS mapping in the Planned Rollout Strategy section for reference.","signature":"EqQaCkYICxgCKkD6c3C0p5EVXmGZLfYXAJvw05hCC7r+Y7lRAjI3V4CZsavXKMECOxZcPJyrB/tleZ93mxGim5A/QZYKtWCT9efAEgw4L6ijYTLxjbDXED8aDFlInzVE4vAltrowqSIwT/O+r8zovCzVlFC2rVAbvCNqoGaoeHOCMJqsWAll9ucKGDKDgtO0vREng9JQtzGLKosZ2+MrcPeF93BrE86zZm2f5SvcOljQIkabKUmeDSVJ+SikvusjYTsU8+DKpcpaFrBpaIRrwVYkFAGye5awDv7u0AvKsP4Org8GEnnxzfyAhoCoJ/myvlBnF+nSy1CTRD2+xq2zsg0GrytIzn8fDM4UMZaa41sk4ZAZDFv/EeBpU3nyzs1sPZkkLjfCw6txV1OPnQOUPdXNGJzx6cdn3IsjCju809WBlcBQf9zI4TsSKzgu8LR85iXcxsikq4HV+Q9u1i1567bupbqQzGcXHGQVNrjf0yKabxlRetYz8wxkEmtb3uWt4Gx7cd+moelbrJlshph6LTul0I4EZwtKn15YagH6NBQg3sEColBKN7KJeDwLrNM8nHabyRT/S7UQkJ2x1+kJqnFPemOmhM2Q3HDlzEp+r3Jq7SJHQ5ow9nNzEJh/bVl2Fg8XnfLjtQHI5zUyF9Xmoy7WdwNa828Hb+oz9Glvq8V6Hq/lxknitEbl5nfYY4j2an7e7RxNjWZkWuuFN8LpGdDSCrUQ0RMti5OeLBg9FTi5MHETZJ6ihYMi/0hFVUQWF6qEaSLRXN5W0T2kdNtsqRQdbdy3Jwx9Bdt1UZ0v3WrLoWt6IYsUGsEeDZNThIs7tyxH4jpPOqjHUg5wDIol4JwzKGJktgL2W0a5ba4flUD5sHkte2YfDxuONV/hjSaJTEj/ZPCUDrOAFRz/HfxC3sQ4wtrxEI8QbvNayabqKot4MJwdzwCbw7U6I0oVMqRXadsZMeJCxAqLWZTRJk2Q6Nq5jRMUZ2z5jGVtcFc3Mb8QtTV7LMlH27jA9O12QsCQFWTqdMfXa4OxByfGjzCUnNKtlGm3oPncdH/D785ZoR+5b5wjGOEi3agRk3B262gQ3zJdAHRAcpE++EswfbRGRNbcx5HeHH5x0mJjIEOZb0N4fu3oofLCAEmj8uocyVCbxsnLR19Q5Iwlnx2d0ubfqJbbBiRkfwnS/RHzRQwBrE0BDUtyvHtIxKufcRwxdj40q4bLFvmvQ778wCLPdsJOBY/XNcLfTq6f7BFXX0H4Tcxu8+y/2dFDhMF83owplM2PPDDp2b5gxuMo86faDgUiJB44BSuwSFC3DvxrgRNYxNEYYS3uTpk/hzIvy4nz8372cU7J0YxgUsu/qMLok/drbF4hRJqp8n3TciVUQ2Mkum+EQargKWqnX+lsERAEG5r5vg2vqzBuqWLz1kIGBe6XtBILfJ5g5iNQ9v4yD8pBdjr78htrvoPx/S7acpRXmWdFCtfK4ZHNcQUjnvY2guLGKWCIH1H+Eb8dvEVvI7Tj242wIah/t8b26SLMRGlcfKxMJrz2j2Xg0XMY25fBpIaRMbpdTsJiplSEGOMTjOT48+RKHvX4XEbbzeCWKwGWvRbeWuT0wQFM54BFQ8U7nJYeI64tTqvBrfgRr9jFQ1JKls/NBckZnvXs+mcFXLMvDgjhukxhZNTbHLXFai6k2bjldPxhGf2rO1faCtD1qNgXkQDnm/10o/lfuVzncYgZ0R7VKtySTvAz0FHlGE1lCdv1zKQbQw4mGK4U+A5UZAqqvIS2BObMdDhYUARQC/qCuyKYrWKOFnx3LL8/d3ARvg8EvBixIk7vMz0kmfIlEtnTfbckYmi6iDTVOBd26CdFZdxOIFnGrKlUZH8b6dT60yRhZ/gOTml3KuIUwhU58hf6Vg21jI1dNwP36eFRmF0wsx2vUXxFOZmPLu3D9ueXnU/1dTIa+DDaZZdb7/4GwS8x+B9X++5P6IpJhCLX26wr52TwPGfQspjELJRT4RLFMbDOavhYIr6HPD4QId8mMuIlnCqruz5FRkn30TlvBSR2GmjK0md+A1YvSsAyC8+yZCvtjLi4CZoEeUm6Smyqql7NeGy0MX7G+p8WXQ6H6VjcjSGmHulhlY33IkQ2ri/uAmQK7kHKUSK24gk5jRPEL5GNBoW5qCtssTlJNHVZId4FfnsmKgj023jtLZBU9elATucxjV7RqN6HlHHjxSqheCk3eqkFkHXO6WCBGtCw/6WuMpM/9WoQ0VhRuoNyKB/AfCYagc8R4o/hvmamsSj+8eENnyWi8qSYNRnh+hbtT9laOwL1wEgVpzMJ83AUTG0NqQAMt16Da1gW19xXFdnwsmZb49o3G8L74e79ZzFdePUpwqyCul5Uc356DmUf7Bt9KeAYMvcq/E5BbFk3GvaGQJ8B3t7EZgsyJSPT2TrXa+F6JWAb0za8hasW6CRmqDIb9G9Ga75Gv9eiqvLPAKcqw5uLl3q8+ixS3y28PUmlsZqm4xSaXd8t9BycqOBRiuGPakpdSGt8OErGyv1krFdQQssrepSQMMEJxcRr3f6oJhTtPCFTuX9Zn4tt3bFonNgXYWd7Mjb/WeL1FSHdKxMExpJBMpkH3DP+EHFaH4YMj+XYiGIZGzX2jPet9o83T5JHLftHQkbmvdYBBgrRpHB3SSrdT8VzLC+wYqVmFS07l3qjEuWJfrkald//N4DhjlYR631l1uRIkrsBGqkKawCGdjnO0DwhMZ33jtrvN9MVVAV0pVPavrFtM5BGZtgCec4Xzax+pUWnQtktRwL8t57YRyOeHZiwGXvPzbJHaJCHFgIfaGSLPjsChIoe6/suR8VN2RgTL8rdGSEMi34+AuWsZ4PlPyQom9bZOyMlb87vNdaP2vGDE9osB8iH256cbdvOJQDqFnVvUL35UE8/P4cz1ahFQP+fzQKEZKsBcyZCap7rbFEwyHR796v9Y/zQveTiSgYJgXN1XVE0bEiPl4LFyQT8Q+Bu77KY7a5yCkjHn/za3FaI9j/2odFnmcYJ4gN7INAN0u6Ed2lCvw2ShQ+Pd4VBcCcE8lgRY3fJmKHub0AKv+2g2I3R2cYQjTCNSnmkMnWPK1d3gmUjwJKxJ7fvrUb9N4jWhrDhvmdmjqQs0kEDpD+MoBLBgx2EK5xoMTM+VBWcvToELXzZeY+7bWlbTMDu7JuCf1Xjt4FAJJdnMjtBWplOLEURP+uaTBNeAPN0gWLZyUldxuaqzPuKRCCk1xvDaIlvO4B8sXtsZcodRwVTuEkbuMglwC6AJMx1J0E2yF3myeNPZhiRSSvwLXvOmLZVArH/4+9i/1DWK4LXmUdoNHsZjsP+El2v6U5IvvgHujN+8IRkZkAae48CxNrsEN5MFfvka0T4WI2ZggsntyEYNT28i2EUlxJEgukQEnSp4sg1c2GBIj4z7u8fqjhrEg/hoKVZ1onmFNB3c4gaAxIRl6mrTkxZ082WvqJ3mPYhfG/gWYI6PqLmIVhURnfJz06y7ldrUcn11e+Sq6O3U3gagFfFqFsY3sSNRZTqgWehonw4tINLYqJhFivPmdJM4w9QK+HXwppa+3nbub5Bz64kyuuBtD7gkWQ0B5k0Lg3+1rB+ZvjFQZvd5lOjk5mvQrekZqfaTSwKE3UgQ4w4uS8MQy5obAyGlZgeh38G/80kTNCgD6s1qkniCARtdd8teEI4bHyoe7qdV0/As82cZ52LcO7IytkWLGLfa1zl6kgWSHhC3M88pf959H3sHIK9rBA60NFLSnOGIQBTT6R1nXi6+C0Pj0LTlNAZgdxSqXweEUFbOzqv6utfH2OTSt0sggQdzadyJLbuFVZ4XArDPgvwyKuvAzGumi7ONjuSqIHCiBS5VWfh/Z800eWw0uCTCouajQfs+dHy4KYDgZzOopwODpdd9U9HrbuTPHV/TcDRml19oh3pEwHEfSRNOmxB7yDb7Ky9opSbk/Mga5E0TJqGK8+6/N8TTRx+fAjX9EZyNtLjox0C3NFl1wAfhX8UOoSb6IfzpByqfJVRZcjo+l1qzxwOqBeAasx76J15k+J5L9UN7IDHU7curRLHhmrzo69fW0bEcV82zmNdj4ub4CKNaRx/myvxvQuW8Vs+oZq10EHHuQcmtz7HXRCBtPRy2lA3xwgq8m/B3fGstHUAgL84oC2XABJH1Ub+Grb9BP2rJS7L8pvmOajQ7GluG0BvyzPlsH5KZ8/6iGg8pqd5k5lUComQ2/fU2ACTzvIz3tCzg8lQOZwn3AUIhbKt8MBQR3C6mx4n9xDAC9njwl4c+tFdphIe1tfocJ1KO6lQtYX/4hYwTupYh4ChT2U6YWzLy6sujWAToVk4pXjwoSROd71prwID6lLXByXHGvwkDHQ0+geBRcRmF5YCCHk9zMaXQs3ZACDavMVhB33n4hhAIFglKZDCYwWmlLfL4Y7u5kY1X2a9X+0FBc3mqIFvKaxa2lQqW5OFMi92Malg3ic1qbBsNsHUf6iXEGbnfxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":7210,"cache_read_input_tokens":25824,"cache_creation":{"ephemeral_5m_input_tokens":7210,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQGF6ZcWnELCVjk3vdc","type":"assistant","uuid":"987fea07-2ca1-4297-bcc2-b30cb39c7408","timestamp":"2026-01-16T04:10:34.582Z"}
{"parentUuid":"987fea07-2ca1-4297-bcc2-b30cb39c7408","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018mcSJSDYekUDcCb9qvMPnG","type":"message","role":"assistant","content":[{"type":"text","text":"I can see the inconsistency. Throughout the document, \"Phase 1\" refers to changing to daily transfers, but in the Implementation Phases section, this is labeled as \"TS-2\". Let me standardize to use the TS numbering consistently throughout."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":7210,"cache_read_input_tokens":25824,"cache_creation":{"ephemeral_5m_input_tokens":7210,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQGF6ZcWnELCVjk3vdc","type":"assistant","uuid":"2d40b093-70ef-4211-a732-6f4617ab6665","timestamp":"2026-01-16T04:10:34.703Z"}
{"parentUuid":"2d40b093-70ef-4211-a732-6f4617ab6665","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018mcSJSDYekUDcCb9qvMPnG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KNv3E4pbZNTLX9NTKL8TyV","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).","new_string":"An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3)."}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":7210,"cache_read_input_tokens":25824,"cache_creation":{"ephemeral_5m_input_tokens":7210,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQGF6ZcWnELCVjk3vdc","type":"assistant","uuid":"817b3e3c-04f7-47c7-a210-00cf25a57861","timestamp":"2026-01-16T04:10:38.979Z"}
{"type":"file-history-snapshot","messageId":"817b3e3c-04f7-47c7-a210-00cf25a57861","snapshot":{"messageId":"e7fcf33d-6db0-44a5-a708-276818d9bf30","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v1","version":1,"backupTime":"2026-01-16T04:11:30.050Z"}},"timestamp":"2026-01-16T04:10:01.423Z"},"isSnapshotUpdate":true}
{"parentUuid":"817b3e3c-04f7-47c7-a210-00cf25a57861","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KNv3E4pbZNTLX9NTKL8TyV","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"c1da778a-059d-46d1-8b82-c967f777f1c7","timestamp":"2026-01-16T04:11:30.030Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).","newString":"An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":15,"oldLines":7,"newStart":15,"newLines":7,"lines":[" <<<"," == What This Initiative Covers"," ","-An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (Phase 1), followed by expansion to OTR convenience stores (Phase 2).","+An existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3)."," "," [cols=\"1,3\"]"," |==="]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"817b3e3c-04f7-47c7-a210-00cf25a57861"}
{"parentUuid":"c1da778a-059d-46d1-8b82-c967f777f1c7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UGfUSAfsqsgrJ18nJv29A6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, now continue with the other references.","signature":"EtUBCkYICxgCKkBrxZi/RhjfDcpNBD90DReEm4K/qaiFkHUfUxdQcjfk2+8zLel7kTBNbh4Myik8sASNTAFqwWiCygMVOtxMOrZwEgzaMT0K7qQRbM5/f+EaDO/EY/yGo6HzGII2ZyIwkHBAS/kpWz2HpztewNrkQ8gXyTTIhAm9qEAqiN9PsecDsnIJlceROT4QAI5qfP1TKj2vtqUyyZkI4IqF5q8UR23xCz+nhcJBbZvBgzURTFT36+sIDLLhzSblfbh0+gu02UB9yWl73jzXs43zE4bDGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1491,"cache_read_input_tokens":33034,"cache_creation":{"ephemeral_5m_input_tokens":1491,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQNFu6yKinVnA854ZTz","type":"assistant","uuid":"afa0cf2e-7768-4286-976d-b5b860068f73","timestamp":"2026-01-16T04:11:32.580Z"}
{"parentUuid":"afa0cf2e-7768-4286-976d-b5b860068f73","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UGfUSAfsqsgrJ18nJv29A6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01R2PdCxhzeb1wRzwjKLVcqs","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.","new_string":"Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming."}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1491,"cache_read_input_tokens":33034,"cache_creation":{"ephemeral_5m_input_tokens":1491,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQNFu6yKinVnA854ZTz","type":"assistant","uuid":"e52115bc-8a87-4946-b695-cbf1c59f7a32","timestamp":"2026-01-16T04:11:35.172Z"}
{"parentUuid":"e52115bc-8a87-4946-b695-cbf1c59f7a32","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01R2PdCxhzeb1wRzwjKLVcqs","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"f84eb8ca-00c4-44f6-998c-00994da0de08","timestamp":"2026-01-16T04:11:35.337Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.","newString":"Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":59,"oldLines":7,"newStart":59,"newLines":7,"lines":[" "," ==== Daily batch is sufficient"," ","-Promotional analytics don't require real-time data. Daily overnight batch processing (planned for Phase 1) meets business requirements with simpler implementation than real-time streaming.","+Promotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming."," "," ==== Metadata-driven configuration"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"e52115bc-8a87-4946-b695-cbf1c59f7a32"}
{"parentUuid":"f84eb8ca-00c4-44f6-998c-00994da0de08","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012aAh1cykeWehNPKXvHpiLE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next one.","signature":"ErEBCkYICxgCKkBXL5jCbH8z/3akn7rFTI9ASuYpii5rw/28zZ80pQZssrNaaMBVf7QxmgcoCH9EmfNZ7QOPqgnzmAwDcfm62uCzEgyIajPOrWGYLNfTy6QaDBaACCEgm0EuhrFy6iIw6KxD2ux4LiyLq8e4aHfXrVwGb5/iHw0ya1FLVcFfYGlF69Z/9jbCcnlmG7rXsmHVKhmRbYH2fUoaYruGPXP4KjaqBhPGMK6JF4K5GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":285,"cache_read_input_tokens":34525,"cache_creation":{"ephemeral_5m_input_tokens":285,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQNeKEgvmprqSHNvu3w","type":"assistant","uuid":"f782d930-8509-4895-91c5-64079bd4570d","timestamp":"2026-01-16T04:11:37.644Z"}
{"parentUuid":"f782d930-8509-4895-91c5-64079bd4570d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012aAh1cykeWehNPKXvHpiLE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0115bgxDChKyLuLkKzDcst5p","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`","new_string":"- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":285,"cache_read_input_tokens":34525,"cache_creation":{"ephemeral_5m_input_tokens":285,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQNeKEgvmprqSHNvu3w","type":"assistant","uuid":"5bd3a63a-98e6-4a83-9f95-4dc105fe3f38","timestamp":"2026-01-16T04:11:42.442Z"}
{"parentUuid":"5bd3a63a-98e6-4a83-9f95-4dc105fe3f38","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0115bgxDChKyLuLkKzDcst5p","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"5c576e1a-4750-4dab-ac06-68d7f7866838","timestamp":"2026-01-16T04:11:42.591Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`","newString":"- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (Phase 1 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":87,"oldLines":7,"newStart":87,"newLines":7,"lines":[" - Monitors ADLS locations for new transaction and product hierarchy files"," - Encrypts files using PGP before transfer"," - Transfers files to Flybuys SFTP server via secure connection","-- Current schedule: weekly on Mondays (Phase 1 changes to daily)","+- Current schedule: weekly on Mondays (TS-2 changes to daily)"," - Pause/resume control mechanism using ADF control flow activities"," - Pipeline: `PL_CM_process_FB_Trans_outbound_extract`"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5bd3a63a-98e6-4a83-9f95-4dc105fe3f38"}
{"parentUuid":"5c576e1a-4750-4dab-ac06-68d7f7866838","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01U9WKrYmxMNqXR71MrYHt3Z","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next, the Customer Journey section.","signature":"EssBCkYICxgCKkAkWvYyD3YZems0YcBBLzPOPaszyxsCSJIqa1UtEpTRDWukoPWrwsmnm27jNuKrRfHLHbQVr6YNFr89NMzb7tsREgxaNwNVQjv5/kBFnLwaDNKfb6XSEU5yUB4/XyIw2T6XFsR2RUfmozPv1qh4qicyhNfieCzkg9qhb2Zf6MwsOCu2TOv6JYeXt+lbUoyAKjOxbis4Mwivh5+LuAhA1yV1VTW55Bs/+8qe6K/MFXfW7lvHaZ0GpY6i4OljMs2WyLcFJZUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":395,"cache_read_input_tokens":34810,"cache_creation":{"ephemeral_5m_input_tokens":395,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQPBDbig9hmAaPxmoYA","type":"assistant","uuid":"324a7601-d9ff-48ce-a23c-6e2cbc0e35be","timestamp":"2026-01-16T04:11:44.966Z"}
{"parentUuid":"324a7601-d9ff-48ce-a23c-6e2cbc0e35be","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01U9WKrYmxMNqXR71MrYHt3Z","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UL1ddRFTuaRYR4y2V81Mh4","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases","new_string":"=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":395,"cache_read_input_tokens":34810,"cache_creation":{"ephemeral_5m_input_tokens":395,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQPBDbig9hmAaPxmoYA","type":"assistant","uuid":"291dc969-05ae-41d6-8103-f679049cadf1","timestamp":"2026-01-16T04:11:53.940Z"}
{"parentUuid":"291dc969-05ae-41d6-8103-f679049cadf1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UL1ddRFTuaRYR4y2V81Mh4","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"d789a0fd-66c3-400f-9195-8da41cdbb39a","timestamp":"2026-01-16T04:11:54.102Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases","newString":"=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":174,"oldLines":16,"newStart":174,"newLines":16,"lines":[" <<<"," == Customer Journey"," ","-=== Transaction Data Flow (As-Is: Weekly; Phase 1: Daily)","+=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)"," "," . Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS"," . Transaction recorded in D365 Commerce with Flybuys barcode linked","-. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; Phase 1: daily)","+. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)"," . Pipeline joins with member lookup table to enrich with full Flybuys card number"," . *Transaction file and Product Hierarchy file generated* and stored in ADLS"," . ADF monitors ADLS for new files"," . ADF encrypts files with PGP","-. *Files transferred to Flybuys SFTP server* (as-is: current location; Phase 1: new SFTP target)","+. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)"," . Flybuys ingests files and attributes transactions to member accounts"," . *Flybuys member earns coalition loyalty points* for Reddy Express purchases"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"291dc969-05ae-41d6-8103-f679049cadf1"}
{"parentUuid":"d789a0fd-66c3-400f-9195-8da41cdbb39a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VQHbSph8jhrcS5k1myMDxi","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now the Non-Functional Requirements section.","signature":"EtQBCkYICxgCKkDFTudiZ56ctp4vdOugZjdjvdfGQ4rWN/OMWSivnt2yPxqiA1WDlyAtGWzkiUUN8SR4CTkviWDf9oISitm/LWGEEgwTceFleDy/Jf3JGxIaDBhYpYkogfliKhPIsCIw6TlWssztjtkBPWnskYgZpzZQHnxyt1P1BylbMC1W+id+61ysuKzsMwzmwKQJIXS9KjxkDdvmKkfOD9j0PYcoHUA5aZLX3wXpypLEEKQJzen1SelHyjvQ6C8rgIy/79wPof8mU9g5Lu4/K+NToaMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":643,"cache_read_input_tokens":35205,"cache_creation":{"ephemeral_5m_input_tokens":643,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQQ2cTJ3SXR3243Hv52","type":"assistant","uuid":"356d7d5c-5170-434e-b957-fe2701659759","timestamp":"2026-01-16T04:11:57.280Z"}
{"parentUuid":"356d7d5c-5170-434e-b957-fe2701659759","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VQHbSph8jhrcS5k1myMDxi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GJtRPqLaoiJ5rzJtpMHv7S","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes","new_string":"| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":643,"cache_read_input_tokens":35205,"cache_creation":{"ephemeral_5m_input_tokens":643,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQQ2cTJ3SXR3243Hv52","type":"assistant","uuid":"0007ca9c-7ed8-4b29-bdfa-506095c1f840","timestamp":"2026-01-16T04:12:01.575Z"}
{"parentUuid":"0007ca9c-7ed8-4b29-bdfa-506095c1f840","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GJtRPqLaoiJ5rzJtpMHv7S","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"2af94caa-99ff-46ea-a2b1-1f8298d832f3","timestamp":"2026-01-16T04:12:01.802Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes","newString":"| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":303,"oldLines":8,"newStart":303,"newLines":8,"lines":[" | Requirement | Target | How We Achieve It"," "," | *Data Freshness*","-| As-is: Weekly (D-7); Phase 1 target: Daily (D-1 data delivered by 02:00 UTC)","-| As-is: Weekly Monday schedule; Phase 1: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes","+| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)","+| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes"," "," | *Data Completeness*"," | 100% of Flybuys member transactions captured (zero data loss)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0007ca9c-7ed8-4b29-bdfa-506095c1f840"}
{"parentUuid":"2af94caa-99ff-46ea-a2b1-1f8298d832f3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SAtkqi8fr8AcGg5hgbuGyK","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next one in the same section.","signature":"EsUBCkYICxgCKkD/LlCg0NmnjVnUiPTIyloGEG7rqmh3AhbivwL+VhCofX+bb16T2DjfcxWdCUE6vXJeSyFV0qkK7O8Zfsn8lzgGEgzzE6S9jeIA2ofJkEMaDLGw3PjIvUry5rBq/SIwMJQ0wJhlVTrzoIU2bGjvl3+dNGLBOv3H1tpsvdDsTCuz1RLsni8Ur0kIanyx0d8ZKi2IigD6DlW4da2/TrdKpBzSpg8ipTlDsC4hl0buD9P0GhaHqgIUx01lliI6GW0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":396,"cache_read_input_tokens":35848,"cache_creation":{"ephemeral_5m_input_tokens":396,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQQbtBwykvWAmc1Zyjs","type":"assistant","uuid":"2f5a164f-175e-457b-8d08-d002cda350d2","timestamp":"2026-01-16T04:12:04.334Z"}
{"parentUuid":"2f5a164f-175e-457b-8d08-d002cda350d2","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SAtkqi8fr8AcGg5hgbuGyK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PEodviKQTExfwBqVfpSdCF","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists","new_string":"| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":396,"cache_read_input_tokens":35848,"cache_creation":{"ephemeral_5m_input_tokens":396,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQQbtBwykvWAmc1Zyjs","type":"assistant","uuid":"ebd8132a-672c-4b81-89b1-7be906d118b3","timestamp":"2026-01-16T04:12:07.596Z"}
{"parentUuid":"ebd8132a-672c-4b81-89b1-7be906d118b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PEodviKQTExfwBqVfpSdCF","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"21bb7fa4-5716-4e7f-bcfb-448d10f4c992","timestamp":"2026-01-16T04:12:07.762Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists","newString":"| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":311,"oldLines":7,"newStart":311,"newLines":7,"lines":[" | SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count"," "," | *SFTP Transfer Success Rate*","-| As-is: 100% weekly transfers; Target: >99% daily transfers (Phase 1)","+| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)"," | Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists"," "," | *Data Security*"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ebd8132a-672c-4b81-89b1-7be906d118b3"}
{"parentUuid":"21bb7fa4-5716-4e7f-bcfb-448d10f4c992","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KyEW56eXffmxhW1WrkCM2L","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next one.","signature":"ErEBCkYICxgCKkBXL5jCbH8z/3akn7rFTI9ASuYpii5rw/28zZ80pQZssrNaaMBVf7QxmgcoCH9EmfNZ7QOPqgnzmAwDcfm62uCzEgw9pGPAGTPGK63gaLMaDM/KFuvCsWGTMf9WrSIwMMooCYKCGa9pZP/yizq4FE/2LPz36s/3vBomoUXkSqS9tNfBsD24X4M0Qy24rNevKhkmI2dSegLXpCSKwWUtEYo+Ki3/KiZ5Z6p1GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":349,"cache_read_input_tokens":36244,"cache_creation":{"ephemeral_5m_input_tokens":349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQR35WNifRExL7vwQP3","type":"assistant","uuid":"6b6b01df-7b85-403d-98ad-345562d56ad1","timestamp":"2026-01-16T04:12:11.856Z"}
{"parentUuid":"6b6b01df-7b85-403d-98ad-345562d56ad1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KyEW56eXffmxhW1WrkCM2L","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ExWL9n6ktyDT65H2Cjcs2Q","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)","new_string":"| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":349,"cache_read_input_tokens":36244,"cache_creation":{"ephemeral_5m_input_tokens":349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQR35WNifRExL7vwQP3","type":"assistant","uuid":"edb81431-eeeb-4c2e-b70b-78f614eada69","timestamp":"2026-01-16T04:12:16.092Z"}
{"parentUuid":"edb81431-eeeb-4c2e-b70b-78f614eada69","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ExWL9n6ktyDT65H2Cjcs2Q","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"2ac507fb-b1a5-414e-b5b2-1820610f5a21","timestamp":"2026-01-16T04:12:16.278Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)","newString":"| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":319,"oldLines":7,"newStart":319,"newLines":7,"lines":[" | PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details"," "," | *Scalability*","-| As-is: Reddy Express stores only; Phase 2 target: 1000+ OTR convenience stores, 50k+ daily transactions","+| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions"," | Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)"," "," | *Operational Flexibility*"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"edb81431-eeeb-4c2e-b70b-78f614eada69"}
{"parentUuid":"2ac507fb-b1a5-414e-b5b2-1820610f5a21","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NfUjDHvd4pg9eKbDtqBe1G","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next, in the Risks section.","signature":"EsMBCkYICxgCKkAai5Z9y2jp1eR2v32gE4jfCXg2U1bcN+kQGDrkaym774WEE1TXdKHzO81/SHdTugxGa/unv5pyBrbitZFb3Li3EgyJHHWHVZ76eIvR9qkaDI78yCAlKoto/i5VwCIwjVrTSL1ApZgmppRUgcxUqVEsFc0jf65IC9v78Zzjg2NrgA3V2o1Bd7jiYWrn8rTVKiuOM4jdgRzVw8aqEY0takPiSKFHdU4Wxq/jrASx6nlzwhgULf/UzZDOKOK9GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":465,"cache_read_input_tokens":36593,"cache_creation":{"ephemeral_5m_input_tokens":465,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQRfSY5eKEC7wasRwnn","type":"assistant","uuid":"02dcfca1-87c6-4d3a-9e5f-8ca411d0d85e","timestamp":"2026-01-16T04:12:18.391Z"}
{"parentUuid":"02dcfca1-87c6-4d3a-9e5f-8ca411d0d85e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NfUjDHvd4pg9eKbDtqBe1G","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GqELFC1Ym7F784j1v9VrW6","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products","new_string":"| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":465,"cache_read_input_tokens":36593,"cache_creation":{"ephemeral_5m_input_tokens":465,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQRfSY5eKEC7wasRwnn","type":"assistant","uuid":"4e008207-fc36-40af-baaa-bbfb31745f76","timestamp":"2026-01-16T04:12:22.278Z"}
{"parentUuid":"4e008207-fc36-40af-baaa-bbfb31745f76","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GqELFC1Ym7F784j1v9VrW6","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"8f360cc4-d28c-4516-9e88-0dd7b69018f4","timestamp":"2026-01-16T04:12:22.447Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products","newString":"| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (Phase 2 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":358,"oldLines":7,"newStart":358,"newLines":7,"lines":[" | New Flybuys members missing from enrichment join, incomplete card numbers"," | Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)"," ","-| *OTR product hierarchy mapping gaps (Phase 2 risk)*","+| *OTR product hierarchy mapping gaps (TS-3 risk)*"," | OTR convenience products not correctly categorised for Flybuys promotions"," | Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"4e008207-fc36-40af-baaa-bbfb31745f76"}
{"parentUuid":"8f360cc4-d28c-4516-9e88-0dd7b69018f4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016rSsPbZDw2r1FKhDWJpBWC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Next one.","signature":"ErEBCkYICxgCKkBXL5jCbH8z/3akn7rFTI9ASuYpii5rw/28zZ80pQZssrNaaMBVf7QxmgcoCH9EmfNZ7QOPqgnzmAwDcfm62uCzEgwBLvhPuvPwKXkB/cMaDCMs+Hmfu5o3/9FDZSIwmg0/szcH8y/u9FkEIjN02XTEq1fD7OZFCtwV8s7ZujnJ+EORPlxmYZWCSQhOrqZRKhlShjC4cKdh8fx8eCVTPsQachUAGnkkFic0GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":368,"cache_read_input_tokens":37058,"cache_creation":{"ephemeral_5m_input_tokens":368,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQS7nJoRTn7pYsCzomL","type":"assistant","uuid":"971c7f37-d840-499f-804a-3b24ab8a3064","timestamp":"2026-01-16T04:12:24.473Z"}
{"parentUuid":"971c7f37-d840-499f-804a-3b24ab8a3064","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016rSsPbZDw2r1FKhDWJpBWC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014V18sJywfGkhCQo6s1Sjsb","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration","new_string":"| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":368,"cache_read_input_tokens":37058,"cache_creation":{"ephemeral_5m_input_tokens":368,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQS7nJoRTn7pYsCzomL","type":"assistant","uuid":"d3308c80-3135-4e12-8bff-de84bbc7c5f7","timestamp":"2026-01-16T04:12:27.679Z"}
{"parentUuid":"d3308c80-3135-4e12-8bff-de84bbc7c5f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014V18sJywfGkhCQo6s1Sjsb","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"0299f7fb-b87a-4369-8ded-b2ae82ce7204","timestamp":"2026-01-16T04:12:27.814Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration","newString":"| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (Phase 1 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":362,"oldLines":7,"newStart":362,"newLines":7,"lines":[" | OTR convenience products not correctly categorised for Flybuys promotions"," | Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products"," ","-| *SFTP target migration failures (Phase 1 risk)*","+| *SFTP target migration failures (TS-2 risk)*"," | Data loss or duplication during SFTP location cutover"," | Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d3308c80-3135-4e12-8bff-de84bbc7c5f7"}
{"parentUuid":"0299f7fb-b87a-4369-8ded-b2ae82ce7204","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AdrsKYoxGHvaXWMstTgXv3","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now in the Key Decisions section.","signature":"EskBCkYICxgCKkBjMu90tPKa9bdV9zI6ng4ceQx+l8+y4DETtlgBSMhUTAkx4lncHrw32N2383ytttaoEjDuTuzJkgsEsc2R22kIEgxh+yt0/8dr9iMfMkcaDMBLDkXkL0pr/XRbkyIwMHA8nO85xsMitDUKDNxGJUdFv7DJe2QrenHD3qnRYlq4Ur5DX6EM2anjc1kJMA0FKjE1ygpq9IQ3IWUCs+1qhxQ5muw+W0KoZFGAzSZHt7QpsHxUWLB6rOGLTNg4MJtQWptRGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":363,"cache_read_input_tokens":37426,"cache_creation":{"ephemeral_5m_input_tokens":363,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQSWjS8kZAzwCaku6hB","type":"assistant","uuid":"8c1471a8-fe0a-48c1-afcd-207d67600d7d","timestamp":"2026-01-16T04:12:30.068Z"}
{"parentUuid":"8c1471a8-fe0a-48c1-afcd-207d67600d7d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AdrsKYoxGHvaXWMstTgXv3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BKwKpZUBFQzNJZp6fuKgaa","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements","new_string":"| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":363,"cache_read_input_tokens":37426,"cache_creation":{"ephemeral_5m_input_tokens":363,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQSWjS8kZAzwCaku6hB","type":"assistant","uuid":"4bd2051a-9f1d-4392-89b7-77f4dbf274cb","timestamp":"2026-01-16T04:12:33.606Z"}
{"parentUuid":"4bd2051a-9f1d-4392-89b7-77f4dbf274cb","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BKwKpZUBFQzNJZp6fuKgaa","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"2204906f-b6e2-4a75-a1bb-31e4037b838d","timestamp":"2026-01-16T04:12:34.056Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements","newString":"| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (Phase 1 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":402,"oldLines":7,"newStart":402,"newLines":7,"lines":[" | Flybuys requires PGP-encrypted files for data security compliance"," | Operational overhead of PGP key management; acceptable for member transaction data protection"," ","-| *Weekly schedule (as-is) → Daily (Phase 1 change)*","+| *Weekly schedule (as-is) → Daily (TS-2 change)*"," | Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience"," | Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"4bd2051a-9f1d-4392-89b7-77f4dbf274cb"}
{"parentUuid":"2204906f-b6e2-4a75-a1bb-31e4037b838d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P5JhS99XdyiJGXZ5py1eyf","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now in the Future Capacity section.","signature":"EssBCkYICxgCKkDkoPbOxtx7Fn51Ep06FdC6WxJTRiY1+t57JN5348itzsn1KDo1W1cTsho2SXW20K4RtMaEdtGKRJar59c3dylrEgwSvTS6jpHfPv57XREaDAhnKGa2ExK7QRd7tCIwXp0Lr8uL1V+tQ1wccyGVNdUUAo3Intuqx/holy4AeynfUnVVc93wl+tkZpUYS/2oKjN+85vgn2Hj/SMYT/3TaD9vBK0xYU8I7Gi/Fvf/cdcsE/fym/YRPS4uKzDHHDtAiVNaS7wYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":330,"cache_read_input_tokens":37789,"cache_creation":{"ephemeral_5m_input_tokens":330,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXAQSyjQ5fFLHdRE9aJX8","type":"assistant","uuid":"4afe3b0a-3827-4bd3-9bb7-3c337484ce45","timestamp":"2026-01-16T04:12:36.187Z"}
{"parentUuid":"4afe3b0a-3827-4bd3-9bb7-3c337484ce45","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01P5JhS99XdyiJGXZ5py1eyf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TJxAsYza4PuJLX8pdKjypA","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships","new_string":"| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":330,"cache_read_input_tokens":37789,"cache_creation":{"ephemeral_5m_input_tokens":330,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXAQSyjQ5fFLHdRE9aJX8","type":"assistant","uuid":"b392f52d-e15b-4ce3-8c88-bfc18fd44ba6","timestamp":"2026-01-16T04:12:38.764Z"}
{"parentUuid":"b392f52d-e15b-4ce3-8c88-bfc18fd44ba6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TJxAsYza4PuJLX8pdKjypA","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"c371bf7a-14ec-48c9-99e0-71111b6a2d08","timestamp":"2026-01-16T04:12:38.949Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships","newString":"| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":426,"oldLines":7,"newStart":426,"newLines":7,"lines":[" | Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)"," "," | *OTR Store Transaction Visibility*","-| Phase 2 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships","+| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships"," "," | *Cross-Brand Product Hierarchy*"," | Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b392f52d-e15b-4ce3-8c88-bfc18fd44ba6"}
{"parentUuid":"c371bf7a-14ec-48c9-99e0-71111b6a2d08","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LxJTNs3vrRy9nr9wMgCcyE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"One more in the same section.","signature":"EsUBCkYICxgCKkAIDPm2y24TGMYzRpXIgvvNDvbpZbHNkxbkC/CWcOlI4O6hoW6vy/7NqJoGmYhpCi59n3v3JwmzjtIrsSvSWGUlEgxYhQ6LnUoevrTWHwQaDDMPNeBWuVThvVE1tyIwnwoArf/0T3IIFRbJRxai9+v3Mjsfrf42w4361+/1e0PdcSXTfopw52URUpQQupZ+Ki2rrxz6hNUm+xIgJ1s27/ZczT/Y24VTAiBteDd7M9kFHzpc0DslUup5Go7JkHQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":280,"cache_read_input_tokens":38119,"cache_creation":{"ephemeral_5m_input_tokens":280,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQTLV53cG4EKKoXLt5a","type":"assistant","uuid":"a95dd042-717e-4563-abf1-66f6714b3e26","timestamp":"2026-01-16T04:12:41.120Z"}
{"parentUuid":"a95dd042-717e-4563-abf1-66f6714b3e26","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LxJTNs3vrRy9nr9wMgCcyE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012TLdFd4xiJ3nWHLMC5P68s","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data","new_string":"| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":280,"cache_read_input_tokens":38119,"cache_creation":{"ephemeral_5m_input_tokens":280,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQTLV53cG4EKKoXLt5a","type":"assistant","uuid":"0002cf2d-db4b-4d00-9bd0-fe3df623eb1f","timestamp":"2026-01-16T04:12:44.619Z"}
{"parentUuid":"0002cf2d-db4b-4d00-9bd0-fe3df623eb1f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012TLdFd4xiJ3nWHLMC5P68s","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"937f8cfa-f6e7-457d-a792-4c247260b1e1","timestamp":"2026-01-16T04:12:44.796Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data","newString":"| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":438,"oldLines":7,"newStart":438,"newLines":7,"lines":[" | Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations"," "," | *Azure-AWS Cross-Cloud Pattern*","-| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; Phase 2 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data","+| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data"," "," | *Coalition Loyalty Expansion*"," | Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0002cf2d-db4b-4d00-9bd0-fe3df623eb1f"}
{"parentUuid":"937f8cfa-f6e7-457d-a792-4c247260b1e1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DLfzzkaP9PYHdrFQbS3G23","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good. Now I should also update the \"Planned Rollout Strategy\" section (lines 294-296) to be consistent. Currently it says \"Phase 1 (TS-2)\" and \"Phase 2 (TS-3)\". Since we're standardizing on TS numbering throughout, I should update this to just use TS-2 and TS-3.","signature":"Eq8DCkYICxgCKkCEuCGDuaSkzLIBHsHW67V0YO2XXXwD+KITGBiyMi/bC32O+JMXF0TCnxMaRUEVqTAyEUi4k6sxENqC0iZpf8o+EgwuIerfoXeRlStuhVAaDJxfeLJK/EdPhsoStSIwHxtTIphfkqwQmoJnusf3yZmiSL+y9Pv+flvSYwKAJ4ygzAaz4VAcFpMYzfu2u8BGKpYCXT9gIxqsWRrnL6MKt0A3ejrSBdJs9GngnL1EZnwzpn+zVnjANXac/BtX4/Ki0DPNSAvg+9CPIzJGXiz0jnJKCAVdgiK5yul0e1B/ZbZKdpA1QH5Ocs64JHGU8ucL4PXzw4bQARxSPkB2jBAsLa+DRvHEsAMis4cfheChAkXBJjAYitCkubPybBLhmaUn8qZ76URkNXC6tA6YwMEmA3G6cgxwwjN5CjZsbgCQCR5BLRwkLa1EVRTrReJ89JxGxgHyLrAXNEMevOqjiKcRSaaNea9oi0P28vqr28XVDQOxfafejoRmp3gs7RwGocmXJ/ZB5NGL9mIesMP7tf8tiwuvVZqu0pMqA2aewS/CCtdZ4tkM1OZmdLsYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":349,"cache_read_input_tokens":38399,"cache_creation":{"ephemeral_5m_input_tokens":349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQTmJKP5fDdnGqwoRkD","type":"assistant","uuid":"6224fefb-079a-4c13-b95e-a0eb7f1f7c00","timestamp":"2026-01-16T04:12:48.879Z"}
{"parentUuid":"6224fefb-079a-4c13-b95e-a0eb7f1f7c00","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DLfzzkaP9PYHdrFQbS3G23","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016pvwTFWLtcsDGyzjoo7mUz","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration","new_string":"*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":349,"cache_read_input_tokens":38399,"cache_creation":{"ephemeral_5m_input_tokens":349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQTmJKP5fDdnGqwoRkD","type":"assistant","uuid":"895d2f16-5eae-492e-b1cb-03dd6957fad4","timestamp":"2026-01-16T04:12:55.372Z"}
{"parentUuid":"895d2f16-5eae-492e-b1cb-03dd6957fad4","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016pvwTFWLtcsDGyzjoo7mUz","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"dc007c1e-14a1-4e0f-b97c-2ce0a52d6b9e","timestamp":"2026-01-16T04:12:55.561Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration","newString":"*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":292,"oldLines":8,"newStart":292,"newLines":8,"lines":[" |==="," "," *Planned Rollout Strategy*:","-- *Phase 1 (TS-2)*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)","-- *Phase 2 (TS-3)*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration","+- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)","+- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration"," "," <<<"," == Non-Functional Requirements (Current & Target)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"895d2f16-5eae-492e-b1cb-03dd6957fad4"}
{"parentUuid":"dc007c1e-14a1-4e0f-b97c-2ce0a52d6b9e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JnaPZRDGHuJp48N4uryo8V","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! I've now made all the changes to ensure consistency. All references to \"Phase 1\" have been changed to \"TS-2\", and all references to \"Phase 2\" have been changed to \"TS-3\". This aligns with the implementation phases table which is the authoritative source for phase numbering.\n\nLet me verify by doing a quick search to make sure I didn't miss any instances.","signature":"EpUECkYICxgCKkBZg1WByQD5mJQTH3sVijqJpFYREgnb55FOqG+bXQXcpnUT+P9eQnKbsmhu4vnK/5+O1JDXbUpOoWgCINbhxk3NEgzvhsqaKTKCFwXkOOMaDC2sUYdObNzvwdwEoyIwyHMLRJIdiPxT7YELWJgQ7A/5CLVu7o2nUcGdnQww4cKcW4bA47eYuViaYYD56GNKKvwCaOncd15Db09Hdv+FxEmnLPzSY3JqCimmoQVHJKjRuJJhDp3tqLk4fynVmTzxI7+RUI18DbFqdh8yRqEjFNdttEHqtnVQJcA3hrxLM/Sd5gbfumCC7yDSlkeGsAON/HCBQA+AaL78DdJjNnzh0x67bEGrXL2mmcAqrjmLCF03mofLENXZrcx44aE+bMnDaZ06v1YfRf/Wbilw/lc524exl2hqBVNdwIVHtbKjCDuOyGjuJa86LZ8Abz1Mpm/ZmbjsIJDiYotuGdvRZFyh/zc9huA0uslA+PcVN8E6KcfePW/ki4Yb3iurHAL5ItLZ58xQC5XfM1+9redAJHQ/qMw4iF8q2x13af+iMMnuz/7QAPGyKZPBhA9dh+MOd2xwNN2962h5SzytsqffSxpviuG5PSEtFardcALUSj2IQG351QRSOdibBspU+rNBRL/3VIVJQTyrrQE5xERiiJEdjoqkbQhklBv57Dg+qbkJgORF9eFK47KE8T9LSyrIisQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":556,"cache_read_input_tokens":38748,"cache_creation":{"ephemeral_5m_input_tokens":556,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXAQUZVS5QAc5CxwENkcC","type":"assistant","uuid":"3ff353f3-af2c-458a-baab-c499e02b360b","timestamp":"2026-01-16T04:12:59.188Z"}
{"parentUuid":"3ff353f3-af2c-458a-baab-c499e02b360b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JnaPZRDGHuJp48N4uryo8V","type":"message","role":"assistant","content":[{"type":"text","text":"Let me verify that all instances have been updated."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":556,"cache_read_input_tokens":38748,"cache_creation":{"ephemeral_5m_input_tokens":556,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXAQUZVS5QAc5CxwENkcC","type":"assistant","uuid":"28582f87-1bcc-4b0c-9b4b-4ccc96f1dcfc","timestamp":"2026-01-16T04:12:59.599Z"}
{"parentUuid":"28582f87-1bcc-4b0c-9b4b-4ccc96f1dcfc","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JnaPZRDGHuJp48N4uryo8V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012ro3dXAA9RNNgQkhebPZwA","name":"Grep","input":{"pattern":"Phase [12]","path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":556,"cache_read_input_tokens":38748,"cache_creation":{"ephemeral_5m_input_tokens":556,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXAQUZVS5QAc5CxwENkcC","type":"assistant","uuid":"bead0fd3-ab96-4f8a-9835-04e9f3acacd8","timestamp":"2026-01-16T04:13:00.575Z"}
{"parentUuid":"bead0fd3-ab96-4f8a-9835-04e9f3acacd8","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012ro3dXAA9RNNgQkhebPZwA","type":"tool_result","content":"163:| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\r\n387:| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)"}]},"uuid":"28cf7752-8b93-4354-9212-7efbb5c4888e","timestamp":"2026-01-16T04:13:02.602Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"163:| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\r\n387:| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)","numLines":2},"sourceToolAssistantUUID":"bead0fd3-ab96-4f8a-9835-04e9f3acacd8"}
{"parentUuid":"28cf7752-8b93-4354-9212-7efbb5c4888e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0197txgQaa3RHZ6PVvMCyrJ5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I found two more instances:\n1. Line 163: \"Phase 2 expansion\" - this is in a capability description and should be \"TS-3\"\n2. Line 387: \"Phase 2 may require\" - this is in the Key Decisions section and should be \"TS-3\"\n\nLet me fix these.","signature":"EpIDCkYICxgCKkB60MNRtKJWE8FAwcPcIGGNUiA62VDITR6+w/v95vxMo6T2NrKbqaGQ6oQEm6T0k+reNqyIU4AfE9RBTRzw3uXmEgzxqYlyk5chm1O3iOkaDJ3Zir84koLB0poaACIwhaH3eGziWa+WitvUJubSOS6OOnXFCfccqeoeamDUxbWCwX7QFDHYRSGtP5jYdKJwKvkBzJ4idLsd8n58myipFLwxsU4/3adqIKVpqGnfXH48onTkthZw/mTOzLbXbo/uPVpVgozuFSlHCT7T5l4o37Is2KBfeYSu3JOZOktpZsS2q8cSpCjsDhk4f0knQFXAAb3VLLTNDAPC/9TI2Cxh7kJvWieuA4Aohv0dFkvTIzXQMgZcLhCR0XiuI7W2oWCf7V6P6nErHrzOqcL9O6n5zuqajFz5ets1JjF/7y024wv3SQkM02Mf1VFUCoIBUkfGKdUOze3+NW9YSmZdKLT5K/GQX9mwr3IfWnRxEbkLLE5U8ECl6VVultA5q2upMqVSr0tSKOg5n1qDhbEjGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":299,"cache_read_input_tokens":39304,"cache_creation":{"ephemeral_5m_input_tokens":299,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQV5fQ378mhf8uQnuoY","type":"assistant","uuid":"7656b633-7c25-4cf8-a760-a8bc67491a8c","timestamp":"2026-01-16T04:13:05.803Z"}
{"parentUuid":"7656b633-7c25-4cf8-a760-a8bc67491a8c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0197txgQaa3RHZ6PVvMCyrJ5","type":"message","role":"assistant","content":[{"type":"text","text":"Found two more instances that need updating."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":299,"cache_read_input_tokens":39304,"cache_creation":{"ephemeral_5m_input_tokens":299,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQV5fQ378mhf8uQnuoY","type":"assistant","uuid":"2590c8a0-a06a-47f8-a110-a4e230c102b0","timestamp":"2026-01-16T04:13:06.311Z"}
{"parentUuid":"2590c8a0-a06a-47f8-a110-a4e230c102b0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0197txgQaa3RHZ6PVvMCyrJ5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017i74LYokB7LGp1UQX77HK1","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)","new_string":"| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":299,"cache_read_input_tokens":39304,"cache_creation":{"ephemeral_5m_input_tokens":299,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQV5fQ378mhf8uQnuoY","type":"assistant","uuid":"2fea388b-53d8-41b7-9d77-c016e021666a","timestamp":"2026-01-16T04:13:09.050Z"}
{"parentUuid":"2fea388b-53d8-41b7-9d77-c016e021666a","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017i74LYokB7LGp1UQX77HK1","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"2bfbdab6-c085-42fa-ae4f-e5acdda55de5","timestamp":"2026-01-16T04:13:09.209Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)","newString":"| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":160,"oldLines":7,"newStart":160,"newLines":7,"lines":[" "," | *Multi-Brand Foundation*"," | Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only","-| Phase 2 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)","+| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)"," "," | *Transaction Data Enrichment*"," | Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"2fea388b-53d8-41b7-9d77-c016e021666a"}
{"parentUuid":"2bfbdab6-c085-42fa-ae4f-e5acdda55de5","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011XFydiBWm9DwmUxnzoCcxs","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, now the last one.","signature":"Er8BCkYICxgCKkCEemcIc8cV1QSAU0Jdq5hxljJ2Udm/Nrdi2uK8PzkBaZWIt8kI7/OjsZjR/PUQcF88Owa+xss0yEcYYtcs4Ch1Egw6JiM1XNiLqggb6EMaDEG5MaL0enLYflsJEiIw2iohonEgL1x28zzi00lCFToGvXRkoJRQG7Rgh/bY1nXviVOfEDS0A9nZSLnqZsVIKidaA02rcW5wyKbi+qz7vHCsx3NBNLz4KbzgHB/KaB145P0fTom3TjsYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":487,"cache_read_input_tokens":39603,"cache_creation":{"ephemeral_5m_input_tokens":487,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQVZdu3qZjpxoRozwSG","type":"assistant","uuid":"115ac2b9-08b7-4efb-bd6c-7891b7056973","timestamp":"2026-01-16T04:13:11.557Z"}
{"parentUuid":"115ac2b9-08b7-4efb-bd6c-7891b7056973","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011XFydiBWm9DwmUxnzoCcxs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Xy3wEM4EErj2MzmyhVoh1z","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)","new_string":"| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (TS-3 may require Azure → AWS data pipeline)"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":487,"cache_read_input_tokens":39603,"cache_creation":{"ephemeral_5m_input_tokens":487,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXAQVZdu3qZjpxoRozwSG","type":"assistant","uuid":"a985b942-a78e-4289-9006-a271837cb729","timestamp":"2026-01-16T04:13:14.528Z"}
{"parentUuid":"a985b942-a78e-4289-9006-a271837cb729","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Xy3wEM4EErj2MzmyhVoh1z","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"bd27af2f-6564-466b-b3da-86d46652b475","timestamp":"2026-01-16T04:13:14.713Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)","newString":"| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (TS-3 may require Azure → AWS data pipeline)","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":384,"oldLines":7,"newStart":384,"newLines":7,"lines":[" "," | *Azure/Fabric platform (not AWS)*"," | D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data","-| Cross-cloud complexity if future AWS-based loyalty services need this data (Phase 2 may require Azure → AWS data pipeline)","+| Cross-cloud complexity if future AWS-based loyalty services need this data (TS-3 may require Azure → AWS data pipeline)"," "," | *SFTP delivery mechanism (not API)*"," | Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"a985b942-a78e-4289-9006-a271837cb729"}
{"parentUuid":"bd27af2f-6564-466b-b3da-86d46652b475","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xs2dS9NphPN11oiF86qG9x","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! Let me verify once more to make sure there are no more \"Phase 1\" or \"Phase 2\" references that should be changed.","signature":"EqICCkYICxgCKkDzkTyHv4KyW+2RxGk3P6NswugYnTN9bVltG2Zzyev6jRxfVqeRk84VVbGyjBLgnXa8gJ7sufRI3PGYQBy01JkiEgwESNP6cU8TCA89BacaDGCP8wzjY1po1VlnZSIwQi/memVRZzv2XC5JqSgcIMaqJ9jjn/H/T1/6blNy9u+L0dwpU8oqbp7CTBOH0aEgKokBQq6/anomIqi4/BmNHaEcVjQcsRCQU4cFHJ+2M3cqk38afUycK544TgM/Aw03rWPGlSxTchYq23GUfojR3B5vn0ZA8WR2u1/IdKpkOliHBbefXZ3yBtzWXgs5k9fjJ93okttZ7R254tUNLAHbWSe6CCGul3KOhJeNqQlokL+0YdluqsxY5rbKJoYYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":338,"cache_read_input_tokens":40090,"cache_creation":{"ephemeral_5m_input_tokens":338,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQVyEDsP675zi5rSrER","type":"assistant","uuid":"463f4939-5d6c-4574-a2e0-bbef6ffe100d","timestamp":"2026-01-16T04:13:17.570Z"}
{"parentUuid":"463f4939-5d6c-4574-a2e0-bbef6ffe100d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Xs2dS9NphPN11oiF86qG9x","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UFKGf6gmGRiZm476e8bk2S","name":"Grep","input":{"pattern":"Phase [12]","path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":338,"cache_read_input_tokens":40090,"cache_creation":{"ephemeral_5m_input_tokens":338,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAQVyEDsP675zi5rSrER","type":"assistant","uuid":"f578f995-87b7-4270-9435-5acd5be005f9","timestamp":"2026-01-16T04:13:18.379Z"}
{"parentUuid":"f578f995-87b7-4270-9435-5acd5be005f9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UFKGf6gmGRiZm476e8bk2S","type":"tool_result","content":"No matches found"}]},"uuid":"cbd7fafa-f531-4995-8d31-c9276c5afdc6","timestamp":"2026-01-16T04:13:19.504Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0},"sourceToolAssistantUUID":"f578f995-87b7-4270-9435-5acd5be005f9"}
{"parentUuid":"cbd7fafa-f531-4995-8d31-c9276c5afdc6","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017MthA83uqn3Da5EV69xzb9","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Excellent! All \"Phase 1\" and \"Phase 2\" references have been updated to \"TS-2\" and \"TS-3\" respectively. The document is now consistent throughout, using the TS numbering scheme that matches the Implementation Phases section.","signature":"EogDCkYICxgCKkANF525moAOWHiYa3XL///KgkQ1G2HeKxGihXjjl8xC0hMwfVbqMemRCFKycgBpaafv4sZs8zAmlH9mp7NK2qwiEgxOblNzw3g8g34x7UQaDOvzaHue8YhLG8FWhyIwa2rP+Zn42qfs6Ah+kvwWv8VWcQSfuJqOHUOSbyhBXQuwZnQA8gjgtIl4nWZnM1iNKu8BdwO68jFVEP+WH1DyOhmaQ9cPQOb5k4lZg32XK1WCS1eVUg3bGx0g61ROiV1P5wdqSltRWCAWyHpxd1VGRO2YRX3n4Eku5a4b278cQgI5A3Qjo0GTJ2dkkJCMwA+xUZl9wQ759O6JdIo87eNjUPQl0K6sUjmVSAYC73uBQe5ilYWLKvCQBtWq1tlgKNOYbLT92CLq7NYJefmXtp38IXaVplnr6WD2p73wmJxZBI/eJ9uX641DBp9hspgkDN9VhcgtL4LmSP31yGek6FcQHE3QaqAaTZyycOVH87OgjI/rgWipHxQZCL/AJ/J3ySknhooYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":179,"cache_read_input_tokens":40428,"cache_creation":{"ephemeral_5m_input_tokens":179,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXAQWKiWviEUYGdTFriuC","type":"assistant","uuid":"d8de8b9a-680d-40b3-9c6d-af6abd0e0069","timestamp":"2026-01-16T04:13:23.002Z"}
{"parentUuid":"d8de8b9a-680d-40b3-9c6d-af6abd0e0069","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017MthA83uqn3Da5EV69xzb9","type":"message","role":"assistant","content":[{"type":"text","text":"Done! I've updated all references throughout the document to be consistent with the implementation phases:\n\n- All \"Phase 1\" references have been changed to \"TS-2\" (SFTP configuration changes, daily cadence)\n- All \"Phase 2\" references have been changed to \"TS-3\" (OTR convenience store expansion)\n\nThe document now consistently uses the TS (Technical Stage) numbering scheme throughout, matching the Implementation Phases section at initiatives/flybuys_strategic_data.adoc:257-292."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":179,"cache_read_input_tokens":40428,"cache_creation":{"ephemeral_5m_input_tokens":179,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXAQWKiWviEUYGdTFriuC","type":"assistant","uuid":"e7464995-6c13-474a-aed5-d232dbcbf371","timestamp":"2026-01-16T04:13:25.180Z"}
{"parentUuid":"e7464995-6c13-474a-aed5-d232dbcbf371","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"system","subtype":"turn_duration","durationMs":153958,"timestamp":"2026-01-16T04:13:26.271Z","uuid":"b7f3c52d-8e02-4ea3-8cf2-c6a63aa9393e","isMeta":false}
{"type":"file-history-snapshot","messageId":"2153334a-0d00-4807-bd8c-366fe1cd292f","snapshot":{"messageId":"2153334a-0d00-4807-bd8c-366fe1cd292f","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v2","version":2,"backupTime":"2026-01-16T05:15:18.036Z"}},"timestamp":"2026-01-16T05:15:18.019Z"},"isSnapshotUpdate":false}
{"parentUuid":"b7f3c52d-8e02-4ea3-8cf2-c6a63aa9393e","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":"incorporate these notes into this doc, but translate their \"Phase 1\" to be our TS-2, and their \"Phase 2\" to be our TS-3 REXP:\n\nREXP manual feed is already in place and can be used by Flybuys to set up the automated ingestion and aim for March 31st.\nBecause IDA was not done for manual ingestion, we will share the IDA for REXP data that we currently ingest manually. Oli to look through and approve the same.\nPartner side changes - Change upload location and change cadence from weekly to daily. Oli confirmed the work effort on their side should be small and aligns with our dependency timeline. Also my team called out that when creating a new sftp user for these new files' ingestion, we need you to create an ssh private key and share linked public key with us.\n \n\n \n\nOTR:\n\nOli confirmed that they can control the shape of the data and will align OTR sales transaction & product hierarchy files to be same structure/attribute as REXP\nOli to provide a sample file with dummy data for us to do some discovery. \nFile with close to prod data will only be available post March production dates. Oli to confirm the exact timelines so we can plan our phase 2 delivery.\n \n\nOther Brands\n\nOut of scope for this SoW. May come in Oct 2026. Will create a new SoW when that is ready for ingestion\nOli to keep the attribute/structure same like other REXP & OTR for consistency\n \n\n \n\nProposed Next steps:\n\n \n\nFlybuys can do a phased delivery approach to meet the different timelines.\n\n \n\nPhase 1:\nREXP delivery target by March 31st to strategic ingestion\nInitiate OTR discovery with sample file with dummy data\nPhase 2\nStarts contingent to sample file with prod similar data for OTR. Current expectation is April-May for delivery, however dependent on OTR readiness and data availability.\nOli to provide with sample file with prod similar data once he has it."},"uuid":"2153334a-0d00-4807-bd8c-366fe1cd292f","timestamp":"2026-01-16T05:15:17.952Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"2153334a-0d00-4807-bd8c-366fe1cd292f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Lqekh11RgjeGxZT3c9S15i","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to incorporate meeting notes into the Flybuys Strategic Data document. I need to:\n\n1. Translate their \"Phase 1\" to our \"TS-2\" (SFTP configuration changes, daily cadence for REXP)\n2. Translate their \"Phase 2\" to our \"TS-3\" (OTR convenience store expansion)\n\nKey points from the notes:\n- REXP manual feed already exists - Flybuys can use it to set up automated ingestion by March 31\n- IDA (Information Disclosure Agreement?) for REXP data needs review/approval by Oli\n- Partner side changes: Change upload location, change cadence from weekly to daily (small effort)\n- Need to create SSH private key and share public key with Flybuys for new SFTP user\n- OTR files will align to same structure/attributes as REXP\n- Sample file with dummy data for OTR to be provided for discovery\n- File with close-to-prod data available post March production dates\n- Other brands (Subway, Oporto) out of scope, may come Oct 2026\n- Phased delivery: Phase 1 = REXP to strategic ingestion by March 31, OTR discovery starts; Phase 2 = OTR delivery April-May pending data availability\n\nI should add this as a new section or integrate into existing sections. Given the structure of the document, I think it makes sense to:\n1. Update the TS-2 and TS-3 descriptions with these details\n2. Add a new section about partner coordination or add to Implementation Phases\n3. Potentially add to Risks & Mitigation about timeline dependencies\n\nLet me read the current document state first to see where these fit best.","signature":"Ev0MCkYICxgCKkDuyxJmHTbAF5Gcyzkf7tMBcU78ittdcmdPgvH74rbcDW90D5kN7dw3/nRqWaJotaZQAsLxeqzoUI4hvGhDUIJuEgxW1ZffMwwCkeS/TIYaDIS/Hjhx3xv7yPJryCIw/JnoeI/qfYrHaKy4rg3JVp4FYQSuSTajKlP512zOUendO2vj9SU3HjR9RZGMnNedKuQLzFZAgj4nsJF4FWEfyQNKcOfgDA6fuuA5GFjMGmh4ysoW3e5OSd52L8Jsk9dwwOBYgYSOWFOZ93RgjwcpO5NE+gB1SEFh6tg8CHWRyPdB4FI4ELI3KTWV5NxIKSH83xrm/1QH1ZVwcjOdDhhC8oNSqxCSyTkTXeNqX4cQN9H/jyOmb2Ua5FUOsqLpbU5cfWDi/D8+6JabfeeDDtOtxsPWdxE9mQgLIUutCDMZkoJtbtNm6zZcwuEqDAV2B0VlT/AmiYhWilR0D0ZlUsm/SJx295STB31VqsH1QAJXF7nC8O5UZe/3J5gWbuZ19sB7tT82aBZjbxJszS1aN2RCt/Vk+nCP5eOmyXas6N486TdO5Kcm3+rqgrt7ko5k0rkmEGkCFEU9CIZXuJ4cKoGQJQTCZmKjJAPgqhATBnoTpBqgVNyCE7GqCpIqzYHZRxvhtYAELDSAZstFLmkLlwYnUcoplQSCBc6Tu8Tulq63rNqhpxmDqzCCEloEHzLjrqxhDOD/LI72Khz0gF0sBgxH/GwwFj1ATBS8WLeq9MRV7GYDcH4GsmUq/yg75gh6HH9CAVdgpEEhc2jrvixigqKYXqcK+jHvdIyciVYFkY/8FOxzSmnNqYZW+A7AdCUzvzykXmv5rR9arBtHvKxGqdrprCd2TRIuFb992qjkErEeudTUXTKMJNcHpM5LMqfL1bT0tIMtOBDFTv6EQAF4b476C5EV7iIwBleVPios/nlr/+W12I7rRnGFhp1F5AGiRrki2etnyAsm6F/3e1ptBmBQejZ8IiYZ2ZQ/zLTDijj/6YEwNhHmbwOHdzP+1HqAy4ngWom2KoS+6rRGIqLjVnhWv1WDebbPoN2EmBVA/lxymA4R7khq/uHDlUT8uoNhtDOOq/PwEIrKTPb6zsg/mng9Xy0PP7iJFzYg3t4cHTMx/yOiK3ocEruHdvuNrzlJrrwPa/JtLL2E4V/OKrBKUHtwaKiEkcQmgfxwNeKwVVMbHpVvQtMJrlk5NSYzkaHL6Yc4yypmBJVUh9lozbPh12oF7Cn1JM+DYFvfgXWwZWqWg3NXtKU2kberWB7ca0xnj2pbZjo+dYES3cGQQ2R9ApTibeBAd+WXp+iI20Lc7pcrtvPlFvw8UPij0G9exyMOWbtETfQLEDLXP0zLfrTkV9/5bvJ9TzIdu6I80Ybsl2AVpQkXlbPsIZYlXrspPjMPHxQRgZR5twJBEQmDfU0YOI37f9L3CI5z9RjWw9QTJ3i/vjXOjf3krpyHsV9TBsqQ19+AcZYPyPHOTojArpUoJz9HYZLsswHRwaeNqFekWZ9mLIZSQ9tOPJ1y3i/ad4d1elH2rudIII3aHOo2ghRN9S2Mlwp0mRHjbKGC4lnNapIyhsD0otvoRUZJY1cap2BZp98Clzzfl3PFYZFWzemwSqDCcuovaCoZ8LPV+qY52hl2cRtnPxH3VU81tYpXPKgAxQe7pug0nEYS991Ho81GIvvYSA5JbK9KsZe0tIpbNyONXU20N7RI4dNQXVT2NXlr2dPSl6Fcl26/fBukZuYSqtf3qu/I10u3VIx8aG0eAJm9c1quk7ebL7VHOA28Nmon78E2XSe7F/Q1OieTXwwUaiOUzfui++0gNT9145mYn1Tp2+PnMr6ZenEbUYvaM2PTpDH7X6bApvF5RhlxC3URen+uWyUzvEdl9ZkDPt5a4w+7goYL4SSJsFvIgg+YSvRJKp6fSKqfr1Fsu8Na6ocmRAqQMNt30ajXDoKTtpcPbVEg/oqusyMJyKnUf/oAcxfbQK0Bcro9lGB/o6j2XDBKlZPkSXN3kDxS1OxI0LbYpWJn9QvUuinpnlneHAJx3L/3CnyURXUT3qYMqnyG1u+vDAvk5i/VfU7ZbZkVw4EpW+jNmkbJPV7t0hCm8jWUNYDFSlJ/eMeW9Gsljv6GLR1L0wEVrK9HR3GPSD+gfI7vO0ZAzBxRXeU2Pa5MF77Ot9+smMaBXWcDnXXgiB95brGGJJIy0HqgLh7TnkoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":39654,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":39654,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXAVERNyS9wtShtZQcWrX","type":"assistant","uuid":"0a54abcd-1a37-4abf-ba5d-501572e090ee","timestamp":"2026-01-16T05:15:28.467Z"}
{"parentUuid":"0a54abcd-1a37-4abf-ba5d-501572e090ee","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Lqekh11RgjeGxZT3c9S15i","type":"message","role":"assistant","content":[{"type":"text","text":"I'll incorporate these meeting notes into the document, translating their Phase 1 to TS-2 and Phase 2 to TS-3. Let me first check the current document structure to determine the best place to add this information."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":39654,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":39654,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXAVERNyS9wtShtZQcWrX","type":"assistant","uuid":"2d15aba7-b0f8-43df-95d1-644c7e5d64be","timestamp":"2026-01-16T05:15:29.271Z"}
{"parentUuid":"2d15aba7-b0f8-43df-95d1-644c7e5d64be","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Lqekh11RgjeGxZT3c9S15i","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K677MC92JkX4PQ4AMK2poy","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","offset":254,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":39654,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":39654,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXAVERNyS9wtShtZQcWrX","type":"assistant","uuid":"b8a645b8-0f40-4aa3-a702-6c7300e0a1f0","timestamp":"2026-01-16T05:15:30.242Z"}
{"parentUuid":"b8a645b8-0f40-4aa3-a702-6c7300e0a1f0","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K677MC92JkX4PQ4AMK2poy","type":"tool_result","content":"   254→\n   255→<<<\n   256→== Implementation Phases\n   257→\n   258→Current production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n   259→\n   260→[cols=\"2,2,1,2\"]\n   261→|===\n   262→| Phase | Capability Enabled | Users | Success Criteria\n   263→\n   264→| *TS-0: Foundation (COMPLETE)*\n   265→| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n   266→| Development team\n   267→| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n   268→\n   269→| *TS-1: Reddy Express Production (COMPLETE)*\n   270→| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n   271→| Reddy Express stores\n   272→| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n   273→\n   274→| *TS-2: SFTP Configuration Changes (PLANNED)*\n   275→| Update SFTP target location and change cadence from weekly (Monday) to daily\n   276→| Reddy Express stores\n   277→| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n   278→\n   279→| *TS-3: OTR Store Integration (PLANNED)*\n   280→| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n   281→| Reddy Express stores + OTR convenience stores\n   282→| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n   283→\n   284→| *TS-4: Full Rollout Validation (PLANNED)*\n   285→| All Reddy Express stores and OTR convenience stores operational with daily transfers\n   286→| All OTRG stores (Reddy Express + convenience)\n   287→| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n   288→\n   289→| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n   290→| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n   291→| All loyalty partners\n   292→| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n   293→|===\n   294→\n   295→*Planned Rollout Strategy*:\n   296→- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n   297→- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n   298→\n   299→<<<\n   300→== Non-Functional Requirements (Current & Target)\n   301→\n   302→[cols=\"1,2,2\"]\n   303→|===\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"fe1158bb-499e-42d6-a44a-654e57d79509","timestamp":"2026-01-16T05:15:30.456Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","content":"\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===","numLines":50,"startLine":254,"totalLines":447}},"sourceToolAssistantUUID":"b8a645b8-0f40-4aa3-a702-6c7300e0a1f0"}
{"parentUuid":"fe1158bb-499e-42d6-a44a-654e57d79509","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017TbwcEoGVcsgwQsUQtBrSR","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I think the best approach is to:\n\n1. Update TS-2 description to include the March 31st target date and the Flybuys partner coordination details\n2. Update TS-3 description to include the April-May timeline and OTR data readiness dependencies\n3. Expand the Planned Rollout Strategy section with more details from the notes\n4. Possibly add a new section on \"Partner Coordination\" or integrate into Implementation Phases\n\nLet me update the Implementation Phases section first.","signature":"EvwECkYICxgCKkBTKCq1roC9gIlJeEMzCq9HqVNzeogJ4x1TVAKKGrfP8iEHxBc37eKdViprXysf5PhulKp4KDkgwZO6bxJcYVVyEgyLQ1ZGbKuDdjrQWDcaDCi5+KiK0beei/YskCIwNKjTr2RczZ3+YIPoECjufx0qcUxgkzNLP0yP5rsMTRmlRKsziSOlZa7WrAawwWCXKuMD3fIefPJDgL03rTfpqET6LFGKG8VkyfAXouGjbKbenRGKD3X2pH326hqJR1U3upuTep6JEFiCPEjFaX6EvvvSqAaSR10KUNyB3SWR1izXkQIR/PGskvC+68TLAk4gEdexJDzdHKO3ZA4BQRm02o3tjGUy0wSeHJEZgSCOt7W3E5aOZ56qDd0cLV0wdkZfetwcEz+EGZuI3qxIww6yF7ffWAHvynwf2VsXILGEpiH7DyQzdsx2AFdrf6qRpcncYA9gKcjVMO9i5viWAzcMawd74bBms8PuvKbY4jIWv4XJyDihmelZObXV8GSVpw/jzR7t4Wg2HbjIQi1+N8axXyIde2Vpx3CwuZGfDudar0nGzSOxb9WdQ7B1Pq0E+VU1QawbHcU2OEhdt3QAnAU6WMuSzxJrDVgDctMjRprMUJdOGwQaZq666pWId1zu/GzT2jzqcnKxYqdtFseUSD52HoenDxuMqQjfkYQFKXmBJlswL47kiJ5gB2LMr2MPsgapZ3VeDoq8r179Ajv/TYNEhnc0oBl/ldEo9kZ8jtlPLPVAn5+a5BRvdcsMorjfGZQ5laxW4TKgMj9jrQdI0ymAVPyzBnHyTj59qd2tcknVrBEO5peKLFnzuAg3laufl9wmKsWNeOgkGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1469,"cache_read_input_tokens":39654,"cache_creation":{"ephemeral_5m_input_tokens":1469,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAVFNDFUjqkJfizwzWNr","type":"assistant","uuid":"599b2f18-96e2-4be5-892d-b0cf2dd4953f","timestamp":"2026-01-16T05:15:36.152Z"}
{"parentUuid":"599b2f18-96e2-4be5-892d-b0cf2dd4953f","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017TbwcEoGVcsgwQsUQtBrSR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Btt6xgw1f9Pb7SNM6iAYow","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt","new_string":"| *TS-2: SFTP Configuration Changes (PLANNED - Target: March 31, 2026)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily; Flybuys automated ingestion using existing REXP manual feed as baseline\n| Reddy Express stores\n| Daily transfers operational by March 31st, new SFTP location validated, zero data loss during migration, Flybuys confirms automated ingestion working, SSH key pair established for new SFTP user"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1469,"cache_read_input_tokens":39654,"cache_creation":{"ephemeral_5m_input_tokens":1469,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAVFNDFUjqkJfizwzWNr","type":"assistant","uuid":"09a2aa75-346f-4cc5-bb1c-1163598cb99b","timestamp":"2026-01-16T05:15:39.775Z"}
{"parentUuid":"09a2aa75-346f-4cc5-bb1c-1163598cb99b","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Btt6xgw1f9Pb7SNM6iAYow","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"67d03ce9-c225-453b-b28e-06aea7357a97","timestamp":"2026-01-16T05:15:39.953Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt","newString":"| *TS-2: SFTP Configuration Changes (PLANNED - Target: March 31, 2026)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily; Flybuys automated ingestion using existing REXP manual feed as baseline\n| Reddy Express stores\n| Daily transfers operational by March 31st, new SFTP location validated, zero data loss during migration, Flybuys confirms automated ingestion working, SSH key pair established for new SFTP user","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:attribute: https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10172891188/DATA-SD-03-02-05+FlyBuys+Loyalty+Transaction+File+-+As+Build+In+Progress\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily\n| Reddy Express stores\n| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (TS-3 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":271,"oldLines":10,"newStart":271,"newLines":10,"lines":[" | Reddy Express stores"," | Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working"," ","-| *TS-2: SFTP Configuration Changes (PLANNED)*","-| Update SFTP target location and change cadence from weekly (Monday) to daily","+| *TS-2: SFTP Configuration Changes (PLANNED - Target: March 31, 2026)*","+| Update SFTP target location and change cadence from weekly (Monday) to daily; Flybuys automated ingestion using existing REXP manual feed as baseline"," | Reddy Express stores","-| Daily transfers operational, new SFTP location validated, zero data loss during migration, Flybuys confirms receipt","+| Daily transfers operational by March 31st, new SFTP location validated, zero data loss during migration, Flybuys confirms automated ingestion working, SSH key pair established for new SFTP user"," "," | *TS-3: OTR Store Integration (PLANNED)*"," | Extend transaction data sharing to OTR convenience stores (1000+ locations)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"09a2aa75-346f-4cc5-bb1c-1163598cb99b"}
{"parentUuid":"67d03ce9-c225-453b-b28e-06aea7357a97","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FAnf8mcmjM1QiuveKoHX9C","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good, now I'll update TS-3 to reflect the OTR timeline and dependencies.","signature":"EvABCkYICxgCKkA97havIrUXa+lSjsKpq5CdaEVm9YRPISKgZCU0YuWRnzzyMw93Yw+0Ndp+q1AhkvAgb+NVLKSNhLTHaDL6mkMAEgw5m6VRg1MRj+TMiZ0aDA4XUABlrxrS+7savSIw9nuTb9+rnSJ8yet8w8pw4/6NULoDpBs/WjIv99JizT2SmxqMcaEBWMAmEIGRDY9BKlidHYIAYywbFyBkmrgiazPLMdT2HOyVwRlzjB3diBxNJhLVhHq3Pw1HTP6a/SRILh2/k3cFiuvvGqtU7S3KYorZVfeaQSTgoJcI8rikRTb56P5qQ8Y0ig06GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":485,"cache_read_input_tokens":41123,"cache_creation":{"ephemeral_5m_input_tokens":485,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXAVG3EmPQKpwkqajPEh8","type":"assistant","uuid":"cec29c4e-6de6-4700-9624-4dfd3f0833e1","timestamp":"2026-01-16T05:15:42.760Z"}
{"parentUuid":"cec29c4e-6de6-4700-9624-4dfd3f0833e1","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FAnf8mcmjM1QiuveKoHX9C","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S25SYVcjsLJm2UKaykazkD","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow","new_string":"| *TS-3: OTR Store Integration (PLANNED - Target: April-May 2026)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations); OTR files aligned to same structure/attributes as REXP for consistency\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow; delivery contingent on OTR sample file with production-similar data availability"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":485,"cache_read_input_tokens":41123,"cache_creation":{"ephemeral_5m_input_tokens":485,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXAVG3EmPQKpwkqajPEh8","type":"assistant","uuid":"05b9ba46-e5c6-466e-b313-a2edb827128c","timestamp":"2026-01-16T05:15:47.391Z"}
{"parentUuid":"05b9ba46-e5c6-466e-b313-a2edb827128c","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S25SYVcjsLJm2UKaykazkD","type":"tool_result","content":"The file /mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc has been updated successfully."}]},"uuid":"9debb0bf-548b-42ca-8567-e0c7e4228480","timestamp":"2026-01-16T05:15:47.625Z","toolUseResult":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","oldString":"| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow","newString":"| *TS-3: OTR Store Integration (PLANNED - Target: April-May 2026)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations); OTR files aligned to same structure/attributes as REXP for consistency\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow; delivery contingent on OTR sample file with production-similar data availability","originalFile":"= Flybuys Strategic Data Integration\n:domain: Loyalty\n:domain-architect: O.Young@otr.com.au\n:project: OTR-2026-04\n:doctype: article\n:attribute: https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10172891188/DATA-SD-03-02-05+FlyBuys+Loyalty+Transaction+File+-+As+Build+In+Progress\n:toc: left\n:toclevels: 3\n:sectanchors:\n:sectlinks:\n:sectnums:\n:icons: font\n:source-highlighter: highlightjs\n:experimental:\n\n<<<\n== What This Initiative Covers\n\nAn existing production data integration that sends Flybuys member transaction and product hierarchy data from Reddy Express stores to Flybuys via SFTP. Currently operating on a weekly schedule, this initiative documents the as-is state and planned changes: transitioning to daily transfers with updated SFTP configuration (TS-2), followed by expansion to OTR convenience stores (TS-3).\n\n[cols=\"1,3\"]\n|===\n| Feature | Description\n\n| Daily transaction file export\n| Automated daily extraction of Flybuys member transactions from D365 Commerce via Microsoft Fabric pipelines to SFTP\n\n| Product hierarchy file export\n| Daily export of Reddy Express product categorisation structure (4-level hierarchy) to support Flybuys promotional analytics\n\n| SFTP secure transfer\n| Encrypted file transfer to Flybuys SFTP server with daily scheduled delivery\n\n| Pause/resume capability\n| Ability to pause daily transfers during promotional periods or operational maintenance windows\n\n| Multi-brand expansion ready\n| Foundation to extend transaction sharing from Reddy Express stores to OTR convenience stores\n\n| Outbound metadata framework\n| Reusable Microsoft Fabric pipeline pattern for partner data exports using metadata-driven configuration\n|===\n\n<<<\n== Architecture Approach\n\nThis is a **Customer-Supplier integration** where OTRG acts as the supplier (data provider) and Flybuys is the customer (data consumer). The solution conforms to Flybuys' data format requirements and SFTP delivery mechanism, as they are the upstream partner in the coalition loyalty relationship.\n\nThe current architecture provides a repeatable pattern for sharing transactional data with external loyalty partners while maintaining clear boundaries: OTRG owns the data extraction and delivery; Flybuys owns the consumption and analytics.\n\n=== Design Principles\n\n==== Back-office native tooling\n\nUses Azure-based Microsoft Fabric and Azure Data Factory for data extraction, as D365 Commerce and transaction data reside in the Azure back-office domain.\n\n==== Conform to partner requirements\n\nFlybuys specifies the file format, delivery mechanism (SFTP), and scheduling. The solution adapts to their integration contract rather than negotiating changes.\n\n==== Daily batch is sufficient\n\nPromotional analytics don't require real-time data. Daily overnight batch processing (planned for TS-2) meets business requirements with simpler implementation than real-time streaming.\n\n==== Metadata-driven configuration\n\nUses Fabric's outbound metadata framework to make the pipeline reusable for other partners (Shell, future coalition programs) without code changes.\n\n==== Encrypted transfer\n\nApplies PGP encryption for files in transit to meet data security requirements for member transaction data.\n\n=== Microsoft Fabric Data Pipeline\n\nTransaction and product data extraction pipeline (currently operational)\n\n- Extracts Flybuys member transactions from D365 Commerce (RAW layer)\n- Joins with member lookup table to enrich with full Flybuys card numbers\n- Applies product hierarchy categorisation (4-level Reddy Express product taxonomy)\n- Generates two files per run: Transaction File and Product Hierarchy File\n- Stores files in ADLS before SFTP transfer\n- Metadata-driven configuration (workspace: `PRP_LH_CM_Raw`, notebook: `NB_CM_Outbound_FB_Trans_Extract`)\n\n=== Azure Data Factory SFTP Integration\n\nSecure file transfer orchestration (currently operational)\n\n- Monitors ADLS locations for new transaction and product hierarchy files\n- Encrypts files using PGP before transfer\n- Transfers files to Flybuys SFTP server via secure connection\n- Current schedule: weekly on Mondays (TS-2 changes to daily)\n- Pause/resume control mechanism using ADF control flow activities\n- Pipeline: `PL_CM_process_FB_Trans_outbound_extract`\n\n=== Transaction Data Scope\n\nFlybuys member transactions only\n\n- Filters for transactions with Flybuys barcode present (`fb.flybuysbarcode is not null`)\n- Includes posted transactions (`entrystatus in (0,2)`)\n- Sales transactions only (`type = 2`)\n- Enriched with member lookup to provide full Flybuys card number\n- Captures discounts, GST, returns, tender types, and basket quantities\n\n=== Product Hierarchy Data\n\nReddy Express product categorisation structure\n\n- 4-level category hierarchy from D365 EcoRes product taxonomy\n- Maps Reddy Express products to Retail Product Category hierarchy\n- Provides category codes and names at each level\n- Supports Flybuys promotional analytics and category-based offers\n\n=== Integration Points\n\n[cols=\"1,3\"]\n|===\n| Integration | Description\n\n| D365 Commerce\n| Source system for transaction data (POS channel) and product hierarchy (EcoRes category tables)\n\n| Microsoft Fabric\n| Data extraction and transformation pipelines (workspace: `PRP_LH_CM_Raw`)\n\n| Azure Data Lake Storage (ADLS)\n| Staging location for transaction and product hierarchy files before SFTP transfer\n\n| Azure Data Factory (ADF)\n| SFTP orchestration, file encryption, scheduling, and control flow management\n\n| Flybuys SFTP Server\n| Destination for daily transaction and product hierarchy files (external partner system)\n\n| Member Lookup Table\n| OTRG member data joined to enrich Flybuys barcode with full card number\n|===\n\n<<<\n== Key Capabilities Delivered\n\n[cols=\"1,2,2\"]\n|===\n| Capability | How It Works | Business Value\n\n| *Daily Transaction Sharing*\n| Automated Fabric pipeline extracts Flybuys member transactions from D365 Commerce and transfers via SFTP\n| Enables Flybuys to attribute Reddy Express purchases to member accounts, powering coalition loyalty points accrual\n\n| *Product Hierarchy Export*\n| Daily export of Reddy Express product categorisation (4-level hierarchy) to support category-based promotions\n| Allows Flybuys to run targeted category promotions (e.g., \"Earn 5x points on Beverages\") at Reddy Express stores\n\n| *Pause/Resume Control*\n| ADF control flow allows Flybuys or OTRG operations to pause daily transfers during promotional windows\n| Operational flexibility to halt data flow during system maintenance or promotional campaign transitions\n\n| *Encrypted File Transfer*\n| PGP encryption applied before SFTP transfer to Flybuys server\n| Protects member transaction data in transit, meeting data security and privacy requirements\n\n| *Multi-Brand Foundation*\n| Metadata-driven pipeline design allows reuse for OTR convenience stores with configuration changes only\n| TS-3 expansion will leverage existing pipelines without rebuilding; pattern applicable to future partners (Shell)\n\n| *Transaction Data Enrichment*\n| Joins Flybuys barcode with member lookup table to provide full card numbers and member identifiers\n| Ensures Flybuys receives complete member identifiers for accurate points attribution\n\n| *Audit Trail & Monitoring*\n| Fabric metadata framework logs pipeline execution, file generation, and SFTP transfer status\n| Operations team has visibility into data delivery success/failure for troubleshooting and SLA compliance\n|===\n\n<<<\n== Customer Journey\n\n=== Transaction Data Flow (As-Is: Weekly; TS-2: Daily)\n\n. Customer with Flybuys card shops at Reddy Express and scans Flybuys barcode at POS\n. Transaction recorded in D365 Commerce with Flybuys barcode linked\n. *Fabric pipeline extracts Flybuys member transactions* (as-is: weekly Monday; TS-2: daily)\n. Pipeline joins with member lookup table to enrich with full Flybuys card number\n. *Transaction file and Product Hierarchy file generated* and stored in ADLS\n. ADF monitors ADLS for new files\n. ADF encrypts files with PGP\n. *Files transferred to Flybuys SFTP server* (as-is: current location; TS-2: new SFTP target)\n. Flybuys ingests files and attributes transactions to member accounts\n. *Flybuys member earns coalition loyalty points* for Reddy Express purchases\n\n[mermaid]\n----\nsequenceDiagram\n    actor Customer as Flybuys Member\n    participant POS as D365 Commerce<br/>POS Channel\n    participant Fabric as Microsoft Fabric<br/>Pipeline\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant ADF as Azure Data Factory<br/>SFTP Pipeline\n    participant SFTP as Flybuys<br/>SFTP Server\n    participant Flybuys as Flybuys<br/>Platform\n\n    Note over Customer,Flybuys: Daily Transaction Data Flow\n\n    Customer ->> POS: Scan Flybuys barcode at checkout\n    POS ->> POS: Record transaction with Flybuys barcode\n\n    Note over Fabric,Flybuys: Daily Scheduled Export (01:00 UTC)\n    Fabric ->> POS: Extract Flybuys member transactions (SQL query)\n    Fabric ->> Fabric: Join with member lookup table\n    Fabric ->> Fabric: Generate Transaction File + Product Hierarchy File\n    Fabric ->> ADLS: Store files (Member_Transactions/ & Product_Hierarchy/)\n\n    ADLS ->> ADF: Trigger SFTP pipeline (file watch)\n    ADF ->> ADF: PGP encrypt files\n    ADF ->> SFTP: Transfer encrypted files via SFTP\n    SFTP ->> Flybuys: Ingest transaction and product data\n    Flybuys ->> Flybuys: Attribute transactions to member accounts\n    Flybuys -->> Customer: Award coalition loyalty points\n----\n\n=== Pause/Resume Control Flow\n\n. Flybuys or OTRG operations team requests pause of daily transfers\n. Operations team accesses ADF control mechanism\n. *Daily SFTP transfer schedule paused* via ADF control flow activity\n. No files transferred during pause period (previous day's data held in ADLS)\n. Operations team resumes transfers when ready\n. *ADF pipeline resumes daily schedule*\n. Backlog of files transferred (if applicable)\n\n[mermaid]\n----\nsequenceDiagram\n    actor Ops as Operations Team\n    participant ADF as Azure Data Factory<br/>Control Flow\n    participant ADLS as Azure Data Lake<br/>Storage\n    participant SFTP as Flybuys<br/>SFTP Server\n\n    Note over Ops,SFTP: Pause Request Scenario\n    Ops ->> ADF: Request pause of daily transfers\n    ADF ->> ADF: Update control flag (pause=true)\n    Note over ADF,SFTP: Daily schedule runs but skip SFTP transfer\n    ADF ->> ADLS: Files continue to accumulate\n\n    Note over Ops,SFTP: Resume Request Scenario\n    Ops ->> ADF: Request resume of daily transfers\n    ADF ->> ADF: Update control flag (pause=false)\n    ADF ->> ADLS: Check for backlog files\n    alt Backlog exists\n        ADF ->> SFTP: Transfer backlog files (catch-up)\n    end\n    ADF ->> SFTP: Resume daily scheduled transfers\n----\n\n<<<\n== Implementation Phases\n\nCurrent production state (TS-0, TS-1 complete) and planned changes (TS-2 onwards)\n\n[cols=\"2,2,1,2\"]\n|===\n| Phase | Capability Enabled | Users | Success Criteria\n\n| *TS-0: Foundation (COMPLETE)*\n| Fabric pipeline development, D365 Commerce data extraction, member lookup integration, ADLS storage, metadata framework\n| Development team\n| Transaction and product hierarchy SQL queries validated, Fabric notebook operational, ADLS file storage configured\n\n| *TS-1: Reddy Express Production (COMPLETE)*\n| Reddy Express stores sending Flybuys transaction data weekly via SFTP\n| Reddy Express stores\n| Weekly file transfers successful, Flybuys ingestion validated, coalition points attribution working\n\n| *TS-2: SFTP Configuration Changes (PLANNED - Target: March 31, 2026)*\n| Update SFTP target location and change cadence from weekly (Monday) to daily; Flybuys automated ingestion using existing REXP manual feed as baseline\n| Reddy Express stores\n| Daily transfers operational by March 31st, new SFTP location validated, zero data loss during migration, Flybuys confirms automated ingestion working, SSH key pair established for new SFTP user\n\n| *TS-3: OTR Store Integration (PLANNED)*\n| Extend transaction data sharing to OTR convenience stores (1000+ locations)\n| Reddy Express stores + OTR convenience stores\n| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow\n\n| *TS-4: Full Rollout Validation (PLANNED)*\n| All Reddy Express stores and OTR convenience stores operational with daily transfers\n| All OTRG stores (Reddy Express + convenience)\n| >99% daily transfer success rate, Flybuys SLA compliance, zero member complaints about missing points\n\n| *TS-5: Target State - Multi-Partner Foundation (FUTURE)*\n| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It\n\n| *Data Freshness*\n| As-is: Weekly (D-7); TS-2 target: Daily (D-1 data delivered by 02:00 UTC)\n| As-is: Weekly Monday schedule; TS-2: Fabric pipeline scheduled at 01:00 UTC daily; ADF SFTP transfer completes within 1 hour; typical end-to-end processing time 45 minutes\n\n| *Data Completeness*\n| 100% of Flybuys member transactions captured (zero data loss)\n| SQL query filters on posted transactions (`entrystatus in (0,2)`); Fabric pipeline retry logic on transient failures; daily reconciliation report comparing transaction count vs POS count\n\n| *SFTP Transfer Success Rate*\n| As-is: 100% weekly transfers; Target: >99% daily transfers (TS-2)\n| Current: ADF retry logic with exponential backoff (3 retries, 5-15-30 minute intervals); automated alerts on failure; manual intervention playbook exists\n\n| *Data Security*\n| Encrypted in transit, secure SFTP access, member data protected\n| PGP encryption applied before SFTP transfer; Flybuys SFTP server requires SSH key authentication; no member PII beyond Flybuys card number and transaction details\n\n| *Scalability*\n| As-is: Reddy Express stores only; TS-3 target: 1000+ OTR convenience stores, 50k+ daily transactions\n| Current architecture: Fabric pipeline scales horizontally; ADLS storage virtually unlimited; SFTP bandwidth sufficient for 50MB daily files (current typical size 5-10MB)\n\n| *Operational Flexibility*\n| Pause/resume capability, manual re-run of failed transfers\n| ADF control flow activities enable pause/resume; Fabric notebook can be manually triggered for specific date ranges; ADLS retains files for 90 days for reprocessing\n\n| *Monitoring & Alerting*\n| Pipeline failure alerts within 15 minutes, daily success/failure dashboard\n| Fabric metadata framework logs execution status; ADF monitoring with CloudWatch-equivalent alerts; operations dashboard shows daily transfer status and file counts\n\n| *Data Residency*\n| Transaction data stored in Australia (ap-southeast-2 equivalent Azure region)\n| ADLS and Fabric workspaces in Azure Australia East region; D365 Commerce production in Australia region; SFTP transfer to Flybuys (Australian partner)\n|===\n\n<<<\n== Risks & Mitigation (Current & Planned)\n\n[cols=\"1,1,2\"]\n|===\n| Risk | Impact | Mitigation\n\n| *D365 Commerce data quality issues*\n| Incomplete or incorrect transaction data sent to Flybuys\n| SQL query validation in development; daily reconciliation report comparing transaction count and total sales value vs POS reporting; automated alerts on data anomalies (e.g., zero transactions on non-holiday weekday)\n\n| *Fabric pipeline failures*\n| Transfer missed, Flybuys members don't receive points timely\n| Current mitigation: Fabric pipeline retry logic; automated alerts to operations team; manual re-run capability; SLA with Flybuys allows T+2 delivery for failed T+1 transfers\n\n| *SFTP connectivity issues*\n| Files not delivered to Flybuys server\n| Current mitigation: ADF retry logic with exponential backoff; automated alerts; ADLS retains files for 90 days for manual re-transfer; Flybuys operations contact established for server-side issues\n\n| *Member lookup table data lag*\n| New Flybuys members missing from enrichment join, incomplete card numbers\n| Member lookup table refreshed daily before transaction pipeline runs; fallback to Flybuys barcode if full card number unavailable (Flybuys can resolve during ingestion)\n\n| *OTR product hierarchy mapping gaps (TS-3 risk)*\n| OTR convenience products not correctly categorised for Flybuys promotions\n| Planned mitigation: Pilot phase validation with 5-10 convenience stores; product hierarchy mapping review with Flybuys before full rollout; fallback to generic \"Convenience\" category for unmapped products\n\n| *SFTP target migration failures (TS-2 risk)*\n| Data loss or duplication during SFTP location cutover\n| Planned mitigation: Parallel run for 7 days (send to both old and new SFTP locations); Flybuys confirms receipt at new location before disabling old location; rollback plan retains old SFTP configuration\n\n| *Pause mechanism misconfiguration*\n| Transfers paused unintentionally, or resume forgotten\n| Current mitigation: ADF control flow activity with explicit enable/disable flag; operations runbook with checklist; automated alert planned if pause duration exceeds 7 days (requires approval for extended pause)\n\n| *Data volume growth exceeding SFTP limits*\n| Large file sizes cause SFTP transfer timeouts or failures\n| Monitor file size trends; compress files if size exceeds 100MB; negotiate with Flybuys for alternative transfer mechanism (e.g., Azure Blob Storage) if SFTP proves insufficient\n|===\n\n<<<\n== Key Decisions Made\n\n[cols=\"1,2,2\"]\n|===\n| Decision | Rationale | Trade-off Accepted\n\n| *Azure/Fabric platform (not AWS)*\n| D365 Commerce and transaction data reside in Azure back-office domain; Microsoft Fabric native integration with D365 data\n| Cross-cloud complexity if future AWS-based loyalty services need this data (TS-3 may require Azure → AWS data pipeline)\n\n| *SFTP delivery mechanism (not API)*\n| Flybuys specifies SFTP as integration method; conformist pattern applies (we adapt to their requirements)\n| No real-time data availability; daily batch latency (T+1 data); SFTP operational overhead vs API simplicity\n\n| *Daily batch (not real-time)*\n| Flybuys promotional analytics don't require real-time data; daily batch simpler to implement and operate\n| Flybuys members see coalition points T+1 (not immediately after purchase); acceptable for coalition loyalty use case\n\n| *Metadata-driven pipeline (not hardcoded)*\n| Reusable pattern for future partners (Shell, other coalition programs); configuration changes only for new partners\n| Additional complexity in metadata framework setup; justified by multi-partner expansion roadmap\n\n| *PGP encryption (not TLS-only)*\n| Flybuys requires PGP-encrypted files for data security compliance\n| Operational overhead of PGP key management; acceptable for member transaction data protection\n\n| *Weekly schedule (as-is) → Daily (TS-2 change)*\n| Initial production deployment used weekly schedule for pilot validation; daily schedule required for Flybuys SLA and improved member experience\n| Weekly schedule provides delayed points attribution; daily schedule increases operational load but meets business requirements\n\n| *Customer-Supplier with Conformist pattern*\n| Flybuys is upstream partner controlling data format and delivery mechanism; we conform to avoid integration negotiation complexity\n| Less control over data format and delivery mechanism; acceptable for coalition loyalty partnership\n\n| *No Anti-Corruption Layer*\n| Transaction data is generic (sales transactions); no Reddy Express-specific domain model requiring protection\n| Direct coupling to Flybuys data format; future format changes require pipeline updates; acceptable given stable Flybuys API contract\n|===\n\n<<<\n== Future Capacity Delivered\n\n[cols=\"1,3\"]\n|===\n| Stream | Capacity\n\n| *Multi-Partner Data Sharing Pattern*\n| Metadata-driven Fabric pipeline pattern reusable for Shell Price Save, future coalition partners, and promotional partners (AFL, Budget Direct)\n\n| *OTR Store Transaction Visibility*\n| TS-3 establishes OTR convenience store transaction data flow to external partners, enabling future coalition loyalty and promotional partnerships\n\n| *Cross-Brand Product Hierarchy*\n| Extended product categorisation framework supports Reddy Express brands (Subway, Oporto) and OTR convenience products in unified taxonomy\n\n| *Data Export Foundation*\n| ADLS and Fabric pipeline infrastructure reusable for other back-office data exports (inventory data, promotional performance, customer feedback surveys)\n\n| *Partner Integration Playbook*\n| Operational runbooks and technical patterns documented for onboarding future loyalty and promotional partners with SFTP or API-based integrations\n\n| *Azure-AWS Cross-Cloud Pattern*\n| Establishes precedent for back-office (Azure) to customer-facing (AWS) data pipelines; TS-3 may require xref:bounded-contexts:loyalty_service.adoc[LoyaltyService] integration on AWS to consume Flybuys transaction data\n\n| *Coalition Loyalty Expansion*\n| Proves viability of coalition loyalty partnerships beyond Flybuys; opens strategic options for multi-brand loyalty programs across OTR Group portfolio\n|===\n","structuredPatch":[{"oldStart":276,"oldLines":10,"newStart":276,"newLines":10,"lines":[" | Reddy Express stores"," | Daily transfers operational by March 31st, new SFTP location validated, zero data loss during migration, Flybuys confirms automated ingestion working, SSH key pair established for new SFTP user"," ","-| *TS-3: OTR Store Integration (PLANNED)*","-| Extend transaction data sharing to OTR convenience stores (1000+ locations)","+| *TS-3: OTR Store Integration (PLANNED - Target: April-May 2026)*","+| Extend transaction data sharing to OTR convenience stores (1000+ locations); OTR files aligned to same structure/attributes as REXP for consistency"," | Reddy Express stores + OTR convenience stores","-| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow","+| OTR transactions flowing to Flybuys, product hierarchy extended to include OTR convenience products, no disruption to Reddy Express data flow; delivery contingent on OTR sample file with production-similar data availability"," "," | *TS-4: Full Rollout Validation (PLANNED)*"," | All Reddy Express stores and OTR convenience stores operational with daily transfers"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"05b9ba46-e5c6-466e-b313-a2edb827128c"}
{"parentUuid":"9debb0bf-548b-42ca-8567-e0c7e4228480","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"system","subtype":"api_error","level":"error","error":{},"retryInMs":524.1769977263792,"retryAttempt":1,"maxRetries":10,"timestamp":"2026-01-16T05:25:30.227Z","uuid":"ac8d0770-d9c3-4c19-8124-00b1ecd842db"}
{"parentUuid":"ac8d0770-d9c3-4c19-8124-00b1ecd842db","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012XaYK5LZW28k1DWzX3LVud","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I'll add details about the other brands being out of scope and potentially coming in Oct 2026. Let me add a note after TS-5 or in the rollout strategy section.","signature":"EswCCkYICxgCKkCAejOayDLb3yMP0jYh6T/Yz6Ui3uA3q6Nk8lHuW1R0MEQIR1lmf7dScwBKELawZgHJVjxVxu4Jh59jOJBShKcAEgyWia2btszBPqpi6AsaDHKOUfQBSZFoWAHWsSIwKTErL8k+sJXKQmoS9W0X5ahDNm0X5ufXuvTqukktN9z7sN5OUaBJJtW24pFoZaJHKrMBcZvLPK/mpZvDZJx1IpI5wJ6e9MLW71nCDi1IkKTV+8x9zet10yQNWa5YLgwcg/AN+UenKMmOG/5+aiKdeZEfzirh7RjVKuRnHeT9LPw53QHYE8F7Inh4xV/A9TbbTonm8zfhEC8Fw7y/W9Iew2sGZUtUfW+nGw/5iO2T2jvhVKsnIZYgd2u/rOC0csx4iYZGjpo0byEaK1ge96lohJ8aKZ2dOOeEkarV/HPavw/yJgfLPtwYAQ=="},{"type":"tool_use","id":"toolu_01CeAkty9FxpRDywCYPG7s2P","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","old_string":"*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration","new_string":"*Planned Rollout Strategy*:\n\n- *TS-2 (March 31, 2026 target)*:\n  ** OTRG: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n  ** OTRG: Create SSH private key and share linked public key with Flybuys for new SFTP user\n  ** Flybuys: Set up automated ingestion using existing REXP manual feed as baseline; review and approve IDA (Information Disclosure Agreement) for REXP data\n  ** Flybuys: Small work effort expected on partner side to change upload location and cadence from weekly to daily\n  ** Initiate OTR discovery: OTRG to provide sample file with dummy data for Flybuys discovery and validation\n\n- *TS-3 (April-May 2026 target)*:\n  ** **Delivery contingent on OTRG providing sample file with production-similar OTR data** (expected post-March production dates)\n  ** Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality\n  ** OTR files aligned to same structure/attributes as REXP for consistency and reusability\n  ** Phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks\n  ** Rollback plan retains Reddy Express-only configuration\n\n*Out of Scope*:\n\n- *Other Brands (Subway, Oporto)*: Not included in current SoW; may be added October 2026 with new SoW; will maintain same attribute/structure as REXP and OTR for consistency"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":42030,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":42030,"ephemeral_1h_input_tokens":0},"output_tokens":729,"service_tier":"standard"}},"requestId":"req_011CXAVGbwmgHhoRUMTcX8jm","type":"assistant","uuid":"740b068f-b430-41f3-99aa-acaca88b256d","timestamp":"2026-01-16T05:25:41.960Z"}
{"parentUuid":"740b068f-b430-41f3-99aa-acaca88b256d","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01CeAkty9FxpRDywCYPG7s2P"}]},"uuid":"64d8691c-72d4-4d2e-908b-23894c6d17dd","timestamp":"2026-01-16T05:25:42.005Z","toolUseResult":"Error: File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.","sourceToolAssistantUUID":"740b068f-b430-41f3-99aa-acaca88b256d"}
{"parentUuid":"64d8691c-72d4-4d2e-908b-23894c6d17dd","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KTqPMgScJfDjkEFjn6EAU5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The file has been modified. I notice the user changed line 19 to say \"OTR convenience stores and mobile application(TS-3)\" which is different from what I saw before. Let me re-read the relevant section to see the current state.","signature":"EowDCkYICxgCKkAbDEd3zT3zHRrWS9CYV7GQ5PrgEdQuZx8KY+B4AhORxBb+pBArSX1vVmj1fTWt43cXqBsH7mvgUijjvY+ibPskEgzFCGz8bg4gpJ2BaSAaDGAp6Xa82ztmBm7iaCIw4gSsWr1tizifDRz3UdSGZhiKGGOMisFYi0AAitz7zZpfbTHFgf9pnejQF4L040OoKvMBRL6wZUc8KTZpt2viFeylMqp2ruh7C9xPOJAxRT9tyj/TeUy1iHQkYQGAECCSoSyDlnHn6jYwHt72YaeQxac3GHDnYRxZ+guzOhPn5LM0Ti0fZnaJtIOP1SFPYpR8IkulRA7+XBQ2OqT9+T+v5aCkSs8D4XrAGCqGOxAiH5tU+c46xRJYNwQBUSv+twSwKDp/YBb1zBIrnS4IgykbNf8cLlJ3Ft4DwlPDI8jZ1+ygzD+TCsuY1LeqNJuuOnxCAhIkVCmjIRLgVRua/14hQSuIS9SoxN1p+lsmK0SnkFp8lzobYIwzkzBW+qkJFz31HeMyeaAhGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":23789,"cache_read_input_tokens":19701,"cache_creation":{"ephemeral_5m_input_tokens":23789,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAW2SJZucoqKBTnVpx8m","type":"assistant","uuid":"8b4b680d-d3c8-44a0-8f30-81d034281b82","timestamp":"2026-01-16T05:25:46.424Z"}
{"parentUuid":"8b4b680d-d3c8-44a0-8f30-81d034281b82","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01KTqPMgScJfDjkEFjn6EAU5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BJkokf1G7jNsmraEp8mGEv","name":"Read","input":{"file_path":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","offset":290,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":23789,"cache_read_input_tokens":19701,"cache_creation":{"ephemeral_5m_input_tokens":23789,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAW2SJZucoqKBTnVpx8m","type":"assistant","uuid":"92a6b17d-34ba-45bd-8a6f-e969d5f8d0b9","timestamp":"2026-01-16T05:25:47.268Z"}
{"parentUuid":"92a6b17d-34ba-45bd-8a6f-e969d5f8d0b9","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BJkokf1G7jNsmraEp8mGEv","type":"tool_result","content":"   290→| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n   291→| All loyalty partners\n   292→| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n   293→|===\n   294→\n   295→*Planned Rollout Strategy*:\n   296→- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n   297→- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n   298→\n   299→<<<\n   300→== Non-Functional Requirements (Current & Target)\n   301→\n   302→[cols=\"1,2,2\"]\n   303→|===\n   304→| Requirement | Target | How We Achieve It\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"13634ca9-8a8b-4ef6-9f18-7419536d80ea","timestamp":"2026-01-16T05:25:47.543Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/Users/o.young/work/architecture/initiatives/flybuys_strategic_data.adoc","content":"| Pipeline pattern reusable for other coalition partners (Shell Price Save, future partners)\n| All loyalty partners\n| Metadata-driven configuration allows new partner onboarding with configuration changes only (no code changes)\n|===\n\n*Planned Rollout Strategy*:\n- *TS-2*: SFTP configuration changes to be tested in non-production environment first; parallel run with old and new SFTP locations for 7 days; cutover during low-volume period (weekend)\n- *TS-3*: Pilot planned for 5-10 OTR convenience stores for 30 days to validate product hierarchy mapping and transaction data quality; phased rollout by region (SA, VIC, NSW, QLD) over 8 weeks; rollback plan retains Reddy Express-only configuration\n\n<<<\n== Non-Functional Requirements (Current & Target)\n\n[cols=\"1,2,2\"]\n|===\n| Requirement | Target | How We Achieve It","numLines":15,"startLine":290,"totalLines":447}},"sourceToolAssistantUUID":"92a6b17d-34ba-45bd-8a6f-e969d5f8d0b9"}
{"parentUuid":"13634ca9-8a8b-4ef6-9f18-7419536d80ea","isSidechain":false,"userType":"external","cwd":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","version":"2.1.9","gitBranch":"subway-dmb","slug":"happy-petting-cat","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BHFzYerey4BJW4vM3hB51F","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"OK, now I can see the current state. The Planned Rollout Strategy section is still in the simple format. Let me now make the edit with the current file state.","signature":"EscCCkYICxgCKkB7PrNF/ueDZcEiOwyiRpH30Btsyx4FB2OTgb977sHu3ArtEazFVEm2vQb8rz+zv4yQlAiqPv5M71rOUNLA2Dc6EgzkoymmDHwXdm8WdfQaDM4G4iSLkPqgstY1OSIwqTF2qwX7XNR55ApFOIWM+WdtuDoopuPPUkaMTvr1WRdr5jOFfAEoPMvLxxJzOHEjKq4BU2omNAgqSBMgmjxDJ0JDuhsFUp1ya4pceGxRLv9CdGhY3sKLegkZrhHvP2w7YHC2RKu/Xdtm3TuuDO+gnNmZ9UVUBn/yDPFGz9t5ApK15FRfQiTKXEFUt9GPgUZjkrQ2iMOL79JsnTbaw3WhoO2RT1htc0Q8AbAP+Gq8sP82IynpdSWQ7I53RoNszYga4gpiaNPN9j6ZCp6JsrmoH3Lc2gaQrr44Aw5mG9gQzcduGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":545,"cache_read_input_tokens":43490,"cache_creation":{"ephemeral_5m_input_tokens":545,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXAW2qKf7WCsgrFxmxTSX","type":"assistant","uuid":"07438656-e9d9-4193-883b-4d2e6200c141","timestamp":"2026-01-16T05:25:50.990Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.169Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"f241900d-169c-4c46-b77e-446bee258c34","snapshot":{"messageId":"f241900d-169c-4c46-b77e-446bee258c34","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.179Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.268Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.305Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"56e66c75-dc85-467b-b728-e6f86aa7c5e5","snapshot":{"messageId":"56e66c75-dc85-467b-b728-e6f86aa7c5e5","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.306Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.348Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.388Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"8567a1d2-5799-4f44-9836-308c4e6126f7","snapshot":{"messageId":"8567a1d2-5799-4f44-9836-308c4e6126f7","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.398Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.440Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.501Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4fae2d3a-c5e0-4a4e-9aaf-a73369ea9ba4","snapshot":{"messageId":"4fae2d3a-c5e0-4a4e-9aaf-a73369ea9ba4","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.512Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.548Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.585Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a2bc7062-8389-4600-ba0e-761d2d274770","snapshot":{"messageId":"a2bc7062-8389-4600-ba0e-761d2d274770","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.585Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.658Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.705Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"3e68f734-4302-4407-9fa8-01ecc6b6ee81","snapshot":{"messageId":"3e68f734-4302-4407-9fa8-01ecc6b6ee81","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.708Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.756Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.800Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4e06b31a-4db7-4ccb-b389-28637639dd09","snapshot":{"messageId":"4e06b31a-4db7-4ccb-b389-28637639dd09","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.811Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.861Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.905Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"5011f38b-4947-480c-9320-3a63d4babdf6","snapshot":{"messageId":"5011f38b-4947-480c-9320-3a63d4babdf6","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.916Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:51.959Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:51.995Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"c1649f96-dd3d-4b20-8ee8-09905fcd8547","snapshot":{"messageId":"c1649f96-dd3d-4b20-8ee8-09905fcd8547","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:51.996Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.051Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.096Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"e8d7c0de-efdd-4a88-ad0e-4e627b03617c","snapshot":{"messageId":"e8d7c0de-efdd-4a88-ad0e-4e627b03617c","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.105Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.146Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.211Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d071d58d-3c5e-497e-81a1-828ede9afbf1","snapshot":{"messageId":"d071d58d-3c5e-497e-81a1-828ede9afbf1","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.225Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.313Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.365Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"9b77f98f-d6bf-4f9f-9845-3276bbdb5efe","snapshot":{"messageId":"9b77f98f-d6bf-4f9f-9845-3276bbdb5efe","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.368Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.459Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.497Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a80d30e3-d3c2-4a0b-8bb7-6f4859a13ed0","snapshot":{"messageId":"a80d30e3-d3c2-4a0b-8bb7-6f4859a13ed0","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.498Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.588Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.648Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"385afb52-4e02-428f-92df-b2f1001e6bb9","snapshot":{"messageId":"385afb52-4e02-428f-92df-b2f1001e6bb9","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.650Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.753Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.814Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d6df489e-67ed-4047-ba71-c103cd1244f1","snapshot":{"messageId":"d6df489e-67ed-4047-ba71-c103cd1244f1","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.817Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.866Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:52.920Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"686dd51d-2168-4340-8bd0-e6aff3688ac3","snapshot":{"messageId":"686dd51d-2168-4340-8bd0-e6aff3688ac3","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:52.922Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:52.985Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.049Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b01b826e-e553-468d-97b7-1817abb59324","snapshot":{"messageId":"b01b826e-e553-468d-97b7-1817abb59324","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.051Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.106Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.162Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a670e920-bda1-455e-ba61-2cb56b13cd09","snapshot":{"messageId":"a670e920-bda1-455e-ba61-2cb56b13cd09","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.171Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.214Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.269Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"645eeeb2-f422-47af-ba20-f7d848963fa6","snapshot":{"messageId":"645eeeb2-f422-47af-ba20-f7d848963fa6","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.272Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.324Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.373Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b3b1bda8-fd43-4f11-bcdd-231058d80615","snapshot":{"messageId":"b3b1bda8-fd43-4f11-bcdd-231058d80615","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.382Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.439Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.491Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"2317c481-e75d-444d-80d0-a4c3581e53fc","snapshot":{"messageId":"2317c481-e75d-444d-80d0-a4c3581e53fc","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.502Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.554Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.609Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4f0135c4-16b2-4d1d-9efc-586a473b72eb","snapshot":{"messageId":"4f0135c4-16b2-4d1d-9efc-586a473b72eb","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.611Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.653Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.710Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"55f6cf8a-7c53-4b49-994d-4f909c63928a","snapshot":{"messageId":"55f6cf8a-7c53-4b49-994d-4f909c63928a","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.723Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.776Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.845Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"5f179911-039f-4c2f-9ec3-9f22ac3384dd","snapshot":{"messageId":"5f179911-039f-4c2f-9ec3-9f22ac3384dd","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.850Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:53.914Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:53.974Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a4408ee4-c4b0-4110-8ae6-29e1050a5802","snapshot":{"messageId":"a4408ee4-c4b0-4110-8ae6-29e1050a5802","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:53.994Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.043Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.120Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"0434aa3d-d7a6-42aa-b373-ea1fd5b5c6aa","snapshot":{"messageId":"0434aa3d-d7a6-42aa-b373-ea1fd5b5c6aa","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.123Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.196Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.274Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a8c957b7-32b1-4443-a4e8-e37d2c453133","snapshot":{"messageId":"a8c957b7-32b1-4443-a4e8-e37d2c453133","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.291Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.338Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.405Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"64c99339-e411-480c-abda-d7ba3b47e385","snapshot":{"messageId":"64c99339-e411-480c-abda-d7ba3b47e385","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.420Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.478Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.561Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a19fa26d-5726-4931-8bbf-fefdb6f6542b","snapshot":{"messageId":"a19fa26d-5726-4931-8bbf-fefdb6f6542b","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.562Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.631Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.702Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"821d939e-a986-4e2a-bf08-1f8462a6d8c2","snapshot":{"messageId":"821d939e-a986-4e2a-bf08-1f8462a6d8c2","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.712Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.763Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.836Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"85320fd4-ec04-4689-8f48-aa24a89ef536","snapshot":{"messageId":"85320fd4-ec04-4689-8f48-aa24a89ef536","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:54.846Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:54.893Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:54.981Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"f0080484-9957-449e-978c-da44c7e71115","snapshot":{"messageId":"f0080484-9957-449e-978c-da44c7e71115","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.003Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.084Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.182Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"11bec143-14b6-4318-92a9-bd49d131f01e","snapshot":{"messageId":"11bec143-14b6-4318-92a9-bd49d131f01e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.199Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.266Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.349Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b912e280-649d-46aa-9740-24e93dd23271","snapshot":{"messageId":"b912e280-649d-46aa-9740-24e93dd23271","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.359Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.423Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.505Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4f225184-80c5-4f1a-8f1f-f208eb35c881","snapshot":{"messageId":"4f225184-80c5-4f1a-8f1f-f208eb35c881","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.517Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.589Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.683Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"de8909f5-a51f-4198-a940-7bac66f62fa5","snapshot":{"messageId":"de8909f5-a51f-4198-a940-7bac66f62fa5","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.698Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.766Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.842Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"96e73413-bb7d-4c71-945c-aa549a1292a4","snapshot":{"messageId":"96e73413-bb7d-4c71-945c-aa549a1292a4","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.851Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:55.902Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:55.984Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6627137c-50cd-4f95-a22d-2dfe4c100496","snapshot":{"messageId":"6627137c-50cd-4f95-a22d-2dfe4c100496","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:55.998Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.063Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.140Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"c4f3cf3b-75c2-4586-87e2-5bec0af9c11e","snapshot":{"messageId":"c4f3cf3b-75c2-4586-87e2-5bec0af9c11e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.161Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.212Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.287Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"7ebb3e5c-869b-4b65-a274-b534c91d2d17","snapshot":{"messageId":"7ebb3e5c-869b-4b65-a274-b534c91d2d17","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.288Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.372Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.464Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"3f62a128-4e29-4103-8401-b3640c357c4f","snapshot":{"messageId":"3f62a128-4e29-4103-8401-b3640c357c4f","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.473Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.529Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.601Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"54e893e7-b21b-4a45-93ad-5de104dc7384","snapshot":{"messageId":"54e893e7-b21b-4a45-93ad-5de104dc7384","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.613Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.651Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.731Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"ba098788-7ab3-4480-8d8e-71cf215b39fa","snapshot":{"messageId":"ba098788-7ab3-4480-8d8e-71cf215b39fa","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.750Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.799Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:56.878Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4e1ba751-fa66-4e33-9484-2947985cbe21","snapshot":{"messageId":"4e1ba751-fa66-4e33-9484-2947985cbe21","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:56.897Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:56.954Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.023Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"58e4a9af-ba00-4c85-a375-6f3fca6b06ee","snapshot":{"messageId":"58e4a9af-ba00-4c85-a375-6f3fca6b06ee","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:57.026Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:57.094Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.154Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"1a2cb561-2d99-4597-a625-298e11761d2a","snapshot":{"messageId":"1a2cb561-2d99-4597-a625-298e11761d2a","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:57.165Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:57.223Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.295Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"fab659f3-5c39-452e-9c53-ec8f6054718a","snapshot":{"messageId":"fab659f3-5c39-452e-9c53-ec8f6054718a","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:57.299Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:57.367Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.470Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b4f138c7-0dbd-45c0-8542-d6b60be16fd4","snapshot":{"messageId":"b4f138c7-0dbd-45c0-8542-d6b60be16fd4","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:57.499Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:57.569Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.725Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"cb40d6c8-b800-447e-a813-d7eb41bc6299","snapshot":{"messageId":"cb40d6c8-b800-447e-a813-d7eb41bc6299","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:57.744Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:57.848Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:57.987Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"26fbf095-47e6-4771-b20e-9ecdaf0cec16","snapshot":{"messageId":"26fbf095-47e6-4771-b20e-9ecdaf0cec16","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.006Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:58.069Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:58.167Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d50cdd5a-90b6-4399-872f-a97f61e7453a","snapshot":{"messageId":"d50cdd5a-90b6-4399-872f-a97f61e7453a","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.183Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:58.255Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:58.342Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"06027de5-5519-4c25-af80-1b037e29f982","snapshot":{"messageId":"06027de5-5519-4c25-af80-1b037e29f982","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.366Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:58.442Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:58.654Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4e52f1c3-06db-4331-9a91-54b6a7f04f67","snapshot":{"messageId":"4e52f1c3-06db-4331-9a91-54b6a7f04f67","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.656Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:58.724Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:58.804Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6c80a195-ee75-42e5-b957-bed5095a0eaa","snapshot":{"messageId":"6c80a195-ee75-42e5-b957-bed5095a0eaa","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.824Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:58.881Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:58.956Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d132c235-12d4-4171-9ad5-313dfebc6ee6","snapshot":{"messageId":"d132c235-12d4-4171-9ad5-313dfebc6ee6","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:58.958Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.026Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.096Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a736c460-31b3-49d6-a018-3b13206d7557","snapshot":{"messageId":"a736c460-31b3-49d6-a018-3b13206d7557","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.115Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.160Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.229Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"cc504180-c4e1-44c5-a4fb-108183e125e8","snapshot":{"messageId":"cc504180-c4e1-44c5-a4fb-108183e125e8","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.247Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.298Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.353Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"dd8f5a1b-3ccf-4f60-9e25-e4692f973a29","snapshot":{"messageId":"dd8f5a1b-3ccf-4f60-9e25-e4692f973a29","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.373Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.430Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.488Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"299cb2dd-7ca6-445f-aa12-5296d44a79b7","snapshot":{"messageId":"299cb2dd-7ca6-445f-aa12-5296d44a79b7","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.495Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.559Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.617Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"713e0f2b-4dbd-4bda-83d5-6ee78fc8bf66","snapshot":{"messageId":"713e0f2b-4dbd-4bda-83d5-6ee78fc8bf66","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.618Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.673Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.727Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"c14ef58c-41b6-4114-aaa5-51863a04c282","snapshot":{"messageId":"c14ef58c-41b6-4114-aaa5-51863a04c282","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.737Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.789Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.845Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b56800f8-e554-4410-988a-c3c38d74122c","snapshot":{"messageId":"b56800f8-e554-4410-988a-c3c38d74122c","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.860Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:30:59.914Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:30:59.988Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"00133505-e64a-4529-a9e8-d2515a22fca3","snapshot":{"messageId":"00133505-e64a-4529-a9e8-d2515a22fca3","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:30:59.991Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.057Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.133Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"70d53970-9d13-4b38-8794-85057177119f","snapshot":{"messageId":"70d53970-9d13-4b38-8794-85057177119f","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.142Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.206Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.280Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4a345e1c-2739-4b1b-8f9a-717cbf0359d0","snapshot":{"messageId":"4a345e1c-2739-4b1b-8f9a-717cbf0359d0","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.292Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.342Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.417Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"ae27a6dc-92f0-4768-bced-16b00f8999ab","snapshot":{"messageId":"ae27a6dc-92f0-4768-bced-16b00f8999ab","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.421Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.492Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.567Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"eec734db-dd68-441c-96a6-ff55e377f95a","snapshot":{"messageId":"eec734db-dd68-441c-96a6-ff55e377f95a","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.578Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.641Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.702Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"01493bd1-512a-41c3-945d-e6e11b5c7025","snapshot":{"messageId":"01493bd1-512a-41c3-945d-e6e11b5c7025","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.719Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.775Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:00.872Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"58d3caca-73db-4238-88f7-20fc067f3272","snapshot":{"messageId":"58d3caca-73db-4238-88f7-20fc067f3272","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:00.885Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:00.942Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.016Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"da5f7eb4-2f13-4ff9-9c28-e7f2a2cf5272","snapshot":{"messageId":"da5f7eb4-2f13-4ff9-9c28-e7f2a2cf5272","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.029Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.081Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.154Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"3bfd041c-8c94-4ce9-88af-321b0292a667","snapshot":{"messageId":"3bfd041c-8c94-4ce9-88af-321b0292a667","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.157Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.206Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.292Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"bcce9097-b39f-446a-88ff-ce9ea7cb52f4","snapshot":{"messageId":"bcce9097-b39f-446a-88ff-ce9ea7cb52f4","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.293Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.350Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.412Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6764afe3-b8cf-49d2-8003-4209b47a5e1e","snapshot":{"messageId":"6764afe3-b8cf-49d2-8003-4209b47a5e1e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.413Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.470Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.548Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"35416f55-e9e4-449e-bfd3-73dba85c8640","snapshot":{"messageId":"35416f55-e9e4-449e-bfd3-73dba85c8640","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.558Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.609Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.676Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"9974adc6-0a41-4aaa-aaf1-ea5aa0762474","snapshot":{"messageId":"9974adc6-0a41-4aaa-aaf1-ea5aa0762474","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.679Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.742Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.800Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"fff42aad-9cd3-4c6c-bf5c-2eb557685595","snapshot":{"messageId":"fff42aad-9cd3-4c6c-bf5c-2eb557685595","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.818Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:01.867Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:01.953Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"628d23cb-23a9-41b0-ab19-bd82d49918b8","snapshot":{"messageId":"628d23cb-23a9-41b0-ab19-bd82d49918b8","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:01.958Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.027Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.107Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"8169397b-7e93-4c65-b01a-70841bd0fd50","snapshot":{"messageId":"8169397b-7e93-4c65-b01a-70841bd0fd50","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.126Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.179Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.255Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"807288d9-6560-4f8c-80b7-27e346557aad","snapshot":{"messageId":"807288d9-6560-4f8c-80b7-27e346557aad","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.260Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.324Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.392Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4e667eed-fc56-43b1-bf24-2e2f61d167de","snapshot":{"messageId":"4e667eed-fc56-43b1-bf24-2e2f61d167de","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.393Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.458Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.512Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"87a05e71-e580-405f-b39a-f285a00768f3","snapshot":{"messageId":"87a05e71-e580-405f-b39a-f285a00768f3","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.514Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.584Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.667Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a9dcca0b-8bee-4a76-9046-b5ac4952d43e","snapshot":{"messageId":"a9dcca0b-8bee-4a76-9046-b5ac4952d43e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.687Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.744Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:02.837Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"94eb55ff-5f3a-4fdb-bf94-2b2270528db0","snapshot":{"messageId":"94eb55ff-5f3a-4fdb-bf94-2b2270528db0","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:02.851Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:02.918Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:03.004Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"5407f4f0-cdfc-42df-a7d1-948a9e37daa6","snapshot":{"messageId":"5407f4f0-cdfc-42df-a7d1-948a9e37daa6","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:03.037Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:03.111Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:03.271Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"151faf4f-6988-41b4-b8fe-b8508c9fe202","snapshot":{"messageId":"151faf4f-6988-41b4-b8fe-b8508c9fe202","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:03.280Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:03.363Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:03.475Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"ae606a9e-50ed-44a6-b105-7cb59e5f02c8","snapshot":{"messageId":"ae606a9e-50ed-44a6-b105-7cb59e5f02c8","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:03.491Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:03.582Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:03.738Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d4af17fa-c235-47a5-92ec-4f74c30dc171","snapshot":{"messageId":"d4af17fa-c235-47a5-92ec-4f74c30dc171","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:03.752Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:03.856Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:03.922Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"5bbf0b93-705c-49bb-9e4c-32bb0ac4859c","snapshot":{"messageId":"5bbf0b93-705c-49bb-9e4c-32bb0ac4859c","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:03.932Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:03.999Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.056Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"2fb3d990-bb19-4a06-ba0f-0e0537d0a496","snapshot":{"messageId":"2fb3d990-bb19-4a06-ba0f-0e0537d0a496","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.059Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.138Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.213Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"9c100cbc-3700-45da-b85c-0abea3a303b3","snapshot":{"messageId":"9c100cbc-3700-45da-b85c-0abea3a303b3","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.231Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.283Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.352Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b762faf5-0605-4d9c-9604-c720e51798ce","snapshot":{"messageId":"b762faf5-0605-4d9c-9604-c720e51798ce","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.354Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.416Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.467Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"15becfb2-fa15-4c80-990a-28f0101ca434","snapshot":{"messageId":"15becfb2-fa15-4c80-990a-28f0101ca434","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.474Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.531Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.596Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"9f07f02b-4d57-4d31-9090-923b144177d5","snapshot":{"messageId":"9f07f02b-4d57-4d31-9090-923b144177d5","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.605Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.643Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.727Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"1f1669d7-437e-421b-aed7-443c80bb8d5e","snapshot":{"messageId":"1f1669d7-437e-421b-aed7-443c80bb8d5e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.741Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.783Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:04.874Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"de9d932f-8994-4e12-b170-94ea20c0b3de","snapshot":{"messageId":"de9d932f-8994-4e12-b170-94ea20c0b3de","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:04.886Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:04.949Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.021Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"3f0935bb-f217-4357-b63e-47397533f852","snapshot":{"messageId":"3f0935bb-f217-4357-b63e-47397533f852","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.038Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.090Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.171Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b2b799b8-927a-4e29-9b7b-ea36033078ff","snapshot":{"messageId":"b2b799b8-927a-4e29-9b7b-ea36033078ff","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.187Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.242Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.315Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"cbd015b1-da2f-41b1-ac4b-d7d97887dc21","snapshot":{"messageId":"cbd015b1-da2f-41b1-ac4b-d7d97887dc21","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.318Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.380Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.450Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"7de0d3b6-bc37-4269-bd1e-7bad9ab8aea1","snapshot":{"messageId":"7de0d3b6-bc37-4269-bd1e-7bad9ab8aea1","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.453Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.517Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.591Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"817af404-a4b6-4e21-9053-1220314fc431","snapshot":{"messageId":"817af404-a4b6-4e21-9053-1220314fc431","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.596Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.645Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.732Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4d0adc79-dfda-4cf0-8f37-6867d97e21f5","snapshot":{"messageId":"4d0adc79-dfda-4cf0-8f37-6867d97e21f5","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.734Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.801Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:05.877Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"e3e19972-5853-464f-95c4-a294bedd918e","snapshot":{"messageId":"e3e19972-5853-464f-95c4-a294bedd918e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:05.882Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:05.955Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:06.039Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"c25547f4-fd23-41f5-8e71-7950e0bf0d0e","snapshot":{"messageId":"c25547f4-fd23-41f5-8e71-7950e0bf0d0e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:06.062Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:06.121Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:06.208Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"86c693b4-c3d2-4202-bd22-f41f97094041","snapshot":{"messageId":"86c693b4-c3d2-4202-bd22-f41f97094041","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:06.219Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:06.304Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:06.408Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"12cb12ca-d5aa-49ad-8430-05f421b86dff","snapshot":{"messageId":"12cb12ca-d5aa-49ad-8430-05f421b86dff","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:06.436Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:06.486Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:06.582Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b6e7fd0c-0325-4f9c-9b1f-b1642eb42878","snapshot":{"messageId":"b6e7fd0c-0325-4f9c-9b1f-b1642eb42878","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:06.607Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:06.656Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:06.758Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"da0dc5ee-071f-4b55-8da6-e1013c250bfa","snapshot":{"messageId":"da0dc5ee-071f-4b55-8da6-e1013c250bfa","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:06.779Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:06.851Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:07.008Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"151f74f6-e0a8-4eda-bbe0-a05aa8dcaa6d","snapshot":{"messageId":"151f74f6-e0a8-4eda-bbe0-a05aa8dcaa6d","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:07.025Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:07.087Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:07.231Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"b6f01c43-a82b-4ed4-875f-a46cc272f9f1","snapshot":{"messageId":"b6f01c43-a82b-4ed4-875f-a46cc272f9f1","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:07.245Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:07.347Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:07.579Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"f96baf45-254f-441a-84fe-532dcaf44a55","snapshot":{"messageId":"f96baf45-254f-441a-84fe-532dcaf44a55","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:07.581Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:07.681Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:07.792Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"0695d77d-380a-4e96-9013-bf9f040b51e8","snapshot":{"messageId":"0695d77d-380a-4e96-9013-bf9f040b51e8","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:07.794Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:07.875Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:07.985Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"dab6c0b7-6f95-4c14-94f5-7cd0ba22d492","snapshot":{"messageId":"dab6c0b7-6f95-4c14-94f5-7cd0ba22d492","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.012Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.077Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:08.178Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"11bd7641-35ce-401f-86a7-457fe798d17b","snapshot":{"messageId":"11bd7641-35ce-401f-86a7-457fe798d17b","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.207Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.269Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:08.397Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"680059f2-e830-4563-9f68-e4949421d643","snapshot":{"messageId":"680059f2-e830-4563-9f68-e4949421d643","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.420Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.485Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:08.565Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"0d2fdf99-cfbd-4504-825c-1e805ce2375e","snapshot":{"messageId":"0d2fdf99-cfbd-4504-825c-1e805ce2375e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.583Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.671Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:08.753Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d3522a02-a573-4adf-8b33-0fad4f625e48","snapshot":{"messageId":"d3522a02-a573-4adf-8b33-0fad4f625e48","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.754Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.838Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:08.910Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6af3dbe3-4d95-4909-8d4d-892b0ccee1ba","snapshot":{"messageId":"6af3dbe3-4d95-4909-8d4d-892b0ccee1ba","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:08.930Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:08.987Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.061Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"a15ffb83-1764-402a-aee5-18ae4a549154","snapshot":{"messageId":"a15ffb83-1764-402a-aee5-18ae4a549154","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.062Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:09.126Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.199Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6be4109d-a5c3-4a8c-a3e4-f1bdde1aaa36","snapshot":{"messageId":"6be4109d-a5c3-4a8c-a3e4-f1bdde1aaa36","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.200Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:09.306Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.371Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"1cdc6e4e-3863-4849-ae95-b935aed15998","snapshot":{"messageId":"1cdc6e4e-3863-4849-ae95-b935aed15998","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.375Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:09.483Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.535Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d14d1760-432e-49a9-8704-7e68f8e4a133","snapshot":{"messageId":"d14d1760-432e-49a9-8704-7e68f8e4a133","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.548Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:09.728Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.800Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d0d3fe66-99ff-477c-82a0-229a3b66ebc6","snapshot":{"messageId":"d0d3fe66-99ff-477c-82a0-229a3b66ebc6","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.813Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:09.919Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:09.986Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"8e3dca82-ea68-4fce-beb4-67ed5159ed37","snapshot":{"messageId":"8e3dca82-ea68-4fce-beb4-67ed5159ed37","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:09.987Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:10.072Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:10.125Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"6f3305cc-85ef-4574-928a-52a46300ca40","snapshot":{"messageId":"6f3305cc-85ef-4574-928a-52a46300ca40","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:10.137Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:10.203Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:10.256Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"afcef9a8-ca68-4a21-af6a-5b60ee028bbc","snapshot":{"messageId":"afcef9a8-ca68-4a21-af6a-5b60ee028bbc","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:10.264Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:10.338Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:10.387Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"f2e85f2c-8108-4454-a5fa-656c6d013416","snapshot":{"messageId":"f2e85f2c-8108-4454-a5fa-656c6d013416","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:10.408Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:10.462Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:10.527Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"8d5db462-a4da-40b1-9a07-dede7b6f06ae","snapshot":{"messageId":"8d5db462-a4da-40b1-9a07-dede7b6f06ae","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:10.530Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:10.584Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:10.629Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"e410c76a-ec8e-4506-a2f7-afe83cee1428","snapshot":{"messageId":"e410c76a-ec8e-4506-a2f7-afe83cee1428","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:10.633Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.223Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:11.293Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"fcb7ca73-257e-4332-b773-f68723a250b7","snapshot":{"messageId":"fcb7ca73-257e-4332-b773-f68723a250b7","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:11.296Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.361Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:11.407Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"8b6479d7-95ab-40a1-ae6a-a80b4e1decdc","snapshot":{"messageId":"8b6479d7-95ab-40a1-ae6a-a80b4e1decdc","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:11.419Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.468Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:11.507Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"57caf1ff-33e6-4dc6-9b19-b2d4a343f650","snapshot":{"messageId":"57caf1ff-33e6-4dc6-9b19-b2d4a343f650","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:11.518Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.571Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:11.656Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"02cb3f70-d56e-488d-872b-aca4c431793b","snapshot":{"messageId":"02cb3f70-d56e-488d-872b-aca4c431793b","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:11.668Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.714Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:11.764Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"86c54df1-4056-4fb5-abb5-455f5d8eeb40","snapshot":{"messageId":"86c54df1-4056-4fb5-abb5-455f5d8eeb40","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:11.778Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:11.830Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.426Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"717a7bb2-f97a-4e35-8f3f-e8da29ae13a1","snapshot":{"messageId":"717a7bb2-f97a-4e35-8f3f-e8da29ae13a1","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.428Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.494Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.531Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"70ca0cfb-18bd-4394-a600-22bd98128e89","snapshot":{"messageId":"70ca0cfb-18bd-4394-a600-22bd98128e89","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.532Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.559Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.614Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4c23e9b0-7e24-4ee5-bc0b-31dd94d18a04","snapshot":{"messageId":"4c23e9b0-7e24-4ee5-bc0b-31dd94d18a04","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.615Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.665Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.699Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"4c048125-aa46-45fe-8c5a-265b33b995a3","snapshot":{"messageId":"4c048125-aa46-45fe-8c5a-265b33b995a3","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.700Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.752Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.813Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"ea4468a5-2b12-453a-afb7-44531163ec6e","snapshot":{"messageId":"ea4468a5-2b12-453a-afb7-44531163ec6e","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.822Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.864Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.898Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"d05a113e-a8a6-4042-8f97-8abde12d7866","snapshot":{"messageId":"d05a113e-a8a6-4042-8f97-8abde12d7866","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.900Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:12.954Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:12.983Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"3ffa47b1-3c65-4c03-81d2-fa15649e621d","snapshot":{"messageId":"3ffa47b1-3c65-4c03-81d2-fa15649e621d","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:12.984Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:13.041Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:13.096Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"bb92e6e6-c420-4aa1-be4e-c4f46c9fe208","snapshot":{"messageId":"bb92e6e6-c420-4aa1-be4e-c4f46c9fe208","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:13.100Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:13.144Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:13.223Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"e8ee6212-e0f0-4e76-8f9e-9be35a979e19","snapshot":{"messageId":"e8ee6212-e0f0-4e76-8f9e-9be35a979e19","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:13.239Z"},"isSnapshotUpdate":false}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-16T05:31:13.285Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-01-16T05:31:13.363Z","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef","content":"what happened? you haven't changed anything"}
{"type":"file-history-snapshot","messageId":"288cb386-910c-4562-aed8-dd2077e06d01","snapshot":{"messageId":"288cb386-910c-4562-aed8-dd2077e06d01","trackedFileBackups":{"initiatives/flybuys_strategic_data.adoc":{"backupFileName":"f0e6e8e781b9b028@v3","version":3,"backupTime":"2026-01-16T05:30:51.199Z"}},"timestamp":"2026-01-16T05:31:13.366Z"},"isSnapshotUpdate":false}
