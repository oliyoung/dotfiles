   500→xref:bounded-contexts:interfaces/oauth.adoc[OAuth Service] | <
   501→1 sec | Persist linking status | None
   502→
   503→|xref:bounded-contexts:profile.adoc[Profile Service] | Publish
   504→xref:bounded-contexts:profile.adoc#Events[PartnerLinked] event
   505→|Event Bus | < 5 sec | Notify downstream systems | None
   506→
   507→|xref:ubiquitous_language.adoc#Customer[Customer] | Make purchase
   508→(fuel/products) | xref:bounded-contexts:interfaces/otr_pos.adoc[OTR
   509→POS] or xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] | 5
   510→min | Complete transaction | No real-time points confirmation at POS
   511→
   512→|xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] or
   513→xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] | Send
   514→transaction | xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   515→|< 500ms | Trigger reward adjudication | None
   516→
   517→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Query reward
   518→preference | xref:bounded-contexts:profile.adoc[Profile Service] | <
   519→100ms | Determine reward partner | None
   520→
   521→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Calculate
   522→rewards | xref:bounded-contexts:external/eagle_eye.adoc[EagleEye] | < 300ms
   523→|Apply earning rules | Complex rules visibility to customer
   524→
   525→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Persist
   526→xref:bounded-contexts:loyalty.adoc#Aggregates[RewardTransaction]
   527→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | < 50ms
   528→|Create audit trail | None
   529→
   530→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Aggregate
   531→transactions | xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   532→(batch job) | 45 min | Prepare daily batch file (CSV, PGP encryption)
   533→|24-hour delay before points credited
   534→
   535→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Transmit
   536→batch file via SFTP
   537→|xref:bounded-contexts:external/flybuys.adoc[Flybuys] SFTP | 15 min | Post
   538→transactions to Flybuys | Transmission failures require retry within
   539→1-hour window
   540→
   541→|xref:bounded-contexts:external/flybuys.adoc[Flybuys] | Process batch
   542→file | xref:bounded-contexts:external/flybuys.adoc[Flybuys] | 2-4 hours
   543→|Credit points to member account | Processing time outside OTR control
   544→
   545→|xref:ubiquitous_language.adoc#Customer[Customer] | View points balance
   546→|xref:bounded-contexts:interfaces/mobile.adoc[Mobile
   547→Application], xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   548→|< 2 sec | Confirm points earned | Cached balance may be stale (5-minute
   549→TTL)
   550→
   551→|xref:bounded-contexts:engagement.adoc[Engagement Service] | Send
   552→confirmation notification
   553→|xref:bounded-contexts:external/braze.adoc[Braze] | < 10 sec | Notify
   554→customer of points earned | Notification delay if Event Bus has issues
   555→|===
   556→
   557→==== Gap Analysis
   558→
   559→===== Business Capability Gaps
   560→
   561→[width="100%",cols="17%,16%,35%,27%,3%,2%",options="header",]
   562→|===
   563→|Capability | AS-IS State | TO-BE State | Gap Description | Priority | Effort
   564→|POS Loyalty Credential | Basic barcode | Omni-channel xref:ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credential] | Improve credential format, support multi-partner | Low | Low
   565→|Reward Preference Management | Flybuys Dependency |xref:bounded-contexts:profile.adoc[Profile Service] API | Extract from Salesforce, implement xref:bounded-contexts:profile.adoc[Profile Service] | High | Medium
   566→|Anti-Corruption Layer | Direct coupling to external systems | ACL in xref:bounded-contexts:loyalty.adoc[Loyalty Service]/xref:bounded-contexts:profile.adoc[Profile Service] |Implement translation layers for xref:bounded-contexts:external/eagle_eye.adoc[EagleEye], xref:bounded-contexts:external/flybuys.adoc[Flybuys] | Low | High
   567→|Transaction Adjudication | Batch processing (nightly) | Real-time synchronous adjudication | Implement real-time xref:bounded-contexts:external/eagle_eye.adoc[EagleEye] integration |Medium | High
   568→|Partner Account Linking |  | Self-service OAuth in mobile app | Implement xref:bounded-contexts:profile.adoc[Profile Service], OAuth integration | High | Medium
   569→|Real-Time Balance Display |  | Real-time query via xref:bounded-contexts:loyalty.adoc[Loyalty Service] | Build xref:bounded-contexts:loyalty.adoc[Loyalty Service] facade, cache strategy | High | High
   570→|OAuth Token Management |  | Centralised OAuth Service | Build generic OAuth infrastructure service | Medium | Medium
   571→|Event Publishing |  | Event Bus with domain events | Implement Event Bus, define event schemas | Medium | Medium
   572→|===
   573→
   574→===== Technology Transformation Requirements
   575→
   576→[width="100%",cols="12%,14%,30%,20%,24%",options="header",]
   577→|===
   578→|Technology Domain | AS-IS Technology | TO-BE Technology | Transformation Needed | Dependency / Risk
   579→|Backend Services | Monolithic xref:bounded-contexts:interfaces/otr_app_api.adoc[OTR App API] |Microservices (xref:bounded-contexts:profile.adoc[Profile Service], xref:bounded-contexts:loyalty.adoc[Loyalty Service])
   580→|Extract bounded contexts from monolith | High risk: database separation, data migration
   581→|Integration Layer | Point-to-point REST calls | Event Bus + Anti-Corruption Layers | Implement Event Bus, ACL adapters | Medium risk: new infrastructure, event schemas
   582→|Data Storage | Relational DB (shared) | NoSQL (LoyaltyService), Relational (ProfileService) | Database per bounded context pattern | High risk: data consistency, migration
   583→|Partner Integration | Manual SFTP uploads | Automated batch + real-time APIs | Build automated workflows, API clients | Low risk: partner API availability
   584→|Monitoring | Limited logging | Distributed tracing, metrics | Implement observability stack | Low risk: tooling selection
   585→|===
   586→
   587→== Technical Architecture
   588→
   589→=== Technical Capability Requirements
   590→
   591→[width="100%",cols="10$,29%,67%",options="header",]
   592→|===
   593→|ID | Capability | Description
   594→|TC-001 | Event-Driven Integration | Asynchronous domain event publishing for engagement, recommendation, and analytics consumption
   595→|TC-002 | Third-Party Account Linking | OAuth 2.0 authorisation flow with secure token management and consent handling
   596→|TC-003 | xref:ubiquitous_language.adoc#Reward%2520Preference[Reward Preference] Management | Customer choice enforcement across loyalty operations
   597→|TC-004 | xref:ubiquitous_language.adoc#Partner[Partner] Transaction Posting | Daily batch file generation and SFTP transmission to xref:bounded-contexts:external/flybuys.adoc[Flybuys] for points crediting
   598→|TC-005 | xref:ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty Credential] Recognition | xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] and xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] EAN-13 barcode scanning → xref:bounded-contexts:loyalty.adoc[Loyalty Service] API resolution → xref:bounded-contexts:external/salesforce_crm.adoc[Salesforce CRM] Customer identity (xref:ubiquitous_language.adoc#Viva%2520Consumer%2520ID%2520%28VCI[VCI]))
   599→|TC-006 | xref:ubiquitous_language.adoc#Partner[Partner] Balance Display | Real-time xref:bounded-contexts:external/flybuys.adoc[Flybuys] points balance queries in xref:bounded-contexts:interfaces/mobile.adoc[Mobile Application] with caching and circuit breaker
   600→|TC-007 | xref:ubiquitous_language.adoc#Digital%2520Fuel%2520Dockets[Digital Fuel Dockets] Integration | xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] and xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] redemption of xref:bounded-contexts:external/flybuys.adoc[Flybuys] xref:ubiquitous_language.adoc#Digital%2520Fuel%2520Dockets[Digital Fuel Dockets]
   601→|TC-008 | xref:ubiquitous_language.adoc#Transaction%2520Adjudication[Transaction Adjudication] Logic | Orchestration of payment data, customer preferences, and partner eligibility rules for rewards
   602→|TC-009 | xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] System Integration with xref:bounded-contexts:loyalty.adoc[Loyalty Service] | xref:ubiquitous_language.adoc#Anti-Corruption%2520Layer%2520%28ACL[Bidirectional ACL]) preventing payment/commerce domain coupling
   603→|TC-010 | xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] System Integration with xref:bounded-contexts:loyalty.adoc[Loyalty Service] | xref:ubiquitous_language.adoc#Anti-Corruption%2520Layer%2520%28ACL[Bidirectional ACL]) preventing payment/commerce domain coupling
   604→|TC-011 | xref:bounded-contexts:interfaces/mobile.adoc[Mobile Application] integration with xref:bounded-contexts:external/eagle_eye.adoc[EagleEye] | Facade service for xref:ubiquitous_language.adoc#Customer[Customer] loyalty wallet data
   605→|TC-012 | xref:bounded-contexts:interfaces/mobile.adoc[Mobile Application] integration with xref:bounded-contexts:external/salesforce_crm.adoc[Salesforce CRM] | Facade service for xref:ubiquitous_language.adoc#Customer[Customer] profile data access prior to #Highlander migration
   606→|===
   607→
   608→==== Requirements Traceability
   609→
   610→[width="100%",cols="15%,11%,41%,33%",options="header",]
   611→|===
   612→|Business Requirement | Technical Capability | Implementation | Location
   613→|TR-001, TR-002, TR-003 | TC-011 TC-012
   614→|xref:bounded-contexts:profile.adoc[Profile Service] bounded
   615→context | xref:bounded-contexts:profile.adoc[Profile Service] &
   616→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   617→
   618→|TR-004 | TC-002 | OAuth 2.0 Account Linking via
   619→|xref:bounded-contexts:external/auth0.adoc[Auth0] via
   620→xref:bounded-contexts:external/flybuys.adoc[Flybuys]
   621→
   622→|TR-005, TR-006 | TC-003 | Reward Preference Selection
   623→|xref:bounded-contexts:profile.adoc[Profile Service] via
   624→xref:bounded-contexts:interfaces/mobile.adoc[Mobile
   625→Application]
   626→
   627→|TR-007 | TC-004 | Transaction Posting to Flybuys
   628→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] via
   629→xref:bounded-contexts:external/edp.adoc[EDP]
   630→
   631→|TR-008, TR-009 | TC-005
   632→|xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] and
   633→xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] barcode
   634→Integration
   635→|xref:bounded-contexts:external/microsoft_dynamics_365_commerce.adoc[Microsoft
   636→Dynamics 365 Commerce]
   637→
   638→|TR-010 | TC-006 | Flybuys Points Balance Query (Real-Time)
   639→|xref:bounded-contexts:loyalty.adoc[Loyalty Service] via
   640→xref:bounded-contexts:interfaces/mobile.adoc[Mobile
   641→Application]
   642→
   643→|TR-011 | TC-007 | Digital Fuel Dockets Query and Redemption
   644→|xref:bounded-contexts:external/microsoft_dynamics_365_commerce.adoc[Microsoft
   645→Dynamics 365 Commerce] &
   646→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   647→
   648→|TR-012 | TC-008 | Two-Step Validation & Redemption
   649→|xref:bounded-contexts:external/eagle_eye.adoc[EagleEye] via
   650→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   651→
   652→|All | TC-009
   653→|xref:ubiquitous_language.adoc#Anti-Corruption%2520Layer%2520%28ACL[Bidirectional
   654→ACL])
   655→|xref:bounded-contexts:external/microsoft_dynamics_365_commerce.adoc[Microsoft
   656→Dynamics 365 Commerce] &
   657→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   658→|===
   659→
   660→=== Service Catalogues
   661→
   662→==== Application Portfolio Catalogue
   663→
   664→[width="99%",cols="16%,27%,7%,7%,7%,29%,7%",options="header",]
   665→|===
   666→|Application | Type | Lifecycle Status | Lifecycle Stage | Owned By
   667→|Business Capabilities Supported | Technology Stack
   668→|xref:bounded-contexts:profile.adoc[Profile Service]
   669→|xref:ubiquitous_language.adoc#Bounded%2520Context[Bounded Context]
   670→|TO-BE | Planned | OTR Digital IT | Partner Account Linking, Reward
   671→Preference Management | ==TBD==
   672→
   673→|xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   674→|xref:ubiquitous_language.adoc#Bounded%2520Context[Bounded Context]
   675→|TO-BE | Planned | OTR Digital IT | Transaction Adjudication, Transaction
   676→Posting, Points Ledger | ==TBD==
   677→
   678→|xref:bounded-contexts:location.adoc[Location Service]
   679→|xref:ubiquitous_language.adoc#Bounded%2520Context[Bounded Context]
   680→|TO-BE | Planned | OTR Digital IT | Store Finder, Proximity Features
   681→|==TBD==
   682→
   683→|xref:bounded-contexts:interfaces/oauth.adoc[OAuth Service]
   684→|Infrastructure Service | TO-BE | Planned | OTR Digital IT | OAuth Token
   685→Management (Generic) | ==TBD==
   686→
   687→|Event Bus | Integration Platform | TO-BE | Planned | OTR Digital IT | Event
   688→Publishing, Event Consumption | ==TBD==
   689→
   690→|xref:bounded-contexts:interfaces/otr_app_api.adoc[OTR App API]
   691→|Monolithic API | AS-IS | Active | OTR Digital IT | All capabilities
   692→(legacy) | .NET
   693→
   694→|xref:bounded-contexts:interfaces/mobile.adoc[Mobile
   695→Application] | Mobile Application | AS-IS | Active | OTR Digital IT
   696→|Customer Engagement, Loyalty Features, Account Linking | Kotlin MP,
   697→Swift
   698→
   699→|xref:bounded-contexts:external/eagle_eye.adoc[EagleEye] | External SaaS
   700→|AS-IS | Active | External Partner | Wallet, Points Ledger, Campaigns,
   701→Promotions | SaaS (REST API)
   702→
   703→|xref:bounded-contexts:external/braze.adoc[Braze] | External Marketing
   704→|AS-IS | Active | External Partner | Customer Engagement, Push
   705→Notifications, Campaigns | SaaS (API)
   706→
   707→|xref:bounded-contexts:external/flybuys.adoc[Flybuys] | External Partner
   708→System | AS-IS | Active | External Partner | Points Balance, Digital
   709→Dockets, OAuth Linking | SaaS (REST API)
   710→
   711→|xref:bounded-contexts:external/salesforce_crm.adoc[Salesforce CRM]
   712→|External CRM | AS-IS | Active | Salesforce Team | Customer Profile System
   713→of Record (VCI) | Salesforce Cloud
   714→
   715→|xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS] | Point of Sale
   716→System | AS-IS | Active | OTR D365 | Transaction Processing, Loyalty
   717→Credential Recognition |
   718→
   719→|xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS] | Point of
   720→Sale System | AS-IS | Active | OTR D365 | Transaction Processing, Flybuys
   721→Barcode Scanning |
   722→
   723→|xref:bounded-contexts:external/coupon_scanner.adoc[Coupon Scanner]
   724→|Integration Service | AS-IS | Sunset (TBD) | VER Fullstack | Flybuys
   725→Barcode Recognition, EagleEye Integration | REST API
   726→|===
   727→
   728→==== Technology Capability Requirements
   729→
   730→This section defines the technical capabilities required to support the
   731→Flybuys Integration architecture. Specific technology products
   732→implementing these capabilities are documented in the
   733→xref:solution-architectures:flybuys_integration.adoc#Technology%2520Portfolio%2520Catalogue[Technology
   734→Portfolio Catalogue] (Solution Architecture).
   735→
   736→[width="99%",cols="18%,8%,41%,17%,16%",options="header",]
   737→|===
   738→|Capability | Category | Required Features | Architectural Pattern
   739→|Standards/Compliance
   740→|Event Messaging | Integration | At-least-once delivery, dead letter
   741→queue, CloudEvents 1.0 support | OHS + Published Language | CloudEvents
   742→1.0
   743→
   744→|Secure Credential Storage | Infrastructure | AES-256 encryption,
   745→customer-managed keys, PCI compliance | OAuth 2.0, PKCE | PCI DSS Level 1
   746→
   747→|Resilience Management | Resilience | Circuit breaker, retry with
   748→exponential backoff, fallback | Circuit Breaker Pattern | -
   749→
   750→|Feature Toggle Management | Deployment | Dynamic flag evaluation, gradual
   751→rollout, instant rollback | Feature Toggle Pattern | -
   752→
   753→|API Gateway | Infrastructure | OAuth validation, rate limiting,
   754→request/response transformation | RESTful API | OpenAPI 3.0
   755→
   756→|NoSQL Data Storage | Data Storage | Partition key performance, global
   757→distribution, TTL support | Database per Service | -
   758→
   759→|Encryption Key Management | Security | Hardware security module (HSM),
   760→key rotation, audit logging | Customer-Managed Keys | AES-256, FIPS 140-2
   761→
   762→|Distributed Caching | Caching | In-memory performance, TTL expiry,
   763→eviction policies | In-Memory Cache, TTL Pattern | -
   764→
   765→|Observability Platform | Observability | Distributed tracing, structured
   766→logging, metrics, correlation IDs | OpenTelemetry | OpenTelemetry standard
   767→
   768→|Customer Identity Platform | Authentication | OAuth 2.0, OIDC, social
   769→login, MFA, CIAM features | OAuth 2.0, OIDC | OAuth 2.0, OIDC, ISO 27001
   770→
   771→|Batch File Transfer | Integration | SFTP protocol, PGP encryption, file
   772→integrity verification | SFTP Protocol | SFTP (SSH File Transfer)
   773→
   774→|Batch Job Scheduling | Infrastructure | Cron-based scheduling, dependency
   775→management, retry/alerting | Cron-based Scheduling | -
   776→|===
   777→
   778→*Implementation Note*: See
   779→xref:solution-architectures:flybuys_integration.adoc#Technology%2520Portfolio%2520Catalogue[Technology
   780→Portfolio Catalogue] for actual technology product selections.
   781→
   782→==== Feature Flag Register
   783→
   784→Comprehensive catalogue of all feature flags used across the Flybuys
   785→Integration initiative. These flags enable progressive rollout and
   786→provide rapid rollback capability without code deployment. *Operational
   787→Deployment*: See
   788→xref:solution-architectures:flybuys_integration.adoc#Transition%2520Phase%2520Matrix[Transition
   789→Phase Matrix] in Solution Architecture for:
   790→
   791→* Rollout schedule by architecture state (AS-0 → AS-4)
   792→* Flag dependencies and enablement order
   793→* Rollback procedures and monitoring thresholds
   794→
   795→===== Infrastructure Flags
   796→
   797→[width="100%",cols="22%,58%,7%,13%",options="header",]
   798→|===
   799→|Flag Name | Purpose | Default | Managed By
   800→|`OTR.Loyalty.Enabled` | Master switch for all loyalty features (bounded
   801→contexts) | Off | Platform Team
   802→|===
   803→
   804→===== Profile Service Flags
   805→
   806→[width="99%",cols="37%,46%,6%,11%",options="header",]
   807→|===
   808→|Flag Name | Purpose | Default | Managed By
   809→|`OTR.Loyalty.PartnerLink.Flybuys` | Enable Flybuys OAuth linking flow in
   810→mobile app | Off | Product Owner
   811→
   812→|`OTR.Loyalty.RewardPreferenceSelection` | Enable reward preference
   813→selection UI in mobile app | Off | Product Owner
   814→|===
   815→
   816→===== Loyalty Service Flags
   817→
   818→[width="100%",cols="35%,49%,5%,11%",options="header",]
   819→|===
   820→|Flag Name | Purpose | Default | Managed By
   821→|`OTR.Loyalty.TransactionAdjudication` | Enable real-time Transaction
   822→Adjudication via LoyaltyService | Off | Product Owner
   823→
   824→|`OTR.Loyalty.PointsEarn.Flybuys` | Enable Flybuys points earning on
   825→transactions | Off | Product Owner
   826→
   827→|`OTR.Loyalty.FlybuysBatchPosting` | Enable daily batch file posting to
   828→Flybuys (SFTP transmission) | Off | Operations Team
   829→|===
   830→
   831→*Note*: Feature flags are managed via
   832→link:#Technology_Capability_Requirements[Feature Toggle
   833→Management] capability. See
   834→xref:solution-architectures:flybuys_integration.adoc#Technology%2520Portfolio%2520Catalogue[Technology
   835→Portfolio Catalogue] for implementation.
   836→
   837→==== Data Entity Catalogue
   838→
   839→[width="100%",cols="27%,14%,5%,22%,3%,29%",options="header",]
   840→|===
   841→|Entity | Owned By | Aggregate Type | Identifier | Lifecycle | Relationships
   842→|xref:ubiquitous_language.adoc#Partner%2520Link[PartnerLink]
   843→|xref:bounded-contexts:profile.adoc[Profile Service] | Aggregate
   844→Root | xref:ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI] +
   845→PartnerType | Persistent | References OAuth tokens (OAuth Service)
   846→
   847→|xref:ubiquitous_language.adoc#Reward%2520Transaction[Reward
   848→Transaction] | xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   849→|Aggregate Root | `TransactionId` | 30-day TTL | References
   850→xref:ubiquitous_language.adoc#Partner%2520Link[PartnerLink] (via VCI)
   851→
   852→|Store | xref:bounded-contexts:location.adoc[Location Service]
   853→|Aggregate Root | `StoreId` | Persistent | None
   854→
   855→|Customer | xref:bounded-contexts:profile.adoc[Profile Service]
   856→|Conceptual
   857→|xref:ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI]
   858→|Persistent | Has
   859→xref:ubiquitous_language.adoc#Partner%2520Link[PartnerLinks]
   860→
   861→|OAuthToken | xref:bounded-contexts:interfaces/oauth.adoc[OAuth
   862→Service] | Value Object | `TokenId` | 14-day max | Referenced by
   863→xref:ubiquitous_language.adoc#Partner%2520Link[PartnerLink]
   864→
   865→|FuelDocket | xref:bounded-contexts:external/flybuys.adoc[Flybuys]
   866→|External | `DocketId` | External | Queried by
   867→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   868→
   869→|Wallet | xref:bounded-contexts:external/eagle_eye.adoc[EagleEye]
   870→|External | `WalletId` | External | Queried by
   871→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   872→
   873→|Membership | xref:bounded-contexts:external/eagle_eye.adoc[EagleEye]
   874→|External | `MembershipId` | External | Queried by
   875→xref:bounded-contexts:loyalty.adoc[Loyalty Service]
   876→
   877→|Campaign | xref:bounded-contexts:external/eagle_eye.adoc[EagleEye]
   878→|External | `CampaignId` | External | Referenced by
   879→xref:ubiquitous_language.adoc#Reward%2520Transaction[Reward
   880→Transaction]
   881→
   882→|Transaction
   883→|xref:bounded-contexts:external/microsoft_dynamics_365_commerce.adoc[Microsoft
   884→Dynamics 365 Commerce] | External | `TransactionId` | External | Queried by
   885→xref:bounded-contexts:loyalty.adoc[Loyalty Service] (batch
   886→aggregation)
   887→
   888→|CustomerProfile
   889→|xref:bounded-contexts:external/salesforce_crm.adoc[Salesforce CRM] &
   890→xref:bounded-contexts:interfaces/otr_app_api.adoc[OTR App API]
   891→|External | xref:ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI]
   892→|External | Synchronised to
   893→xref:bounded-contexts:profile.adoc[Profile Service]
   894→|===
   895→
   896→=== Baseline Architecture
   897→
   898→==== Existing System Components
   899→
   900→===== xref:bounded-contexts:interfaces/otr_pos.adoc[OTR POS]
   901→
   902→====== Platform
   903→
   904→On-premises SQL Server, POS integration at OTR Stores
   905→
   906→===== xref:bounded-contexts:interfaces/otr_plus_pos.adoc[OTR+ POS]
   907→
   908→====== Platform
   909→
   910→On-premises SQL Server, POS integration at REXP Stores and future OTR
   911→conversions
   912→
   913→====== Capabilities
   914→
   915→* Flybuys barcode scanning (offline mode)
   916→* Basic transaction logging
   917→
   918→====== Limitations
   919→
   920→* Customer transactions not linked to
   921→xref:ubiquitous_language.adoc#Loyalty%2520Credential[Loyalty
   922→Credentials] (barcode-only recognition)
   923→* No integration with
   924→xref:bounded-contexts:interfaces/mobile.adoc[Mobile
   925→Application]
   926→* Manual reconciliation with Flybuys batch files
   927→* No support for
   928→xref:ubiquitous_language.adoc#Partner%2520Integration[Partner
   929→Integration] or real-time balance queries
   930→* No event-driven capabilities
   931→* Highly coupled to xref:bounded-contexts:external/flybuys.adoc[Flybuys]
   932→
   933→===== OTR App API
   934→
   935→====== Platform
   936→
   937→AWS Lambda (.NET Core), API Gateway, DynamoDB
   938→
   939→====== Capabilities
   940→
   941→* Customer authentication
   942→* Loyalty balance queries
   943→* Offer redemption
   944→
   945→====== Limitations
   946→
   947→* No external partner linking capability
   948→* Tightly coupled to Microsoft Dynamics 365 Commerce
   949→* Customer profile data only in OTR App database
   950→* No event-driven architecture (synchronous REST calls only)
   951→* No transaction adjudication logic (loyalty queries separate from
   952→payment processing)
   953→* No support for Flybuys integration patterns (OAuth, batch file
   954→posting)
   955→* Limited scalability (single Lambda function for all API operations)
   956→* High technical debt (no bounded contexts, mixed domain logic)
   957→* Difficult to maintain and extend (monolithic codebase)
   958→* No support for digital voucher integration
   959→* Limited monitoring and alerting capabilities
   960→* No formalised Ubiquitous Language (UL) leading to inconsistent
   961→terminology
   962→
   963→===== xref:bounded-contexts:external/salesforce_crm.adoc[Salesforce CRM]
   964→
   965→====== Platform
   966→
   967→Salesforce Sales Cloud
   968→
   969→====== Capabilities
   970→
   971→* Customer profile system of record
   972→(xref:ubiquitous_language.adoc#Viva%2520Consumer%2520ID[VCI])
   973→
   974→===== xref:bounded-contexts:external/eagle_eye.adoc[EagleEye]
   975→
   976→====== Platform
   977→
   978→External SaaS (REST APIs, Webhooks)
   979→
   980→====== Capabilities
   981→
   982→* Wallet management (grants, offers)
   983→* Points ledger
   984→* Membership/tiers
   985→* Campaigns
   986→
   987→===== xref:bounded-contexts:external/coupon_scanner.adoc[Coupon Scanner]
   988→
   989→===== Platform
   990→
   991→VER API
   992→
   993→===== Capabilities
   994→
   995→* Recognition of
   996→xref:ubiquitous_language.adoc#Flybuys%2520Cardholder%2520Number[Flybuys
   997→Cardholder Number]
   998→* Recognition of
   999→xref:ubiquitous_language.adoc#%28Paper%20Shopper%20Docket[Shopper

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
