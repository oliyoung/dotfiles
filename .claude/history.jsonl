{"display":"/exit ","pastedContents":{},"timestamp":1763420254560,"project":"/home/oliy/work","sessionId":"847a9f5a-5b87-44d2-ba25-8eabf9b259a0"}
{"display":"/exit ","pastedContents":{},"timestamp":1763420254566,"project":"/home/oliy/work","sessionId":"847a9f5a-5b87-44d2-ba25-8eabf9b259a0"}
{"display":"/exit ","pastedContents":{},"timestamp":1763420254566,"project":"/home/oliy/work","sessionId":"847a9f5a-5b87-44d2-ba25-8eabf9b259a0"}
{"display":"/init ","pastedContents":{},"timestamp":1763420898278,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"/init ","pastedContents":{},"timestamp":1763420898278,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"What should I add detail to? Where's the most valuable place to invest?","pastedContents":{},"timestamp":1763421221895,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Learning DDD and building a good architecture base before we start on our roadmap for next year","pastedContents":{},"timestamp":1763421451666,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets do it","pastedContents":{},"timestamp":1763421585179,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1. External service, it should be configured in EagleEye supplied by D365 Commerce's products","pastedContents":{},"timestamp":1763421653516,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"It's synchronous, the outcome of the EagleEye call can effect the transaction","pastedContents":{},"timestamp":1763421769821,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1: Yes, 2: No, 3: Proceeds without, 4: All of those","pastedContents":{},"timestamp":1763421880501,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1: Probably should keep it, 2: it just fails, 3: Same event, different status, 4: the POS applies it, 5: seperate aggregate i think ","pastedContents":{},"timestamp":1763421986682,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1: Daily Batch, 2: Retries, 3: No, if someone isn't linked at transaction time, they don't get rewards, 4: That's outside of this domain","pastedContents":{},"timestamp":1763422077543,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I don't know, lets come back to it","pastedContents":{},"timestamp":1763422183554,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets go with Option A","pastedContents":{},"timestamp":1763423387852,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1. That flow feels right, at least it's close enough. 2. Lets go through all of those one-by-one","pastedContents":{},"timestamp":1763423523867,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"we should fall back on configurable business rules in the domain","pastedContents":{},"timestamp":1763423654338,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"What do you think is best, I think it should be via config files","pastedContents":{},"timestamp":1763423766997,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think the invariants + eagle eye works well for now","pastedContents":{},"timestamp":1763423850646,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Ask me questions one at a time please ","pastedContents":{},"timestamp":1763423940244,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"2","pastedContents":{},"timestamp":1763424005380,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"if a user has unlinked their flybuys, then we should default to OTR Rewards, that should always be the fallback","pastedContents":{},"timestamp":1763424184462,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"That's business logic","pastedContents":{},"timestamp":1763424224353,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Everyone who uses the OTR App is a \"member\", so if they're scannign their OTR (or flybuys barcode) they should always have a Loyalty Wallet","pastedContents":{},"timestamp":1763424293478,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"2. Upsert the record, and sqwark an event ","pastedContents":{},"timestamp":1763424340185,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Yeah, we should push an additional event just so we can track the occurance of it","pastedContents":{},"timestamp":1763424388585,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Not sure yet, but probably all of the above","pastedContents":{},"timestamp":1763424511396,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"EagleEye will need to know VivaCustomerID and transaction details, it should be aware of the membership and discount rules","pastedContents":{},"timestamp":1763424559422,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I'm not sure what the system of record should be, it's either CRM/Profile or with EagleEye, probably should be internally managed right?","pastedContents":{},"timestamp":1763424658220,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think for changes, the app should call the CRM, it is just another customer attribute really","pastedContents":{},"timestamp":1763424710050,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Option A works, always preference simple over fast","pastedContents":{},"timestamp":1763424787610,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I don't think that aggregate belongs in that context, it's a CRM aggregate","pastedContents":{},"timestamp":1763424849237,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"That's a reward grant response right? It should be in their docs","pastedContents":{},"timestamp":1763424887363,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"What do you think?","pastedContents":{},"timestamp":1763424933844,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Love that, it's a great start","pastedContents":{},"timestamp":1763424989486,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"It does matter why it failed, with \"not eligible\" we could configure POS/App to show that","pastedContents":{},"timestamp":1763425059493,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"That should be in the client that receives it, and it should be agnostic to the client (POS faces Team Members, App faces Guests)","pastedContents":{},"timestamp":1763425127165,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"We haven't really thought through the event architecture, so automatically raising events is good for now because then we don't have to come back and uplift it, it can just sit idle until it's ready","pastedContents":{},"timestamp":1763425209883,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"We should default to using events to propagate cross boundary changes","pastedContents":{},"timestamp":1763425688120,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"That's probably more implementation than architecture","pastedContents":{},"timestamp":1763425731192,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets keep application seperate from domain, option b","pastedContents":{},"timestamp":1763425952606,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"In `application-layer\\loyalty-application-services.md` we should use mermaid for diagramming, not ascii, it's beautiful but mermaid is beautifuller","pastedContents":{},"timestamp":1763426481419,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets use real pseudocode in those examples too, i don't want the appearance of suggesting implementation and our engineers are good","pastedContents":{},"timestamp":1763426696948,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets do 1.","pastedContents":{},"timestamp":1763427106656,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":" Lets design the EagleEye ACL, use this https://developer.eagleeye.com/eagleeye-developer/docs/air-platform-overview","pastedContents":{},"timestamp":1763427459779,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I'm not sure how much of the transaction aggregate belongs with this domain","pastedContents":{},"timestamp":1763427924910,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"No, the Loyalty Service shouldn't store the full basket","pastedContents":{},"timestamp":1763428019867,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I like Option B, we can show the reward reasons in a Guest's history","pastedContents":{},"timestamp":1763428195657,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets review the other aggregates","pastedContents":{},"timestamp":1763428306949,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"The Flybuys linking flow is actually a classic OAuth flow, it's account to account","pastedContents":{},"timestamp":1763428390964,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"One questions at a time, first one is option b","pastedContents":{},"timestamp":1763428451748,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think we want to keep it generic","pastedContents":{},"timestamp":1763428544072,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Opt 1","pastedContents":{},"timestamp":1763428575452,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Option A seems most scalable","pastedContents":{},"timestamp":1763428661773,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"A FuelDiscount and ProductOffer are both kinds of Grants","pastedContents":{},"timestamp":1763428731210,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Simplify always","pastedContents":{},"timestamp":1763428817538,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Option A","pastedContents":{},"timestamp":1763428939303,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets review those last aggregates","pastedContents":{},"timestamp":1763429203994,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"3. All points in EE, but different campaign/programmes","pastedContents":{},"timestamp":1763429361296,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"2. That's EE also","pastedContents":{},"timestamp":1763429361297,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1. A - EagleEye is the system of record for all grant balances (there could be more than one programme to track balances)","pastedContents":{},"timestamp":1763429361297,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think I want to introduce another bounded context for subscription management, we'll use another supplier (probably a payment gateway) to manage subscription logic","pastedContents":{},"timestamp":1763429524512,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"None of the third party platforms (EagleEye, Braze) will publish events, those should be in the ACL","pastedContents":{},"timestamp":1763429666151,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"It does","pastedContents":{},"timestamp":1763430027512,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":" Lets make sure the arch decisions always show current state, don't mention things that have changed or updated","pastedContents":{},"timestamp":1763430162933,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Is Membership a domain or a bounded context?","pastedContents":{},"timestamp":1763435372664,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"does it fit as a bounded context?","pastedContents":{},"timestamp":1763436121109,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"What would be the safe play, the one that doesn't paint us into a corner?","pastedContents":{},"timestamp":1763436326547,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"\" Think of EagleEye as a temporary implementation detail behind your ACL.\" This was my opinion already","pastedContents":{},"timestamp":1763436720516,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets work on the engagment domain and context-map","pastedContents":{},"timestamp":1763436945046,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"They're different concepts, a marketing campaign might be related to a loyalty campaign, but probably not. All Loyalty Campaigns will probably have a marcom campaign","pastedContents":{},"timestamp":1763437165391,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Segmentation should live in Braze, that's a marketing function, but we should supply Braze with enough customer attribution that enables it","pastedContents":{},"timestamp":1763437271867,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"going forward, the feedback is owned by EDP, but the feedback should flow THROUGH the engagement platform","pastedContents":{},"timestamp":1763437476803,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"\"  Same pattern as LoyaltyService publishing EagleEye events!\" How about that ;)","pastedContents":{},"timestamp":1763437626657,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Comms preferences & push notification preferences should stay in Braze. History & Audit trail belongs in Braze too. Event-to-campaign triggers are Engagement logic","pastedContents":{},"timestamp":1763437736035,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"C - that's a marketing team responsibility","pastedContents":{},"timestamp":1763437779336,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"We're building a Salesforce (Profile's system of record) to Braze with ADF right now, that will probably the plumbing going forward","pastedContents":{},"timestamp":1763438640336,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think those should be as close to real time as possible, we'd want to catch loyalty events while guests are still in store/on the forecourt","pastedContents":{},"timestamp":1763438951072,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"There'd be transaction events fired from the mobile app","pastedContents":{},"timestamp":1763439007950,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"ooh sinlge event, source is an attribute","pastedContents":{},"timestamp":1763439088916,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"C","pastedContents":{},"timestamp":1763440433509,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"c","pastedContents":{},"timestamp":1763440526362,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I think it's just a stateless event router","pastedContents":{},"timestamp":1763440599627,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"yep, do all of that","pastedContents":{},"timestamp":1763440977410,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"can you merge the two arch decision docs, and add one for the loyalty context","pastedContents":{},"timestamp":1763441348674,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"\"- Mobile app transactions flow through POS APIs\" this is incorrect, Mobile App is responsible for it's own transactions to D365 not through POS","pastedContents":{},"timestamp":1763441663933,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"\"Decision 8: POS as Transaction Source of Truth\" we still have this, it's not","pastedContents":{},"timestamp":1763441749714,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"\"POS (in-store/forecourt) and D365 Commerce (mobile/web) as transaction sources\" this is subtly incorrect, POS is generally a D365 Commerce CSU","pastedContents":{},"timestamp":1763442037353,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"That's not correct either, the mobile apps have their own architecture that eventually drops transactions into D365","pastedContents":{},"timestamp":1763442429210,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"How do i document the event bus in this architecture?","pastedContents":{},"timestamp":1763442566942,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"1","pastedContents":{},"timestamp":1763443019906,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Can you generate a swagger/OpenAPI doc from this?","pastedContents":{},"timestamp":1763443358832,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"2","pastedContents":{},"timestamp":1763443586086,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Did you finish that yaml file?","pastedContents":{},"timestamp":1763503200587,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"I've never used the AsyncAPI spec, tell me more ","pastedContents":{},"timestamp":1763503273143,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Yes please","pastedContents":{},"timestamp":1763504985824,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"There are mentions of 'CustomerId', lets rename that to VivaConsumerId","pastedContents":{},"timestamp":1763505308888,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"is it possible to namespace event names with asyncapi?","pastedContents":{},"timestamp":1763505627292,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Yep, love that","pastedContents":{},"timestamp":1763505835066,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Can we document that naming schema somewhere too","pastedContents":{},"timestamp":1763506082796,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"we have `customerId`  mentioned in places, that should be `VivaConsumerID`","pastedContents":{},"timestamp":1763506211077,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Customers are Guests in OTR Published Language","pastedContents":{},"timestamp":1763507012758,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"For contact names and details, use Oli Young and o.young@otr.com.au","pastedContents":{},"timestamp":1763508079586,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Does security:\n  - BearerAuth: [] cover using Azure CIAM?","pastedContents":{},"timestamp":1763508165301,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"go with the recommendation","pastedContents":{},"timestamp":1763508508545,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets refer to Eagle Eye Campaigns as Programmes, just to be clear against Braze marketing campaigns","pastedContents":{},"timestamp":1763509050053,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Did we update the published language too where appropriate?","pastedContents":{},"timestamp":1763509219134,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets add some standard event handles. Using this https://www.braze.com/docs/developer_guide/home handle the most common webhooks/events Braze might emit","pastedContents":{},"timestamp":1763509527575,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"and the corresponding changes to the EngagementService to reflect receiving those braze sourced webhooks?","pastedContents":{},"timestamp":1763509736746,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Compelte that last task. I have upgraded my usage limit","pastedContents":{},"timestamp":1763510242262,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"What's Avro specifications","pastedContents":{},"timestamp":1763510578879,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Google has something similar right? Popular with golang?","pastedContents":{},"timestamp":1763510740180,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets keep it simple to JSON for now, but flag protobuf as a potential next phase","pastedContents":{},"timestamp":1763511218457,"project":"/home/oliy/work/architecture","sessionId":"10d13a99-ba39-4e96-a67d-afe3330bcc26"}
{"display":"Lets expand the definition of \"EngagementService\" to explicitly include INBOUND comms, feedback, customer support requests etc","pastedContents":{},"timestamp":1763529082272,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"update the architecture decisions doc too","pastedContents":{},"timestamp":1763529721431,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"remove those mentions of real time conversations and SignalR, that's way beyond scope","pastedContents":{},"timestamp":1763530130603,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"Push sentiment analysis out too, that's too far beyond our current roadmap","pastedContents":{},"timestamp":1763530454868,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"write me a commit message for the staged changes","pastedContents":{},"timestamp":1763530717057,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"The VivaConsumerID is a Salesforce recordId, somehow mention that and it's format (15 characters, case-sensitive)","pastedContents":{},"timestamp":1763530933609,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"and the corresponding changes to the EngagementService to reflect receiving those braze sourced webhooks?\n.","pastedContents":{},"timestamp":1763531869184,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":" can D365 Commerce fire events for Azure Service Bus easily?","pastedContents":{},"timestamp":1763531869185,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"Lets mention somewhere that this is a 2-3 year plan","pastedContents":{},"timestamp":1763603878781,"project":"/home/oliy/work/architecture","sessionId":"6c469cef-230d-44de-9023-9aec3bf384b0"}
{"display":"Looking at teh initiatives folder, does this look like the idiosyncratic approach to documenting initiatives in DDD","pastedContents":{},"timestamp":1763692719480,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"Lets work on the payments context map","pastedContents":{},"timestamp":1763692851435,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"1","pastedContents":{},"timestamp":1763692914581,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"2","pastedContents":{},"timestamp":1763693257810,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"is engagement both a bounded context AND a domain","pastedContents":{},"timestamp":1763697533833,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"can you implement those skeleton bounded contexts","pastedContents":{},"timestamp":1763698124736,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"Remove any reference to the web interface, we don't have one","pastedContents":{},"timestamp":1763698494338,"project":"/home/oliy/work/architecture","sessionId":"e58766b7-ec33-4dce-9442-806db777d0c4"}
{"display":"Did we finish the last command?","pastedContents":{},"timestamp":1763698692757,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"We're removing the web interface","pastedContents":{},"timestamp":1763698752663,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Add somewwhere that we use Kotlin for mobile dev","pastedContents":{},"timestamp":1763699089063,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"I mean Kotlin multiplatform","pastedContents":{},"timestamp":1763699146931,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"I'll need to present this strategy to the engineering team that will implement it, assume they have little to no DDD experience, and have not had architectural structure like this before","pastedContents":{},"timestamp":1763699729792,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Don't include code samples or implementation details, i just want to explain arch and the framework i'm using","pastedContents":{},"timestamp":1763700180600,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/context ","pastedContents":{},"timestamp":1763700673113,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/context ","pastedContents":{},"timestamp":1763700673114,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/context ","pastedContents":{},"timestamp":1763700673114,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/install-github-app ","pastedContents":{},"timestamp":1763700865659,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/install-github-app ","pastedContents":{},"timestamp":1763700865659,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"/install-github-app ","pastedContents":{},"timestamp":1763700865659,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"how do i paste an image in","pastedContents":{},"timestamp":1763700872764,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"'/mnt/c/Users/o.young/Desktop/Screenshot 2025-11-21 152740.png'","pastedContents":{},"timestamp":1763701089910,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"We're staying with AWS for this part, the rest of the back office is still on Azure ","pastedContents":{},"timestamp":1763701177845,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Add those to the questions, use placeholders and generic terms for internal services ","pastedContents":{},"timestamp":1763701236215,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Keep the links to the DDD theory on learn.microsoft","pastedContents":{},"timestamp":1763701423856,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Need to frame this as a 2-3 year plan too, we have immediate implementation plans (Google & Apply Pay, Flybuys integration) but this full picture is aspirational","pastedContents":{},"timestamp":1763701729040,"project":"/home/oliy/work/architecture","sessionId":"4b9be08b-989d-4764-8ca5-bd7b5b2a2367"}
{"display":"Solve the \"MD036 - Emphasis used instead of a heading\" in all of the markdown documents, use all 6 heaing levels, and remember this for the future","pastedContents":{},"timestamp":1763943219642,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Also resolve \"MD022 - Headings should be surrounded by blank lines\"","pastedContents":{},"timestamp":1763943590943,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Ensure that's added to the CLAUDE.md file","pastedContents":{},"timestamp":1763943976285,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Lets expand the definition from \"digital loyalty platform\" to \"digital platform\", loyalty is just one context-map","pastedContents":{},"timestamp":1763944070148,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Take out any reference to timelines","pastedContents":{},"timestamp":1763944338715,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"commit and push all this","pastedContents":{},"timestamp":1763944674571,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/agents ","pastedContents":{},"timestamp":1763944831213,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/agents ","pastedContents":{},"timestamp":1763944831214,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/agents ","pastedContents":{},"timestamp":1763944831214,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"how do i use agents?","pastedContents":{},"timestamp":1763944845576,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Not now, lets build out the cloud-infrastructure.wsd diagram","pastedContents":{},"timestamp":1763944912434,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"That's a great target state, lets document current state, start a new diagram and build out relationships through conversation","pastedContents":{},"timestamp":1763945225784,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Nope, none of the current state is reflected in this repo, we have to start clean","pastedContents":{},"timestamp":1763945401818,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"We have two mobile applications, but they're essentially the same app reskinned, they're the OTR App and the SPS App","pastedContents":{},"timestamp":1763945449170,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"They primarily connect to an AWS API Gateway, and also directly to a Payments Provider called DataMesh (aka DMG)","pastedContents":{},"timestamp":1763945515969,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Depending on the request, it's either routed to AWS ELB or AWS EBS, ELB abstracts a legacy framework, EBS has new services","pastedContents":{},"timestamp":1763945602841,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"ELB balances requests to two EC2 instances running Windows for C# functions","pastedContents":{},"timestamp":1763945680606,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"EBS has an EC2 Autoscaling group, also running C# functions","pastedContents":{},"timestamp":1763945720580,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"One question at a time please, add that to Claude.md","pastedContents":{},"timestamp":1763945784611,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"In dev and production, the connect to an RDS database on an older infrastructure (which will be decommissioned)","pastedContents":{},"timestamp":1763945859131,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"they also connect to a different RDS database in UAT, both use SQL Server","pastedContents":{},"timestamp":1763945903887,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":" incoming requests between the app and the API Gateway are routed through a WAF","pastedContents":{},"timestamp":1763945962733,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"outbound requests are firewalled through a Fortigate Network Firewall running on an EC2 instance","pastedContents":{},"timestamp":1763946007154,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Telemetry data (CPU, IO, Memory etc) is pushed to CloudWatch","pastedContents":{},"timestamp":1763946038114,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"both the EC2 instances and the mobile app directly connect to the DataMesh payment gateway through websockets","pastedContents":{},"timestamp":1763946089723,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"the DMG requests don't go through the outbound firewall","pastedContents":{},"timestamp":1763946120539,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Only outbound connections from the EC2 instances to the mobile app go through the fortigate firewaall            ","pastedContents":{},"timestamp":1763946160559,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":" The mobile apps and the Ec2 instances also connect to Braintree for PayPal","pastedContents":{},"timestamp":1763946218046,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":" bypass","pastedContents":{},"timestamp":1763946268307,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"We should show that DataMesh routes tokentisation calls and Shell Card purchases through DMG to FiServe","pastedContents":{},"timestamp":1763946331148,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"In another group, on the OTR Internal Network (it's a WAN) there is a SOAP API called \"PereQOperations\", it connects to the OTR App API","pastedContents":{},"timestamp":1763947866119,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"The PereQOperations service connects to a PereQOrder service (also via SOAP)","pastedContents":{},"timestamp":1763948112549,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"There are many stores, each store has it's own LAN, there is an instance of the PereQOrder service on each Store LAN, and its contained in a back office  group called the Kitchen Display System (KDS)","pastedContents":{},"timestamp":1763948295877,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"There is a data store in each KDS instance, and at least one screen","pastedContents":{},"timestamp":1763948335893,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"There is a service that manages HappyWash Codes called Codax https://www.psdcodax.com/products/","pastedContents":{},"timestamp":1763948417195,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"the KDS also connects and enables fuel pumps on the forecourt through Fuel Controller","pastedContents":{},"timestamp":1763948483914,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Codax connects to the automated car wash system","pastedContents":{},"timestamp":1763948535941,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Each KDS connects to one or many POS terminals, each of which have a Payment Terminal and Barcode scanner","pastedContents":{},"timestamp":1763948664348,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"The POS connects back to a Microsoft Dynamics instance on the OTR External Network on Azure","pastedContents":{},"timestamp":1763948749702,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"   There is an Azure Logic App ins the OTR External Network that connects to the RDS server in the OTR App API for customer engagment functions","pastedContents":{},"timestamp":1763949007713,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Lets add a relationship between an in store customer and the POS              ","pastedContents":{},"timestamp":1763949073012,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":" the EC2 instances in the OTR App API connect to a Fuel Worker that connects to a Fuel Service in the VER Azure group to proces unattended fuel purchases and enablign the SPS app to be used in REXP Stores","pastedContents":{},"timestamp":1763949179726,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"That's beyond the scope of this right now","pastedContents":{},"timestamp":1763949273693,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Oh there's a CIAM service in the VER Azure group, the mobile apps and the EC2 instances use that for identity","pastedContents":{},"timestamp":1763949302147,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":" This is a HLD based on the a rebuild, it contains relevant infomration to the UML diagram we are designing. Analyse for relevance and confirm all changes you find before making alterations to the UML","pastedContents":{},"timestamp":1763949601743,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Execution Status: \nOn Hold\n  - Feb 2025\n\nRelated Project(s):\n\nOTR App Backend Rebuild\n\n1. Document Control\n1.1. Contacts \n1.2. Version History\n2. Document Purpose\n2.1. In Scope\n2.2. Out of Scope\n3. Key Requirements\n3.1. Functional Requirements\n3.2. Non-Functional Requirements\n4. Key Design Decisions (KDDs)\n5. Other Design Decisions\n6. Design Assumptions, Issues, Risks and Dependencies\n7. Conceptual View\n7.1. Current State\n7.2. Target State\n8. Application View\n9. Infrastructure and Security View\n9.1. Solution Components Summary\n9.2. Environment View\n9.3. Deployment Diagram\n9.4. Connectivity\n9.5. Component Deployment Specifications & Security Controls\n9.6. Users\n9.7. Backup & Recovery\n9.8. Monitoring - Application, Infrastructure & Security\n9.9. Data- Reports & Interfaces/Data Integration\n10. Patterns Used\n10.1. Integration Patterns\n10.2. Security Patterns\n10.3. Infrastructure Patterns\n11. References\n12. Appendix\n12.1. Appendix A - Alternative Target State Diagram\n1. Document Control\n1.1. Contacts \nName\n\nDocument Role\n\nEmail\n\nStatus\n\nRina Pranoto\n\nContributor\n\nrina.pranoto@vivaenergy.com.au \n\nN/A\n  \n\nRajnish Joseph\n\nContributor\n\nrajnish.joseph@vivaenergy.com.au\n\nN/A\n  \n\nAndy Arch\n\nPeer Reviewer\n\nandrew.arch@vivaenergy.com.au\n\nPeer review completed\n      \n\nMayank Sharma\n\nPeer Reviewer\n\nmayank.sharma@vivaenergy.com.au\n\nPeer review completed\nConditionally- The sections pertaining to security are currently in development and will undergo review as they are completed.   \n\nTigere Machonisa\n\nPeer Reviewer\n\ntigere.machonisa@vivaenergy.com.au\n\nPeer review completed\n    \n\nJason Stipkovic\n\nPeer Reviewer\n\njason.stipkovic@vivaenergy.com.au\n\nPeer review completed\n  \n\nAmandeep Modgil\n\nPeer Reviewer\n\namandeep.modgil@vivaenergy.com.au\n\nPeer review requested\n  \n\nDaniel Andrade\n\nPeer Reviewer\n\ndaniel.andrade@vivaenergy.com.au\n\nPeer review completed\n  \n\nVER ARB (Architecture Review Board)\n\nApprover\n\n https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10494017545\n \n\n \nApproved\n    \n\nTony Matthews\n\nAudience - Informed\n\nt.matthews@otr.com.au\n\n \n\nAmin Jodeyri\n\nAudience - Informed\n\na.jodeyri@otr.com.au\n\n \n\nDarren Peisley\n\nAudience - Informed\n\nd.peisley@otr.com.au\n\n \n\n1.2. Version History\nVersion\n\nDate\n\nAuthor\n\nChange Summary\n\n0.1\n\nMay 27, 2024\n\nRina Pranoto\n\nFirst Draft\n\n0.2\n\n\nNov 14, 2024 \n\nRina Pranoto\n\nDocument structure uplifted to the latest version\n\n0.3\n\nNov 24, 2024 \n\nRina Pranoto\n\nDesign Decisions, Target State solution and Deployment view are completed\n\n1.0\n\nNov 25, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for Peer Review\n\n1.1\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for ARB\n\n1.2\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nARB endorsed version\n\n2. Document Purpose\nThe OTR mobile app has been going through transformations from its inception version back in 2016, to the latest version to support the current OTR requirements. OTR App 4.0 aims to further enhance the application to be able to support future requirements for both OTR and Viva brands. \n\nThe purpose of this document is to outline the high level design of OTR App 4.0 backend rebuild, which includes rearchitecting and replatforming the application to modernise its functionality, and rehost the BFF (Backend-for-Frontend) services into Azure in accordance with VER infrastructure, integration and security standard. \n\nPoint of note: ‘backend’ in this context refers to the server-side application(s) currently hosted on OTR AWS, which complement the OTR mobile app (native and hybrid) functionality. It does not refer to the OTR systems hosted on-premises.\n\n2.1. In Scope\nThis solution includes:\n\nthe overall design approach of rearchitecting the existing OTR mobile app back-end (server) functionality into VER-aligned BFF services; and\n\nthe replatforming of the OTR mobile app back-end (server) into VER Azure hosting, in accordance with the standard VER infrastructure, integration and security practices.\n\n2.2. Out of Scope\nThis solution does not cover:\n\nany migration (refactoring, replatforming, or rearchitecting) of OTR systems currently hosted on-premises, either inside OTR stores or within OTR DC (Data Centre);\n\nany new app functionality not currently supported by the current mobile app version, such as food/item delivery, OTR app in Reddy Express sites, etc;\n\nother VER Digital Channels outside of OTR mobile app;\n\nany integration and/or migration of loyalty rewards from the app into Strategic LMS, except for certain aspects as covered by the relevant Service Design under this HLD; and\n\nany strategic design and roadmap for External Customer Identity & Access Management (IDAM). This topic will be covered as a separate work package.\n\n3. Key Requirements\n3.1. Functional Requirements\nRefer to https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10427203585\n for the full requirements.\n\n3.2. Non-Functional Requirements\nRefer to Non Functional Requirements.xlsx for the full non-functional requirements. The architecturally-significant non-functional requirements are summarised in the table below.\n\nID\n\nRequirement Summary\n\nDescription\n\nTraceability\n\nRequirement Met (Yes/No/Partial)\n\n1\n\nApplication or Service Criticality: Availability\n\n99.9%, which translates to max downtime of 1 hour per month / 3 hours per quarter.\n\nN/A\n\nYes\n\nThe Service Design must meet this SLA, excluding dependencies with legacy on-prem applications and/or external vendors, which have their own specified SLAs.\n\n2\n\nApplication or Service Criticality: Disaster Recovery\n\nRTO is 4-24 hours, to be defined per service.\n\nRPO requirement is yet to be defined.\n\nN/A\n\nThe RTO and RPO is to be assessed per Azure resource being utilised to implement the relevant Service. Refer to the https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#9.7.-Backup-%26-Recovery\n section for more details.\n\n3\n\nVolumetrics\n\nNo. of current app users:\n\n771,926 total users including deleted.\n\n486,488 total users excluding deleted.\n\n172,700 active users monthly.\n\nUser volume is anticipated to grow up to 5x the current volume, once app adoption within ReddyExpress stores commences (post the completion of this HLD / out of scope for this HLD).\n\nTransaction volume is being assessed by Product Owner and Business Analysts.\n\nN/A\n\nN/A\n\n5\n\nData Classification\n\nConfidential\n\nN/A\n\n\nN/A\n\n\n6\n\nData Privacy\n\nThe specific VER Data Privacy requirement is yet to be defined. However, The Privacy Act applies. Reference: https://www.oaic.gov.au/privacy/privacy-legislation/the-privacy-act, which includes https://www.oaic.gov.au/privacy/australian-privacy-principles.\n\nN/A\n\nAccording to The Privacy act, the customer data collected must be compliant in terms of storage and lifecycle management.\n\nThe solution to meet this requirement is not just technical, but also covers legal and operational aspects.\n\nThe existing OTR privacy policy attached to the app upon user registration requires to be reviewed.\n\n7\n\nSecurity\n\nSecurity Assurance assessment is to be done, following this guideline: https://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/10379919741\n \n\nN/A\n\nPen Test is to be organised accordingly by the project.\n\nAdditionally, PCI audit is also required.\n\n8\n\nPerformance\n\nPerformance/load testing is required to validate the projected growth.\n\nN/A\n\nPerformance/load testing is to be performed by the project.\n\n4. Key Design Decisions (KDDs)\nID\n\nDecision Summary\n\nDescription\n\nStatus\n\nDate of Endorsement\n\nOwner\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\n5. Other Design Decisions\nID\n\nDecision Description\n\nAlternative Option(s) Considered\n\nDecision Rationale\n\nStatus\n\nCE-OD-001\n\n \n\n \n\n \n\nThe application is to be rearchitected from a monolithic centralised server into service-based architecture and event-based architecture.\n\nThis is to replace the ‘tandem’ legacy web services setup, which was required to interface with a vendor-locked layer.\n\nThis approach also simplifies the existing application architecture by removing additional dependencies (e.g. Wordpress CMS, MS CE, internal legacy components).\n\nRetain the existing monolitic / centralised web-servers to service all APIs.\n\nThe monolithic / centralised architecture is not scalable, and does not separate service boundaries and blast zone. The service-based architecture is aligned to the CE strategic roadmap to support Viva omnichannel strategy.\n\nConfirmed\n \n\nCE-OD-002\n\nVER D365 is to be set as the target source of truth for products and product categories. This is to support replacing the existing legacy-based product structure and multiple layers of mapping.\n\nIn the transitional/interim state, dual D365 setting might require to be maintained.\n\nN/A\n\nMultiple ERPs are not aligned to the strategic roadmap of VER. Therefore, this decision has no alternative. The main goal is to achieve a single ERP in the target state.\n\nConfirmed\n  \n\nCE-OD-003\n\nFurther to CE-OD-002 above, custom catalogue/order/basket services is to be implemented.\n\nUse Microsoft headless commerce product feature.\n\nCustom option has been chosen for the following reasons:\n\nCheaper operation: The license cost alone for headless commerce server (even at MS expected discount) means the development payback is under 6 months\n\nNo change to core D365: D365 does not have a good fit for the required Site/Offer/Category hierarchy meaning we would have to customise within D365.  D365 development is more costly and the implementation cycle is slower so this could offset the dev savings.\n\nFlexibility in design: Integrating directly with D365 makes the migration from OTR Legacy to OTR+ harder (or adds a dependency which will delay delivery by 6+ months)\n\nMore options to optimise performance: A custom solution will allow us to be more in control of performance\n\nConfirmed\n  \n\nCE-OD-004\n\nThe existing business logic contained in various SQL Server stored procedures will be refactored to the relevant services. \n\nThe end goal is to have lean stored procedures as mechanism to do Database CRUD (Create, Retrieve, Update, Delete) only, if required.\n\nRetain existing business logics within stored procedures in a lift and shift.\n\nRetaining business logic within database stored procedures creates multiple places where business logics reside, adding complexity in maintenance and operational support. It also limits certain functionality unnecessarily.\n\nConfirmed\n  \n\nCE-OD-005\n\nFurther to CE-OD-004 above, data store choice for each service is to be assessed per Service Design, to ensure fit-for-purpose. This also includes the assessment on the best strategy to migrate the existing data from the AWS-hosted SQL Server Databases into the new data store of choice.\n\nFrom operational cost perspective, the preferred order of data store options (from the lowest to highest cost) is as following:\n\nAzure Table storage\n\nCosmos DB (for non RDBMS / no-SQL)\n\nSQL Server DB (consider Azure SQL Hyperscale)\n\nNote: the fit-for-purpose assessment is to consider all factors, not just operational cost perspective (albeit being a major factor).\n\nRetain the existing centralised SQL Server database to store all OTR app data across all services.\n\nThe centralised SQL Server database does not align with the service-based microservices principles, as it created tight coupling / heavy dependency across services, resulting in more complexity to manage in the long term. \n\nRelational Database Management System (RDBMS) is also not always fit-for-purpose for certain services.\n\nConfirmed\n  \n\nCE-OD-006\n\nShared Azure Service Bus (ASB) managed by VER Integration team is to be utilised for any event-based inter and/or intra-services integration.\n\nStanding up a dedicated ASB for CE / OTR app BFF.\n\nFor compliance, private ASB endpoints are mandatory, which requires premium tier.\n\nShared ASB has been chosen, as the volume within CE on its own does not warrant having a dedicated ASB in premium tier created for CE. \n\nConfirmed\n  \n\n6. Design Assumptions, Issues, Risks and Dependencies\nID\n\nType\n\nDescription\n\nMitigation\n\n1\n\nDependency\n\nThe solution has dependency on the VER infrastructure pattern readiness, including:\n\nthe creation of landing zone / asset via bedrock;\n\nthe endorsed patterns for individual Azure resources being used; and\n\nthe integration readiness to APIM and shared ASB.\n\nContinuous engagement and collaboration with VER infrastructure and integration team is mandatory.\n\n2\n\nDependency\n\nThe solution has dependency on CE/VER endorsed Microservices design, which is being developed at the same time.\n\nContinuous engagement and review at different dev points is mandatory.\n\n3\n\nDependency\n\nThe solution has dependency on External Customer Identity & Access Management (IDAM) solution, which is to be done by a vendor at the same time.\n\nContinuous collaboration with the vendor is mandatory.\n\n7. Conceptual View\n7.1. Current State\nOTR app current-state-prod.png\nThe current server-side functionality ('backend') to support OTR Mobile App is hosted on AWS, with a ‘dual orchestration’ logic happening between Distillery vs. Peregrine servers.\n\n7.2. Target State\nThis Target State is in review. Some of the considerations and decisions may be deprecated\n\nThe following diagram outlines the target state architecture.\n\nKey considerations:\n\nThe detailed view of each service, along with its relevant integrations, are elaborated in the specific Service Design (captured as child pages to this HLD).\n\nInter-service communication will be done either via internal API endpoints (synchronous) or via ASB events (asynchronous).\n\nAt the time of writing, ‘OTR Sites (Data Centre and Stores)' are considered ‘external’ from networking point of view, and therefore all integration methods between applications hosted within ‘OTR Sites’ and ‘VER Azure’ follow external B2B integration patterns.\n\nSpecific to integration with PereQOperations and PereQOperations OWL APIs, inbound and outbound connectivity are temporarily routed via the existing OTR app Peregrine Service (legacy) hosted in OTR AWS, as the legacy server performs REST-to-SOAP API translations (and vice versa) required by the app BFF services. Changes to PereQOperations and PereQOperations OWL APIs are to be kept to a minimum, considering they are to be decommissioned in the near future.\n\nNote: in addition to the key considerations above, also refer to the Design Decisions captured in https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#5.-Other-Design-Decisions\n.\n\nOTR App Backend Rebuild Diagram.jpg\nDiagram: https://miro.com/app/board/uXjVKyv51kk=/\n \n\n \n\nThe following table outlines the summary of impact across multiple applications/platform.\n\nSolution Component\n\nSummary of Impact\n\nSolution Component Domain\n\nData Classification per Solution Component\n\nLink to Detailed Design / Reference\n\nNotes\n\n1    \nOTR Mobile App (iOS / Android)\n\nModify app authentication to use OAuth per VER standard integration practice. \n\nSome app logic might require to be adjusted to work with the new BFF APIs.\n\nSome UI changes might be required to work with the new BFF APIs (not anticipated to be major).\n\nVER - Customer Engagement\n\nand\n\nOTR IT Team\n\nConfidential\n\n \n\n \n\n2    \nOTR Admin App (desktop / mobile)\n\nDevelop the new web-app to provide admins UI to manage certain operations.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n3    \nAPI Management (APIM)\n\nNew APIM endpoints are to be created to interface with the new BFF APIs/Service endpoints.\n\nNew AD groups are to be created to manage API authorisations.\n\nFirewall rules are to be configured accordingly.\n\nTo confirm access token expiry is to be set as 60 mins and re-auth tokens as 24 hours.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n4    \nAzure Service Bus (ASB) - shared\n\nNew topics and subscriptions are to be configured.\n\nRetry policies are to be configured per use case.\n\nFirewall rules are to be configured accordingly.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\n(out of scope for this HLD)\n\nA new External Customer IDAM is to be designed and implemented to support this solution. However, the details are to be covered by a separate HLD.\n\nVER IDAM\n\nN/A\n\n \n\n \n\n6    \nFuel Service\n\nThe fuel service is responsible for the operation of pay at pump functionality and Scan Pump Save. It communicates with internal APIs in order to handle the creation, alteration and deletion of a fuel transaction. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Fuel Service’ workspace within CE, co-existing with the Fuel Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10328572159\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10481106978\n \n\n \n\n7    \nPayment Service\n\nThe payment service integrates with payment providers and allows orders and services to request payment from a consumer. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Payment Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10490478593\n \n\n \n\n8    \nSite Service\n\nThe site service acts as a source of reference for any site-related data, ingesting and maintaining various data from OTR D365 (with a view to expand this to VER D365 at the right time), such as service location, brands available, opening times and other operational data. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Site Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208455\n \n\n \n\n9    \nCatalogue Service\n\nThe catalogue service acts as a source of reference for any brand, category and product data available at each site, The data is ingested from OTR D365 (with a view to expand to VER D365 at the right time) on a periodic basis.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Catalogue Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504273983\n \n\n \n\n10    \nInitiative Service\n\nThis service handles customer preferences, including user opt-in or opt-out choice. It also provides feeds for consumers that require them.  \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Initiative Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306784\n \n\n \n\n11    \nLoyalty Service\n\nThis service handles OTR in-app rewards and loyalty campaigns/offers, with a view to be enhanced by integrating this with the core LMS platform in the near future.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Loyalty Service’ workspace within CE, co-existing with the Loyalty Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10135667116\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241267\n \n\n \n\n12    \nCommunication Service\n\nThis service is responsible for the transmission of notifications to the consumers, by integrating with Apple or Firebase to support iOS or Android mobile devices accordingly.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Communication Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208485\n \n\n \n\n13    \nAdmin Service\n\nThis service enables admin users to manage any relevant app functions as required.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Admin Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306797\n \n\n \n\n14    \nUser Service\n\nThis service manages app user data, including PII. While the immediate build migrates the existing functionality like-for-like, in the near future, this service will be integrated with the appropriate customer master platform (the source of truth) and will only retain a copy for performance/functionality reasons (as a source of reference).\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘User Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306809\n \n\n \n\n15    \nCar Wash Service\n\nThis service handles the issuance and refresh of Happy Wash service codes between the app and the stores.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Car Wash Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241285\n \n\n \n\n16    \nOrder Service\n\nThis service handles non-fuel orders, provides tax invoices and order history.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Order Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208499\n \n\n \n\n17    \nOTR D365\n\nThe existing integration between the app services and OTR D365 requires to be maintained.\n\nFunctionality changes and integration adjustment are to be covered within Site Service, Catalogue Service and User Service.\n\nAny user/consumer data will be assessed within the relevant Service and may be migrated as part of the Service rebuild if possible.\n\nThe migration and decommissioning of OTR D365 itself is out of scope for this HLD.\n\nOTR and VER - ERP / D365\n\nConfidential\n\n \n\n \n\n18    \nPereQOperations & PereQOperations OWL\n\nNo expected change as part of this HLD.\n\nThese SOAP-based services are considered legacy and will be replaced and decommissioned in the near future. Therefore changes/impacts are to be kept minimum.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n19    \nOTR Store Systems\n\nNo expected change as part of this HLD.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n20    \nPeregrine Data Warehouse (legacy)\n\nExisting SSIS jobs and/or bulk operations are to be assessed and adjusted accordingly, to ensure operational continuity.\n\nIntegration between app BFF services and the Peregrine Data Warehouse should follow the standard VER integration patterns.\n\nOTR and VER Data Platform\n\nConfidential\n\n \n\n \n\n21    \nOTR App Peregrine Service (legacy)\n\nThis refers to the existing AWS-hosted backend server/VM which does the REST-to-SOAP API translations (and vice versa) when integrating with PereQOperations and PereQOperations OWL APIs.\n\nModify server to call the new APIs via APIM, with the standard OAuth 2.0 authentication.\n\nModify server to receive API calls from the new services.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n22    \nBraintree\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n23    \nData Mesh Group (DMG)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n24    \nNotification Services (Apple Push / Firebase)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nConfidential (External Party)\n\n \n\n \n\n25    \n(future consideration) Loyalty Management System (LMS) - EagleEye AIR\n\n \n\nVER - Customer Engagement\n\n \n\n \n\n \n\n26    \n(future consideration)\n\nEnterprise Data Platform (EDP)\n\n \n\nVER - Data Platform\n\n \n\n \n\n \n\n27    \n(future consideration)\n\nERP Platform (Microsoft D365)\n\n \n\nVER - ERP (D365)\n\n \n\n \n\n \n\n28    \n(future consideration)\n\nCommerce Scale Unit (CSU)\n\n \n\nVER - Stores\n\n \n\n \n\n \n\n \n\n8. Application View\nDetailed design for each service is captured in the relevant Service Design (child pages to this HLD).\n\n9. Infrastructure and Security View\n9.1. Solution Components Summary\nComponent\n\nSaaS/IaaS/PaaS\n\nNew/Existing/Modify\n\n1    \nOTR Mobile App (iOS / Android)\n\nClient (mobile app)\n\nModify\n\n2    \nOTR Admin App (desktop / mobile)\n\nClient (web app)\n\nNew\n\n3    \nAPI Management (APIM)\n\nPaaS\n\nModify\n\n4    \nAzure Service Bus (ASB) - shared\n\nPaaS\n\nModify\n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\nAnticipated to be Saas - solution is out of scope for this HLD\n\nAnticipated to be ‘new’ - out of scope for this HLD\n\n6    \nFuel Service\n\nPaaS\n\nModify\n\n7    \nPayment Service\n\nPaaS\n\nNew\n\n8    \nSite Service\n\nPaaS\n\nNew\n\n9    \nCatalogue Service\n\nPaaS\n\nNew\n\n10    \nInitiative Service\n\nPaaS\n\nNew\n\n11    \nLoyalty Service\n\nPaaS\n\nModify\n\n12    \nCommunication Service\n\nPaaS\n\nNew\n\n13    \nAdmin Service\n\nPaaS\n\nNew\n\n14    \nUser Service\n\nPaaS\n\nNew\n\n15    \nHappy Wash Service\n\nPaaS\n\nNew\n\n16    \nOrder Service\n\nPaaS\n\nNew\n\n17    \nOTR D365\n\nSaaS\n\nModify\n\n18    \nPereQOperations & PereQOperations OWL\n\nOn-premises (OTR DC)\n\nExisting\n\n19    \nOTR Store Systems\n\nOn-premises (OTR stores)\n\nExisting\n\n20    \nPeregrine Data Warehouse (legacy)\n\nOn-premises (OTR DC)\n\nModify\n\n21    \nOTR App Peregrine Service (legacy)\n\nPaaS (AWS)\n\nModify\n\n22    \nBraintree\n\nSaaS\n\nExisting\n\n23    \nData Mesh Group (DMG)\n\nSaaS\n\nExisting\n\n24    \nNotification Services (Apple Push / Firebase)\n\nSaaS\n\nExisting\n\n9.2. Environment View\nEnvironment Type\n\nRemarks\n\nDevelopment\n\nDevelopment testing is currently done on developer machines. For strategic future state, requires Dev environment to be created.\n\nUAT\n\nTo be created per services (workspace) to replace the existing UAT environment.\n\nProd\n\nTo be created per services (workspace) to replace the existing Prod environment.\n\n9.3. Deployment Diagram\nNote: in addition to the resources captured in the diagram, Azure Redis Cache will also be considered. However, use cases are to be confirmed first before incorporated into the solution.\n\n9.4. Connectivity\nSource\n\nDestination\n\nProtocol\n\nAuth\n\n1    \nOTR Mobile Apps\n\nVER APIM, via Cloudflare → Public IP → App Gateway → delegated subnet → delegated subnet / private IP\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via CA-issued Client certificates.\n\nCertificate pinning is used.\n\n2    \nAzure Function for X Service via delegated subnet\n\nOTR hosted-applications via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nFor OTR App Peregrine Service (AWS hosted): TBC\n\nFor Peregrine Data Warehouse (legacy): TBC\n\n3    \nVER APIM via delegated subnet\n\nAzure Function for X Service via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n4    \nAzure Function for X Service via delegated subnet\n\nVER Shared Log Analytics (via public endpoint, per standard VER setup)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n5    \nAzure Function for X Service via delegated subnet\n\nVER Shared Service Bus (ASB) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\n5671 - AMQP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n6    \nAzure Function for X Service via delegated subnet\n\nStorage Account (Table) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n7    \nAzure Function for X Service via delegated subnet\n\nCosmos DB via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n8    \nAzure Function for X Service via delegated subnet\n\nSQL Server DB via private endpoint\n\n1433 - TCP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n9    \nAzure Function for X Service via delegated subnet\n\nKey Vault via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n10    \nOTR-hosted applications (in OTR AWS and OTR DC)\n\nVER APIM, via Cloudflare and App Gateway\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via self-signed certificates (internal system).\n\n11    \nAzure Function for X Service via delegated subnet\n\nBraintree via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n12    \nAzure Function for X Service via delegated subnet\n\nData Mesh Group (DMG) via outbound firewall (via Netskope SSE in the future)\n\n443 - WebSocket over TLS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMessages are authenticated with a KEK (Key Encryption Key).\n\nFor the session token:\n\nIt is a onetime use token.\n\nIt is a random string\n\nCardholder data (PAN) is encrypted at the DMG side using a DUKPT derived key and 3DES algorithm.\n\n13    \nAzure Virtual Desktop (AVD)\n\nAzure private resources (function apps, keyvault, data store)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nRBAC Entra ID\n\nNote: the current use cases is only for internal testing & support. No Business User access.\n\n14    \nAzure DevOps\n\nAzure resources via DevOps agent and deployment planes\n\nThe DevOps Agent is responsible for deploying and updating configurations in different environments (Development, Test, and Prod), by coordinating Terraform to deploy resources via Azure Resource Manager APIs.\n\nThe agent interacts with the Azure Function deployment pipeline, ensuring that infrastructure configurations, APIM policy updates, and application deployments are consistent across environments.\n\nIn addition to the ARM APIs, the code for the function app is deployed through it’s deployment plane to a deployment slot. This should be secured by its own scm private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nEntra ID for individuals\n\nManaged Identity for automation\n\n15    \nVER APIM\n\nVER Shared Service Bus via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n16    \nAzure Function for X Service via delegated subnet\n\nStorage Account for Function Apps: blob, file via delegated subnet via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n17    \nAzure Function for X Service via delegated subnet\n\nApple Push Notifications (APNs)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n18    \nAzure Function for X Service via delegated subnet\n\nFirebase Cloud Messaging (FCM)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n19    \nAzure Function for X Service via delegated subnet\n\nOTR D365\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n9.5. Component Deployment Specifications & Security Controls\nAzure Resource\n\nDeployment\n\n1    \nApp Service Plan - Azure Functions\n\n \n\n \n\nSizing\n\nPremium Function - P0v3:1\n\nZone redundancy not required\n\nWindows\n\nLanguage: C# - Dotnet8\n\nXUnit | Fluent Assertions | Moq\n\nAzure Functions V4\n\nZip deploy \n\nApplication Insights enabled \n\nConnect to Application Insights with a connection string\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nUse managed identity for accessing resources\n\nSite credentials for deployments - Source code is managed in Azure DevOps with access control and build pipeline checks to prevent bad merges\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD for developers\n\nSCM deployment plane\n\nCI/CD pipeline\n\nNetwork Controls\n\nSecured by private endpoints for:\n\nFunction\n\ninbound \n\nSCM\n\nSCM should restrict access from Dev Pipeline agent\n\nDelegated subnet /27\n\nAll egress traffic must route through delegated subnet \n\nStorage account for Azure Functions instance secured by private endpoints for blob and file - \n\nAccess key vault through private endpoint \n\nConsiderations\n\nN/A\n\n2    \nAzure Key Vault\n\nSizing\n\nStandard tier\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nTLS 1.2 and 1.3\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nSecrets (Incl - Keys, Certs) Data Plane: RBAC Managed Identities\n\nFunctions\n\nSecrets Management Plane: RBAC\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nKey management plane\n\nSSO RBAC - internal staff\n\nCI/CD pipeline\n\nSecrets (Incl - Keys, Certs) data plane\n\nSSO RBAC - internal staff\n\nNetwork Controls\n\nSecured by Private Endpoint\n\nConsiderations\n\nN/A\n\n3    \nAzure Storage - table\n\nSizing\n\nGeneral Purpose v2 Storage Account - ZRS (99.99% SLA)\n\nTable Storage\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nRBAC Managed Identities\n\nFunctions\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nDeployment plane\n\nCI/CD pipeline\n\nData plane\n\nFunction managed identity\n\nNetwork Controls\n\nSecured by private endpoints\n\nConsiderations\n\nShould only be accessible via Azure backbone/ managed identity, from VER network or Azure Virtual Desktop for testing and support purposes.\n\n4    \nAzure Cosmos DB\n\nSizing\n\nSingle Database\n\nContainers 14000 RUs total between both regions\n\nDiagnostic settings enabled for audit logs \n\nRedundancies\n\nRead Region - Australia Southeast\n\nBackup every 240 min Retained for 8 hours - with Geo-Redundant setting, the backup is done on both regions.\n\nWrite Region - Australia East → replicates data to Australia Southeast\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nData Explorer only viewable if IP address is whitelisted and selected networks is enabled\n\nDeployment plane\n\nCI/CD pipeline \n\n\nServer / Database\n\nManaged User Identity - RBAC access to function applications\n\nNetwork Controls\n\nSecured by private endpoint\n\nSecured by NSG separate rules for coupon-scanner / flybuys\n\nDisabled Public Network access\n\nConsiderations\n\nNoSQL database type interaction is handled with Azure.Cosmos.Client nuget package ( c# ).\n\nCosmos private endpoint uses 3 IP’s, 1 shared IP and 1 specific IP for regions Australia East ( primary write region ) Australia Southeast ( secondary read region).\n\n5    \nAzure SQL\n\nSizing\n\nAzure SQL Database\n\nSingle database\n\nDTU - Standard tier\n\nS0 - Compute Size\n\nIncrease compute size as required\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nStorage Explorer\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nDeployment plane\n\nCI/CD pipeline - db owner role\n\nServer\n\nServer admin (sysadmin, dbo) - username/password\n\nEntra Id admin - Entra security group\n\nDatabase\n\nFunction App managed identity - data writer role\n\nStorage Explorer - TBD: either SSO internal staff or Storage Explorer managed identity - data writer and data reader roles\n\nNetwork Controls\n\nSecured by private endpoint\n\nConsiderations\n\nRow level and column level encryption using SQL Certificate should be possible - pending requirement from security, as this has performance impact.\n\n6    \nNetworking:\n\nVNet\n\nSubnets\n\nNSGs\n\nUDRs\n\nSizing\n\nVNet /24\n\nPrivate Endpoint Subnet /27\n\ndelegated Subnet /27\n\nOther VNets - peering / routing consideration\n\nFirewall security VNet\n\nVNet Address Space:\n\nDev: /24\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nDeployment plane\n\nCI/CD pipeline\n\n7    \nAzure Monitor\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAuth\n\nRBAC Managed Identities - Log stream to App Insights\n\nNetwork Controls\n\nLog Analytics and Azure Monitor (Application Insights) could potentially be publicly accessible, for staff access (as per current pattern)\n\nLog stream to App Insights is public (as per current pattern)\n\nConsiderations\n\nSimilar to Fuel Service implementation, logs volume sent to the shared workspace should be configured with a daily cap.\n\n9.6. Users\n\n\n\nUser Details\n\nUsers & RBAC controls\n\nCurrently, there are 486,488 registered users for the OTR mobile app, out of which 172,700 is considered active monthly.\n\nThe External Customer Identity & Access Management (IDAM) solution is out of scope of this HLD and will be done as a separate HLD.\n\nAdditionally, a new Admin app/portal is to be created as part of this solution. RBAC is to be mapped for the Admin Users, per relevant Entra roles and groups.\n\nSSO, Conditional Access Policy and User Provisioning \n\nSSO is to be set up for access to Admin App/Portal.\n\nDeveloper / Technical Support access is to be set up according to the Viva standard.\n\n \n\n9.7. Backup & Recovery\nThe current backup policies for AWS-hosted OTR resource are as following:\n\nEC2 instances - Daily backup\n\nRDS Instances, MySQL and MSSQL - Daily backup\n\nIn the new Azure hosting, in the event of DR, the approach will involve deploying a new Azure Function instance in another region as necessary using automated pipelines.\n\nThe Azure Storage Account will be configured with Zone-Redundant Storage (ZRS), with 0 RPO and RTO of less than 15 mins.\n\nSpecific backup & recovery configurations are to be elaborated in the relevant Service Design.\n\n9.8. Monitoring - Application, Infrastructure & Security\nThe existing OTR app monitoring is performed via a combination of AWS Cloud Trails and Dynatrace. With the strategic hosting migration into Azure Cloud, Cloud Trails will no longer be available. \n\nAdditionally, the following servers are also regularly monitored:\n\nDatabases(RDS)\n\nprod-otr-app2-2a - MySQL\n\nprod-otr-app2-2b - MYSQL\n\nprodotrappmssql - MSSQL\n\nEC2\n\nProd OTR App - 2A (Linux/Apache)\n\nProd OTR App - 2B (Linux/Apache)\n\nProd OTR Web Service - 2A (Windows/IIS)\n\nProd OTR Web Service - 2B (Windows/IIS)\n\nCurrent Dynatrace for OTR: https://vnv91336.live.dynatrace.com/#newhosts;gtf=-14d%20to%20-7d;gf=all\n\n \n\nIn the new Azure hosting, monitoring is performed at application and infrastructure levels.\n\nApplication level:\n\nA common logging package will log code transaction execution information, traces, and debug data at configurable logging level to Application insights and shared Log Analytics, e.g. Serilog. This information is queried in both App Insights and the shared log analytics via kql queries.\n\nA common /health function api will be exposed to proactively indicate application-level health.\n\nAzure Workbooks provide dashboards that visually summarize key application-level metrics and insights across variable time periods primarily from App Insights via kql queries.\n\nInfrastructure level:\n\nThe out of the box Function App runtime environment logs are streamed to app insights and from there to the shared log analytics. These are used for Alert queries. E.g. number of unhealthy nodes > 0. This is built into the Terraform modules used.\n\nA shared Log Analytics workspace with a configurable period of log retention is utilized for auditing, tracing and debugging during support and the development life cycle using kql queries that can be stored as dashboard notebooks. All logs across all of the infrastructure components are streamed here.\n\nAzure Monitor Application insights will provide detailed Function App logs which is also streamed to the shared log analytics workspace. Both the out of the box information as part of the Premium Tier runtime (e.g. availability, server requests, etc.) as well as the streamed logs from the log package for transaction level data.\n\nMonitoring:\n\nAzure Monitor alerts based on queries for the following:\n\nAny exceptions streamed from the common logging package to App Insights\n\nAny basic out of the box infrastructure queries in log analytics indicating problems at the infrastructure level e.g. unhealthy nodes > 0 in 15 minutes, Average CPU utilization > 90 % in 15-minute period, high transaction volumes, high volume of 4xx or 5xx http response codes, etc.\n\nWhen the common /health function app API returns a Http status code other than 2xx\n\nAlerts are sent out to the members of the support team to action via email. Additionally, VER Integration team is in the process of integrating alerts to ServiceNow for Incident Management purposes.\n\n9.9. Data- Reports & Interfaces/Data Integration\nAt the time of writing, Reporting requirements are yet to be captured. HLD will be amended once requirements are received, and if there is any material change to the proposed solution.\n\n10. Patterns Used\n10.1. Integration Patterns\nIntegration Pattern\n\nPattern Status\n\nMode\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9923133545\n\ndomain endorsed\n\n \n\n \n\n10.2. Security Patterns\nSecurity Pattern\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9997582337\n\ndraft\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9995911207\n\nApproved\n\nNo deviation\n\n \n\n10.3. Infrastructure Patterns\nAzure Resource\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9898952562\n\nPeer review\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852518458\n\narch informed\n\nNo deviation\n\n \n\n3    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830793256\n\narch informed\n\nNo deviation\n\n \n\n4    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830760505\n\narch informed\n\nNo deviation\n\n \n\n5    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088191\n\narch informed\n\nNo deviation\n\n \n\n6    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088147\n\nPeer review\n\nSome deviation\n\nDeviates regarding AMPLS and Private Endpoint for log analytics. IAM-based with public endpoint instead.\n\n7    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852616708\n\narch informed\n\nNo deviation\n\n \n\n11. References\nId\n\nName\n\nLink\n\nREF-001\n\nOTR Diagrams\n\nOTR App Solution Architecture_AS IS.drawio \n\nApp Solution Architecture New Cloud Design v2.drawio  \n\nREF-002\n\nOTR initial design decisions\n\nOTR App V4 Design decisions.docx\n\nREF-003\n\nSoftware Requirement Specifications (SRSs) created by CodeFish\n\nSRS - Final\n\nREF-004\n\nSharepoint location where ‘current state’ documents are stored\n\nCurrent State Documents\n\n12. Appendix\n12.1. Appendix A - Alternative Target State DiagramExecution Status: \nOn Hold\n  - Feb 2025\n\nRelated Project(s):\n\nOTR App Backend Rebuild\n\n1. Document Control\n1.1. Contacts \n1.2. Version History\n2. Document Purpose\n2.1. In Scope\n2.2. Out of Scope\n3. Key Requirements\n3.1. Functional Requirements\n3.2. Non-Functional Requirements\n4. Key Design Decisions (KDDs)\n5. Other Design Decisions\n6. Design Assumptions, Issues, Risks and Dependencies\n7. Conceptual View\n7.1. Current State\n7.2. Target State\n8. Application View\n9. Infrastructure and Security View\n9.1. Solution Components Summary\n9.2. Environment View\n9.3. Deployment Diagram\n9.4. Connectivity\n9.5. Component Deployment Specifications & Security Controls\n9.6. Users\n9.7. Backup & Recovery\n9.8. Monitoring - Application, Infrastructure & Security\n9.9. Data- Reports & Interfaces/Data Integration\n10. Patterns Used\n10.1. Integration Patterns\n10.2. Security Patterns\n10.3. Infrastructure Patterns\n11. References\n12. Appendix\n12.1. Appendix A - Alternative Target State Diagram\n1. Document Control\n1.1. Contacts \nName\n\nDocument Role\n\nEmail\n\nStatus\n\nRina Pranoto\n\nContributor\n\nrina.pranoto@vivaenergy.com.au \n\nN/A\n  \n\nRajnish Joseph\n\nContributor\n\nrajnish.joseph@vivaenergy.com.au\n\nN/A\n  \n\nAndy Arch\n\nPeer Reviewer\n\nandrew.arch@vivaenergy.com.au\n\nPeer review completed\n      \n\nMayank Sharma\n\nPeer Reviewer\n\nmayank.sharma@vivaenergy.com.au\n\nPeer review completed\nConditionally- The sections pertaining to security are currently in development and will undergo review as they are completed.   \n\nTigere Machonisa\n\nPeer Reviewer\n\ntigere.machonisa@vivaenergy.com.au\n\nPeer review completed\n    \n\nJason Stipkovic\n\nPeer Reviewer\n\njason.stipkovic@vivaenergy.com.au\n\nPeer review completed\n  \n\nAmandeep Modgil\n\nPeer Reviewer\n\namandeep.modgil@vivaenergy.com.au\n\nPeer review requested\n  \n\nDaniel Andrade\n\nPeer Reviewer\n\ndaniel.andrade@vivaenergy.com.au\n\nPeer review completed\n  \n\nVER ARB (Architecture Review Board)\n\nApprover\n\n https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10494017545\n \n\n \nApproved\n    \n\nTony Matthews\n\nAudience - Informed\n\nt.matthews@otr.com.au\n\n \n\nAmin Jodeyri\n\nAudience - Informed\n\na.jodeyri@otr.com.au\n\n \n\nDarren Peisley\n\nAudience - Informed\n\nd.peisley@otr.com.au\n\n \n\n1.2. Version History\nVersion\n\nDate\n\nAuthor\n\nChange Summary\n\n0.1\n\nMay 27, 2024\n\nRina Pranoto\n\nFirst Draft\n\n0.2\n\n\nNov 14, 2024 \n\nRina Pranoto\n\nDocument structure uplifted to the latest version\n\n0.3\n\nNov 24, 2024 \n\nRina Pranoto\n\nDesign Decisions, Target State solution and Deployment view are completed\n\n1.0\n\nNov 25, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for Peer Review\n\n1.1\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for ARB\n\n1.2\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nARB endorsed version\n\n2. Document Purpose\nThe OTR mobile app has been going through transformations from its inception version back in 2016, to the latest version to support the current OTR requirements. OTR App 4.0 aims to further enhance the application to be able to support future requirements for both OTR and Viva brands. \n\nThe purpose of this document is to outline the high level design of OTR App 4.0 backend rebuild, which includes rearchitecting and replatforming the application to modernise its functionality, and rehost the BFF (Backend-for-Frontend) services into Azure in accordance with VER infrastructure, integration and security standard. \n\nPoint of note: ‘backend’ in this context refers to the server-side application(s) currently hosted on OTR AWS, which complement the OTR mobile app (native and hybrid) functionality. It does not refer to the OTR systems hosted on-premises.\n\n2.1. In Scope\nThis solution includes:\n\nthe overall design approach of rearchitecting the existing OTR mobile app back-end (server) functionality into VER-aligned BFF services; and\n\nthe replatforming of the OTR mobile app back-end (server) into VER Azure hosting, in accordance with the standard VER infrastructure, integration and security practices.\n\n2.2. Out of Scope\nThis solution does not cover:\n\nany migration (refactoring, replatforming, or rearchitecting) of OTR systems currently hosted on-premises, either inside OTR stores or within OTR DC (Data Centre);\n\nany new app functionality not currently supported by the current mobile app version, such as food/item delivery, OTR app in Reddy Express sites, etc;\n\nother VER Digital Channels outside of OTR mobile app;\n\nany integration and/or migration of loyalty rewards from the app into Strategic LMS, except for certain aspects as covered by the relevant Service Design under this HLD; and\n\nany strategic design and roadmap for External Customer Identity & Access Management (IDAM). This topic will be covered as a separate work package.\n\n3. Key Requirements\n3.1. Functional Requirements\nRefer to https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10427203585\n for the full requirements.\n\n3.2. Non-Functional Requirements\nRefer to Non Functional Requirements.xlsx for the full non-functional requirements. The architecturally-significant non-functional requirements are summarised in the table below.\n\nID\n\nRequirement Summary\n\nDescription\n\nTraceability\n\nRequirement Met (Yes/No/Partial)\n\n1\n\nApplication or Service Criticality: Availability\n\n99.9%, which translates to max downtime of 1 hour per month / 3 hours per quarter.\n\nN/A\n\nYes\n\nThe Service Design must meet this SLA, excluding dependencies with legacy on-prem applications and/or external vendors, which have their own specified SLAs.\n\n2\n\nApplication or Service Criticality: Disaster Recovery\n\nRTO is 4-24 hours, to be defined per service.\n\nRPO requirement is yet to be defined.\n\nN/A\n\nThe RTO and RPO is to be assessed per Azure resource being utilised to implement the relevant Service. Refer to the https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#9.7.-Backup-%26-Recovery\n section for more details.\n\n3\n\nVolumetrics\n\nNo. of current app users:\n\n771,926 total users including deleted.\n\n486,488 total users excluding deleted.\n\n172,700 active users monthly.\n\nUser volume is anticipated to grow up to 5x the current volume, once app adoption within ReddyExpress stores commences (post the completion of this HLD / out of scope for this HLD).\n\nTransaction volume is being assessed by Product Owner and Business Analysts.\n\nN/A\n\nN/A\n\n5\n\nData Classification\n\nConfidential\n\nN/A\n\n\nN/A\n\n\n6\n\nData Privacy\n\nThe specific VER Data Privacy requirement is yet to be defined. However, The Privacy Act applies. Reference: https://www.oaic.gov.au/privacy/privacy-legislation/the-privacy-act, which includes https://www.oaic.gov.au/privacy/australian-privacy-principles.\n\nN/A\n\nAccording to The Privacy act, the customer data collected must be compliant in terms of storage and lifecycle management.\n\nThe solution to meet this requirement is not just technical, but also covers legal and operational aspects.\n\nThe existing OTR privacy policy attached to the app upon user registration requires to be reviewed.\n\n7\n\nSecurity\n\nSecurity Assurance assessment is to be done, following this guideline: https://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/10379919741\n \n\nN/A\n\nPen Test is to be organised accordingly by the project.\n\nAdditionally, PCI audit is also required.\n\n8\n\nPerformance\n\nPerformance/load testing is required to validate the projected growth.\n\nN/A\n\nPerformance/load testing is to be performed by the project.\n\n4. Key Design Decisions (KDDs)\nID\n\nDecision Summary\n\nDescription\n\nStatus\n\nDate of Endorsement\n\nOwner\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\n5. Other Design Decisions\nID\n\nDecision Description\n\nAlternative Option(s) Considered\n\nDecision Rationale\n\nStatus\n\nCE-OD-001\n\n \n\n \n\n \n\nThe application is to be rearchitected from a monolithic centralised server into service-based architecture and event-based architecture.\n\nThis is to replace the ‘tandem’ legacy web services setup, which was required to interface with a vendor-locked layer.\n\nThis approach also simplifies the existing application architecture by removing additional dependencies (e.g. Wordpress CMS, MS CE, internal legacy components).\n\nRetain the existing monolitic / centralised web-servers to service all APIs.\n\nThe monolithic / centralised architecture is not scalable, and does not separate service boundaries and blast zone. The service-based architecture is aligned to the CE strategic roadmap to support Viva omnichannel strategy.\n\nConfirmed\n \n\nCE-OD-002\n\nVER D365 is to be set as the target source of truth for products and product categories. This is to support replacing the existing legacy-based product structure and multiple layers of mapping.\n\nIn the transitional/interim state, dual D365 setting might require to be maintained.\n\nN/A\n\nMultiple ERPs are not aligned to the strategic roadmap of VER. Therefore, this decision has no alternative. The main goal is to achieve a single ERP in the target state.\n\nConfirmed\n  \n\nCE-OD-003\n\nFurther to CE-OD-002 above, custom catalogue/order/basket services is to be implemented.\n\nUse Microsoft headless commerce product feature.\n\nCustom option has been chosen for the following reasons:\n\nCheaper operation: The license cost alone for headless commerce server (even at MS expected discount) means the development payback is under 6 months\n\nNo change to core D365: D365 does not have a good fit for the required Site/Offer/Category hierarchy meaning we would have to customise within D365.  D365 development is more costly and the implementation cycle is slower so this could offset the dev savings.\n\nFlexibility in design: Integrating directly with D365 makes the migration from OTR Legacy to OTR+ harder (or adds a dependency which will delay delivery by 6+ months)\n\nMore options to optimise performance: A custom solution will allow us to be more in control of performance\n\nConfirmed\n  \n\nCE-OD-004\n\nThe existing business logic contained in various SQL Server stored procedures will be refactored to the relevant services. \n\nThe end goal is to have lean stored procedures as mechanism to do Database CRUD (Create, Retrieve, Update, Delete) only, if required.\n\nRetain existing business logics within stored procedures in a lift and shift.\n\nRetaining business logic within database stored procedures creates multiple places where business logics reside, adding complexity in maintenance and operational support. It also limits certain functionality unnecessarily.\n\nConfirmed\n  \n\nCE-OD-005\n\nFurther to CE-OD-004 above, data store choice for each service is to be assessed per Service Design, to ensure fit-for-purpose. This also includes the assessment on the best strategy to migrate the existing data from the AWS-hosted SQL Server Databases into the new data store of choice.\n\nFrom operational cost perspective, the preferred order of data store options (from the lowest to highest cost) is as following:\n\nAzure Table storage\n\nCosmos DB (for non RDBMS / no-SQL)\n\nSQL Server DB (consider Azure SQL Hyperscale)\n\nNote: the fit-for-purpose assessment is to consider all factors, not just operational cost perspective (albeit being a major factor).\n\nRetain the existing centralised SQL Server database to store all OTR app data across all services.\n\nThe centralised SQL Server database does not align with the service-based microservices principles, as it created tight coupling / heavy dependency across services, resulting in more complexity to manage in the long term. \n\nRelational Database Management System (RDBMS) is also not always fit-for-purpose for certain services.\n\nConfirmed\n  \n\nCE-OD-006\n\nShared Azure Service Bus (ASB) managed by VER Integration team is to be utilised for any event-based inter and/or intra-services integration.\n\nStanding up a dedicated ASB for CE / OTR app BFF.\n\nFor compliance, private ASB endpoints are mandatory, which requires premium tier.\n\nShared ASB has been chosen, as the volume within CE on its own does not warrant having a dedicated ASB in premium tier created for CE. \n\nConfirmed\n  \n\n6. Design Assumptions, Issues, Risks and Dependencies\nID\n\nType\n\nDescription\n\nMitigation\n\n1\n\nDependency\n\nThe solution has dependency on the VER infrastructure pattern readiness, including:\n\nthe creation of landing zone / asset via bedrock;\n\nthe endorsed patterns for individual Azure resources being used; and\n\nthe integration readiness to APIM and shared ASB.\n\nContinuous engagement and collaboration with VER infrastructure and integration team is mandatory.\n\n2\n\nDependency\n\nThe solution has dependency on CE/VER endorsed Microservices design, which is being developed at the same time.\n\nContinuous engagement and review at different dev points is mandatory.\n\n3\n\nDependency\n\nThe solution has dependency on External Customer Identity & Access Management (IDAM) solution, which is to be done by a vendor at the same time.\n\nContinuous collaboration with the vendor is mandatory.\n\n7. Conceptual View\n7.1. Current State\nOTR app current-state-prod.png\nThe current server-side functionality ('backend') to support OTR Mobile App is hosted on AWS, with a ‘dual orchestration’ logic happening between Distillery vs. Peregrine servers.\n\n7.2. Target State\nThis Target State is in review. Some of the considerations and decisions may be deprecated\n\nThe following diagram outlines the target state architecture.\n\nKey considerations:\n\nThe detailed view of each service, along with its relevant integrations, are elaborated in the specific Service Design (captured as child pages to this HLD).\n\nInter-service communication will be done either via internal API endpoints (synchronous) or via ASB events (asynchronous).\n\nAt the time of writing, ‘OTR Sites (Data Centre and Stores)' are considered ‘external’ from networking point of view, and therefore all integration methods between applications hosted within ‘OTR Sites’ and ‘VER Azure’ follow external B2B integration patterns.\n\nSpecific to integration with PereQOperations and PereQOperations OWL APIs, inbound and outbound connectivity are temporarily routed via the existing OTR app Peregrine Service (legacy) hosted in OTR AWS, as the legacy server performs REST-to-SOAP API translations (and vice versa) required by the app BFF services. Changes to PereQOperations and PereQOperations OWL APIs are to be kept to a minimum, considering they are to be decommissioned in the near future.\n\nNote: in addition to the key considerations above, also refer to the Design Decisions captured in https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#5.-Other-Design-Decisions\n.\n\nOTR App Backend Rebuild Diagram.jpg\nDiagram: https://miro.com/app/board/uXjVKyv51kk=/\n \n\n \n\nThe following table outlines the summary of impact across multiple applications/platform.\n\nSolution Component\n\nSummary of Impact\n\nSolution Component Domain\n\nData Classification per Solution Component\n\nLink to Detailed Design / Reference\n\nNotes\n\n1    \nOTR Mobile App (iOS / Android)\n\nModify app authentication to use OAuth per VER standard integration practice. \n\nSome app logic might require to be adjusted to work with the new BFF APIs.\n\nSome UI changes might be required to work with the new BFF APIs (not anticipated to be major).\n\nVER - Customer Engagement\n\nand\n\nOTR IT Team\n\nConfidential\n\n \n\n \n\n2    \nOTR Admin App (desktop / mobile)\n\nDevelop the new web-app to provide admins UI to manage certain operations.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n3    \nAPI Management (APIM)\n\nNew APIM endpoints are to be created to interface with the new BFF APIs/Service endpoints.\n\nNew AD groups are to be created to manage API authorisations.\n\nFirewall rules are to be configured accordingly.\n\nTo confirm access token expiry is to be set as 60 mins and re-auth tokens as 24 hours.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n4    \nAzure Service Bus (ASB) - shared\n\nNew topics and subscriptions are to be configured.\n\nRetry policies are to be configured per use case.\n\nFirewall rules are to be configured accordingly.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\n(out of scope for this HLD)\n\nA new External Customer IDAM is to be designed and implemented to support this solution. However, the details are to be covered by a separate HLD.\n\nVER IDAM\n\nN/A\n\n \n\n \n\n6    \nFuel Service\n\nThe fuel service is responsible for the operation of pay at pump functionality and Scan Pump Save. It communicates with internal APIs in order to handle the creation, alteration and deletion of a fuel transaction. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Fuel Service’ workspace within CE, co-existing with the Fuel Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10328572159\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10481106978\n \n\n \n\n7    \nPayment Service\n\nThe payment service integrates with payment providers and allows orders and services to request payment from a consumer. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Payment Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10490478593\n \n\n \n\n8    \nSite Service\n\nThe site service acts as a source of reference for any site-related data, ingesting and maintaining various data from OTR D365 (with a view to expand this to VER D365 at the right time), such as service location, brands available, opening times and other operational data. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Site Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208455\n \n\n \n\n9    \nCatalogue Service\n\nThe catalogue service acts as a source of reference for any brand, category and product data available at each site, The data is ingested from OTR D365 (with a view to expand to VER D365 at the right time) on a periodic basis.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Catalogue Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504273983\n \n\n \n\n10    \nInitiative Service\n\nThis service handles customer preferences, including user opt-in or opt-out choice. It also provides feeds for consumers that require them.  \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Initiative Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306784\n \n\n \n\n11    \nLoyalty Service\n\nThis service handles OTR in-app rewards and loyalty campaigns/offers, with a view to be enhanced by integrating this with the core LMS platform in the near future.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Loyalty Service’ workspace within CE, co-existing with the Loyalty Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10135667116\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241267\n \n\n \n\n12    \nCommunication Service\n\nThis service is responsible for the transmission of notifications to the consumers, by integrating with Apple or Firebase to support iOS or Android mobile devices accordingly.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Communication Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208485\n \n\n \n\n13    \nAdmin Service\n\nThis service enables admin users to manage any relevant app functions as required.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Admin Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306797\n \n\n \n\n14    \nUser Service\n\nThis service manages app user data, including PII. While the immediate build migrates the existing functionality like-for-like, in the near future, this service will be integrated with the appropriate customer master platform (the source of truth) and will only retain a copy for performance/functionality reasons (as a source of reference).\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘User Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306809\n \n\n \n\n15    \nCar Wash Service\n\nThis service handles the issuance and refresh of Happy Wash service codes between the app and the stores.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Car Wash Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241285\n \n\n \n\n16    \nOrder Service\n\nThis service handles non-fuel orders, provides tax invoices and order history.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Order Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208499\n \n\n \n\n17    \nOTR D365\n\nThe existing integration between the app services and OTR D365 requires to be maintained.\n\nFunctionality changes and integration adjustment are to be covered within Site Service, Catalogue Service and User Service.\n\nAny user/consumer data will be assessed within the relevant Service and may be migrated as part of the Service rebuild if possible.\n\nThe migration and decommissioning of OTR D365 itself is out of scope for this HLD.\n\nOTR and VER - ERP / D365\n\nConfidential\n\n \n\n \n\n18    \nPereQOperations & PereQOperations OWL\n\nNo expected change as part of this HLD.\n\nThese SOAP-based services are considered legacy and will be replaced and decommissioned in the near future. Therefore changes/impacts are to be kept minimum.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n19    \nOTR Store Systems\n\nNo expected change as part of this HLD.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n20    \nPeregrine Data Warehouse (legacy)\n\nExisting SSIS jobs and/or bulk operations are to be assessed and adjusted accordingly, to ensure operational continuity.\n\nIntegration between app BFF services and the Peregrine Data Warehouse should follow the standard VER integration patterns.\n\nOTR and VER Data Platform\n\nConfidential\n\n \n\n \n\n21    \nOTR App Peregrine Service (legacy)\n\nThis refers to the existing AWS-hosted backend server/VM which does the REST-to-SOAP API translations (and vice versa) when integrating with PereQOperations and PereQOperations OWL APIs.\n\nModify server to call the new APIs via APIM, with the standard OAuth 2.0 authentication.\n\nModify server to receive API calls from the new services.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n22    \nBraintree\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n23    \nData Mesh Group (DMG)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n24    \nNotification Services (Apple Push / Firebase)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nConfidential (External Party)\n\n \n\n \n\n25    \n(future consideration) Loyalty Management System (LMS) - EagleEye AIR\n\n \n\nVER - Customer Engagement\n\n \n\n \n\n \n\n26    \n(future consideration)\n\nEnterprise Data Platform (EDP)\n\n \n\nVER - Data Platform\n\n \n\n \n\n \n\n27    \n(future consideration)\n\nERP Platform (Microsoft D365)\n\n \n\nVER - ERP (D365)\n\n \n\n \n\n \n\n28    \n(future consideration)\n\nCommerce Scale Unit (CSU)\n\n \n\nVER - Stores\n\n \n\n \n\n \n\n \n\n8. Application View\nDetailed design for each service is captured in the relevant Service Design (child pages to this HLD).\n\n9. Infrastructure and Security View\n9.1. Solution Components Summary\nComponent\n\nSaaS/IaaS/PaaS\n\nNew/Existing/Modify\n\n1    \nOTR Mobile App (iOS / Android)\n\nClient (mobile app)\n\nModify\n\n2    \nOTR Admin App (desktop / mobile)\n\nClient (web app)\n\nNew\n\n3    \nAPI Management (APIM)\n\nPaaS\n\nModify\n\n4    \nAzure Service Bus (ASB) - shared\n\nPaaS\n\nModify\n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\nAnticipated to be Saas - solution is out of scope for this HLD\n\nAnticipated to be ‘new’ - out of scope for this HLD\n\n6    \nFuel Service\n\nPaaS\n\nModify\n\n7    \nPayment Service\n\nPaaS\n\nNew\n\n8    \nSite Service\n\nPaaS\n\nNew\n\n9    \nCatalogue Service\n\nPaaS\n\nNew\n\n10    \nInitiative Service\n\nPaaS\n\nNew\n\n11    \nLoyalty Service\n\nPaaS\n\nModify\n\n12    \nCommunication Service\n\nPaaS\n\nNew\n\n13    \nAdmin Service\n\nPaaS\n\nNew\n\n14    \nUser Service\n\nPaaS\n\nNew\n\n15    \nHappy Wash Service\n\nPaaS\n\nNew\n\n16    \nOrder Service\n\nPaaS\n\nNew\n\n17    \nOTR D365\n\nSaaS\n\nModify\n\n18    \nPereQOperations & PereQOperations OWL\n\nOn-premises (OTR DC)\n\nExisting\n\n19    \nOTR Store Systems\n\nOn-premises (OTR stores)\n\nExisting\n\n20    \nPeregrine Data Warehouse (legacy)\n\nOn-premises (OTR DC)\n\nModify\n\n21    \nOTR App Peregrine Service (legacy)\n\nPaaS (AWS)\n\nModify\n\n22    \nBraintree\n\nSaaS\n\nExisting\n\n23    \nData Mesh Group (DMG)\n\nSaaS\n\nExisting\n\n24    \nNotification Services (Apple Push / Firebase)\n\nSaaS\n\nExisting\n\n9.2. Environment View\nEnvironment Type\n\nRemarks\n\nDevelopment\n\nDevelopment testing is currently done on developer machines. For strategic future state, requires Dev environment to be created.\n\nUAT\n\nTo be created per services (workspace) to replace the existing UAT environment.\n\nProd\n\nTo be created per services (workspace) to replace the existing Prod environment.\n\n9.3. Deployment Diagram\nNote: in addition to the resources captured in the diagram, Azure Redis Cache will also be considered. However, use cases are to be confirmed first before incorporated into the solution.\n\n9.4. Connectivity\nSource\n\nDestination\n\nProtocol\n\nAuth\n\n1    \nOTR Mobile Apps\n\nVER APIM, via Cloudflare → Public IP → App Gateway → delegated subnet → delegated subnet / private IP\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via CA-issued Client certificates.\n\nCertificate pinning is used.\n\n2    \nAzure Function for X Service via delegated subnet\n\nOTR hosted-applications via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nFor OTR App Peregrine Service (AWS hosted): TBC\n\nFor Peregrine Data Warehouse (legacy): TBC\n\n3    \nVER APIM via delegated subnet\n\nAzure Function for X Service via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n4    \nAzure Function for X Service via delegated subnet\n\nVER Shared Log Analytics (via public endpoint, per standard VER setup)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n5    \nAzure Function for X Service via delegated subnet\n\nVER Shared Service Bus (ASB) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\n5671 - AMQP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n6    \nAzure Function for X Service via delegated subnet\n\nStorage Account (Table) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n7    \nAzure Function for X Service via delegated subnet\n\nCosmos DB via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n8    \nAzure Function for X Service via delegated subnet\n\nSQL Server DB via private endpoint\n\n1433 - TCP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n9    \nAzure Function for X Service via delegated subnet\n\nKey Vault via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n10    \nOTR-hosted applications (in OTR AWS and OTR DC)\n\nVER APIM, via Cloudflare and App Gateway\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via self-signed certificates (internal system).\n\n11    \nAzure Function for X Service via delegated subnet\n\nBraintree via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n12    \nAzure Function for X Service via delegated subnet\n\nData Mesh Group (DMG) via outbound firewall (via Netskope SSE in the future)\n\n443 - WebSocket over TLS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMessages are authenticated with a KEK (Key Encryption Key).\n\nFor the session token:\n\nIt is a onetime use token.\n\nIt is a random string\n\nCardholder data (PAN) is encrypted at the DMG side using a DUKPT derived key and 3DES algorithm.\n\n13    \nAzure Virtual Desktop (AVD)\n\nAzure private resources (function apps, keyvault, data store)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nRBAC Entra ID\n\nNote: the current use cases is only for internal testing & support. No Business User access.\n\n14    \nAzure DevOps\n\nAzure resources via DevOps agent and deployment planes\n\nThe DevOps Agent is responsible for deploying and updating configurations in different environments (Development, Test, and Prod), by coordinating Terraform to deploy resources via Azure Resource Manager APIs.\n\nThe agent interacts with the Azure Function deployment pipeline, ensuring that infrastructure configurations, APIM policy updates, and application deployments are consistent across environments.\n\nIn addition to the ARM APIs, the code for the function app is deployed through it’s deployment plane to a deployment slot. This should be secured by its own scm private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nEntra ID for individuals\n\nManaged Identity for automation\n\n15    \nVER APIM\n\nVER Shared Service Bus via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n16    \nAzure Function for X Service via delegated subnet\n\nStorage Account for Function Apps: blob, file via delegated subnet via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n17    \nAzure Function for X Service via delegated subnet\n\nApple Push Notifications (APNs)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n18    \nAzure Function for X Service via delegated subnet\n\nFirebase Cloud Messaging (FCM)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n19    \nAzure Function for X Service via delegated subnet\n\nOTR D365\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n9.5. Component Deployment Specifications & Security Controls\nAzure Resource\n\nDeployment\n\n1    \nApp Service Plan - Azure Functions\n\n \n\n \n\nSizing\n\nPremium Function - P0v3:1\n\nZone redundancy not required\n\nWindows\n\nLanguage: C# - Dotnet8\n\nXUnit | Fluent Assertions | Moq\n\nAzure Functions V4\n\nZip deploy \n\nApplication Insights enabled \n\nConnect to Application Insights with a connection string\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nUse managed identity for accessing resources\n\nSite credentials for deployments - Source code is managed in Azure DevOps with access control and build pipeline checks to prevent bad merges\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD for developers\n\nSCM deployment plane\n\nCI/CD pipeline\n\nNetwork Controls\n\nSecured by private endpoints for:\n\nFunction\n\ninbound \n\nSCM\n\nSCM should restrict access from Dev Pipeline agent\n\nDelegated subnet /27\n\nAll egress traffic must route through delegated subnet \n\nStorage account for Azure Functions instance secured by private endpoints for blob and file - \n\nAccess key vault through private endpoint \n\nConsiderations\n\nN/A\n\n2    \nAzure Key Vault\n\nSizing\n\nStandard tier\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nTLS 1.2 and 1.3\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nSecrets (Incl - Keys, Certs) Data Plane: RBAC Managed Identities\n\nFunctions\n\nSecrets Management Plane: RBAC\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nKey management plane\n\nSSO RBAC - internal staff\n\nCI/CD pipeline\n\nSecrets (Incl - Keys, Certs) data plane\n\nSSO RBAC - internal staff\n\nNetwork Controls\n\nSecured by Private Endpoint\n\nConsiderations\n\nN/A\n\n3    \nAzure Storage - table\n\nSizing\n\nGeneral Purpose v2 Storage Account - ZRS (99.99% SLA)\n\nTable Storage\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nRBAC Managed Identities\n\nFunctions\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nDeployment plane\n\nCI/CD pipeline\n\nData plane\n\nFunction managed identity\n\nNetwork Controls\n\nSecured by private endpoints\n\nConsiderations\n\nShould only be accessible via Azure backbone/ managed identity, from VER network or Azure Virtual Desktop for testing and support purposes.\n\n4    \nAzure Cosmos DB\n\nSizing\n\nSingle Database\n\nContainers 14000 RUs total between both regions\n\nDiagnostic settings enabled for audit logs \n\nRedundancies\n\nRead Region - Australia Southeast\n\nBackup every 240 min Retained for 8 hours - with Geo-Redundant setting, the backup is done on both regions.\n\nWrite Region - Australia East → replicates data to Australia Southeast\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nData Explorer only viewable if IP address is whitelisted and selected networks is enabled\n\nDeployment plane\n\nCI/CD pipeline \n\n\nServer / Database\n\nManaged User Identity - RBAC access to function applications\n\nNetwork Controls\n\nSecured by private endpoint\n\nSecured by NSG separate rules for coupon-scanner / flybuys\n\nDisabled Public Network access\n\nConsiderations\n\nNoSQL database type interaction is handled with Azure.Cosmos.Client nuget package ( c# ).\n\nCosmos private endpoint uses 3 IP’s, 1 shared IP and 1 specific IP for regions Australia East ( primary write region ) Australia Southeast ( secondary read region).\n\n5    \nAzure SQL\n\nSizing\n\nAzure SQL Database\n\nSingle database\n\nDTU - Standard tier\n\nS0 - Compute Size\n\nIncrease compute size as required\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nStorage Explorer\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nDeployment plane\n\nCI/CD pipeline - db owner role\n\nServer\n\nServer admin (sysadmin, dbo) - username/password\n\nEntra Id admin - Entra security group\n\nDatabase\n\nFunction App managed identity - data writer role\n\nStorage Explorer - TBD: either SSO internal staff or Storage Explorer managed identity - data writer and data reader roles\n\nNetwork Controls\n\nSecured by private endpoint\n\nConsiderations\n\nRow level and column level encryption using SQL Certificate should be possible - pending requirement from security, as this has performance impact.\n\n6    \nNetworking:\n\nVNet\n\nSubnets\n\nNSGs\n\nUDRs\n\nSizing\n\nVNet /24\n\nPrivate Endpoint Subnet /27\n\ndelegated Subnet /27\n\nOther VNets - peering / routing consideration\n\nFirewall security VNet\n\nVNet Address Space:\n\nDev: /24\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nDeployment plane\n\nCI/CD pipeline\n\n7    \nAzure Monitor\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAuth\n\nRBAC Managed Identities - Log stream to App Insights\n\nNetwork Controls\n\nLog Analytics and Azure Monitor (Application Insights) could potentially be publicly accessible, for staff access (as per current pattern)\n\nLog stream to App Insights is public (as per current pattern)\n\nConsiderations\n\nSimilar to Fuel Service implementation, logs volume sent to the shared workspace should be configured with a daily cap.\n\n9.6. Users\n\n\n\nUser Details\n\nUsers & RBAC controls\n\nCurrently, there are 486,488 registered users for the OTR mobile app, out of which 172,700 is considered active monthly.\n\nThe External Customer Identity & Access Management (IDAM) solution is out of scope of this HLD and will be done as a separate HLD.\n\nAdditionally, a new Admin app/portal is to be created as part of this solution. RBAC is to be mapped for the Admin Users, per relevant Entra roles and groups.\n\nSSO, Conditional Access Policy and User Provisioning \n\nSSO is to be set up for access to Admin App/Portal.\n\nDeveloper / Technical Support access is to be set up according to the Viva standard.\n\n \n\n9.7. Backup & Recovery\nThe current backup policies for AWS-hosted OTR resource are as following:\n\nEC2 instances - Daily backup\n\nRDS Instances, MySQL and MSSQL - Daily backup\n\nIn the new Azure hosting, in the event of DR, the approach will involve deploying a new Azure Function instance in another region as necessary using automated pipelines.\n\nThe Azure Storage Account will be configured with Zone-Redundant Storage (ZRS), with 0 RPO and RTO of less than 15 mins.\n\nSpecific backup & recovery configurations are to be elaborated in the relevant Service Design.\n\n9.8. Monitoring - Application, Infrastructure & Security\nThe existing OTR app monitoring is performed via a combination of AWS Cloud Trails and Dynatrace. With the strategic hosting migration into Azure Cloud, Cloud Trails will no longer be available. \n\nAdditionally, the following servers are also regularly monitored:\n\nDatabases(RDS)\n\nprod-otr-app2-2a - MySQL\n\nprod-otr-app2-2b - MYSQL\n\nprodotrappmssql - MSSQL\n\nEC2\n\nProd OTR App - 2A (Linux/Apache)\n\nProd OTR App - 2B (Linux/Apache)\n\nProd OTR Web Service - 2A (Windows/IIS)\n\nProd OTR Web Service - 2B (Windows/IIS)\n\nCurrent Dynatrace for OTR: https://vnv91336.live.dynatrace.com/#newhosts;gtf=-14d%20to%20-7d;gf=all\n\n \n\nIn the new Azure hosting, monitoring is performed at application and infrastructure levels.\n\nApplication level:\n\nA common logging package will log code transaction execution information, traces, and debug data at configurable logging level to Application insights and shared Log Analytics, e.g. Serilog. This information is queried in both App Insights and the shared log analytics via kql queries.\n\nA common /health function api will be exposed to proactively indicate application-level health.\n\nAzure Workbooks provide dashboards that visually summarize key application-level metrics and insights across variable time periods primarily from App Insights via kql queries.\n\nInfrastructure level:\n\nThe out of the box Function App runtime environment logs are streamed to app insights and from there to the shared log analytics. These are used for Alert queries. E.g. number of unhealthy nodes > 0. This is built into the Terraform modules used.\n\nA shared Log Analytics workspace with a configurable period of log retention is utilized for auditing, tracing and debugging during support and the development life cycle using kql queries that can be stored as dashboard notebooks. All logs across all of the infrastructure components are streamed here.\n\nAzure Monitor Application insights will provide detailed Function App logs which is also streamed to the shared log analytics workspace. Both the out of the box information as part of the Premium Tier runtime (e.g. availability, server requests, etc.) as well as the streamed logs from the log package for transaction level data.\n\nMonitoring:\n\nAzure Monitor alerts based on queries for the following:\n\nAny exceptions streamed from the common logging package to App Insights\n\nAny basic out of the box infrastructure queries in log analytics indicating problems at the infrastructure level e.g. unhealthy nodes > 0 in 15 minutes, Average CPU utilization > 90 % in 15-minute period, high transaction volumes, high volume of 4xx or 5xx http response codes, etc.\n\nWhen the common /health function app API returns a Http status code other than 2xx\n\nAlerts are sent out to the members of the support team to action via email. Additionally, VER Integration team is in the process of integrating alerts to ServiceNow for Incident Management purposes.\n\n9.9. Data- Reports & Interfaces/Data Integration\nAt the time of writing, Reporting requirements are yet to be captured. HLD will be amended once requirements are received, and if there is any material change to the proposed solution.\n\n10. Patterns Used\n10.1. Integration Patterns\nIntegration Pattern\n\nPattern Status\n\nMode\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9923133545\n\ndomain endorsed\n\n \n\n \n\n10.2. Security Patterns\nSecurity Pattern\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9997582337\n\ndraft\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9995911207\n\nApproved\n\nNo deviation\n\n \n\n10.3. Infrastructure Patterns\nAzure Resource\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9898952562\n\nPeer review\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852518458\n\narch informed\n\nNo deviation\n\n \n\n3    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830793256\n\narch informed\n\nNo deviation\n\n \n\n4    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830760505\n\narch informed\n\nNo deviation\n\n \n\n5    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088191\n\narch informed\n\nNo deviation\n\n \n\n6    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088147\n\nPeer review\n\nSome deviation\n\nDeviates regarding AMPLS and Private Endpoint for log analytics. IAM-based with public endpoint instead.\n\n7    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852616708\n\narch informed\n\nNo deviation\n\n \n\n11. References\nId\n\nName\n\nLink\n\nREF-001\n\nOTR Diagrams\n\nOTR App Solution Architecture_AS IS.drawio \n\nApp Solution Architecture New Cloud Design v2.drawio  \n\nREF-002\n\nOTR initial design decisions\n\nOTR App V4 Design decisions.docx\n\nREF-003\n\nSoftware Requirement Specifications (SRSs) created by CodeFish\n\nSRS - Final\n\nREF-004\n\nSharepoint location where ‘current state’ documents are stored\n\nCurrent State Documents\n\n12. Appendix\n12.1. Appendix A - Alternative Target State DiagramExecution Status: \nOn Hold\n  - Feb 2025\n\nRelated Project(s):\n\nOTR App Backend Rebuild\n\n1. Document Control\n1.1. Contacts \n1.2. Version History\n2. Document Purpose\n2.1. In Scope\n2.2. Out of Scope\n3. Key Requirements\n3.1. Functional Requirements\n3.2. Non-Functional Requirements\n4. Key Design Decisions (KDDs)\n5. Other Design Decisions\n6. Design Assumptions, Issues, Risks and Dependencies\n7. Conceptual View\n7.1. Current State\n7.2. Target State\n8. Application View\n9. Infrastructure and Security View\n9.1. Solution Components Summary\n9.2. Environment View\n9.3. Deployment Diagram\n9.4. Connectivity\n9.5. Component Deployment Specifications & Security Controls\n9.6. Users\n9.7. Backup & Recovery\n9.8. Monitoring - Application, Infrastructure & Security\n9.9. Data- Reports & Interfaces/Data Integration\n10. Patterns Used\n10.1. Integration Patterns\n10.2. Security Patterns\n10.3. Infrastructure Patterns\n11. References\n12. Appendix\n12.1. Appendix A - Alternative Target State Diagram\n1. Document Control\n1.1. Contacts \nName\n\nDocument Role\n\nEmail\n\nStatus\n\nRina Pranoto\n\nContributor\n\nrina.pranoto@vivaenergy.com.au \n\nN/A\n  \n\nRajnish Joseph\n\nContributor\n\nrajnish.joseph@vivaenergy.com.au\n\nN/A\n  \n\nAndy Arch\n\nPeer Reviewer\n\nandrew.arch@vivaenergy.com.au\n\nPeer review completed\n      \n\nMayank Sharma\n\nPeer Reviewer\n\nmayank.sharma@vivaenergy.com.au\n\nPeer review completed\nConditionally- The sections pertaining to security are currently in development and will undergo review as they are completed.   \n\nTigere Machonisa\n\nPeer Reviewer\n\ntigere.machonisa@vivaenergy.com.au\n\nPeer review completed\n    \n\nJason Stipkovic\n\nPeer Reviewer\n\njason.stipkovic@vivaenergy.com.au\n\nPeer review completed\n  \n\nAmandeep Modgil\n\nPeer Reviewer\n\namandeep.modgil@vivaenergy.com.au\n\nPeer review requested\n  \n\nDaniel Andrade\n\nPeer Reviewer\n\ndaniel.andrade@vivaenergy.com.au\n\nPeer review completed\n  \n\nVER ARB (Architecture Review Board)\n\nApprover\n\n https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10494017545\n \n\n \nApproved\n    \n\nTony Matthews\n\nAudience - Informed\n\nt.matthews@otr.com.au\n\n \n\nAmin Jodeyri\n\nAudience - Informed\n\na.jodeyri@otr.com.au\n\n \n\nDarren Peisley\n\nAudience - Informed\n\nd.peisley@otr.com.au\n\n \n\n1.2. Version History\nVersion\n\nDate\n\nAuthor\n\nChange Summary\n\n0.1\n\nMay 27, 2024\n\nRina Pranoto\n\nFirst Draft\n\n0.2\n\n\nNov 14, 2024 \n\nRina Pranoto\n\nDocument structure uplifted to the latest version\n\n0.3\n\nNov 24, 2024 \n\nRina Pranoto\n\nDesign Decisions, Target State solution and Deployment view are completed\n\n1.0\n\nNov 25, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for Peer Review\n\n1.1\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for ARB\n\n1.2\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nARB endorsed version\n\n2. Document Purpose\nThe OTR mobile app has been going through transformations from its inception version back in 2016, to the latest version to support the current OTR requirements. OTR App 4.0 aims to further enhance the application to be able to support future requirements for both OTR and Viva brands. \n\nThe purpose of this document is to outline the high level design of OTR App 4.0 backend rebuild, which includes rearchitecting and replatforming the application to modernise its functionality, and rehost the BFF (Backend-for-Frontend) services into Azure in accordance with VER infrastructure, integration and security standard. \n\nPoint of note: ‘backend’ in this context refers to the server-side application(s) currently hosted on OTR AWS, which complement the OTR mobile app (native and hybrid) functionality. It does not refer to the OTR systems hosted on-premises.\n\n2.1. In Scope\nThis solution includes:\n\nthe overall design approach of rearchitecting the existing OTR mobile app back-end (server) functionality into VER-aligned BFF services; and\n\nthe replatforming of the OTR mobile app back-end (server) into VER Azure hosting, in accordance with the standard VER infrastructure, integration and security practices.\n\n2.2. Out of Scope\nThis solution does not cover:\n\nany migration (refactoring, replatforming, or rearchitecting) of OTR systems currently hosted on-premises, either inside OTR stores or within OTR DC (Data Centre);\n\nany new app functionality not currently supported by the current mobile app version, such as food/item delivery, OTR app in Reddy Express sites, etc;\n\nother VER Digital Channels outside of OTR mobile app;\n\nany integration and/or migration of loyalty rewards from the app into Strategic LMS, except for certain aspects as covered by the relevant Service Design under this HLD; and\n\nany strategic design and roadmap for External Customer Identity & Access Management (IDAM). This topic will be covered as a separate work package.\n\n3. Key Requirements\n3.1. Functional Requirements\nRefer to https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10427203585\n for the full requirements.\n\n3.2. Non-Functional Requirements\nRefer to Non Functional Requirements.xlsx for the full non-functional requirements. The architecturally-significant non-functional requirements are summarised in the table below.\n\nID\n\nRequirement Summary\n\nDescription\n\nTraceability\n\nRequirement Met (Yes/No/Partial)\n\n1\n\nApplication or Service Criticality: Availability\n\n99.9%, which translates to max downtime of 1 hour per month / 3 hours per quarter.\n\nN/A\n\nYes\n\nThe Service Design must meet this SLA, excluding dependencies with legacy on-prem applications and/or external vendors, which have their own specified SLAs.\n\n2\n\nApplication or Service Criticality: Disaster Recovery\n\nRTO is 4-24 hours, to be defined per service.\n\nRPO requirement is yet to be defined.\n\nN/A\n\nThe RTO and RPO is to be assessed per Azure resource being utilised to implement the relevant Service. Refer to the https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#9.7.-Backup-%26-Recovery\n section for more details.\n\n3\n\nVolumetrics\n\nNo. of current app users:\n\n771,926 total users including deleted.\n\n486,488 total users excluding deleted.\n\n172,700 active users monthly.\n\nUser volume is anticipated to grow up to 5x the current volume, once app adoption within ReddyExpress stores commences (post the completion of this HLD / out of scope for this HLD).\n\nTransaction volume is being assessed by Product Owner and Business Analysts.\n\nN/A\n\nN/A\n\n5\n\nData Classification\n\nConfidential\n\nN/A\n\n\nN/A\n\n\n6\n\nData Privacy\n\nThe specific VER Data Privacy requirement is yet to be defined. However, The Privacy Act applies. Reference: https://www.oaic.gov.au/privacy/privacy-legislation/the-privacy-act, which includes https://www.oaic.gov.au/privacy/australian-privacy-principles.\n\nN/A\n\nAccording to The Privacy act, the customer data collected must be compliant in terms of storage and lifecycle management.\n\nThe solution to meet this requirement is not just technical, but also covers legal and operational aspects.\n\nThe existing OTR privacy policy attached to the app upon user registration requires to be reviewed.\n\n7\n\nSecurity\n\nSecurity Assurance assessment is to be done, following this guideline: https://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/10379919741\n \n\nN/A\n\nPen Test is to be organised accordingly by the project.\n\nAdditionally, PCI audit is also required.\n\n8\n\nPerformance\n\nPerformance/load testing is required to validate the projected growth.\n\nN/A\n\nPerformance/load testing is to be performed by the project.\n\n4. Key Design Decisions (KDDs)\nID\n\nDecision Summary\n\nDescription\n\nStatus\n\nDate of Endorsement\n\nOwner\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\n5. Other Design Decisions\nID\n\nDecision Description\n\nAlternative Option(s) Considered\n\nDecision Rationale\n\nStatus\n\nCE-OD-001\n\n \n\n \n\n \n\nThe application is to be rearchitected from a monolithic centralised server into service-based architecture and event-based architecture.\n\nThis is to replace the ‘tandem’ legacy web services setup, which was required to interface with a vendor-locked layer.\n\nThis approach also simplifies the existing application architecture by removing additional dependencies (e.g. Wordpress CMS, MS CE, internal legacy components).\n\nRetain the existing monolitic / centralised web-servers to service all APIs.\n\nThe monolithic / centralised architecture is not scalable, and does not separate service boundaries and blast zone. The service-based architecture is aligned to the CE strategic roadmap to support Viva omnichannel strategy.\n\nConfirmed\n \n\nCE-OD-002\n\nVER D365 is to be set as the target source of truth for products and product categories. This is to support replacing the existing legacy-based product structure and multiple layers of mapping.\n\nIn the transitional/interim state, dual D365 setting might require to be maintained.\n\nN/A\n\nMultiple ERPs are not aligned to the strategic roadmap of VER. Therefore, this decision has no alternative. The main goal is to achieve a single ERP in the target state.\n\nConfirmed\n  \n\nCE-OD-003\n\nFurther to CE-OD-002 above, custom catalogue/order/basket services is to be implemented.\n\nUse Microsoft headless commerce product feature.\n\nCustom option has been chosen for the following reasons:\n\nCheaper operation: The license cost alone for headless commerce server (even at MS expected discount) means the development payback is under 6 months\n\nNo change to core D365: D365 does not have a good fit for the required Site/Offer/Category hierarchy meaning we would have to customise within D365.  D365 development is more costly and the implementation cycle is slower so this could offset the dev savings.\n\nFlexibility in design: Integrating directly with D365 makes the migration from OTR Legacy to OTR+ harder (or adds a dependency which will delay delivery by 6+ months)\n\nMore options to optimise performance: A custom solution will allow us to be more in control of performance\n\nConfirmed\n  \n\nCE-OD-004\n\nThe existing business logic contained in various SQL Server stored procedures will be refactored to the relevant services. \n\nThe end goal is to have lean stored procedures as mechanism to do Database CRUD (Create, Retrieve, Update, Delete) only, if required.\n\nRetain existing business logics within stored procedures in a lift and shift.\n\nRetaining business logic within database stored procedures creates multiple places where business logics reside, adding complexity in maintenance and operational support. It also limits certain functionality unnecessarily.\n\nConfirmed\n  \n\nCE-OD-005\n\nFurther to CE-OD-004 above, data store choice for each service is to be assessed per Service Design, to ensure fit-for-purpose. This also includes the assessment on the best strategy to migrate the existing data from the AWS-hosted SQL Server Databases into the new data store of choice.\n\nFrom operational cost perspective, the preferred order of data store options (from the lowest to highest cost) is as following:\n\nAzure Table storage\n\nCosmos DB (for non RDBMS / no-SQL)\n\nSQL Server DB (consider Azure SQL Hyperscale)\n\nNote: the fit-for-purpose assessment is to consider all factors, not just operational cost perspective (albeit being a major factor).\n\nRetain the existing centralised SQL Server database to store all OTR app data across all services.\n\nThe centralised SQL Server database does not align with the service-based microservices principles, as it created tight coupling / heavy dependency across services, resulting in more complexity to manage in the long term. \n\nRelational Database Management System (RDBMS) is also not always fit-for-purpose for certain services.\n\nConfirmed\n  \n\nCE-OD-006\n\nShared Azure Service Bus (ASB) managed by VER Integration team is to be utilised for any event-based inter and/or intra-services integration.\n\nStanding up a dedicated ASB for CE / OTR app BFF.\n\nFor compliance, private ASB endpoints are mandatory, which requires premium tier.\n\nShared ASB has been chosen, as the volume within CE on its own does not warrant having a dedicated ASB in premium tier created for CE. \n\nConfirmed\n  \n\n6. Design Assumptions, Issues, Risks and Dependencies\nID\n\nType\n\nDescription\n\nMitigation\n\n1\n\nDependency\n\nThe solution has dependency on the VER infrastructure pattern readiness, including:\n\nthe creation of landing zone / asset via bedrock;\n\nthe endorsed patterns for individual Azure resources being used; and\n\nthe integration readiness to APIM and shared ASB.\n\nContinuous engagement and collaboration with VER infrastructure and integration team is mandatory.\n\n2\n\nDependency\n\nThe solution has dependency on CE/VER endorsed Microservices design, which is being developed at the same time.\n\nContinuous engagement and review at different dev points is mandatory.\n\n3\n\nDependency\n\nThe solution has dependency on External Customer Identity & Access Management (IDAM) solution, which is to be done by a vendor at the same time.\n\nContinuous collaboration with the vendor is mandatory.\n\n7. Conceptual View\n7.1. Current State\nOTR app current-state-prod.png\nThe current server-side functionality ('backend') to support OTR Mobile App is hosted on AWS, with a ‘dual orchestration’ logic happening between Distillery vs. Peregrine servers.\n\n7.2. Target State\nThis Target State is in review. Some of the considerations and decisions may be deprecated\n\nThe following diagram outlines the target state architecture.\n\nKey considerations:\n\nThe detailed view of each service, along with its relevant integrations, are elaborated in the specific Service Design (captured as child pages to this HLD).\n\nInter-service communication will be done either via internal API endpoints (synchronous) or via ASB events (asynchronous).\n\nAt the time of writing, ‘OTR Sites (Data Centre and Stores)' are considered ‘external’ from networking point of view, and therefore all integration methods between applications hosted within ‘OTR Sites’ and ‘VER Azure’ follow external B2B integration patterns.\n\nSpecific to integration with PereQOperations and PereQOperations OWL APIs, inbound and outbound connectivity are temporarily routed via the existing OTR app Peregrine Service (legacy) hosted in OTR AWS, as the legacy server performs REST-to-SOAP API translations (and vice versa) required by the app BFF services. Changes to PereQOperations and PereQOperations OWL APIs are to be kept to a minimum, considering they are to be decommissioned in the near future.\n\nNote: in addition to the key considerations above, also refer to the Design Decisions captured in https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#5.-Other-Design-Decisions\n.\n\nOTR App Backend Rebuild Diagram.jpg\nDiagram: https://miro.com/app/board/uXjVKyv51kk=/\n \n\n \n\nThe following table outlines the summary of impact across multiple applications/platform.\n\nSolution Component\n\nSummary of Impact\n\nSolution Component Domain\n\nData Classification per Solution Component\n\nLink to Detailed Design / Reference\n\nNotes\n\n1    \nOTR Mobile App (iOS / Android)\n\nModify app authentication to use OAuth per VER standard integration practice. \n\nSome app logic might require to be adjusted to work with the new BFF APIs.\n\nSome UI changes might be required to work with the new BFF APIs (not anticipated to be major).\n\nVER - Customer Engagement\n\nand\n\nOTR IT Team\n\nConfidential\n\n \n\n \n\n2    \nOTR Admin App (desktop / mobile)\n\nDevelop the new web-app to provide admins UI to manage certain operations.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n3    \nAPI Management (APIM)\n\nNew APIM endpoints are to be created to interface with the new BFF APIs/Service endpoints.\n\nNew AD groups are to be created to manage API authorisations.\n\nFirewall rules are to be configured accordingly.\n\nTo confirm access token expiry is to be set as 60 mins and re-auth tokens as 24 hours.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n4    \nAzure Service Bus (ASB) - shared\n\nNew topics and subscriptions are to be configured.\n\nRetry policies are to be configured per use case.\n\nFirewall rules are to be configured accordingly.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\n(out of scope for this HLD)\n\nA new External Customer IDAM is to be designed and implemented to support this solution. However, the details are to be covered by a separate HLD.\n\nVER IDAM\n\nN/A\n\n \n\n \n\n6    \nFuel Service\n\nThe fuel service is responsible for the operation of pay at pump functionality and Scan Pump Save. It communicates with internal APIs in order to handle the creation, alteration and deletion of a fuel transaction. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Fuel Service’ workspace within CE, co-existing with the Fuel Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10328572159\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10481106978\n \n\n \n\n7    \nPayment Service\n\nThe payment service integrates with payment providers and allows orders and services to request payment from a consumer. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Payment Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10490478593\n \n\n \n\n8    \nSite Service\n\nThe site service acts as a source of reference for any site-related data, ingesting and maintaining various data from OTR D365 (with a view to expand this to VER D365 at the right time), such as service location, brands available, opening times and other operational data. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Site Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208455\n \n\n \n\n9    \nCatalogue Service\n\nThe catalogue service acts as a source of reference for any brand, category and product data available at each site, The data is ingested from OTR D365 (with a view to expand to VER D365 at the right time) on a periodic basis.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Catalogue Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504273983\n \n\n \n\n10    \nInitiative Service\n\nThis service handles customer preferences, including user opt-in or opt-out choice. It also provides feeds for consumers that require them.  \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Initiative Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306784\n \n\n \n\n11    \nLoyalty Service\n\nThis service handles OTR in-app rewards and loyalty campaigns/offers, with a view to be enhanced by integrating this with the core LMS platform in the near future.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Loyalty Service’ workspace within CE, co-existing with the Loyalty Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10135667116\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241267\n \n\n \n\n12    \nCommunication Service\n\nThis service is responsible for the transmission of notifications to the consumers, by integrating with Apple or Firebase to support iOS or Android mobile devices accordingly.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Communication Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208485\n \n\n \n\n13    \nAdmin Service\n\nThis service enables admin users to manage any relevant app functions as required.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Admin Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306797\n \n\n \n\n14    \nUser Service\n\nThis service manages app user data, including PII. While the immediate build migrates the existing functionality like-for-like, in the near future, this service will be integrated with the appropriate customer master platform (the source of truth) and will only retain a copy for performance/functionality reasons (as a source of reference).\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘User Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306809\n \n\n \n\n15    \nCar Wash Service\n\nThis service handles the issuance and refresh of Happy Wash service codes between the app and the stores.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Car Wash Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241285\n \n\n \n\n16    \nOrder Service\n\nThis service handles non-fuel orders, provides tax invoices and order history.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Order Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208499\n \n\n \n\n17    \nOTR D365\n\nThe existing integration between the app services and OTR D365 requires to be maintained.\n\nFunctionality changes and integration adjustment are to be covered within Site Service, Catalogue Service and User Service.\n\nAny user/consumer data will be assessed within the relevant Service and may be migrated as part of the Service rebuild if possible.\n\nThe migration and decommissioning of OTR D365 itself is out of scope for this HLD.\n\nOTR and VER - ERP / D365\n\nConfidential\n\n \n\n \n\n18    \nPereQOperations & PereQOperations OWL\n\nNo expected change as part of this HLD.\n\nThese SOAP-based services are considered legacy and will be replaced and decommissioned in the near future. Therefore changes/impacts are to be kept minimum.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n19    \nOTR Store Systems\n\nNo expected change as part of this HLD.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n20    \nPeregrine Data Warehouse (legacy)\n\nExisting SSIS jobs and/or bulk operations are to be assessed and adjusted accordingly, to ensure operational continuity.\n\nIntegration between app BFF services and the Peregrine Data Warehouse should follow the standard VER integration patterns.\n\nOTR and VER Data Platform\n\nConfidential\n\n \n\n \n\n21    \nOTR App Peregrine Service (legacy)\n\nThis refers to the existing AWS-hosted backend server/VM which does the REST-to-SOAP API translations (and vice versa) when integrating with PereQOperations and PereQOperations OWL APIs.\n\nModify server to call the new APIs via APIM, with the standard OAuth 2.0 authentication.\n\nModify server to receive API calls from the new services.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n22    \nBraintree\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n23    \nData Mesh Group (DMG)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n24    \nNotification Services (Apple Push / Firebase)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nConfidential (External Party)\n\n \n\n \n\n25    \n(future consideration) Loyalty Management System (LMS) - EagleEye AIR\n\n \n\nVER - Customer Engagement\n\n \n\n \n\n \n\n26    \n(future consideration)\n\nEnterprise Data Platform (EDP)\n\n \n\nVER - Data Platform\n\n \n\n \n\n \n\n27    \n(future consideration)\n\nERP Platform (Microsoft D365)\n\n \n\nVER - ERP (D365)\n\n \n\n \n\n \n\n28    \n(future consideration)\n\nCommerce Scale Unit (CSU)\n\n \n\nVER - Stores\n\n \n\n \n\n \n\n \n\n8. Application View\nDetailed design for each service is captured in the relevant Service Design (child pages to this HLD).\n\n9. Infrastructure and Security View\n9.1. Solution Components Summary\nComponent\n\nSaaS/IaaS/PaaS\n\nNew/Existing/Modify\n\n1    \nOTR Mobile App (iOS / Android)\n\nClient (mobile app)\n\nModify\n\n2    \nOTR Admin App (desktop / mobile)\n\nClient (web app)\n\nNew\n\n3    \nAPI Management (APIM)\n\nPaaS\n\nModify\n\n4    \nAzure Service Bus (ASB) - shared\n\nPaaS\n\nModify\n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\nAnticipated to be Saas - solution is out of scope for this HLD\n\nAnticipated to be ‘new’ - out of scope for this HLD\n\n6    \nFuel Service\n\nPaaS\n\nModify\n\n7    \nPayment Service\n\nPaaS\n\nNew\n\n8    \nSite Service\n\nPaaS\n\nNew\n\n9    \nCatalogue Service\n\nPaaS\n\nNew\n\n10    \nInitiative Service\n\nPaaS\n\nNew\n\n11    \nLoyalty Service\n\nPaaS\n\nModify\n\n12    \nCommunication Service\n\nPaaS\n\nNew\n\n13    \nAdmin Service\n\nPaaS\n\nNew\n\n14    \nUser Service\n\nPaaS\n\nNew\n\n15    \nHappy Wash Service\n\nPaaS\n\nNew\n\n16    \nOrder Service\n\nPaaS\n\nNew\n\n17    \nOTR D365\n\nSaaS\n\nModify\n\n18    \nPereQOperations & PereQOperations OWL\n\nOn-premises (OTR DC)\n\nExisting\n\n19    \nOTR Store Systems\n\nOn-premises (OTR stores)\n\nExisting\n\n20    \nPeregrine Data Warehouse (legacy)\n\nOn-premises (OTR DC)\n\nModify\n\n21    \nOTR App Peregrine Service (legacy)\n\nPaaS (AWS)\n\nModify\n\n22    \nBraintree\n\nSaaS\n\nExisting\n\n23    \nData Mesh Group (DMG)\n\nSaaS\n\nExisting\n\n24    \nNotification Services (Apple Push / Firebase)\n\nSaaS\n\nExisting\n\n9.2. Environment View\nEnvironment Type\n\nRemarks\n\nDevelopment\n\nDevelopment testing is currently done on developer machines. For strategic future state, requires Dev environment to be created.\n\nUAT\n\nTo be created per services (workspace) to replace the existing UAT environment.\n\nProd\n\nTo be created per services (workspace) to replace the existing Prod environment.\n\n9.3. Deployment Diagram\nNote: in addition to the resources captured in the diagram, Azure Redis Cache will also be considered. However, use cases are to be confirmed first before incorporated into the solution.\n\n9.4. Connectivity\nSource\n\nDestination\n\nProtocol\n\nAuth\n\n1    \nOTR Mobile Apps\n\nVER APIM, via Cloudflare → Public IP → App Gateway → delegated subnet → delegated subnet / private IP\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via CA-issued Client certificates.\n\nCertificate pinning is used.\n\n2    \nAzure Function for X Service via delegated subnet\n\nOTR hosted-applications via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nFor OTR App Peregrine Service (AWS hosted): TBC\n\nFor Peregrine Data Warehouse (legacy): TBC\n\n3    \nVER APIM via delegated subnet\n\nAzure Function for X Service via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n4    \nAzure Function for X Service via delegated subnet\n\nVER Shared Log Analytics (via public endpoint, per standard VER setup)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n5    \nAzure Function for X Service via delegated subnet\n\nVER Shared Service Bus (ASB) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\n5671 - AMQP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n6    \nAzure Function for X Service via delegated subnet\n\nStorage Account (Table) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n7    \nAzure Function for X Service via delegated subnet\n\nCosmos DB via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n8    \nAzure Function for X Service via delegated subnet\n\nSQL Server DB via private endpoint\n\n1433 - TCP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n9    \nAzure Function for X Service via delegated subnet\n\nKey Vault via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n10    \nOTR-hosted applications (in OTR AWS and OTR DC)\n\nVER APIM, via Cloudflare and App Gateway\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via self-signed certificates (internal system).\n\n11    \nAzure Function for X Service via delegated subnet\n\nBraintree via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n12    \nAzure Function for X Service via delegated subnet\n\nData Mesh Group (DMG) via outbound firewall (via Netskope SSE in the future)\n\n443 - WebSocket over TLS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMessages are authenticated with a KEK (Key Encryption Key).\n\nFor the session token:\n\nIt is a onetime use token.\n\nIt is a random string\n\nCardholder data (PAN) is encrypted at the DMG side using a DUKPT derived key and 3DES algorithm.\n\n13    \nAzure Virtual Desktop (AVD)\n\nAzure private resources (function apps, keyvault, data store)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nRBAC Entra ID\n\nNote: the current use cases is only for internal testing & support. No Business User access.\n\n14    \nAzure DevOps\n\nAzure resources via DevOps agent and deployment planes\n\nThe DevOps Agent is responsible for deploying and updating configurations in different environments (Development, Test, and Prod), by coordinating Terraform to deploy resources via Azure Resource Manager APIs.\n\nThe agent interacts with the Azure Function deployment pipeline, ensuring that infrastructure configurations, APIM policy updates, and application deployments are consistent across environments.\n\nIn addition to the ARM APIs, the code for the function app is deployed through it’s deployment plane to a deployment slot. This should be secured by its own scm private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nEntra ID for individuals\n\nManaged Identity for automation\n\n15    \nVER APIM\n\nVER Shared Service Bus via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n16    \nAzure Function for X Service via delegated subnet\n\nStorage Account for Function Apps: blob, file via delegated subnet via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n17    \nAzure Function for X Service via delegated subnet\n\nApple Push Notifications (APNs)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n18    \nAzure Function for X Service via delegated subnet\n\nFirebase Cloud Messaging (FCM)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n19    \nAzure Function for X Service via delegated subnet\n\nOTR D365\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n9.5. Component Deployment Specifications & Security Controls\nAzure Resource\n\nDeployment\n\n1    \nApp Service Plan - Azure Functions\n\n \n\n \n\nSizing\n\nPremium Function - P0v3:1\n\nZone redundancy not required\n\nWindows\n\nLanguage: C# - Dotnet8\n\nXUnit | Fluent Assertions | Moq\n\nAzure Functions V4\n\nZip deploy \n\nApplication Insights enabled \n\nConnect to Application Insights with a connection string\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nUse managed identity for accessing resources\n\nSite credentials for deployments - Source code is managed in Azure DevOps with access control and build pipeline checks to prevent bad merges\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD for developers\n\nSCM deployment plane\n\nCI/CD pipeline\n\nNetwork Controls\n\nSecured by private endpoints for:\n\nFunction\n\ninbound \n\nSCM\n\nSCM should restrict access from Dev Pipeline agent\n\nDelegated subnet /27\n\nAll egress traffic must route through delegated subnet \n\nStorage account for Azure Functions instance secured by private endpoints for blob and file - \n\nAccess key vault through private endpoint \n\nConsiderations\n\nN/A\n\n2    \nAzure Key Vault\n\nSizing\n\nStandard tier\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nTLS 1.2 and 1.3\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nSecrets (Incl - Keys, Certs) Data Plane: RBAC Managed Identities\n\nFunctions\n\nSecrets Management Plane: RBAC\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nKey management plane\n\nSSO RBAC - internal staff\n\nCI/CD pipeline\n\nSecrets (Incl - Keys, Certs) data plane\n\nSSO RBAC - internal staff\n\nNetwork Controls\n\nSecured by Private Endpoint\n\nConsiderations\n\nN/A\n\n3    \nAzure Storage - table\n\nSizing\n\nGeneral Purpose v2 Storage Account - ZRS (99.99% SLA)\n\nTable Storage\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nRBAC Managed Identities\n\nFunctions\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nDeployment plane\n\nCI/CD pipeline\n\nData plane\n\nFunction managed identity\n\nNetwork Controls\n\nSecured by private endpoints\n\nConsiderations\n\nShould only be accessible via Azure backbone/ managed identity, from VER network or Azure Virtual Desktop for testing and support purposes.\n\n4    \nAzure Cosmos DB\n\nSizing\n\nSingle Database\n\nContainers 14000 RUs total between both regions\n\nDiagnostic settings enabled for audit logs \n\nRedundancies\n\nRead Region - Australia Southeast\n\nBackup every 240 min Retained for 8 hours - with Geo-Redundant setting, the backup is done on both regions.\n\nWrite Region - Australia East → replicates data to Australia Southeast\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nData Explorer only viewable if IP address is whitelisted and selected networks is enabled\n\nDeployment plane\n\nCI/CD pipeline \n\n\nServer / Database\n\nManaged User Identity - RBAC access to function applications\n\nNetwork Controls\n\nSecured by private endpoint\n\nSecured by NSG separate rules for coupon-scanner / flybuys\n\nDisabled Public Network access\n\nConsiderations\n\nNoSQL database type interaction is handled with Azure.Cosmos.Client nuget package ( c# ).\n\nCosmos private endpoint uses 3 IP’s, 1 shared IP and 1 specific IP for regions Australia East ( primary write region ) Australia Southeast ( secondary read region).\n\n5    \nAzure SQL\n\nSizing\n\nAzure SQL Database\n\nSingle database\n\nDTU - Standard tier\n\nS0 - Compute Size\n\nIncrease compute size as required\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nStorage Explorer\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nDeployment plane\n\nCI/CD pipeline - db owner role\n\nServer\n\nServer admin (sysadmin, dbo) - username/password\n\nEntra Id admin - Entra security group\n\nDatabase\n\nFunction App managed identity - data writer role\n\nStorage Explorer - TBD: either SSO internal staff or Storage Explorer managed identity - data writer and data reader roles\n\nNetwork Controls\n\nSecured by private endpoint\n\nConsiderations\n\nRow level and column level encryption using SQL Certificate should be possible - pending requirement from security, as this has performance impact.\n\n6    \nNetworking:\n\nVNet\n\nSubnets\n\nNSGs\n\nUDRs\n\nSizing\n\nVNet /24\n\nPrivate Endpoint Subnet /27\n\ndelegated Subnet /27\n\nOther VNets - peering / routing consideration\n\nFirewall security VNet\n\nVNet Address Space:\n\nDev: /24\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nDeployment plane\n\nCI/CD pipeline\n\n7    \nAzure Monitor\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAuth\n\nRBAC Managed Identities - Log stream to App Insights\n\nNetwork Controls\n\nLog Analytics and Azure Monitor (Application Insights) could potentially be publicly accessible, for staff access (as per current pattern)\n\nLog stream to App Insights is public (as per current pattern)\n\nConsiderations\n\nSimilar to Fuel Service implementation, logs volume sent to the shared workspace should be configured with a daily cap.\n\n9.6. Users\n\n\n\nUser Details\n\nUsers & RBAC controls\n\nCurrently, there are 486,488 registered users for the OTR mobile app, out of which 172,700 is considered active monthly.\n\nThe External Customer Identity & Access Management (IDAM) solution is out of scope of this HLD and will be done as a separate HLD.\n\nAdditionally, a new Admin app/portal is to be created as part of this solution. RBAC is to be mapped for the Admin Users, per relevant Entra roles and groups.\n\nSSO, Conditional Access Policy and User Provisioning \n\nSSO is to be set up for access to Admin App/Portal.\n\nDeveloper / Technical Support access is to be set up according to the Viva standard.\n\n \n\n9.7. Backup & Recovery\nThe current backup policies for AWS-hosted OTR resource are as following:\n\nEC2 instances - Daily backup\n\nRDS Instances, MySQL and MSSQL - Daily backup\n\nIn the new Azure hosting, in the event of DR, the approach will involve deploying a new Azure Function instance in another region as necessary using automated pipelines.\n\nThe Azure Storage Account will be configured with Zone-Redundant Storage (ZRS), with 0 RPO and RTO of less than 15 mins.\n\nSpecific backup & recovery configurations are to be elaborated in the relevant Service Design.\n\n9.8. Monitoring - Application, Infrastructure & Security\nThe existing OTR app monitoring is performed via a combination of AWS Cloud Trails and Dynatrace. With the strategic hosting migration into Azure Cloud, Cloud Trails will no longer be available. \n\nAdditionally, the following servers are also regularly monitored:\n\nDatabases(RDS)\n\nprod-otr-app2-2a - MySQL\n\nprod-otr-app2-2b - MYSQL\n\nprodotrappmssql - MSSQL\n\nEC2\n\nProd OTR App - 2A (Linux/Apache)\n\nProd OTR App - 2B (Linux/Apache)\n\nProd OTR Web Service - 2A (Windows/IIS)\n\nProd OTR Web Service - 2B (Windows/IIS)\n\nCurrent Dynatrace for OTR: https://vnv91336.live.dynatrace.com/#newhosts;gtf=-14d%20to%20-7d;gf=all\n\n \n\nIn the new Azure hosting, monitoring is performed at application and infrastructure levels.\n\nApplication level:\n\nA common logging package will log code transaction execution information, traces, and debug data at configurable logging level to Application insights and shared Log Analytics, e.g. Serilog. This information is queried in both App Insights and the shared log analytics via kql queries.\n\nA common /health function api will be exposed to proactively indicate application-level health.\n\nAzure Workbooks provide dashboards that visually summarize key application-level metrics and insights across variable time periods primarily from App Insights via kql queries.\n\nInfrastructure level:\n\nThe out of the box Function App runtime environment logs are streamed to app insights and from there to the shared log analytics. These are used for Alert queries. E.g. number of unhealthy nodes > 0. This is built into the Terraform modules used.\n\nA shared Log Analytics workspace with a configurable period of log retention is utilized for auditing, tracing and debugging during support and the development life cycle using kql queries that can be stored as dashboard notebooks. All logs across all of the infrastructure components are streamed here.\n\nAzure Monitor Application insights will provide detailed Function App logs which is also streamed to the shared log analytics workspace. Both the out of the box information as part of the Premium Tier runtime (e.g. availability, server requests, etc.) as well as the streamed logs from the log package for transaction level data.\n\nMonitoring:\n\nAzure Monitor alerts based on queries for the following:\n\nAny exceptions streamed from the common logging package to App Insights\n\nAny basic out of the box infrastructure queries in log analytics indicating problems at the infrastructure level e.g. unhealthy nodes > 0 in 15 minutes, Average CPU utilization > 90 % in 15-minute period, high transaction volumes, high volume of 4xx or 5xx http response codes, etc.\n\nWhen the common /health function app API returns a Http status code other than 2xx\n\nAlerts are sent out to the members of the support team to action via email. Additionally, VER Integration team is in the process of integrating alerts to ServiceNow for Incident Management purposes.\n\n9.9. Data- Reports & Interfaces/Data Integration\nAt the time of writing, Reporting requirements are yet to be captured. HLD will be amended once requirements are received, and if there is any material change to the proposed solution.\n\n10. Patterns Used\n10.1. Integration Patterns\nIntegration Pattern\n\nPattern Status\n\nMode\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9923133545\n\ndomain endorsed\n\n \n\n \n\n10.2. Security Patterns\nSecurity Pattern\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9997582337\n\ndraft\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9995911207\n\nApproved\n\nNo deviation\n\n \n\n10.3. Infrastructure Patterns\nAzure Resource\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9898952562\n\nPeer review\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852518458\n\narch informed\n\nNo deviation\n\n \n\n3    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830793256\n\narch informed\n\nNo deviation\n\n \n\n4    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830760505\n\narch informed\n\nNo deviation\n\n \n\n5    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088191\n\narch informed\n\nNo deviation\n\n \n\n6    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088147\n\nPeer review\n\nSome deviation\n\nDeviates regarding AMPLS and Private Endpoint for log analytics. IAM-based with public endpoint instead.\n\n7    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852616708\n\narch informed\n\nNo deviation\n\n \n\n11. References\nId\n\nName\n\nLink\n\nREF-001\n\nOTR Diagrams\n\nOTR App Solution Architecture_AS IS.drawio \n\nApp Solution Architecture New Cloud Design v2.drawio  \n\nREF-002\n\nOTR initial design decisions\n\nOTR App V4 Design decisions.docx\n\nREF-003\n\nSoftware Requirement Specifications (SRSs) created by CodeFish\n\nSRS - Final\n\nREF-004\n\nSharepoint location where ‘current state’ documents are stored\n\nCurrent State Documents\n\n12. Appendix\n12.1. Appendix A - Alternative Target State DiagramExecution Status: \nOn Hold\n  - Feb 2025\n\nRelated Project(s):\n\nOTR App Backend Rebuild\n\n1. Document Control\n1.1. Contacts \n1.2. Version History\n2. Document Purpose\n2.1. In Scope\n2.2. Out of Scope\n3. Key Requirements\n3.1. Functional Requirements\n3.2. Non-Functional Requirements\n4. Key Design Decisions (KDDs)\n5. Other Design Decisions\n6. Design Assumptions, Issues, Risks and Dependencies\n7. Conceptual View\n7.1. Current State\n7.2. Target State\n8. Application View\n9. Infrastructure and Security View\n9.1. Solution Components Summary\n9.2. Environment View\n9.3. Deployment Diagram\n9.4. Connectivity\n9.5. Component Deployment Specifications & Security Controls\n9.6. Users\n9.7. Backup & Recovery\n9.8. Monitoring - Application, Infrastructure & Security\n9.9. Data- Reports & Interfaces/Data Integration\n10. Patterns Used\n10.1. Integration Patterns\n10.2. Security Patterns\n10.3. Infrastructure Patterns\n11. References\n12. Appendix\n12.1. Appendix A - Alternative Target State Diagram\n1. Document Control\n1.1. Contacts \nName\n\nDocument Role\n\nEmail\n\nStatus\n\nRina Pranoto\n\nContributor\n\nrina.pranoto@vivaenergy.com.au \n\nN/A\n  \n\nRajnish Joseph\n\nContributor\n\nrajnish.joseph@vivaenergy.com.au\n\nN/A\n  \n\nAndy Arch\n\nPeer Reviewer\n\nandrew.arch@vivaenergy.com.au\n\nPeer review completed\n      \n\nMayank Sharma\n\nPeer Reviewer\n\nmayank.sharma@vivaenergy.com.au\n\nPeer review completed\nConditionally- The sections pertaining to security are currently in development and will undergo review as they are completed.   \n\nTigere Machonisa\n\nPeer Reviewer\n\ntigere.machonisa@vivaenergy.com.au\n\nPeer review completed\n    \n\nJason Stipkovic\n\nPeer Reviewer\n\njason.stipkovic@vivaenergy.com.au\n\nPeer review completed\n  \n\nAmandeep Modgil\n\nPeer Reviewer\n\namandeep.modgil@vivaenergy.com.au\n\nPeer review requested\n  \n\nDaniel Andrade\n\nPeer Reviewer\n\ndaniel.andrade@vivaenergy.com.au\n\nPeer review completed\n  \n\nVER ARB (Architecture Review Board)\n\nApprover\n\n https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10494017545\n \n\n \nApproved\n    \n\nTony Matthews\n\nAudience - Informed\n\nt.matthews@otr.com.au\n\n \n\nAmin Jodeyri\n\nAudience - Informed\n\na.jodeyri@otr.com.au\n\n \n\nDarren Peisley\n\nAudience - Informed\n\nd.peisley@otr.com.au\n\n \n\n1.2. Version History\nVersion\n\nDate\n\nAuthor\n\nChange Summary\n\n0.1\n\nMay 27, 2024\n\nRina Pranoto\n\nFirst Draft\n\n0.2\n\n\nNov 14, 2024 \n\nRina Pranoto\n\nDocument structure uplifted to the latest version\n\n0.3\n\nNov 24, 2024 \n\nRina Pranoto\n\nDesign Decisions, Target State solution and Deployment view are completed\n\n1.0\n\nNov 25, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for Peer Review\n\n1.1\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nVersion ready for ARB\n\n1.2\n\nNov 28, 2024 \n\nRina Pranoto & Raj Joseph\n\nARB endorsed version\n\n2. Document Purpose\nThe OTR mobile app has been going through transformations from its inception version back in 2016, to the latest version to support the current OTR requirements. OTR App 4.0 aims to further enhance the application to be able to support future requirements for both OTR and Viva brands. \n\nThe purpose of this document is to outline the high level design of OTR App 4.0 backend rebuild, which includes rearchitecting and replatforming the application to modernise its functionality, and rehost the BFF (Backend-for-Frontend) services into Azure in accordance with VER infrastructure, integration and security standard. \n\nPoint of note: ‘backend’ in this context refers to the server-side application(s) currently hosted on OTR AWS, which complement the OTR mobile app (native and hybrid) functionality. It does not refer to the OTR systems hosted on-premises.\n\n2.1. In Scope\nThis solution includes:\n\nthe overall design approach of rearchitecting the existing OTR mobile app back-end (server) functionality into VER-aligned BFF services; and\n\nthe replatforming of the OTR mobile app back-end (server) into VER Azure hosting, in accordance with the standard VER infrastructure, integration and security practices.\n\n2.2. Out of Scope\nThis solution does not cover:\n\nany migration (refactoring, replatforming, or rearchitecting) of OTR systems currently hosted on-premises, either inside OTR stores or within OTR DC (Data Centre);\n\nany new app functionality not currently supported by the current mobile app version, such as food/item delivery, OTR app in Reddy Express sites, etc;\n\nother VER Digital Channels outside of OTR mobile app;\n\nany integration and/or migration of loyalty rewards from the app into Strategic LMS, except for certain aspects as covered by the relevant Service Design under this HLD; and\n\nany strategic design and roadmap for External Customer Identity & Access Management (IDAM). This topic will be covered as a separate work package.\n\n3. Key Requirements\n3.1. Functional Requirements\nRefer to https://vivaenergy.atlassian.net/wiki/spaces/VER/pages/10427203585\n for the full requirements.\n\n3.2. Non-Functional Requirements\nRefer to Non Functional Requirements.xlsx for the full non-functional requirements. The architecturally-significant non-functional requirements are summarised in the table below.\n\nID\n\nRequirement Summary\n\nDescription\n\nTraceability\n\nRequirement Met (Yes/No/Partial)\n\n1\n\nApplication or Service Criticality: Availability\n\n99.9%, which translates to max downtime of 1 hour per month / 3 hours per quarter.\n\nN/A\n\nYes\n\nThe Service Design must meet this SLA, excluding dependencies with legacy on-prem applications and/or external vendors, which have their own specified SLAs.\n\n2\n\nApplication or Service Criticality: Disaster Recovery\n\nRTO is 4-24 hours, to be defined per service.\n\nRPO requirement is yet to be defined.\n\nN/A\n\nThe RTO and RPO is to be assessed per Azure resource being utilised to implement the relevant Service. Refer to the https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#9.7.-Backup-%26-Recovery\n section for more details.\n\n3\n\nVolumetrics\n\nNo. of current app users:\n\n771,926 total users including deleted.\n\n486,488 total users excluding deleted.\n\n172,700 active users monthly.\n\nUser volume is anticipated to grow up to 5x the current volume, once app adoption within ReddyExpress stores commences (post the completion of this HLD / out of scope for this HLD).\n\nTransaction volume is being assessed by Product Owner and Business Analysts.\n\nN/A\n\nN/A\n\n5\n\nData Classification\n\nConfidential\n\nN/A\n\n\nN/A\n\n\n6\n\nData Privacy\n\nThe specific VER Data Privacy requirement is yet to be defined. However, The Privacy Act applies. Reference: https://www.oaic.gov.au/privacy/privacy-legislation/the-privacy-act, which includes https://www.oaic.gov.au/privacy/australian-privacy-principles.\n\nN/A\n\nAccording to The Privacy act, the customer data collected must be compliant in terms of storage and lifecycle management.\n\nThe solution to meet this requirement is not just technical, but also covers legal and operational aspects.\n\nThe existing OTR privacy policy attached to the app upon user registration requires to be reviewed.\n\n7\n\nSecurity\n\nSecurity Assurance assessment is to be done, following this guideline: https://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/10379919741\n \n\nN/A\n\nPen Test is to be organised accordingly by the project.\n\nAdditionally, PCI audit is also required.\n\n8\n\nPerformance\n\nPerformance/load testing is required to validate the projected growth.\n\nN/A\n\nPerformance/load testing is to be performed by the project.\n\n4. Key Design Decisions (KDDs)\nID\n\nDecision Summary\n\nDescription\n\nStatus\n\nDate of Endorsement\n\nOwner\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\nN/A\n\n5. Other Design Decisions\nID\n\nDecision Description\n\nAlternative Option(s) Considered\n\nDecision Rationale\n\nStatus\n\nCE-OD-001\n\n \n\n \n\n \n\nThe application is to be rearchitected from a monolithic centralised server into service-based architecture and event-based architecture.\n\nThis is to replace the ‘tandem’ legacy web services setup, which was required to interface with a vendor-locked layer.\n\nThis approach also simplifies the existing application architecture by removing additional dependencies (e.g. Wordpress CMS, MS CE, internal legacy components).\n\nRetain the existing monolitic / centralised web-servers to service all APIs.\n\nThe monolithic / centralised architecture is not scalable, and does not separate service boundaries and blast zone. The service-based architecture is aligned to the CE strategic roadmap to support Viva omnichannel strategy.\n\nConfirmed\n \n\nCE-OD-002\n\nVER D365 is to be set as the target source of truth for products and product categories. This is to support replacing the existing legacy-based product structure and multiple layers of mapping.\n\nIn the transitional/interim state, dual D365 setting might require to be maintained.\n\nN/A\n\nMultiple ERPs are not aligned to the strategic roadmap of VER. Therefore, this decision has no alternative. The main goal is to achieve a single ERP in the target state.\n\nConfirmed\n  \n\nCE-OD-003\n\nFurther to CE-OD-002 above, custom catalogue/order/basket services is to be implemented.\n\nUse Microsoft headless commerce product feature.\n\nCustom option has been chosen for the following reasons:\n\nCheaper operation: The license cost alone for headless commerce server (even at MS expected discount) means the development payback is under 6 months\n\nNo change to core D365: D365 does not have a good fit for the required Site/Offer/Category hierarchy meaning we would have to customise within D365.  D365 development is more costly and the implementation cycle is slower so this could offset the dev savings.\n\nFlexibility in design: Integrating directly with D365 makes the migration from OTR Legacy to OTR+ harder (or adds a dependency which will delay delivery by 6+ months)\n\nMore options to optimise performance: A custom solution will allow us to be more in control of performance\n\nConfirmed\n  \n\nCE-OD-004\n\nThe existing business logic contained in various SQL Server stored procedures will be refactored to the relevant services. \n\nThe end goal is to have lean stored procedures as mechanism to do Database CRUD (Create, Retrieve, Update, Delete) only, if required.\n\nRetain existing business logics within stored procedures in a lift and shift.\n\nRetaining business logic within database stored procedures creates multiple places where business logics reside, adding complexity in maintenance and operational support. It also limits certain functionality unnecessarily.\n\nConfirmed\n  \n\nCE-OD-005\n\nFurther to CE-OD-004 above, data store choice for each service is to be assessed per Service Design, to ensure fit-for-purpose. This also includes the assessment on the best strategy to migrate the existing data from the AWS-hosted SQL Server Databases into the new data store of choice.\n\nFrom operational cost perspective, the preferred order of data store options (from the lowest to highest cost) is as following:\n\nAzure Table storage\n\nCosmos DB (for non RDBMS / no-SQL)\n\nSQL Server DB (consider Azure SQL Hyperscale)\n\nNote: the fit-for-purpose assessment is to consider all factors, not just operational cost perspective (albeit being a major factor).\n\nRetain the existing centralised SQL Server database to store all OTR app data across all services.\n\nThe centralised SQL Server database does not align with the service-based microservices principles, as it created tight coupling / heavy dependency across services, resulting in more complexity to manage in the long term. \n\nRelational Database Management System (RDBMS) is also not always fit-for-purpose for certain services.\n\nConfirmed\n  \n\nCE-OD-006\n\nShared Azure Service Bus (ASB) managed by VER Integration team is to be utilised for any event-based inter and/or intra-services integration.\n\nStanding up a dedicated ASB for CE / OTR app BFF.\n\nFor compliance, private ASB endpoints are mandatory, which requires premium tier.\n\nShared ASB has been chosen, as the volume within CE on its own does not warrant having a dedicated ASB in premium tier created for CE. \n\nConfirmed\n  \n\n6. Design Assumptions, Issues, Risks and Dependencies\nID\n\nType\n\nDescription\n\nMitigation\n\n1\n\nDependency\n\nThe solution has dependency on the VER infrastructure pattern readiness, including:\n\nthe creation of landing zone / asset via bedrock;\n\nthe endorsed patterns for individual Azure resources being used; and\n\nthe integration readiness to APIM and shared ASB.\n\nContinuous engagement and collaboration with VER infrastructure and integration team is mandatory.\n\n2\n\nDependency\n\nThe solution has dependency on CE/VER endorsed Microservices design, which is being developed at the same time.\n\nContinuous engagement and review at different dev points is mandatory.\n\n3\n\nDependency\n\nThe solution has dependency on External Customer Identity & Access Management (IDAM) solution, which is to be done by a vendor at the same time.\n\nContinuous collaboration with the vendor is mandatory.\n\n7. Conceptual View\n7.1. Current State\nOTR app current-state-prod.png\nThe current server-side functionality ('backend') to support OTR Mobile App is hosted on AWS, with a ‘dual orchestration’ logic happening between Distillery vs. Peregrine servers.\n\n7.2. Target State\nThis Target State is in review. Some of the considerations and decisions may be deprecated\n\nThe following diagram outlines the target state architecture.\n\nKey considerations:\n\nThe detailed view of each service, along with its relevant integrations, are elaborated in the specific Service Design (captured as child pages to this HLD).\n\nInter-service communication will be done either via internal API endpoints (synchronous) or via ASB events (asynchronous).\n\nAt the time of writing, ‘OTR Sites (Data Centre and Stores)' are considered ‘external’ from networking point of view, and therefore all integration methods between applications hosted within ‘OTR Sites’ and ‘VER Azure’ follow external B2B integration patterns.\n\nSpecific to integration with PereQOperations and PereQOperations OWL APIs, inbound and outbound connectivity are temporarily routed via the existing OTR app Peregrine Service (legacy) hosted in OTR AWS, as the legacy server performs REST-to-SOAP API translations (and vice versa) required by the app BFF services. Changes to PereQOperations and PereQOperations OWL APIs are to be kept to a minimum, considering they are to be decommissioned in the near future.\n\nNote: in addition to the key considerations above, also refer to the Design Decisions captured in https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10155720746/OTR+Mobile+App+Backend+Rebuild#5.-Other-Design-Decisions\n.\n\nOTR App Backend Rebuild Diagram.jpg\nDiagram: https://miro.com/app/board/uXjVKyv51kk=/\n \n\n \n\nThe following table outlines the summary of impact across multiple applications/platform.\n\nSolution Component\n\nSummary of Impact\n\nSolution Component Domain\n\nData Classification per Solution Component\n\nLink to Detailed Design / Reference\n\nNotes\n\n1    \nOTR Mobile App (iOS / Android)\n\nModify app authentication to use OAuth per VER standard integration practice. \n\nSome app logic might require to be adjusted to work with the new BFF APIs.\n\nSome UI changes might be required to work with the new BFF APIs (not anticipated to be major).\n\nVER - Customer Engagement\n\nand\n\nOTR IT Team\n\nConfidential\n\n \n\n \n\n2    \nOTR Admin App (desktop / mobile)\n\nDevelop the new web-app to provide admins UI to manage certain operations.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n3    \nAPI Management (APIM)\n\nNew APIM endpoints are to be created to interface with the new BFF APIs/Service endpoints.\n\nNew AD groups are to be created to manage API authorisations.\n\nFirewall rules are to be configured accordingly.\n\nTo confirm access token expiry is to be set as 60 mins and re-auth tokens as 24 hours.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n4    \nAzure Service Bus (ASB) - shared\n\nNew topics and subscriptions are to be configured.\n\nRetry policies are to be configured per use case.\n\nFirewall rules are to be configured accordingly.\n\nVER Integration\n\nRestricted\n\n \n\n \n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\n(out of scope for this HLD)\n\nA new External Customer IDAM is to be designed and implemented to support this solution. However, the details are to be covered by a separate HLD.\n\nVER IDAM\n\nN/A\n\n \n\n \n\n6    \nFuel Service\n\nThe fuel service is responsible for the operation of pay at pump functionality and Scan Pump Save. It communicates with internal APIs in order to handle the creation, alteration and deletion of a fuel transaction. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Fuel Service’ workspace within CE, co-existing with the Fuel Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10328572159\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10481106978\n \n\n \n\n7    \nPayment Service\n\nThe payment service integrates with payment providers and allows orders and services to request payment from a consumer. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Payment Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10490478593\n \n\n \n\n8    \nSite Service\n\nThe site service acts as a source of reference for any site-related data, ingesting and maintaining various data from OTR D365 (with a view to expand this to VER D365 at the right time), such as service location, brands available, opening times and other operational data. \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Site Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208455\n \n\n \n\n9    \nCatalogue Service\n\nThe catalogue service acts as a source of reference for any brand, category and product data available at each site, The data is ingested from OTR D365 (with a view to expand to VER D365 at the right time) on a periodic basis.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Catalogue Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504273983\n \n\n \n\n10    \nInitiative Service\n\nThis service handles customer preferences, including user opt-in or opt-out choice. It also provides feeds for consumers that require them.  \n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Initiative Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306784\n \n\n \n\n11    \nLoyalty Service\n\nThis service handles OTR in-app rewards and loyalty campaigns/offers, with a view to be enhanced by integrating this with the core LMS platform in the near future.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nDeployment-wise, this service is to reside within the existing ‘Loyalty Service’ workspace within CE, co-existing with the Loyalty Service APIs created to support https://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10135667116\n.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241267\n \n\n \n\n12    \nCommunication Service\n\nThis service is responsible for the transmission of notifications to the consumers, by integrating with Apple or Firebase to support iOS or Android mobile devices accordingly.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Communication Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208485\n \n\n \n\n13    \nAdmin Service\n\nThis service enables admin users to manage any relevant app functions as required.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Admin Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306797\n \n\n \n\n14    \nUser Service\n\nThis service manages app user data, including PII. While the immediate build migrates the existing functionality like-for-like, in the near future, this service will be integrated with the appropriate customer master platform (the source of truth) and will only retain a copy for performance/functionality reasons (as a source of reference).\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘User Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nConfidential\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504306809\n \n\n \n\n15    \nCar Wash Service\n\nThis service handles the issuance and refresh of Happy Wash service codes between the app and the stores.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Car Wash Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504241285\n \n\n \n\n16    \nOrder Service\n\nThis service handles non-fuel orders, provides tax invoices and order history.\n\nThis service is to be rebuilt as a CE service.\n\nNew API endpoints are to be created.\n\nA new ‘Order Service’ workspace is to be provisioned to host the solution.\n\nVER - Customer Engagement\n\nRestricted\n\nhttps://vivaenergy.atlassian.net/wiki/spaces/OTRGARCH/pages/10504208499\n \n\n \n\n17    \nOTR D365\n\nThe existing integration between the app services and OTR D365 requires to be maintained.\n\nFunctionality changes and integration adjustment are to be covered within Site Service, Catalogue Service and User Service.\n\nAny user/consumer data will be assessed within the relevant Service and may be migrated as part of the Service rebuild if possible.\n\nThe migration and decommissioning of OTR D365 itself is out of scope for this HLD.\n\nOTR and VER - ERP / D365\n\nConfidential\n\n \n\n \n\n18    \nPereQOperations & PereQOperations OWL\n\nNo expected change as part of this HLD.\n\nThese SOAP-based services are considered legacy and will be replaced and decommissioned in the near future. Therefore changes/impacts are to be kept minimum.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n19    \nOTR Store Systems\n\nNo expected change as part of this HLD.\n\nOTR and VER - Stores\n\nRestricted\n\n \n\n \n\n20    \nPeregrine Data Warehouse (legacy)\n\nExisting SSIS jobs and/or bulk operations are to be assessed and adjusted accordingly, to ensure operational continuity.\n\nIntegration between app BFF services and the Peregrine Data Warehouse should follow the standard VER integration patterns.\n\nOTR and VER Data Platform\n\nConfidential\n\n \n\n \n\n21    \nOTR App Peregrine Service (legacy)\n\nThis refers to the existing AWS-hosted backend server/VM which does the REST-to-SOAP API translations (and vice versa) when integrating with PereQOperations and PereQOperations OWL APIs.\n\nModify server to call the new APIs via APIM, with the standard OAuth 2.0 authentication.\n\nModify server to receive API calls from the new services.\n\nVER - Customer Engagement\n\nConfidential\n\n \n\n \n\n22    \nBraintree\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n23    \nData Mesh Group (DMG)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nMost Confidential (External Party)\n\n \n\n \n\n24    \nNotification Services (Apple Push / Firebase)\n\nNo expected change as part of this HLD.\n\nExternal Party\n\nConfidential (External Party)\n\n \n\n \n\n25    \n(future consideration) Loyalty Management System (LMS) - EagleEye AIR\n\n \n\nVER - Customer Engagement\n\n \n\n \n\n \n\n26    \n(future consideration)\n\nEnterprise Data Platform (EDP)\n\n \n\nVER - Data Platform\n\n \n\n \n\n \n\n27    \n(future consideration)\n\nERP Platform (Microsoft D365)\n\n \n\nVER - ERP (D365)\n\n \n\n \n\n \n\n28    \n(future consideration)\n\nCommerce Scale Unit (CSU)\n\n \n\nVER - Stores\n\n \n\n \n\n \n\n \n\n8. Application View\nDetailed design for each service is captured in the relevant Service Design (child pages to this HLD).\n\n9. Infrastructure and Security View\n9.1. Solution Components Summary\nComponent\n\nSaaS/IaaS/PaaS\n\nNew/Existing/Modify\n\n1    \nOTR Mobile App (iOS / Android)\n\nClient (mobile app)\n\nModify\n\n2    \nOTR Admin App (desktop / mobile)\n\nClient (web app)\n\nNew\n\n3    \nAPI Management (APIM)\n\nPaaS\n\nModify\n\n4    \nAzure Service Bus (ASB) - shared\n\nPaaS\n\nModify\n\n5    \nExternal Customer Identity & Access Management (IDAM)\n\nAnticipated to be Saas - solution is out of scope for this HLD\n\nAnticipated to be ‘new’ - out of scope for this HLD\n\n6    \nFuel Service\n\nPaaS\n\nModify\n\n7    \nPayment Service\n\nPaaS\n\nNew\n\n8    \nSite Service\n\nPaaS\n\nNew\n\n9    \nCatalogue Service\n\nPaaS\n\nNew\n\n10    \nInitiative Service\n\nPaaS\n\nNew\n\n11    \nLoyalty Service\n\nPaaS\n\nModify\n\n12    \nCommunication Service\n\nPaaS\n\nNew\n\n13    \nAdmin Service\n\nPaaS\n\nNew\n\n14    \nUser Service\n\nPaaS\n\nNew\n\n15    \nHappy Wash Service\n\nPaaS\n\nNew\n\n16    \nOrder Service\n\nPaaS\n\nNew\n\n17    \nOTR D365\n\nSaaS\n\nModify\n\n18    \nPereQOperations & PereQOperations OWL\n\nOn-premises (OTR DC)\n\nExisting\n\n19    \nOTR Store Systems\n\nOn-premises (OTR stores)\n\nExisting\n\n20    \nPeregrine Data Warehouse (legacy)\n\nOn-premises (OTR DC)\n\nModify\n\n21    \nOTR App Peregrine Service (legacy)\n\nPaaS (AWS)\n\nModify\n\n22    \nBraintree\n\nSaaS\n\nExisting\n\n23    \nData Mesh Group (DMG)\n\nSaaS\n\nExisting\n\n24    \nNotification Services (Apple Push / Firebase)\n\nSaaS\n\nExisting\n\n9.2. Environment View\nEnvironment Type\n\nRemarks\n\nDevelopment\n\nDevelopment testing is currently done on developer machines. For strategic future state, requires Dev environment to be created.\n\nUAT\n\nTo be created per services (workspace) to replace the existing UAT environment.\n\nProd\n\nTo be created per services (workspace) to replace the existing Prod environment.\n\n9.3. Deployment Diagram\nNote: in addition to the resources captured in the diagram, Azure Redis Cache will also be considered. However, use cases are to be confirmed first before incorporated into the solution.\n\n9.4. Connectivity\nSource\n\nDestination\n\nProtocol\n\nAuth\n\n1    \nOTR Mobile Apps\n\nVER APIM, via Cloudflare → Public IP → App Gateway → delegated subnet → delegated subnet / private IP\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via CA-issued Client certificates.\n\nCertificate pinning is used.\n\n2    \nAzure Function for X Service via delegated subnet\n\nOTR hosted-applications via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nFor OTR App Peregrine Service (AWS hosted): TBC\n\nFor Peregrine Data Warehouse (legacy): TBC\n\n3    \nVER APIM via delegated subnet\n\nAzure Function for X Service via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n4    \nAzure Function for X Service via delegated subnet\n\nVER Shared Log Analytics (via public endpoint, per standard VER setup)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n5    \nAzure Function for X Service via delegated subnet\n\nVER Shared Service Bus (ASB) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\n5671 - AMQP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n6    \nAzure Function for X Service via delegated subnet\n\nStorage Account (Table) via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n7    \nAzure Function for X Service via delegated subnet\n\nCosmos DB via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n8    \nAzure Function for X Service via delegated subnet\n\nSQL Server DB via private endpoint\n\n1433 - TCP\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n9    \nAzure Function for X Service via delegated subnet\n\nKey Vault via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n10    \nOTR-hosted applications (in OTR AWS and OTR DC)\n\nVER APIM, via Cloudflare and App Gateway\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via self-signed certificates (internal system).\n\n11    \nAzure Function for X Service via delegated subnet\n\nBraintree via outbound firewall (via Netskope SSE in the future)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n12    \nAzure Function for X Service via delegated subnet\n\nData Mesh Group (DMG) via outbound firewall (via Netskope SSE in the future)\n\n443 - WebSocket over TLS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMessages are authenticated with a KEK (Key Encryption Key).\n\nFor the session token:\n\nIt is a onetime use token.\n\nIt is a random string\n\nCardholder data (PAN) is encrypted at the DMG side using a DUKPT derived key and 3DES algorithm.\n\n13    \nAzure Virtual Desktop (AVD)\n\nAzure private resources (function apps, keyvault, data store)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nRBAC Entra ID\n\nNote: the current use cases is only for internal testing & support. No Business User access.\n\n14    \nAzure DevOps\n\nAzure resources via DevOps agent and deployment planes\n\nThe DevOps Agent is responsible for deploying and updating configurations in different environments (Development, Test, and Prod), by coordinating Terraform to deploy resources via Azure Resource Manager APIs.\n\nThe agent interacts with the Azure Function deployment pipeline, ensuring that infrastructure configurations, APIM policy updates, and application deployments are consistent across environments.\n\nIn addition to the ARM APIs, the code for the function app is deployed through it’s deployment plane to a deployment slot. This should be secured by its own scm private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nEntra ID for individuals\n\nManaged Identity for automation\n\n15    \nVER APIM\n\nVER Shared Service Bus via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n16    \nAzure Function for X Service via delegated subnet\n\nStorage Account for Function Apps: blob, file via delegated subnet via private endpoint\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nManaged Identity\n\n17    \nAzure Function for X Service via delegated subnet\n\nApple Push Notifications (APNs)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n18    \nAzure Function for X Service via delegated subnet\n\nFirebase Cloud Messaging (FCM)\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n19    \nAzure Function for X Service via delegated subnet\n\nOTR D365\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nTBC\n\n9.5. Component Deployment Specifications & Security Controls\nAzure Resource\n\nDeployment\n\n1    \nApp Service Plan - Azure Functions\n\n \n\n \n\nSizing\n\nPremium Function - P0v3:1\n\nZone redundancy not required\n\nWindows\n\nLanguage: C# - Dotnet8\n\nXUnit | Fluent Assertions | Moq\n\nAzure Functions V4\n\nZip deploy \n\nApplication Insights enabled \n\nConnect to Application Insights with a connection string\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nUse managed identity for accessing resources\n\nSite credentials for deployments - Source code is managed in Azure DevOps with access control and build pipeline checks to prevent bad merges\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD for developers\n\nSCM deployment plane\n\nCI/CD pipeline\n\nNetwork Controls\n\nSecured by private endpoints for:\n\nFunction\n\ninbound \n\nSCM\n\nSCM should restrict access from Dev Pipeline agent\n\nDelegated subnet /27\n\nAll egress traffic must route through delegated subnet \n\nStorage account for Azure Functions instance secured by private endpoints for blob and file - \n\nAccess key vault through private endpoint \n\nConsiderations\n\nN/A\n\n2    \nAzure Key Vault\n\nSizing\n\nStandard tier\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nTLS 1.2 and 1.3\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nSecrets (Incl - Keys, Certs) Data Plane: RBAC Managed Identities\n\nFunctions\n\nSecrets Management Plane: RBAC\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nKey management plane\n\nSSO RBAC - internal staff\n\nCI/CD pipeline\n\nSecrets (Incl - Keys, Certs) data plane\n\nSSO RBAC - internal staff\n\nNetwork Controls\n\nSecured by Private Endpoint\n\nConsiderations\n\nN/A\n\n3    \nAzure Storage - table\n\nSizing\n\nGeneral Purpose v2 Storage Account - ZRS (99.99% SLA)\n\nTable Storage\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nEnforce HTTPS\n\nMin TLS 1.2\n\nEncryption at Rest\n\nServer Side Encryption\n\nAuth\n\nRBAC Managed Identities\n\nFunctions\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAccess via AVD\n\nDeployment plane\n\nCI/CD pipeline\n\nData plane\n\nFunction managed identity\n\nNetwork Controls\n\nSecured by private endpoints\n\nConsiderations\n\nShould only be accessible via Azure backbone/ managed identity, from VER network or Azure Virtual Desktop for testing and support purposes.\n\n4    \nAzure Cosmos DB\n\nSizing\n\nSingle Database\n\nContainers 14000 RUs total between both regions\n\nDiagnostic settings enabled for audit logs \n\nRedundancies\n\nRead Region - Australia Southeast\n\nBackup every 240 min Retained for 8 hours - with Geo-Redundant setting, the backup is done on both regions.\n\nWrite Region - Australia East → replicates data to Australia Southeast\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nData Explorer only viewable if IP address is whitelisted and selected networks is enabled\n\nDeployment plane\n\nCI/CD pipeline \n\n\nServer / Database\n\nManaged User Identity - RBAC access to function applications\n\nNetwork Controls\n\nSecured by private endpoint\n\nSecured by NSG separate rules for coupon-scanner / flybuys\n\nDisabled Public Network access\n\nConsiderations\n\nNoSQL database type interaction is handled with Azure.Cosmos.Client nuget package ( c# ).\n\nCosmos private endpoint uses 3 IP’s, 1 shared IP and 1 specific IP for regions Australia East ( primary write region ) Australia Southeast ( secondary read region).\n\n5    \nAzure SQL\n\nSizing\n\nAzure SQL Database\n\nSingle database\n\nDTU - Standard tier\n\nS0 - Compute Size\n\nIncrease compute size as required\n\nDiagnostic settings enabled for audit logs\n\nEncryption in Transit\n\nMin TLS 1.2\n\nEncryption at Rest\n\nTDE\n\nAuth\n\nRBAC Managed Identity\n\nFunction App\n\nStorage Explorer\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff (including developer)\n\nDeployment plane\n\nCI/CD pipeline - db owner role\n\nServer\n\nServer admin (sysadmin, dbo) - username/password\n\nEntra Id admin - Entra security group\n\nDatabase\n\nFunction App managed identity - data writer role\n\nStorage Explorer - TBD: either SSO internal staff or Storage Explorer managed identity - data writer and data reader roles\n\nNetwork Controls\n\nSecured by private endpoint\n\nConsiderations\n\nRow level and column level encryption using SQL Certificate should be possible - pending requirement from security, as this has performance impact.\n\n6    \nNetworking:\n\nVNet\n\nSubnets\n\nNSGs\n\nUDRs\n\nSizing\n\nVNet /24\n\nPrivate Endpoint Subnet /27\n\ndelegated Subnet /27\n\nOther VNets - peering / routing consideration\n\nFirewall security VNet\n\nVNet Address Space:\n\nDev: /24\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nDeployment plane\n\nCI/CD pipeline\n\n7    \nAzure Monitor\n\nAccess\n\nAzure console management plane\n\nSSO RBAC - internal staff\n\nAuth\n\nRBAC Managed Identities - Log stream to App Insights\n\nNetwork Controls\n\nLog Analytics and Azure Monitor (Application Insights) could potentially be publicly accessible, for staff access (as per current pattern)\n\nLog stream to App Insights is public (as per current pattern)\n\nConsiderations\n\nSimilar to Fuel Service implementation, logs volume sent to the shared workspace should be configured with a daily cap.\n\n9.6. Users\n\n\n\nUser Details\n\nUsers & RBAC controls\n\nCurrently, there are 486,488 registered users for the OTR mobile app, out of which 172,700 is considered active monthly.\n\nThe External Customer Identity & Access Management (IDAM) solution is out of scope of this HLD and will be done as a separate HLD.\n\nAdditionally, a new Admin app/portal is to be created as part of this solution. RBAC is to be mapped for the Admin Users, per relevant Entra roles and groups.\n\nSSO, Conditional Access Policy and User Provisioning \n\nSSO is to be set up for access to Admin App/Portal.\n\nDeveloper / Technical Support access is to be set up according to the Viva standard.\n\n \n\n9.7. Backup & Recovery\nThe current backup policies for AWS-hosted OTR resource are as following:\n\nEC2 instances - Daily backup\n\nRDS Instances, MySQL and MSSQL - Daily backup\n\nIn the new Azure hosting, in the event of DR, the approach will involve deploying a new Azure Function instance in another region as necessary using automated pipelines.\n\nThe Azure Storage Account will be configured with Zone-Redundant Storage (ZRS), with 0 RPO and RTO of less than 15 mins.\n\nSpecific backup & recovery configurations are to be elaborated in the relevant Service Design.\n\n9.8. Monitoring - Application, Infrastructure & Security\nThe existing OTR app monitoring is performed via a combination of AWS Cloud Trails and Dynatrace. With the strategic hosting migration into Azure Cloud, Cloud Trails will no longer be available. \n\nAdditionally, the following servers are also regularly monitored:\n\nDatabases(RDS)\n\nprod-otr-app2-2a - MySQL\n\nprod-otr-app2-2b - MYSQL\n\nprodotrappmssql - MSSQL\n\nEC2\n\nProd OTR App - 2A (Linux/Apache)\n\nProd OTR App - 2B (Linux/Apache)\n\nProd OTR Web Service - 2A (Windows/IIS)\n\nProd OTR Web Service - 2B (Windows/IIS)\n\nCurrent Dynatrace for OTR: https://vnv91336.live.dynatrace.com/#newhosts;gtf=-14d%20to%20-7d;gf=all\n\n \n\nIn the new Azure hosting, monitoring is performed at application and infrastructure levels.\n\nApplication level:\n\nA common logging package will log code transaction execution information, traces, and debug data at configurable logging level to Application insights and shared Log Analytics, e.g. Serilog. This information is queried in both App Insights and the shared log analytics via kql queries.\n\nA common /health function api will be exposed to proactively indicate application-level health.\n\nAzure Workbooks provide dashboards that visually summarize key application-level metrics and insights across variable time periods primarily from App Insights via kql queries.\n\nInfrastructure level:\n\nThe out of the box Function App runtime environment logs are streamed to app insights and from there to the shared log analytics. These are used for Alert queries. E.g. number of unhealthy nodes > 0. This is built into the Terraform modules used.\n\nA shared Log Analytics workspace with a configurable period of log retention is utilized for auditing, tracing and debugging during support and the development life cycle using kql queries that can be stored as dashboard notebooks. All logs across all of the infrastructure components are streamed here.\n\nAzure Monitor Application insights will provide detailed Function App logs which is also streamed to the shared log analytics workspace. Both the out of the box information as part of the Premium Tier runtime (e.g. availability, server requests, etc.) as well as the streamed logs from the log package for transaction level data.\n\nMonitoring:\n\nAzure Monitor alerts based on queries for the following:\n\nAny exceptions streamed from the common logging package to App Insights\n\nAny basic out of the box infrastructure queries in log analytics indicating problems at the infrastructure level e.g. unhealthy nodes > 0 in 15 minutes, Average CPU utilization > 90 % in 15-minute period, high transaction volumes, high volume of 4xx or 5xx http response codes, etc.\n\nWhen the common /health function app API returns a Http status code other than 2xx\n\nAlerts are sent out to the members of the support team to action via email. Additionally, VER Integration team is in the process of integrating alerts to ServiceNow for Incident Management purposes.\n\n9.9. Data- Reports & Interfaces/Data Integration\nAt the time of writing, Reporting requirements are yet to be captured. HLD will be amended once requirements are received, and if there is any material change to the proposed solution.\n\n10. Patterns Used\n10.1. Integration Patterns\nIntegration Pattern\n\nPattern Status\n\nMode\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9923133545\n\ndomain endorsed\n\n \n\n \n\n10.2. Security Patterns\nSecurity Pattern\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9997582337\n\ndraft\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9995911207\n\nApproved\n\nNo deviation\n\n \n\n10.3. Infrastructure Patterns\nAzure Resource\n\nPattern Status\n\nPattern Deviation\n\nReference\n\n1    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9898952562\n\nPeer review\n\nNo deviation\n\n \n\n2    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852518458\n\narch informed\n\nNo deviation\n\n \n\n3    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830793256\n\narch informed\n\nNo deviation\n\n \n\n4    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9830760505\n\narch informed\n\nNo deviation\n\n \n\n5    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088191\n\narch informed\n\nNo deviation\n\n \n\n6    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9831088147\n\nPeer review\n\nSome deviation\n\nDeviates regarding AMPLS and Private Endpoint for log analytics. IAM-based with public endpoint instead.\n\n7    \nhttps://vivaenergy.atlassian.net/wiki/spaces/NewCo/pages/9852616708\n\narch informed\n\nNo deviation\n\n \n\n11. References\nId\n\nName\n\nLink\n\nREF-001\n\nOTR Diagrams\n\nOTR App Solution Architecture_AS IS.drawio \n\nApp Solution Architecture New Cloud Design v2.drawio  \n\nREF-002\n\nOTR initial design decisions\n\nOTR App V4 Design decisions.docx\n\nREF-003\n\nSoftware Requirement Specifications (SRSs) created by CodeFish\n\nSRS - Final\n\nREF-004\n\nSharepoint location where ‘current state’ documents are stored\n\nCurrent State Documents\n\n12. Appendix\n12.1. Appendix A - Alternative Target State Diagram[O[I\n\n\n\n\n","pastedContents":{},"timestamp":1763949718743,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"The \"Distillery\" servers are deprecated and removed, they are not relevant to this diagram. The MySQL database is decommissions. Add Dynatrace","pastedContents":{},"timestamp":1763949822204,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Were they the only inconsistencies?","pastedContents":{},"timestamp":1763949867866,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"add #3","pastedContents":{},"timestamp":1763949936656,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"nah","pastedContents":{},"timestamp":1763949968371,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"I'm going to make some statements about the connectivity, include them appropriately ","pastedContents":{},"timestamp":1763950319264,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"OTR Mobile Apps\n\nVER APIM, via Cloudflare → Public IP → App Gateway → delegated subnet → delegated subnet / private IP\n\n443 - HTTPS\n\nMicrosoft Public TLS 1.2,1.3 Cert\n\nMicrosoft Entra ID Service Principal with OAuth2 via CA-issued Client certificates.\n\nCertificate pinning is used.","pastedContents":{},"timestamp":1763950338874,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/model ","pastedContents":{},"timestamp":1763950704174,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/model ","pastedContents":{},"timestamp":1763950704174,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/model ","pastedContents":{},"timestamp":1763950704174,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/statusline ","pastedContents":{},"timestamp":1763950722293,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/statusline ","pastedContents":{},"timestamp":1763950722293,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Verify the consistency and relevance of each of the context maps, suggest relationships that don't belong in a map, or relationships between bounded contexts that haven't been defined","pastedContents":{},"timestamp":1763960740363,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Lets address them one by one","pastedContents":{},"timestamp":1763960927644,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Check the bounded context, but probably c","pastedContents":{},"timestamp":1763960969977,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"always","pastedContents":{},"timestamp":1763961036467,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Yes","pastedContents":{},"timestamp":1763961158676,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961278243,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961333783,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961368494,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961583629,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961693069,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763961745452,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"On each relationship defined in a context map, add a sentence the describes the relationship in plain english, include the purpose, ask for clarity if needed","pastedContents":{},"timestamp":1763961925019,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"1 - yes, 2 - another comment, 3 - start with loyalty","pastedContents":{},"timestamp":1763962001423,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"commit all this","pastedContents":{},"timestamp":1763962197158,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Add to the comments why each relationship is important to _that_ context map","pastedContents":{},"timestamp":1763962287304,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yes","pastedContents":{},"timestamp":1763962633508,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"commit and push these","pastedContents":{},"timestamp":1763963144298,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/compact ","pastedContents":{},"timestamp":1763963349698,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/compact ","pastedContents":{},"timestamp":1763963349698,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/compact ","pastedContents":{},"timestamp":1763963349698,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"/compact ","pastedContents":{},"timestamp":1763963349698,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"merge bounded-contexts\\ARCHITECTURE_DECISIONS_ENGAGEMENT.md into the header block of bounded-contexts/engagement.cml","pastedContents":{},"timestamp":1763963350020,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"1 - yes, 2 - delete it","pastedContents":{},"timestamp":1763963613369,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"do the same with the loyalty files","pastedContents":{},"timestamp":1763963641052,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"absolutely","pastedContents":{},"timestamp":1763963775575,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"How does this document I'm pasting in, change our understanding of the flybuys initiative and how does it impact our understanding of the loyalty domain --- # Flybuys Integration Project: Complete Narrative\n\n## Executive Summary\n\nThe Flybuys Integration project unifies loyalty functionality across OTR and Reddy Express (REXP) stores with the OTR and SPS mobile applications. Currently, Flybuys operates only in Reddy Express stores with no mobile app integration, creating fragmented rewards tracking. The target state enables customers to link Flybuys accounts to both applications and earn points consistently across all channels, with the SPS app servicing REXP stores.\n\n## Project Context & Strategic Background\n\n### Business Challenge\n\nThe OTR Group operates across two distinct brands—OTR and Reddy Express—with separate customer bases and loyalty expectations. Flybuys points serve as a key driver for much of the existing Reddy Express customer base, but the current implementation has significant limitations:\n\n- Flybuys operates only in Reddy Express stores with basic barcode pattern matching\n- No account linking capability exists between OTR systems and Flybuys\n- No mobile app integration creates fragmented rewards tracking\n- Customers cannot access their Flybuys data through OTR digital channels\n- The system cannot support sophisticated reward campaigns or personalisation\n\n### Strategic Principles\n\nThe project follows several core architectural and business principles:\n\n1. **Client Agnosticism**: The loyalty architecture must serve both web and mobile applications without client-specific backends, enabling faster feature delivery, reduced maintenance costs, and consistent user experiences across platforms.\n\n2. **Partner Agnosticism**: The Loyalty System should be flexible enough to integrate with any third-party loyalty partner, not just Flybuys. This future-proofs the architecture as the business evolves.\n\n3. **Service Abstraction**: All vendor-specific platforms (CRM systems, loyalty engines, identity providers) should be abstracted behind generic service layers to enable platform changes without architectural rework.\n\n4. **Rewards as Universal Concept**: \"Rewards\" is the catch-all term for any positive outcome to a Guest from the Loyalty system, replacing vendor-specific terminology like \"points\" or \"grants.\"\n\n5. **System of Record Clarity**: The CRM platform is the authoritative source for all OTR Group Guest profiles and linking data, while the Loyalty Engine handles transaction processing and reward calculations.\n\n### Long-term Vision\n\nThe design supports consolidating to the OTR app as the primary digital loyalty platform as sites convert over five years. The architecture prioritises consistency and simplicity to maximise adoption and reduce implementation complexity, while establishing a platform for future reliable growth and capabilities comparable to enterprise loyalty solutions like Eagle Eye AIR (an AI-driven loyalty and personalisation platform that enables real-time personalised offers and campaigns).\n\n## Architectural Foundation\n\n### Core Architecture Statements\n\nThe project is guided by a comprehensive set of architectural principles established early in requirements gathering:\n\n**Loyalty System Ownership & Scope**\n- The Loyalty System should master all OTR Group loyalty data and programmes\n- All transactions will be adjudicated for rewards within the Loyalty System\n- Existing loyalty programmes will be migrated into the Loyalty System over time\n- Future reward types (coffee redemption, car wash, Subway, fuel discounts) will migrate to the Loyalty System\n\n**Third-Party Partner Model**\n- Flybuys is positioned as a third-party partner to the OTR Group Loyalty strategy, not the primary system\n- Flybuys provides a user database and distributes reward grants on OTR's behalf\n- OTR retains responsibility for all future loyalty programmes\n\n**Technical Architecture Principles**\n- The Loyalty System should be a flexible microservice with loose coupling to other services\n- Design should be contract-first with proper HTTP methods\n- System should follow the principle of least astonishment—matching user expectations and mental models\n- Track REDUSE metrics (a standard architectural quality measure)\n- People are part of the system; design should match user experience and mental models\n\n**Integration Points**\n- Mobile apps should use the Loyalty System to link third-party accounts, calculate/adjudicate rewards, and grant rewards\n- Mobile apps should retain reward preferences in the Loyalty System\n- POS systems should recognise OTR barcodes and reconcile them to OTR Loyalty accounts\n- POS should recognise Flybuys barcodes if linked to an OTR account\n- The Loyalty System should resolve OTR accounts and any linked third-party partner accounts\n- The system should keep third-party data fresh through synchronisation\n\n**Data Management & Integration**\n- CRM is the system of record for customer data\n- The Loyalty System maintains loose coupling with the CRM platform\n- The Loyalty System should handle OAuth integration for third-party account linking\n\n### Service Architecture Pattern\n\nThe project employs a **facade pattern** (also called Backend-for-Frontend or BFF) to create simplified interfaces hiding the complexity of multiple underlying services. This approach:\n\n- Provides a single entry point for clients (mobile apps)\n- Coordinates calls to various microservices (CRM, Loyalty Engine, third-party APIs)\n- Handles cross-cutting concerns (authentication, rate limiting, logging)\n- Reduces client coupling to internal service boundaries\n- Enables better fault isolation and API evolution\n\nThe microservice layer follows clear naming conventions aligned with domain responsibilities:\n- **Customer Service** (or Customer Registry Service): Manages all customer records mastered in CRM\n- **Loyalty Service**: Handles loyalty transactions, calculations, and reward grants\n- **Engagement Service**: Manages customer communications and marketing\n\n### Technology & Platform Decisions\n\n**Identity & Access Management**\n- OAuth 2.0 with PKCE (RFC 7636) for third-party account linking\n- PKCE (Proof Key for Code Exchange) provides security for public clients like mobile apps\n- Flybuys leverages Auth0 as their identity platform for member authentication\n- Azure CIAM (Customer Identity and Access Management) for OTR Group identity\n- Token storage requires Azure Key Vault or similar secure storage (Azure CIAM doesn't natively store third-party tokens)\n\n**Integration Platforms**\n- CRM System (abstracted, currently Salesforce)\n- Loyalty Rules Engine (abstracted, currently Eagle Eye)\n- Customer Engagement Platform (abstracted, currently Braze)\n- Point of Sale System (Dynamics 365 Commerce)\n- API Gateway (Azure API Management)\n- Identity Provider (Azure AD/CIAM)\n\n**Data Residency & Compliance**\n- All OAuth tokens and customer PII must be stored in Australian data centres\n- Privacy considerations under GDPR and Australian Privacy Act requirements\n- Audit logging requirements for compliance and customer service\n\n## Functional Requirements\n\n### Core Use Cases\n\nThe project developed eight primary use cases with detailed descriptions:\n\n**UC-001: Link Flybuys Account (App)**\n- Guest initiates linking from OTR or SPS mobile app\n- System redirects to Flybuys OAuth login (PKCE flow)\n- Guest authenticates with Flybuys credentials\n- Guest approves consent for data sharing\n- System creates bidirectional link between accounts\n- System synchronises initial data (member number, points balance)\n- Guest sees confirmation with linked status\n\n**UC-002: Unlink Flybuys Account (App)**\n- Guest initiates unlinking from app settings\n- System presents confirmation dialogue\n- Guest confirms unlinking action\n- System removes bidirectional link\n- System notifies CRM and Braze of status change\n- Guest returns to unlinked state\n\n**UC-003: View Flybuys Points Balance (App)**\n- Guest views their profile/loyalty section\n- System retrieves current Flybuys points balance via API\n- System displays balance with last updated timestamp\n- System handles graceful degradation if Flybuys API unavailable\n\n**UC-004: Earn Flybuys Points (In-Store with App)**\n- Guest presents OTR app barcode at POS\n- POS scans barcode and retrieves Guest profile\n- System checks for linked Flybuys account\n- Transaction processes normally\n- System calculates eligible Flybuys points based on rules\n- System queues points for batch processing\n- Guest receives receipt with points earned indication\n\n**UC-005: Select Reward Preference (App)**\n- Guest views available reward options (Flybuys points vs SPS fuel discount)\n- Guest selects preferred reward type\n- System validates selection against eligibility rules\n- System persists preference to Loyalty Service\n- Guest sees confirmation of new preference\n\n**UC-006: Switch Reward Preference (App)**\n- Guest changes reward selection\n- System shows impact of switching (e.g., points vs discount)\n- Guest confirms preference change\n- System updates preference in real-time\n- Next transaction uses new preference\n\n**UC-007: Daily Points File Generation**\n- System identifies all Flybuys transactions from previous day\n- System classifies transactions (base points vs bonus points)\n- System generates formatted file per Flybuys specifications\n- System transmits file to Flybuys via secure channel\n- System logs transmission for audit trail\n\n**UC-008: Customer Service Inquiry**\n- Guest care agent accesses customer profile\n- System displays transaction history with Flybuys attribution\n- Agent can view points earned, pending points, and linking status\n- Agent can view timestamps for linking/unlinking events\n- System provides sufficient data for resolving common queries\n\n### Error Handling & Alternative Flows\n\nEach use case includes comprehensive error scenarios:\n\n- **Flybuys account already linked** to another OTR account\n- **Network/API failures** during linking process\n- **Invalid Flybuys credentials** or authentication failures\n- **Expired tokens** during session\n- **Failed payment recovery** with points preservation\n- **Flybuys API unavailable** with graceful degradation\n- **Data synchronisation failures** with retry logic\n- **Circuit breaker activation** for downstream service protection\n\n### Eligibility Rules & Business Logic\n\n**Transaction Eligibility**\n- Points calculation applies product exclusions (tobacco, gift cards, etc.)\n- Fuel transactions capped at specific litre limits\n- Payment method affects eligibility (Shell Card vs other methods)\n- Site type determines available rewards (OTR vs REXP)\n- Guest preference respected (Flybuys points vs SPS fuel discount)\n\n**Cross-Channel Consistency**\n- Same eligibility rules apply across OTR App, SPS App, OTR In-Store, and REXP In-Store\n- Daily points file includes transactions from all channels\n- Points classification tracked at transaction level (base vs bonus)\n\n## Work Breakdown Structure (WBS)\n\nThe project developed a comprehensive 135+ item WBS organised into major workstreams:\n\n### Phase 1: Foundation (WBS-1 to WBS-30)\n- Requirements gathering and analysis\n- Architectural design and documentation\n- Stakeholder alignment and approval\n- Technical design authority reviews\n\n### Phase 2: Core Integration (WBS-31 to WBS-70)\n- OAuth 2.0 PKCE implementation\n- CRM integration for account linking\n- Loyalty Service API development\n- Flybuys API integration\n- Token management and secure storage\n\n### Phase 3: Mobile Experience (WBS-71 to WBS-90)\n- OTR App linking/unlinking flows\n- SPS App linking/unlinking flows\n- Points balance display\n- Reward preference selection UI\n- Error handling and user feedback\n\n### Phase 4: In-Store Integration (WBS-91 to WBS-110)\n- POS barcode scanning integration\n- Coupon Scanner integration with Loyalty Service\n- Transaction adjudication logic\n- Real-time eligibility checking\n- Receipt printing modifications\n\n### Phase 5: Batch Processing (WBS-111 to WBS-125)\n- Daily transaction identification\n- Points classification logic\n- File generation per Flybuys spec\n- Secure file transmission\n- Audit logging and reconciliation\n\n### Phase 6: Platform Synchronisation (WBS-126 to WBS-135)\n- Real-time sync with CRM\n- Real-time sync with Braze\n- Data consistency monitoring\n- Failed sync recovery processes\n\n### Notable WBS Refinements\n\nDuring WBS review, 23 items were updated to use consistent terminology, replacing \"points\" with \"Reward Grants\" to align with architectural principles of vendor-neutral language.\n\n## Scope Management\n\n### In Scope\n\n**Mobile App Functionality**\n- OTR App users adding existing Flybuys barcodes to profiles\n- OTR App users adding temporary Flybuys barcodes\n- SPS App equivalent functionality for REXP customers\n- Mapping app barcodes to Flybuys accounts in Loyalty Service\n- Guest reward preference selection in both OTR and SPS apps\n- Reward preference selection in Flybuys App (via Flybuys platform)\n\n**In-Store Functionality**\n- Guests presenting app barcodes and earning Flybuys points at POS\n- OTR POS integration with Coupon Scanner and Loyalty Service\n- Transaction-level capture of Flybuys membership status\n\n**Backend Integration**\n- OAuth 2.0 integration with Flybuys (via Auth0)\n- Real-time synchronisation with CRM and Braze\n- Daily points file generation and transmission\n- Transaction classification and batch processing\n\n### Out of Scope\n\n**Explicitly Excluded**\n- Any backend rebuild, replatforming, or replacement of OTR Mobile backend\n- Migrating OTR App's internal loyalty functionality to new platform (future phase)\n- OTR App users linking Shell Card accounts (separate initiative)\n- OTR POS recognising OTR App barcodes (already exists)\n- Any redemption of OTR or Flybuys rewards\n- Basket adjudication logic\n- Data exports to/imports from Flybuys (handled via daily file only)\n- Reporting requirements (future phase)\n- Managing Flybuys campaigns or offers (Flybuys responsibility)\n- OTR POS scanning Flybuys physical cards (REXP only)\n\n### Timeline Considerations\n\n- **November 2025 Release**: Core linking functionality in mobile apps\n- **Q1 2026**: OTR POS upgrades to support Flybuys barcode scanning\n\n## High-Level Design Approach\n\n### Three-Phase Architecture\n\nThe architectural approach recognises three distinct but related design concerns:\n\n**1. Transition Architecture**\n- Moving from the legacy REXP barcode-only system to integrated loyalty\n- Maintaining backward compatibility during migration\n- Gradual rollout across sites as they convert brands\n- Data migration and reconciliation strategies\n\n**2. Linking Architecture**\n- OAuth 2.0 PKCE flow for secure account connection\n- Token management and secure storage patterns\n- Bidirectional linking between OTR and Flybuys systems\n- Real-time synchronisation with CRM and engagement platforms\n- Graceful handling of linking failures and edge cases\n\n**3. Grants Architecture** (renamed from \"Points Architecture\")\n- Transaction adjudication and eligibility rule engine\n- Reward calculation based on purchase data\n- Batch processing for daily file generation\n- Classification of reward types (base vs bonus)\n- Audit trail and reconciliation capabilities\n\n### Design Principles for High-Level Design\n\nThe HLD follows specific goals:\n\n**Primary Goals**\n- Communicate solution architecture without code-level details\n- Enable stakeholder decision-making and risk identification\n- Bridge business and technical teams with shared understanding\n- Guide detailed design and implementation work\n\n**Key Audiences**\n- Technical architects (validate approach)\n- Engineering teams (understand what to build)\n- Product/business stakeholders (understand what they're getting)\n- Operations teams (understand deployment and support)\n\n**Content Approach**\n- System context and scope\n- Major components and responsibilities\n- Integration points between systems\n- Data flows and sequences\n- Key architectural decisions with rationale\n- Non-functional requirements\n- Deployment approach\n- Risks and mitigations\n\n**What HLD is NOT**\n- Not a requirements document (that's the BRD)\n- Not implementation instructions (that's LLD)\n- Not detailed API specifications\n\n### Key Architectural Decisions\n\n**Decision 1: System of Record Designation**\n- CRM designated as system of record for all OTR Group Guest profiles, contact data, and linking status\n- Loyalty Engine maintains transaction data and reward calculations\n- Clear data ownership prevents conflicts and enables proper synchronisation\n\n**Decision 2: Idempotency Approach**\n- All linking operations use unique request identifiers\n- Duplicate requests within 60 seconds return existing result without reprocessing\n- Prevents double-linking and ensures consistency\n\n**Decision 3: Circuit Breaker Configuration**\n- Flybuys API protected with circuit breaker pattern\n- Threshold: 50% failure rate over 10 requests in 60 seconds\n- Circuit opens for 30 seconds before attempting half-open state\n- Protects system from cascading failures\n\n**Decision 4: Retry Policy**\n- Failed synchronisation operations retry with exponential backoff\n- Timing: 1 second, 5 seconds, 15 seconds\n- Maximum 3 attempts before alerting administrators\n- Guest-facing operations succeed regardless of sync status\n\n**Decision 5: Error Handling Strategy**\n- Graceful degradation for non-critical features (points balance display)\n- Fail-fast approach for critical operations (linking/unlinking)\n- Maintains data consistency while maximising availability\n\n**Decision 6: API Versioning**\n- Backend-for-Frontend facade versions independently from downstream services\n- Allows mobile apps to remain stable during backend changes\n- Decouples client evolution from service evolution\n\n**Decision 7: Monitoring Thresholds**\n- Alert on: >5% linking failure rate, >10 second response times, token storage failures, >3 consecutive sync failures\n- Log only: individual request failures, cache misses, token refreshes\n- Balances operational awareness with alert fatigue\n\n## Technical Deep Dives\n\n### OAuth 2.0 PKCE Implementation\n\n**Flow Sequence**\n1. Partner app (member logged in) redirects to Flybuys login via `/authorise` endpoint\n2. Required parameters: `response_type`, `client_id`, `code_challenge_method`, `code_challenge`, `redirect_uri`, `state`, `scope`, `audience`\n3. Member authenticates with Flybuys credentials\n4. Member presented with consent page to approve linking\n5. Upon approval, systems create backend link and request token via `/oauth/token`\n6. Token parameters: `client_id`, `grant_type`, `code`, `code_verifier`, `redirect_uri`\n7. System receives `access_token` and `refresh_token` for subsequent API calls\n\n**Security Considerations**\n- PKCE prevents authorisation code interception attacks\n- Code verifier proves possession of original code challenge\n- Tokens stored in secure Azure Key Vault\n- Token refresh handled automatically before expiration\n- All communication over HTTPS/TLS\n\n### Data Synchronisation Strategy\n\n**Real-Time Sync Events**\n- Account linking/unlinking triggers immediate CRM update\n- CRM update triggers Braze synchronisation for marketing\n- Linking status affects customer segmentation and campaigns\n- Timestamps captured for audit trail\n\n**Batch Synchronisation**\n- Daily transaction file generation after settlement\n- Points balance refresh on app launch (cached for session)\n- Failed sync operations queued for retry\n- Manual reconciliation tools for edge cases\n\n**Data Freshness Requirements**\n- Linking status: Real-time (within 5 seconds)\n- Points balance: On-demand with 5-minute cache\n- Transaction history: 24-hour batch window acceptable\n- Marketing segments: Near real-time (within 1 minute)\n\n### POS Integration Architecture\n\n**Current State: Reddy Express**\n- Basic barcode pattern matching\n- No integration with OTR loyalty systems\n- No mobile app support\n- Limited to Flybuys physical card scanning\n\n**Target State: Unified System**\n- POS recognises OTR app barcodes (already implemented)\n- POS integrates with Coupon Scanner and Loyalty Service\n- Real-time eligibility checking during transaction\n- Support for both OTR and linked Flybuys accounts\n- Transaction data captured for batch processing\n\n**Integration Points**\n- POS → Coupon Scanner: Barcode validation\n- Coupon Scanner → Loyalty Service: Account resolution\n- Loyalty Service → CRM: Guest profile lookup\n- Loyalty Service → Loyalty Engine: Eligibility checking\n- POS → Receipt Printer: Points earned messaging\n\n## Non-Functional Requirements\n\n### Performance Requirements\n- API response time: <2 seconds for 95th percentile\n- Points balance retrieval: <500ms target\n- Linking flow completion: <10 seconds total\n- Batch file generation: Complete within 2-hour window\n- POS transaction delay: <1 second additional processing\n\n### Scalability Requirements\n- Support 100,000+ linked accounts at launch\n- Handle 10,000+ transactions per day across all channels\n- Scale to 500,000+ accounts over 5 years\n- Accommodate seasonal traffic spikes (3x normal volume)\n\n### Availability Requirements\n- Mobile app functionality: 99.5% uptime\n- POS integration: 99.9% uptime (critical path)\n- Batch processing: 99% completion rate\n- Graceful degradation for non-critical features\n\n### Security Requirements\n- OAuth tokens encrypted at rest\n- All API communication over TLS 1.2+\n- PII data stored in Australian data centres\n- Audit logging for all account modifications\n- Role-based access control for admin functions\n\n### Monitoring & Alerting\n- Track REDUSE metrics (Reliability, Errors, Duration, Utilisation, Saturation, Events)\n- Application Performance Monitoring (APM) integration\n- Business metrics dashboards (linking rate, points earned, API failures)\n- Customer service query volume and resolution time\n- Real-time alerting for critical failures\n\n## Key Design Patterns & Principles\n\n### Architectural Patterns\n\n**Backend-for-Frontend (BFF)**\n- Client-specific facades tailor data aggregation for mobile apps\n- OTR App BFF and SPS App BFF share common backend services\n- Reduces client complexity and improves performance through batching\n- Enables independent evolution of mobile and backend systems\n\n**Circuit Breaker**\n- Protects against cascading failures from Flybuys API\n- Automatically opens circuit after failure threshold\n- Provides fallback behaviour during outages\n- Gradually tests service recovery via half-open state\n\n**Retry with Exponential Backoff**\n- Handles transient failures gracefully\n- Reduces load on struggling services\n- Provides time for service recovery\n- Alerts after retry exhaustion for manual intervention\n\n**API Gateway Pattern**\n- Centralised entry point for all API requests\n- Handles authentication, rate limiting, logging\n- Routes requests to appropriate backend services\n- Enables API versioning and traffic management\n\n### Design Principles for Digital Consumer Applications\n\n**User Experience Patterns**\n- Progressive enhancement for features\n- Offline-first considerations for mobile\n- Real-time feedback for user actions\n- Push notification architecture for engagement\n\n**Performance Patterns**\n- Content delivery optimisation\n- Response caching strategies\n- API response pagination for large datasets\n- Database query optimisation\n\n**Security & Privacy**\n- OAuth2/JWT authentication\n- Privacy regulation compliance (GDPR, Australian Privacy Act)\n- Secure session management\n- Content security policies\n\n**Scalability Patterns**\n- Auto-scaling strategies for traffic variation\n- Database sharding for large customer bases\n- Load balancing for high-availability\n- Circuit breaker for external service failures\n\n**Analytics & Monitoring**\n- Event tracking architecture for user behaviour\n- Error logging and monitoring systems\n- Performance monitoring and alerting\n- A/B testing infrastructure for feature validation\n\n## Terminology & Language Standards\n\n### Standardised Terminology\n\nThe project established vendor-neutral language:\n\n**\"Reward Grants\" (not \"Points\")**\n- Refers to any positive outcome from loyalty system\n- Vendor-agnostic term enabling platform changes\n- Includes points, discounts, offers, or other benefits\n\n**\"Guest\" (not \"Customer\" or \"Member\")**\n- Standardised term for end users across all documentation\n- Reflects hospitality industry heritage\n- Consistent with existing OTR terminology\n\n**\"System of Record\" (not \"Mastered in\")**\n- Clear ownership designation for data\n- Widely understood in enterprise architecture\n- Alternative: \"Authoritative Source\"\n\n**Service Abstraction**\n- \"Loyalty Rules Engine\" instead of \"Eagle Eye\"\n- \"CIAM Platform\" instead of \"Azure AD\"\n- \"CRM System\" instead of \"Salesforce\"\n- \"Customer Engagement Platform\" instead of \"Braze\"\n- \"Point of Sale System\" instead of \"Dynamics 365 Commerce\"\n- \"API Gateway\" instead of \"Azure API Management\"\n\n### Correct Technical Terms\n\n**\"Link\" (not \"Connect\" or \"Integrate\")**\n- OAuth process of connecting two accounts\n- Creates bidirectional relationship\n- Enables data sharing with user consent\n\n**\"Grant\" (not \"Award\" or \"Assign\")**\n- Technical term for issuing rewards to customers\n- Implies authorisation and allocation\n- Standard in loyalty systems terminology\n\n**\"Adjudicate\" (not \"Process\" or \"Calculate\")**\n- Determining transaction eligibility for rewards\n- Applying business rules and logic\n- Making determination on reward grants\n\n## Open Questions & Future Considerations\n\n### Unresolved Technical Questions\n\n1. **Token Storage Strategy**: Finalise Azure Key Vault vs Azure Cosmos DB approach for storing OAuth tokens at scale\n\n2. **Real-time vs Batch**: Determine optimal balance between real-time synchronisation cost and batch processing efficiency\n\n3. **Error Recovery**: Define detailed procedures for failed linking attempts and partial sync states\n\n4. **Mobile App Rollout**: Determine phased rollout strategy vs big-bang release for account linking feature\n\n5. **Legacy Data Migration**: Define approach for migrating existing REXP Flybuys data to new system\n\n### Future Enhancements\n\n**Phase 2 Functionality** (Post-Launch)\n- Redemption of OTR and Flybuys rewards through app\n- Basket-level adjudication for complex offers\n- Real-time campaign management and personalisation\n- Advanced reporting and analytics\n\n**Integration Expansion**\n- Shell Card account linking\n- Additional third-party loyalty programmes\n- Expanded redemption options (coffee, car wash, Subway)\n- Fuel discount integration\n\n**Platform Consolidation**\n- Full migration of OTR App internal loyalty to unified platform\n- Site conversion completion over 5-year horizon\n- Retirement of legacy REXP systems\n- Single customer view across all touchpoints\n\n### Risks & Mitigations\n\n**Risk: Flybuys API Availability**\n- Mitigation: Circuit breaker pattern, graceful degradation, cached data\n\n**Risk: Token Storage Security**\n- Mitigation: Azure Key Vault, encryption at rest, audit logging\n\n**Risk: POS Integration Complexity**\n- Mitigation: Phased rollout, comprehensive testing, fallback procedures\n\n**Risk: Customer Confusion During Transition**\n- Mitigation: Clear communication, in-app education, customer service training\n\n**Risk: Data Synchronisation Failures**\n- Mitigation: Retry logic, manual reconciliation tools, alerting\n\n**Risk: Performance Under Load**\n- Mitigation: Load testing, auto-scaling, performance monitoring\n\n## Project Governance & Delivery\n\n### Stakeholder Alignment\n\nThe project maintains alignment through:\n- Regular design authority reviews\n- Business requirements sign-off\n- Technical architecture reviews\n- Cross-functional working groups\n\n### Delivery Approach\n\n**Requirements Phase** (Complete)\n- Business requirements documentation\n- Use case development\n- Architectural principles established\n- WBS development\n\n**Design Phase** (Current)\n- High-level design documentation\n- Detailed technical specifications\n- Integration design and API contracts\n- Security and compliance review\n\n**Development Phase** (Upcoming)\n- Mobile app development (OTR and SPS)\n- Backend service implementation\n- POS integration work\n- Testing and quality assurance\n\n**Launch Phase** (November 2025)\n- Phased rollout strategy\n- Customer communication\n- Customer service training\n- Monitoring and support\n\n### Success Criteria\n\n**Business Metrics**\n- Linking rate: % of app users who link Flybuys\n- Engagement increase: Transaction frequency and value\n- Customer satisfaction: NPS score improvement\n- Operational efficiency: Reduction in support queries\n\n**Technical Metrics**\n- API performance: Response times within SLA\n- System availability: Uptime targets achieved\n- Error rates: Linking success rate >95%\n- Data accuracy: Synchronisation consistency >99.9%\n\n## Conclusion\n\nThe Flybuys Integration project represents a strategic modernisation of OTR Group's loyalty capabilities, moving from fragmented, site-specific implementations to a unified, scalable, and partner-agnostic architecture. By establishing clear architectural principles, comprehensive requirements, and thoughtful design patterns, the project positions OTR Group for long-term growth in digital loyalty while maintaining flexibility to adapt to future partnership and technology changes.\n\nThe three-phase architectural approach (Transition, Linking, and Grants) provides a clear roadmap from current state to target state, while the emphasis on vendor-neutral terminology and service abstraction ensures the architecture remains resilient to platform changes. With November 2025 launch targeting core mobile linking functionality and Q1 2026 expanding to full POS integration, the project delivers immediate customer value while laying groundwork for future enhancements.\n\nSuccess depends on maintaining architectural discipline, ensuring robust error handling and monitoring, and keeping customer experience at the centre of all design decisions. The comprehensive WBS, detailed use cases, and clear governance structure position the project for successful delivery and sustainable long-term operation.","pastedContents":{},"timestamp":1764109331658,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"There's a lot there, can we step through the feedback one-by-one","pastedContents":{},"timestamp":1764109573098,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"That's changing the initiative file right?","pastedContents":{},"timestamp":1764109642666,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"I think you're right, the initiative should call out the staged approach","pastedContents":{},"timestamp":1764109675773,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Yeah looks good","pastedContents":{},"timestamp":1764109739686,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"1 & 3","pastedContents":{},"timestamp":1764109868505,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Why wouldn't it be in the domain, explain as a DDD concept","pastedContents":{},"timestamp":1764109959654,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Yes","pastedContents":{},"timestamp":1764110649790,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"align the BC","pastedContents":{},"timestamp":1764111043073,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"lfg","pastedContents":{},"timestamp":1764111118580,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"The Flybuys API is stable and published, we should conform to i, but I also want to keep that relationship as generic as possible","pastedContents":{},"timestamp":1764111191568,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"yeah","pastedContents":{},"timestamp":1764111243513,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"It's a legacy way of handling scanned barcodes at pos in REXP stores, it's a single serving solution and doesn't really have an architectural solution. We do need to be able to provide a service to the POS via D365 to scan a barcode and determine the guest's identity. Model this for the ideal future state, maybe using a DDD pattern to \"strangle\" it and refactor it into the loyalty service","pastedContents":{},"timestamp":1764111600356,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Yes","pastedContents":{},"timestamp":1764112118494,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"Yes please","pastedContents":{},"timestamp":1764113046127,"project":"/home/oliy/work/architecture","sessionId":"f2280f57-e2a5-4af3-a729-d5e36adbc56c"}
{"display":"lets keep going\n","pastedContents":{},"timestamp":1764113179023,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"I posted a narrative document before and we were working on comparing that to the existing model","pastedContents":{},"timestamp":1764113210956,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"This one # Flybuys Integration Project: Complete Narrative\n\n## Executive Summary\n\nThe Flybuys Integration project unifies loyalty functionality across OTR and Reddy Express (REXP) stores with the OTR and SPS mobile applications. Currently, Flybuys operates only in Reddy Express stores with no mobile app integration, creating fragmented rewards tracking. The target state enables customers to link Flybuys accounts to both applications and earn points consistently across all channels, with the SPS app servicing REXP stores.\n\n## Project Context & Strategic Background\n\n### Business Challenge\n\nThe OTR Group operates across two distinct brands—OTR and Reddy Express—with separate customer bases and loyalty expectations. Flybuys points serve as a key driver for much of the existing Reddy Express customer base, but the current implementation has significant limitations:\n\n- Flybuys operates only in Reddy Express stores with basic barcode pattern matching\n- No account linking capability exists between OTR systems and Flybuys\n- No mobile app integration creates fragmented rewards tracking\n- Customers cannot access their Flybuys data through OTR digital channels\n- The system cannot support sophisticated reward campaigns or personalisation\n\n### Strategic Principles\n\nThe project follows several core architectural and business principles:\n\n1. **Client Agnosticism**: The loyalty architecture must serve both web and mobile applications without client-specific backends, enabling faster feature delivery, reduced maintenance costs, and consistent user experiences across platforms.\n\n2. **Partner Agnosticism**: The Loyalty System should be flexible enough to integrate with any third-party loyalty partner, not just Flybuys. This future-proofs the architecture as the business evolves.\n\n3. **Service Abstraction**: All vendor-specific platforms (CRM systems, loyalty engines, identity providers) should be abstracted behind generic service layers to enable platform changes without architectural rework.\n\n4. **Rewards as Universal Concept**: \"Rewards\" is the catch-all term for any positive outcome to a Guest from the Loyalty system, replacing vendor-specific terminology like \"points\" or \"grants.\"\n\n5. **System of Record Clarity**: The CRM platform is the authoritative source for all OTR Group Guest profiles and linking data, while the Loyalty Engine handles transaction processing and reward calculations.\n\n### Long-term Vision\n\nThe design supports consolidating to the OTR app as the primary digital loyalty platform as sites convert over five years. The architecture prioritises consistency and simplicity to maximise adoption and reduce implementation complexity, while establishing a platform for future reliable growth and capabilities comparable to enterprise loyalty solutions like Eagle Eye AIR (an AI-driven loyalty and personalisation platform that enables real-time personalised offers and campaigns).\n\n## Architectural Foundation\n\n### Core Architecture Statements\n\nThe project is guided by a comprehensive set of architectural principles established early in requirements gathering:\n\n**Loyalty System Ownership & Scope**\n- The Loyalty System should master all OTR Group loyalty data and programmes\n- All transactions will be adjudicated for rewards within the Loyalty System\n- Existing loyalty programmes will be migrated into the Loyalty System over time\n- Future reward types (coffee redemption, car wash, Subway, fuel discounts) will migrate to the Loyalty System\n\n**Third-Party Partner Model**\n- Flybuys is positioned as a third-party partner to the OTR Group Loyalty strategy, not the primary system\n- Flybuys provides a user database and distributes reward grants on OTR's behalf\n- OTR retains responsibility for all future loyalty programmes\n\n**Technical Architecture Principles**\n- The Loyalty System should be a flexible microservice with loose coupling to other services\n- Design should be contract-first with proper HTTP methods\n- System should follow the principle of least astonishment—matching user expectations and mental models\n- Track REDUSE metrics (a standard architectural quality measure)\n- People are part of the system; design should match user experience and mental models\n\n**Integration Points**\n- Mobile apps should use the Loyalty System to link third-party accounts, calculate/adjudicate rewards, and grant rewards\n- Mobile apps should retain reward preferences in the Loyalty System\n- POS systems should recognise OTR barcodes and reconcile them to OTR Loyalty accounts\n- POS should recognise Flybuys barcodes if linked to an OTR account\n- The Loyalty System should resolve OTR accounts and any linked third-party partner accounts\n- The system should keep third-party data fresh through synchronisation\n\n**Data Management & Integration**\n- CRM is the system of record for customer data\n- The Loyalty System maintains loose coupling with the CRM platform\n- The Loyalty System should handle OAuth integration for third-party account linking\n\n### Service Architecture Pattern\n\nThe project employs a **facade pattern** (also called Backend-for-Frontend or BFF) to create simplified interfaces hiding the complexity of multiple underlying services. This approach:\n\n- Provides a single entry point for clients (mobile apps)\n- Coordinates calls to various microservices (CRM, Loyalty Engine, third-party APIs)\n- Handles cross-cutting concerns (authentication, rate limiting, logging)\n- Reduces client coupling to internal service boundaries\n- Enables better fault isolation and API evolution\n\nThe microservice layer follows clear naming conventions aligned with domain responsibilities:\n- **Customer Service** (or Customer Registry Service): Manages all customer records mastered in CRM\n- **Loyalty Service**: Handles loyalty transactions, calculations, and reward grants\n- **Engagement Service**: Manages customer communications and marketing\n\n### Technology & Platform Decisions\n\n**Identity & Access Management**\n- OAuth 2.0 with PKCE (RFC 7636) for third-party account linking\n- PKCE (Proof Key for Code Exchange) provides security for public clients like mobile apps\n- Flybuys leverages Auth0 as their identity platform for member authentication\n- Azure CIAM (Customer Identity and Access Management) for OTR Group identity\n- Token storage requires Azure Key Vault or similar secure storage (Azure CIAM doesn't natively store third-party tokens)\n\n**Integration Platforms**\n- CRM System (abstracted, currently Salesforce)\n- Loyalty Rules Engine (abstracted, currently Eagle Eye)\n- Customer Engagement Platform (abstracted, currently Braze)\n- Point of Sale System (Dynamics 365 Commerce)\n- API Gateway (Azure API Management)\n- Identity Provider (Azure AD/CIAM)\n\n**Data Residency & Compliance**\n- All OAuth tokens and customer PII must be stored in Australian data centres\n- Privacy considerations under GDPR and Australian Privacy Act requirements\n- Audit logging requirements for compliance and customer service\n\n## Functional Requirements\n\n### Core Use Cases\n\nThe project developed eight primary use cases with detailed descriptions:\n\n**UC-001: Link Flybuys Account (App)**\n- Guest initiates linking from OTR or SPS mobile app\n- System redirects to Flybuys OAuth login (PKCE flow)\n- Guest authenticates with Flybuys credentials\n- Guest approves consent for data sharing\n- System creates bidirectional link between accounts\n- System synchronises initial data (member number, points balance)\n- Guest sees confirmation with linked status\n\n**UC-002: Unlink Flybuys Account (App)**\n- Guest initiates unlinking from app settings\n- System presents confirmation dialogue\n- Guest confirms unlinking action\n- System removes bidirectional link\n- System notifies CRM and Braze of status change\n- Guest returns to unlinked state\n\n**UC-003: View Flybuys Points Balance (App)**\n- Guest views their profile/loyalty section\n- System retrieves current Flybuys points balance via API\n- System displays balance with last updated timestamp\n- System handles graceful degradation if Flybuys API unavailable\n\n**UC-004: Earn Flybuys Points (In-Store with App)**\n- Guest presents OTR app barcode at POS\n- POS scans barcode and retrieves Guest profile\n- System checks for linked Flybuys account\n- Transaction processes normally\n- System calculates eligible Flybuys points based on rules\n- System queues points for batch processing\n- Guest receives receipt with points earned indication\n\n**UC-005: Select Reward Preference (App)**\n- Guest views available reward options (Flybuys points vs SPS fuel discount)\n- Guest selects preferred reward type\n- System validates selection against eligibility rules\n- System persists preference to Loyalty Service\n- Guest sees confirmation of new preference\n\n**UC-006: Switch Reward Preference (App)**\n- Guest changes reward selection\n- System shows impact of switching (e.g., points vs discount)\n- Guest confirms preference change\n- System updates preference in real-time\n- Next transaction uses new preference\n\n**UC-007: Daily Points File Generation**\n- System identifies all Flybuys transactions from previous day\n- System classifies transactions (base points vs bonus points)\n- System generates formatted file per Flybuys specifications\n- System transmits file to Flybuys via secure channel\n- System logs transmission for audit trail\n\n**UC-008: Customer Service Inquiry**\n- Guest care agent accesses customer profile\n- System displays transaction history with Flybuys attribution\n- Agent can view points earned, pending points, and linking status\n- Agent can view timestamps for linking/unlinking events\n- System provides sufficient data for resolving common queries\n\n### Error Handling & Alternative Flows\n\nEach use case includes comprehensive error scenarios:\n\n- **Flybuys account already linked** to another OTR account\n- **Network/API failures** during linking process\n- **Invalid Flybuys credentials** or authentication failures\n- **Expired tokens** during session\n- **Failed payment recovery** with points preservation\n- **Flybuys API unavailable** with graceful degradation\n- **Data synchronisation failures** with retry logic\n- **Circuit breaker activation** for downstream service protection\n\n### Eligibility Rules & Business Logic\n\n**Transaction Eligibility**\n- Points calculation applies product exclusions (tobacco, gift cards, etc.)\n- Fuel transactions capped at specific litre limits\n- Payment method affects eligibility (Shell Card vs other methods)\n- Site type determines available rewards (OTR vs REXP)\n- Guest preference respected (Flybuys points vs SPS fuel discount)\n\n**Cross-Channel Consistency**\n- Same eligibility rules apply across OTR App, SPS App, OTR In-Store, and REXP In-Store\n- Daily points file includes transactions from all channels\n- Points classification tracked at transaction level (base vs bonus)\n\n## Work Breakdown Structure (WBS)\n\nThe project developed a comprehensive 135+ item WBS organised into major workstreams:\n\n### Phase 1: Foundation (WBS-1 to WBS-30)\n- Requirements gathering and analysis\n- Architectural design and documentation\n- Stakeholder alignment and approval\n- Technical design authority reviews\n\n### Phase 2: Core Integration (WBS-31 to WBS-70)\n- OAuth 2.0 PKCE implementation\n- CRM integration for account linking\n- Loyalty Service API development\n- Flybuys API integration\n- Token management and secure storage\n\n### Phase 3: Mobile Experience (WBS-71 to WBS-90)\n- OTR App linking/unlinking flows\n- SPS App linking/unlinking flows\n- Points balance display\n- Reward preference selection UI\n- Error handling and user feedback\n\n### Phase 4: In-Store Integration (WBS-91 to WBS-110)\n- POS barcode scanning integration\n- Coupon Scanner integration with Loyalty Service\n- Transaction adjudication logic\n- Real-time eligibility checking\n- Receipt printing modifications\n\n### Phase 5: Batch Processing (WBS-111 to WBS-125)\n- Daily transaction identification\n- Points classification logic\n- File generation per Flybuys spec\n- Secure file transmission\n- Audit logging and reconciliation\n\n### Phase 6: Platform Synchronisation (WBS-126 to WBS-135)\n- Real-time sync with CRM\n- Real-time sync with Braze\n- Data consistency monitoring\n- Failed sync recovery processes\n\n### Notable WBS Refinements\n\nDuring WBS review, 23 items were updated to use consistent terminology, replacing \"points\" with \"Reward Grants\" to align with architectural principles of vendor-neutral language.\n\n## Scope Management\n\n### In Scope\n\n**Mobile App Functionality**\n- OTR App users adding existing Flybuys barcodes to profiles\n- OTR App users adding temporary Flybuys barcodes\n- SPS App equivalent functionality for REXP customers\n- Mapping app barcodes to Flybuys accounts in Loyalty Service\n- Guest reward preference selection in both OTR and SPS apps\n- Reward preference selection in Flybuys App (via Flybuys platform)\n\n**In-Store Functionality**\n- Guests presenting app barcodes and earning Flybuys points at POS\n- OTR POS integration with Coupon Scanner and Loyalty Service\n- Transaction-level capture of Flybuys membership status\n\n**Backend Integration**\n- OAuth 2.0 integration with Flybuys (via Auth0)\n- Real-time synchronisation with CRM and Braze\n- Daily points file generation and transmission\n- Transaction classification and batch processing\n\n### Out of Scope\n\n**Explicitly Excluded**\n- Any backend rebuild, replatforming, or replacement of OTR Mobile backend\n- Migrating OTR App's internal loyalty functionality to new platform (future phase)\n- OTR App users linking Shell Card accounts (separate initiative)\n- OTR POS recognising OTR App barcodes (already exists)\n- Any redemption of OTR or Flybuys rewards\n- Basket adjudication logic\n- Data exports to/imports from Flybuys (handled via daily file only)\n- Reporting requirements (future phase)\n- Managing Flybuys campaigns or offers (Flybuys responsibility)\n- OTR POS scanning Flybuys physical cards (REXP only)\n\n### Timeline Considerations\n\n- **November 2025 Release**: Core linking functionality in mobile apps\n- **Q1 2026**: OTR POS upgrades to support Flybuys barcode scanning\n\n## High-Level Design Approach\n\n### Three-Phase Architecture\n\nThe architectural approach recognises three distinct but related design concerns:\n\n**1. Transition Architecture**\n- Moving from the legacy REXP barcode-only system to integrated loyalty\n- Maintaining backward compatibility during migration\n- Gradual rollout across sites as they convert brands\n- Data migration and reconciliation strategies\n\n**2. Linking Architecture**\n- OAuth 2.0 PKCE flow for secure account connection\n- Token management and secure storage patterns\n- Bidirectional linking between OTR and Flybuys systems\n- Real-time synchronisation with CRM and engagement platforms\n- Graceful handling of linking failures and edge cases\n\n**3. Grants Architecture** (renamed from \"Points Architecture\")\n- Transaction adjudication and eligibility rule engine\n- Reward calculation based on purchase data\n- Batch processing for daily file generation\n- Classification of reward types (base vs bonus)\n- Audit trail and reconciliation capabilities\n\n### Design Principles for High-Level Design\n\nThe HLD follows specific goals:\n\n**Primary Goals**\n- Communicate solution architecture without code-level details\n- Enable stakeholder decision-making and risk identification\n- Bridge business and technical teams with shared understanding\n- Guide detailed design and implementation work\n\n**Key Audiences**\n- Technical architects (validate approach)\n- Engineering teams (understand what to build)\n- Product/business stakeholders (understand what they're getting)\n- Operations teams (understand deployment and support)\n\n**Content Approach**\n- System context and scope\n- Major components and responsibilities\n- Integration points between systems\n- Data flows and sequences\n- Key architectural decisions with rationale\n- Non-functional requirements\n- Deployment approach\n- Risks and mitigations\n\n**What HLD is NOT**\n- Not a requirements document (that's the BRD)\n- Not implementation instructions (that's LLD)\n- Not detailed API specifications\n\n### Key Architectural Decisions\n\n**Decision 1: System of Record Designation**\n- CRM designated as system of record for all OTR Group Guest profiles, contact data, and linking status\n- Loyalty Engine maintains transaction data and reward calculations\n- Clear data ownership prevents conflicts and enables proper synchronisation\n\n**Decision 2: Idempotency Approach**\n- All linking operations use unique request identifiers\n- Duplicate requests within 60 seconds return existing result without reprocessing\n- Prevents double-linking and ensures consistency\n\n**Decision 3: Circuit Breaker Configuration**\n- Flybuys API protected with circuit breaker pattern\n- Threshold: 50% failure rate over 10 requests in 60 seconds\n- Circuit opens for 30 seconds before attempting half-open state\n- Protects system from cascading failures\n\n**Decision 4: Retry Policy**\n- Failed synchronisation operations retry with exponential backoff\n- Timing: 1 second, 5 seconds, 15 seconds\n- Maximum 3 attempts before alerting administrators\n- Guest-facing operations succeed regardless of sync status\n\n**Decision 5: Error Handling Strategy**\n- Graceful degradation for non-critical features (points balance display)\n- Fail-fast approach for critical operations (linking/unlinking)\n- Maintains data consistency while maximising availability\n\n**Decision 6: API Versioning**\n- Backend-for-Frontend facade versions independently from downstream services\n- Allows mobile apps to remain stable during backend changes\n- Decouples client evolution from service evolution\n\n**Decision 7: Monitoring Thresholds**\n- Alert on: >5% linking failure rate, >10 second response times, token storage failures, >3 consecutive sync failures\n- Log only: individual request failures, cache misses, token refreshes\n- Balances operational awareness with alert fatigue\n\n## Technical Deep Dives\n\n### OAuth 2.0 PKCE Implementation\n\n**Flow Sequence**\n1. Partner app (member logged in) redirects to Flybuys login via `/authorise` endpoint\n2. Required parameters: `response_type`, `client_id`, `code_challenge_method`, `code_challenge`, `redirect_uri`, `state`, `scope`, `audience`\n3. Member authenticates with Flybuys credentials\n4. Member presented with consent page to approve linking\n5. Upon approval, systems create backend link and request token via `/oauth/token`\n6. Token parameters: `client_id`, `grant_type`, `code`, `code_verifier`, `redirect_uri`\n7. System receives `access_token` and `refresh_token` for subsequent API calls\n\n**Security Considerations**\n- PKCE prevents authorisation code interception attacks\n- Code verifier proves possession of original code challenge\n- Tokens stored in secure Azure Key Vault\n- Token refresh handled automatically before expiration\n- All communication over HTTPS/TLS\n\n### Data Synchronisation Strategy\n\n**Real-Time Sync Events**\n- Account linking/unlinking triggers immediate CRM update\n- CRM update triggers Braze synchronisation for marketing\n- Linking status affects customer segmentation and campaigns\n- Timestamps captured for audit trail\n\n**Batch Synchronisation**\n- Daily transaction file generation after settlement\n- Points balance refresh on app launch (cached for session)\n- Failed sync operations queued for retry\n- Manual reconciliation tools for edge cases\n\n**Data Freshness Requirements**\n- Linking status: Real-time (within 5 seconds)\n- Points balance: On-demand with 5-minute cache\n- Transaction history: 24-hour batch window acceptable\n- Marketing segments: Near real-time (within 1 minute)\n\n### POS Integration Architecture\n\n**Current State: Reddy Express**\n- Basic barcode pattern matching\n- No integration with OTR loyalty systems\n- No mobile app support\n- Limited to Flybuys physical card scanning\n\n**Target State: Unified System**\n- POS recognises OTR app barcodes (already implemented)\n- POS integrates with Coupon Scanner and Loyalty Service\n- Real-time eligibility checking during transaction\n- Support for both OTR and linked Flybuys accounts\n- Transaction data captured for batch processing\n\n**Integration Points**\n- POS → Coupon Scanner: Barcode validation\n- Coupon Scanner → Loyalty Service: Account resolution\n- Loyalty Service → CRM: Guest profile lookup\n- Loyalty Service → Loyalty Engine: Eligibility checking\n- POS → Receipt Printer: Points earned messaging\n\n## Non-Functional Requirements\n\n### Performance Requirements\n- API response time: <2 seconds for 95th percentile\n- Points balance retrieval: <500ms target\n- Linking flow completion: <10 seconds total\n- Batch file generation: Complete within 2-hour window\n- POS transaction delay: <1 second additional processing\n\n### Scalability Requirements\n- Support 100,000+ linked accounts at launch\n- Handle 10,000+ transactions per day across all channels\n- Scale to 500,000+ accounts over 5 years\n- Accommodate seasonal traffic spikes (3x normal volume)\n\n### Availability Requirements\n- Mobile app functionality: 99.5% uptime\n- POS integration: 99.9% uptime (critical path)\n- Batch processing: 99% completion rate\n- Graceful degradation for non-critical features\n\n### Security Requirements\n- OAuth tokens encrypted at rest\n- All API communication over TLS 1.2+\n- PII data stored in Australian data centres\n- Audit logging for all account modifications\n- Role-based access control for admin functions\n\n### Monitoring & Alerting\n- Track REDUSE metrics (Reliability, Errors, Duration, Utilisation, Saturation, Events)\n- Application Performance Monitoring (APM) integration\n- Business metrics dashboards (linking rate, points earned, API failures)\n- Customer service query volume and resolution time\n- Real-time alerting for critical failures\n\n## Key Design Patterns & Principles\n\n### Architectural Patterns\n\n**Backend-for-Frontend (BFF)**\n- Client-specific facades tailor data aggregation for mobile apps\n- OTR App BFF and SPS App BFF share common backend services\n- Reduces client complexity and improves performance through batching\n- Enables independent evolution of mobile and backend systems\n\n**Circuit Breaker**\n- Protects against cascading failures from Flybuys API\n- Automatically opens circuit after failure threshold\n- Provides fallback behaviour during outages\n- Gradually tests service recovery via half-open state\n\n**Retry with Exponential Backoff**\n- Handles transient failures gracefully\n- Reduces load on struggling services\n- Provides time for service recovery\n- Alerts after retry exhaustion for manual intervention\n\n**API Gateway Pattern**\n- Centralised entry point for all API requests\n- Handles authentication, rate limiting, logging\n- Routes requests to appropriate backend services\n- Enables API versioning and traffic management\n\n### Design Principles for Digital Consumer Applications\n\n**User Experience Patterns**\n- Progressive enhancement for features\n- Offline-first considerations for mobile\n- Real-time feedback for user actions\n- Push notification architecture for engagement\n\n**Performance Patterns**\n- Content delivery optimisation\n- Response caching strategies\n- API response pagination for large datasets\n- Database query optimisation\n\n**Security & Privacy**\n- OAuth2/JWT authentication\n- Privacy regulation compliance (GDPR, Australian Privacy Act)\n- Secure session management\n- Content security policies\n\n**Scalability Patterns**\n- Auto-scaling strategies for traffic variation\n- Database sharding for large customer bases\n- Load balancing for high-availability\n- Circuit breaker for external service failures\n\n**Analytics & Monitoring**\n- Event tracking architecture for user behaviour\n- Error logging and monitoring systems\n- Performance monitoring and alerting\n- A/B testing infrastructure for feature validation\n\n## Terminology & Language Standards\n\n### Standardised Terminology\n\nThe project established vendor-neutral language:\n\n**\"Reward Grants\" (not \"Points\")**\n- Refers to any positive outcome from loyalty system\n- Vendor-agnostic term enabling platform changes\n- Includes points, discounts, offers, or other benefits\n\n**\"Guest\" (not \"Customer\" or \"Member\")**\n- Standardised term for end users across all documentation\n- Reflects hospitality industry heritage\n- Consistent with existing OTR terminology\n\n**\"System of Record\" (not \"Mastered in\")**\n- Clear ownership designation for data\n- Widely understood in enterprise architecture\n- Alternative: \"Authoritative Source\"\n\n**Service Abstraction**\n- \"Loyalty Rules Engine\" instead of \"Eagle Eye\"\n- \"CIAM Platform\" instead of \"Azure AD\"\n- \"CRM System\" instead of \"Salesforce\"\n- \"Customer Engagement Platform\" instead of \"Braze\"\n- \"Point of Sale System\" instead of \"Dynamics 365 Commerce\"\n- \"API Gateway\" instead of \"Azure API Management\"\n\n### Correct Technical Terms\n\n**\"Link\" (not \"Connect\" or \"Integrate\")**\n- OAuth process of connecting two accounts\n- Creates bidirectional relationship\n- Enables data sharing with user consent\n\n**\"Grant\" (not \"Award\" or \"Assign\")**\n- Technical term for issuing rewards to customers\n- Implies authorisation and allocation\n- Standard in loyalty systems terminology\n\n**\"Adjudicate\" (not \"Process\" or \"Calculate\")**\n- Determining transaction eligibility for rewards\n- Applying business rules and logic\n- Making determination on reward grants\n\n## Open Questions & Future Considerations\n\n### Unresolved Technical Questions\n\n1. **Token Storage Strategy**: Finalise Azure Key Vault vs Azure Cosmos DB approach for storing OAuth tokens at scale\n\n2. **Real-time vs Batch**: Determine optimal balance between real-time synchronisation cost and batch processing efficiency\n\n3. **Error Recovery**: Define detailed procedures for failed linking attempts and partial sync states\n\n4. **Mobile App Rollout**: Determine phased rollout strategy vs big-bang release for account linking feature\n\n5. **Legacy Data Migration**: Define approach for migrating existing REXP Flybuys data to new system\n\n### Future Enhancements\n\n**Phase 2 Functionality** (Post-Launch)\n- Redemption of OTR and Flybuys rewards through app\n- Basket-level adjudication for complex offers\n- Real-time campaign management and personalisation\n- Advanced reporting and analytics\n\n**Integration Expansion**\n- Shell Card account linking\n- Additional third-party loyalty programmes\n- Expanded redemption options (coffee, car wash, Subway)\n- Fuel discount integration\n\n**Platform Consolidation**\n- Full migration of OTR App internal loyalty to unified platform\n- Site conversion completion over 5-year horizon\n- Retirement of legacy REXP systems\n- Single customer view across all touchpoints\n\n### Risks & Mitigations\n\n**Risk: Flybuys API Availability**\n- Mitigation: Circuit breaker pattern, graceful degradation, cached data\n\n**Risk: Token Storage Security**\n- Mitigation: Azure Key Vault, encryption at rest, audit logging\n\n**Risk: POS Integration Complexity**\n- Mitigation: Phased rollout, comprehensive testing, fallback procedures\n\n**Risk: Customer Confusion During Transition**\n- Mitigation: Clear communication, in-app education, customer service training\n\n**Risk: Data Synchronisation Failures**\n- Mitigation: Retry logic, manual reconciliation tools, alerting\n\n**Risk: Performance Under Load**\n- Mitigation: Load testing, auto-scaling, performance monitoring\n\n## Project Governance & Delivery\n\n### Stakeholder Alignment\n\nThe project maintains alignment through:\n- Regular design authority reviews\n- Business requirements sign-off\n- Technical architecture reviews\n- Cross-functional working groups\n\n### Delivery Approach\n\n**Requirements Phase** (Complete)\n- Business requirements documentation\n- Use case development\n- Architectural principles established\n- WBS development\n\n**Design Phase** (Current)\n- High-level design documentation\n- Detailed technical specifications\n- Integration design and API contracts\n- Security and compliance review\n\n**Development Phase** (Upcoming)\n- Mobile app development (OTR and SPS)\n- Backend service implementation\n- POS integration work\n- Testing and quality assurance\n\n**Launch Phase** (November 2025)\n- Phased rollout strategy\n- Customer communication\n- Customer service training\n- Monitoring and support\n\n### Success Criteria\n\n**Business Metrics**\n- Linking rate: % of app users who link Flybuys\n- Engagement increase: Transaction frequency and value\n- Customer satisfaction: NPS score improvement\n- Operational efficiency: Reduction in support queries\n\n**Technical Metrics**\n- API performance: Response times within SLA\n- System availability: Uptime targets achieved\n- Error rates: Linking success rate >95%\n- Data accuracy: Synchronisation consistency >99.9%\n\n## Conclusion\n\nThe Flybuys Integration project represents a strategic modernisation of OTR Group's loyalty capabilities, moving from fragmented, site-specific implementations to a unified, scalable, and partner-agnostic architecture. By establishing clear architectural principles, comprehensive requirements, and thoughtful design patterns, the project positions OTR Group for long-term growth in digital loyalty while maintaining flexibility to adapt to future partnership and technology changes.\n\nThe three-phase architectural approach (Transition, Linking, and Grants) provides a clear roadmap from current state to target state, while the emphasis on vendor-neutral terminology and service abstraction ensures the architecture remains resilient to platform changes. With November 2025 launch targeting core mobile linking functionality and Q1 2026 expanding to full POS integration, the project delivers immediate customer value while laying groundwork for future enhancements.\n\nSuccess depends on maintaining architectural discipline, ensuring robust error handling and monitoring, and keeping customer experience at the centre of all design decisions. The comprehensive WBS, detailed use cases, and clear governance structure position the project for successful delivery and sustainable long-term operation.3.","pastedContents":{},"timestamp":1764113284785,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"lets keep it to pure architecture","pastedContents":{},"timestamp":1764113734696,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"Ensure our definition of the Viva Consumer ID is consistent","pastedContents":{},"timestamp":1764114699181,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"Yeah, the CML model is the source of truth","pastedContents":{},"timestamp":1764114839253,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"Lets work on DIGITAL_STRATGY.md - i want to create a first draft that is idiosyncratic to the architecture i'm building but extends on it to be a more strategic document that can be shared with the rest of the business as an example of what it looks like","pastedContents":{},"timestamp":1764196105208,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"make those changes again?","pastedContents":{},"timestamp":1764196524026,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"Rewrite the digital strategy doc, your changes got blown away","pastedContents":{},"timestamp":1764196605890,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"What file path?","pastedContents":{},"timestamp":1764196657999,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"I'm seeing an old one only 95 lines long :|","pastedContents":{},"timestamp":1764196851410,"project":"/home/oliy/work/architecture","sessionId":"76bb7848-eab9-4870-9869-b8968fb11132"}
{"display":"/agents ","pastedContents":{},"timestamp":1764197508031,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"/agents ","pastedContents":{},"timestamp":1764197508032,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"/agents ","pastedContents":{},"timestamp":1764197508032,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"As a digital strategy author, help me compile a draft of our digital strategy for 2026","pastedContents":{},"timestamp":1764197552918,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Convert the header block to a table","pastedContents":{},"timestamp":1764199171019,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Remove the hard mentions of impacts, only verifiable facts and strategy, not defined goals yet","pastedContents":{},"timestamp":1764199247657,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"The \"Head of Digital Technology\" is \"Head of IT Retail Business Solutions\", their name is Chris Iona","pastedContents":{},"timestamp":1764199703073,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"The \"Engineering Manager\" is \"Mobile Application and Ecommerce Lead\" and their name is Amin Jodeyri","pastedContents":{},"timestamp":1764199750028,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"The \"Principal Domain Architect\" is \"Domain Architect - Digital and Loyalty\" - their name is Oli Young","pastedContents":{},"timestamp":1764199808399,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Lets defocus the DDD a little from the document, and expand the definition of the domain arhitect to be more generic","pastedContents":{},"timestamp":1764199864411,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Add this logic about Shell Card Drivers and Flybuys grants into the flybuys intergration initiative --  - YES points earned on base rates = 1pt per $2\n - NO points earned on grants for docket deals (8PPL or 4CPL)\n - YES points earned on other ad hoc flybuys bonus points campaigns....eg) get X2 bonus points when you fill up every week for 4 weeks. We haven't run these recently but used to in 2024 and should build a system that can again ","pastedContents":{},"timestamp":1764214897135,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Convert the sequence diagrams to mermaid ","pastedContents":{},"timestamp":1764215208327,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"lets ensure that the loyalty domain is aware of the two step process, we need to validate/adjudicate the basket before payment capture, and again after (Validation/Redemption) and the loyalty service needs to be aware of the payment method being used","pastedContents":{},"timestamp":1764218135741,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"lets make that generic, we might introduce other payment types that will interact with the loyalty service","pastedContents":{},"timestamp":1764219346686,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Update the Ubiquitous Language with what we've added if applicab;e","pastedContents":{},"timestamp":1764220579577,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"ensure australian english","pastedContents":{},"timestamp":1764220764003,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"do we cover burn and grant in the UL?","pastedContents":{},"timestamp":1764221391200,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"lets stick with industry standards, but yes","pastedContents":{},"timestamp":1764221462327,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Thinking about the personaliation intiative, note somethwere that we need to consider how we train the models, and that there will need to be a discussion about building it in house or outsourcing, and lets expand that ","pastedContents":{},"timestamp":1764279624423,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":" Too far, we don't have the ML skills in house. lets pair it back to only outsourcing it to Azure and AWS, but hold mention for Brazes' solution","pastedContents":{},"timestamp":1764280015644,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"\"Can customer data leave Australia?\" no","pastedContents":{},"timestamp":1764280219266,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"add loyalty support to location BC","pastedContents":{},"timestamp":1764291369808,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Location BC should also manage \"what loyalty programme is available at this location\"","pastedContents":{},"timestamp":1764291518766,"project":"/home/oliy/work/architecture","sessionId":"095c7e64-39c3-4d29-aac9-a06a1c41eaf5"}
{"display":"Im going to tell you a narrative of things i learnt in the last few days, i want you to ask more questions, refer to the architecture in this folder and include it in the future plans","pastedContents":{},"timestamp":1764462472916,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"We have an admin portal, it's not salesforce because their legacies are different. The home grown portal came from the app team at OTR, Salesforce comes from Viva. The admin portal contains our best picture of our OTR App users, it has a richer profile about our customers and has value in the loyalty and engagment service. Salesforce is the system of record for the group, and defines the Viva COnsumer ID (VCI)","pastedContents":{},"timestamp":1764462587524,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"they operate independently, neither of them know of each other's existence","pastedContents":{},"timestamp":1764462638614,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"It isn't. There is no VCI in the admin portal","pastedContents":{},"timestamp":1764462667240,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Yes, it does, but I think it's keyed by email address","pastedContents":{},"timestamp":1764462697543,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"My plan is to introduce the VCI to the app ecosystem, that'll happen in the flybuys initiative","pastedContents":{},"timestamp":1764462758860,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I'll start routing a lot of consumer engagement through salesforce, and key all of the external profiles with the VCI - eagle eye already does, braze will need to","pastedContents":{},"timestamp":1764462828835,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"DOn't know, that's a later problem. Todays problem is, in the future we need to make refunds much quicker. The current turn around is 15 days, this needs to be IMMEDIATE for the right customer. We will determine the appropriate response based on the customer's risk, loyalty and fraud profile","pastedContents":{},"timestamp":1764462955285,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"They could be anything, the reason for the refund should form a factor in the refund process, i want to focus on the user's profile. The 15 day delay is a product of failing internal systems, poor workflows, poor communication between business units","pastedContents":{},"timestamp":1764463038527,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Lets assume that most of the attributes exist or can be derived, but the first step to \"instant refunds\" is ensuring we have a solidfied, centralised and singular picture of each customer. This also benefits other initiatives like braze segmentation","pastedContents":{},"timestamp":1764463126038,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I think there should be an abstraction to Salesforce, maybe a ProfileService?","pastedContents":{},"timestamp":1764463200368,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"We already have the bones for a profile service in the OTR App database","pastedContents":{},"timestamp":1764463244404,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I believe its the source of data for the admin portal","pastedContents":{},"timestamp":1764463283790,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"The OTR App Database (db) is easier to manage and manipulate, and is under our team's control, I think it becomes the ProfileService, and connects to SF with the VCI","pastedContents":{},"timestamp":1764463412706,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Second option, and i imagine the ProfileService will be much more volatile than Salesforce","pastedContents":{},"timestamp":1764463457438,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I think so, i think that's a good dataset for the user profile","pastedContents":{},"timestamp":1764463779308,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Yeah, i think it's more appropriate for Partner Link to live on the ProfileService","pastedContents":{},"timestamp":1764463830889,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I don't think event sourcing is appropriate here","pastedContents":{},"timestamp":1764463908005,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Yes it should","pastedContents":{},"timestamp":1764463960418,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"I think that capability is beyond our scope, I think it'll be a triggered request to another business unit, but what i want is to be able to provide them with a scored and evaluated profile ","pastedContents":{},"timestamp":1764464086296,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"It should provide its own, but also expose the factors in the evaluation for another unit to retrieve and judge for themselves","pastedContents":{},"timestamp":1764464140155,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"All of those are good, expand it to other common factors, this is an ideal state architecture and if there are other good attributes we can build a plan to retreive those too. Loyalty tier should come from LoyaltyService.","pastedContents":{},"timestamp":1764464216515,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"This looks great, those other systems are outside of our domain, but leaving ourselves the opportunity to build our own fraud detection is important","pastedContents":{},"timestamp":1764464327102,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"this profile service also should interact with the engagmeent service, i thnkk","pastedContents":{},"timestamp":1764464408267,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Its bidriectional, but each should maintain their system of record status","pastedContents":{},"timestamp":1764464721360,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Notification preference is an ES responsibility","pastedContents":{},"timestamp":1764464747483,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Cached & Summarised both ways, it's not real time, it can have some latency","pastedContents":{},"timestamp":1764464793921,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Hybrid, i want to maintain a strong event based architecture, but with rational choices about batching and syncing","pastedContents":{},"timestamp":1764464877954,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"It does","pastedContents":{},"timestamp":1764464948095,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"Lets start incorporating this","pastedContents":{},"timestamp":1764465050009,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"What is missing from the Profile Domain that would be normally expected","pastedContents":{},"timestamp":1764560909452,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Lets go through those one by one","pastedContents":{},"timestamp":1764560979847,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"That's covered by the engagement domain","pastedContents":{},"timestamp":1764561060684,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Store preference feels like a Profile responsibility?","pastedContents":{},"timestamp":1764561179921,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"I agree, demo data is global and belongs on the system of record, language preference belongs on the profile or engagement service","pastedContents":{},"timestamp":1764561271764,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"lets leave it on the proifle","pastedContents":{},"timestamp":1764561421782,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"They're all eventually profile responsibilities","pastedContents":{},"timestamp":1764561610779,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"It's all braze","pastedContents":{},"timestamp":1764561657517,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Not applicable yet","pastedContents":{},"timestamp":1764561753450,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"That's all EE/LS","pastedContents":{},"timestamp":1764561788164,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Social logins are handled by CIAM","pastedContents":{},"timestamp":1764562048090,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"They're canonical, staff member should be a flag on profile, VIP status is membership","pastedContents":{},"timestamp":1764562122672,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"That's application layer","pastedContents":{},"timestamp":1764562675364,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Yes please","pastedContents":{},"timestamp":1764562737862,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Can you produce a typescript version of this DSL? https://github.com/ContextMapper/context-mapper-dsl","pastedContents":{},"timestamp":1764564122940,"project":"/home/oliy/work/architecture","sessionId":"78d31c2a-6630-4693-9a6e-8a2ba6d74c13"}
{"display":"run `npm run build`","pastedContents":{},"timestamp":1764564850809,"project":"/home/oliy/work/architecture/typescript-dsl","sessionId":"0d2d4841-92d8-42ba-9dab-9ade98cbc03e"}
{"display":"npm linl","pastedContents":{},"timestamp":1764564951760,"project":"/home/oliy/work/architecture/typescript-dsl","sessionId":"0d2d4841-92d8-42ba-9dab-9ade98cbc03e"}
{"display":"i ran `cml-ts -i context-maps/digital.cml -o diagrams/context-maps -f mermaid` and it produced ```\ngraph TB\n\n  LoyaltyService[\"LoyaltyService\"]\n  style LoyaltyService fill:#90EE90\n  ProfileService[\"ProfileService\"]\n  style ProfileService fill:#90EE90\n  EngagementService[\"EngagementService\"]\n  style EngagementService fill:#90EE90\n  RecommendationService[\"RecommendationService\"]\n  style RecommendationService fill:#90EE90\n  LocationService[\"LocationService\"]\n  style LocationService fill:#90EE90\n  PaymentService[\"PaymentService\"]\n  style PaymentService fill:#90EE90\n  EagleEye[\"EagleEye\"]\n  style EagleEye fill:#90EE90\n  Braze[\"Braze\"]\n  style Braze fill:#90EE90\n  D365Commerce[\"D365Commerce\"]\n  style D365Commerce fill:#90EE90\n  Flybuys[\"Flybuys\"]\n  style Flybuys fill:#90EE90\n  Salesforce[\"Salesforce\"]\n  style Salesforce fill:#90EE90\n  SalesforceServiceCloud[\"SalesforceServiceCloud\"]\n  style SalesforceServiceCloud fill:#90EE90\n  MicrosoftEntraExternalID[\"MicrosoftEntraExternalID\"]\n  style MicrosoftEntraExternalID fill:#90EE90\n  RecommendationExternalService[\"RecommendationExternalService\"]\n  style RecommendationExternalService fill:#90EE90\n  MobileApp[\"MobileApp\"]\n  style MobileApp fill:#90EE90``` which is a collection of entities but no edges","pastedContents":{},"timestamp":1764565145836,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"yes","pastedContents":{},"timestamp":1764565480584,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"The directionality in the relationships label is redundant, the arrows on the edges can visualise it","pastedContents":{},"timestamp":1764566005769,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"Lets make it so the external entities (Braze et al) are coloured differently than the internal ones","pastedContents":{},"timestamp":1764566971947,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"This is great, commit and push this work to the repo","pastedContents":{},"timestamp":1764568009645,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"next thing i want to do is be able to publish plain english versions of this architecture to HTML files","pastedContents":{},"timestamp":1764568183717,"project":"/home/oliy/work/architecture","sessionId":"4a1f1840-94be-47ca-9d40-775f26b8966d"}
{"display":"we still have 'PartnerLinkInfo' on the loyalty bounded context, thought we moved that to the profile BC","pastedContents":{},"timestamp":1764646979146,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Your recommendation works","pastedContents":{},"timestamp":1764647159711,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"There are value in the comments in the bounded contexts, context map and domains. Move those to a markdown file that sits alongside the CML files","pastedContents":{},"timestamp":1764647673066,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Keep going","pastedContents":{},"timestamp":1764651492920,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Do those two too","pastedContents":{},"timestamp":1764652720603,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Add that to your directive files, that CML files should predominantly be just CML, and contextual / soft reasoning should be updated in the paired markdown","pastedContents":{},"timestamp":1764652991344,"project":"/home/oliy/work/architecture","sessionId":"0aa7eb69-1e6b-4984-b1ae-014bdb2ace37"}
{"display":"Add store grading to Location bounded context, ask more clarifiying questions","pastedContents":{},"timestamp":1764720946177,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"High Performing, Standard, Low Performing ","pastedContents":{},"timestamp":1764721339878,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"I'm going to write out the rough draft of a gamification upgrade intiative, it uses the StoreGrade aggregate ","pastedContents":{},"timestamp":1764724754138,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"That folder and filename are great, this is closest to the loyalty domain (although it's probably more accurately growth marketing). The high level concept is \"a multifactore reward engine that, based on on customer segementation, purchased fuel grade and location via StoreGrade, grants fuel discount or bonus point rewards\"","pastedContents":{},"timestamp":1764724911802,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"The rewards are also stratified, they could be anything from 2C per litre all the way to a free tank, and a variable number of bonus points, but those rewards will be bucketed","pastedContents":{},"timestamp":1764725046041,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"I changed the overview to \"\nThis initiative introduces a multi-factor reward engine that dynamically grants stratified fuel discount and bonus point rewards based on customer segmentation, fuel grade purchased, and store performance grading. Rewards are bucketed into discrete tiers ranging from 2c per litre up to a free tank of fuel, or variable bonus point allocations. The gamification engine discreetly incentivises customer behaviour (premium fuel purchases, visits to specific store tiers) by mapping transaction factors to reward buckets.\"","pastedContents":{},"timestamp":1764725378108,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"The reward evaluation will have some randomness to it, but the break down of the probablities will be part of the system","pastedContents":{},"timestamp":1764726472601,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"we're not doing loyalty tiering","pastedContents":{},"timestamp":1764747241952,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"  when did i talk about customer segmentation?","pastedContents":{},"timestamp":1764747514316,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"We refer to cost per litre discount as CPL not c/L","pastedContents":{},"timestamp":1764747662900,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"Rewards won with this system will be allocated in the LoyaltySystem","pastedContents":{},"timestamp":1764747798925,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"7157db80-06eb-4ac3-963f-a9eaeabe9ede"}
{"display":"exi","pastedContents":{},"timestamp":1764807002051,"project":"/mnt/c/Users/o.young/Documents/GitHub","sessionId":"600cfec0-49e9-4986-8e31-0de7f51f8ef2"}
{"display":"Produce markdown versions of all of the bounded context files next to their CML files","pastedContents":{},"timestamp":1764807099040,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"c7be3509-cba6-4ad2-87d9-f5f9d8ec3d6f"}
{"display":"also do the same for the external and interface bcs","pastedContents":{},"timestamp":1764809920608,"project":"/mnt/c/Users/o.young/Documents/GitHub/architecture","sessionId":"c7be3509-cba6-4ad2-87d9-f5f9d8ec3d6f"}
{"display":"Update the flybuys integration vision to make it consistent with the changes to the DDD in CML ","pastedContents":{},"timestamp":1764812719673,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"continue this task","pastedContents":{},"timestamp":1764826981811,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"In the domains folder, translate the CML into plain english and take the comments and move them to a paired markdown file in the same folder, ","pastedContents":{},"timestamp":1764828568677,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"when you're complete, commit and push this to github","pastedContents":{},"timestamp":1764829479295,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"What's a more PC version of \" Mastered in Salesforce CRM\"","pastedContents":{},"timestamp":1764889563189,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"describe in a sentance what a loyalty pass in an apple wallet or google wallet is and does","pastedContents":{},"timestamp":1764889683008,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"I've made changes to the first section of the delivery domain markdown file, use those changes as a pattern to apply to the other markdown files in the domain folder","pastedContents":{},"timestamp":1764890039639,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"In the fulfilment domain we talk about \"Fufliment Configuration\" that belongs on the Location Domain","pastedContents":{},"timestamp":1764891208653,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"Lets consolidate around \"location\" being called the Store Domain","pastedContents":{},"timestamp":1764891391717,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"Is that now consistent across the project","pastedContents":{},"timestamp":1764892681513,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"Update our understanding of Fuel Gamificaiton with this Business Objective: \n\nWe are designing a multi-dimensional SPS Dynamic Discount Engine that adjusts discount probabilities based on three commercial levers: \n\nStore Type \n\nCustomer Type \n\nFuel Grade \n\nThis engine replaces today’s static discount distribution with a flexible rules-based model that can: \n\nReward new customers more aggressively to drive early retention. \n\nIncrease discounts for problem/under-performing stores to stimulate volume. \n\nTighten discounts at good/high-performing stores to protect margin. \n\nIntroduce premium fuel uplift logic, incentivising higher-value fuel grades. \n\nThe framework is simple, scalable, and requires minimal operational effort while giving Product & Marketing a powerful tool to control discount cost, fuel mix, and site uplift strategies. \n\n \n\nDetails: \n\n1. Business Dimensions \n\nA. Store Type \n\nStore classification determines probability weighting for each discount tier. \n\nStore Type \n\nPurpose \n\nNew \n\nNew/Converted stores - incentivise early adoption. \n\nStandard \n\nTypical OTR network performance - use baseline distribution. \n\nProblem \n\nUnder-performing sites needing tactical intervention. \n\nGood \n\nOut-performing sites where discount spend should be reduced. \n\n \n\nB. Customer Type \n\nCustomer Type \n\nDefinition \n\nExpected Discount Strategy \n\nNew Customer \n\nNew account onboarding offer. \n\nAlways receive higher discount tiers (min 6c or 10c) for first X transactions \n\nExisting Customer \n\nAny customer with ≥1 (or more) past SPS purchase \n\nDiscount based on Store Type weighting \n\nC. Fuel Grade \n\nFuel Grade \n\nLogic \n\nPremium (V-Power) \n\nOption A: Guarantee min 4c/6c  \n\nOption B: Increase probability of higher-tier discounts \n\nNon-Premium \n\nUse standard discount distribution per store type \n\n \n\n2. Discount Distribution and Rules \n\nRule 1: Baseline Discount Distribution \n\nWeighting Table: \n\nTier \n\nNew \n\nStandard \n\nProblem \n\nGood \n\n2c \n\n0% \n\n36.8% \n\n0% \n\n61.7% \n\n6c \n\n35% \n\n37.1% \n\n60% \n\n37.1% \n\n10c \n\n35% \n\n21.8% \n\n40% \n\n0.5% \n\n20c \n\n25% \n\n4.2% \n\n0% \n\n0.5% \n\nFree Tank \n\n5% \n\n0.2% \n\n0% \n\n0.2% \n\n \n\nRule 2: New Customer \n\nIf customer type = New (first-ever fuel purchase): \n\nIgnore Store Type distribution \n\nApply New Customer distribution (the “New” column) \n\nOptional: Guaranteed minimum discount tier for first 1–3 purchases \n\nThis supports early habit formation. \n\nRule 3: Premium Fuel \n\nIf customer purchases premium fuel: \n\nApply premium uplift mechanic \n\nExamples: \n\nGuarantee minimum 6c \n\nIncreased probability on higher discount tiers \n\nThis supports Shell’s V-Power uplift strategy. ","pastedContents":{},"timestamp":1764893311613,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"Combine the DDD Glossary into the UL folder, and add Facade Pattern","pastedContents":{},"timestamp":1764895216092,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dc9709e0-aca1-4d18-a547-8fe94c5d7f9a"}
{"display":"Review the documents in the visions folder, think about their structure, compare to modern architectural standards like but not limited to DDD or TOGAF, and tell me what artifact type they most resemble and suggest improvements to their structure to make them more aligned to standard architectural document types. I will also be writing \"SOlution Designs\" which should be the pragmatic \"todo\" versions of these more visionary documents","pastedContents":{},"timestamp":1765147816447,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Yes please","pastedContents":{},"timestamp":1765148402109,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Can you create two templates in the templates folder","pastedContents":{},"timestamp":1765149354909,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Lets keep working on the vision doc for flybuys ","pastedContents":{},"timestamp":1765150178045,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Why are we defining product outcomes in an architectural vision?","pastedContents":{},"timestamp":1765150499423,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Business case / requirements are out of scope of my work, we have a BA working on that. My work should be purely technical and responsive to business requirements. it's the how and what, not the why or when. This vision will have to be presented to an ARB, and will form the solution design which is also my responsibility","pastedContents":{},"timestamp":1765150703546,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Yes","pastedContents":{},"timestamp":1765150841529,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"And what kind of document is that defined as in TOGAF or ISO standards?","pastedContents":{},"timestamp":1765151662736,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"I'm going to call them architecture defintiions","pastedContents":{},"timestamp":1765152170729,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Review the techncial capabilities required in Architecture Definitions\\Flybuys Integration.md against the rest of the document and Architecture Definitions\\Flybuys Integration - NOT TOGAF.md","pastedContents":{},"timestamp":1765164945123,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Implmenet those three changes","pastedContents":{},"timestamp":1765165494414,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Is there anything conceptually in the NOT TOGAF version taht should be in the other version","pastedContents":{},"timestamp":1765166036040,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Reevaluate considering that this a TOGAF Architecture Definition Document, as i understand, those strategic details don't belong here","pastedContents":{},"timestamp":1765166270850,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Yes","pastedContents":{},"timestamp":1765166412977,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"08057da2-af3d-4936-99a6-aa1ebfd36204"}
{"display":"Update Templates\\Architecture Definition Template.md from Architecture Definitions\\Flybuys Integration.md","pastedContents":{},"timestamp":1765250531243,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"I want this Solution Architectures\\Flybuys Integration.md to be a TOGAF standard Solution Architecture Document, i also want to reduce the duplication of anything that's defined in the Architecture Definition Document. Make suggestions 1-by-1 to align it with the standard, but i want it to be pragmatic and useful","pastedContents":{},"timestamp":1765253203242,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Yes","pastedContents":{},"timestamp":1765253266173,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Yes, but maintain compatibility with a standard TOGAF Solution Architecutre ","pastedContents":{},"timestamp":1765253333971,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Yes","pastedContents":{},"timestamp":1765253396502,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"yes yes we should, implementation is the engineers responsibility, this should establish specifications and contracts","pastedContents":{},"timestamp":1765253635971,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"I think so, i'll review and change if needed","pastedContents":{},"timestamp":1765253765653,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Yes, keep implementation and project management out of this, we aren't concerned about delivery, just that the soution fits the requirements","pastedContents":{},"timestamp":1765253972956,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Lets go with that for now","pastedContents":{},"timestamp":1765254120398,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Good","pastedContents":{},"timestamp":1765254319781,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"yep","pastedContents":{},"timestamp":1765254419198,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"good, ensure that also updates the template in the templates/ folder","pastedContents":{},"timestamp":1765254762934,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"update Solution Architectures/Flybuys Integration.md to follow the new template structure","pastedContents":{},"timestamp":1765255607022,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Don't number the headings","pastedContents":{},"timestamp":1765256749727,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"Ensure you get all the subheadings too, they have dot references","pastedContents":{},"timestamp":1765256882921,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"defining the Interface Specifications here isn't useful, create a openapi spec instead","pastedContents":{},"timestamp":1765257744568,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"commit and push all this","pastedContents":{},"timestamp":1765257852973,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ac177595-768e-43c5-9359-4a992921819d"}
{"display":"I want to implement https://discourse.gohugo.io/t/experiment-obsidian-style-wikilinks-in-hugo-looking-for-feedback/55775","pastedContents":{},"timestamp":1765334352440,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"Great, but it doesn't handle `Every [Customer](/ubiquitous-language/#Customer) has a [VCI](/ubiquitous-language/#Viva Consumer ID) part of their [Loyalty Credentials](/ubiquitous-language/#Loyalty Credential)` properly, those are anchors on the link, the `/#` should just be `#`","pastedContents":{},"timestamp":1765334552218,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"Still not quite, consider this HTML block, those are still Markdown links not HTML ```<p>This Architecture Definition Document defines the architecture for integrating <a href=\"/bounded-context/external/flybuys/\">Flybuys</a> across OTR’s digital and store network via the <a href=\"/bounded-context/interfaces/mobile-application/\">Mobile Applications</a> as a [Coalition Partner](/ubiquitous-language#Coalition Partner)\nThe definition introduces new [bounded contexts](/ubiquitous-language#Bounded Context) (<a href=\"/bounded-context/profile-service/\">Profile Service</a>, <a href=\"/bounded-context/loyalty-service/\">Loyalty Service</a>) implementing DDD strategic patterns with [event-driven integration](/ubiquitous-language#Event Bus).\nThe architecture establishes a canonical set of [Loyalty Credentials](/ubiquitous-language#Loyalty Credential), reusable [Partner Integration](/ubiquitous-language#Partner Integration) linking patterns, and [Basket Adjudication](/ubiquitous-language#Basket Adjudication) orchestration.\nThe <a href=\"/bounded-context/profile-service/\">Profile Service</a> also partially serves as an facade service for delivering <a href=\"/bounded-context/interfaces/otr-pos/\">OTR POS</a> integration to <a href=\"/bounded-context/external/salesforce-crm/\">Salesforce CRM</a> before the #Highlander programme</p>```","pastedContents":{},"timestamp":1765334672119,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"Nice! next, `==TBD==` should render to `<span class='highlight'>TBD</span>`","pastedContents":{},"timestamp":1765334846234,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"Great! The changes we made to the linking, are those only applied to this theme or globally?","pastedContents":{},"timestamp":1765337265506,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"Lets make more portable, i don't want it dependent on the theme","pastedContents":{},"timestamp":1765337406370,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"/exit ","pastedContents":{},"timestamp":1765338023406,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"/exit ","pastedContents":{},"timestamp":1765338038370,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"095f68d4-18c4-4bae-997d-c0616c0e4e1f"}
{"display":"''","pastedContents":{},"timestamp":1765338484924,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"23d26c11-1aa1-4070-bd21-938667f74fa7"}
{"display":"Some of my links look lik http://localhost:1313/ubiquitous-language/#customer%5C that %5C is redundant","pastedContents":{},"timestamp":1765338777054,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"23d26c11-1aa1-4070-bd21-938667f74fa7"}
{"display":"Act as a senior software engineer and editor, compare Architecture Definitions\\Flybuys Integration.md and Solution Architectures\\Flybuys Integration.md for inconsistencies and other errors","pastedContents":{},"timestamp":1765353117278,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Fix 8,9 & 10","pastedContents":{},"timestamp":1765353458531,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"What were the other 8 recommendations?","pastedContents":{},"timestamp":1765353551470,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Fix 3 & 4","pastedContents":{},"timestamp":1765353772479,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"What's left?","pastedContents":{},"timestamp":1765353812198,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"With #5 solve it the other way, ensure that the things marked TBD are consistently marked as TBD","pastedContents":{},"timestamp":1765354082589,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Continue last task","pastedContents":{},"timestamp":1765403119308,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"lets fix #2","pastedContents":{},"timestamp":1765403554468,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Tell me more about #2","pastedContents":{},"timestamp":1765403686927,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"yeah lets do that","pastedContents":{},"timestamp":1765403815831,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Tell me about #6","pastedContents":{},"timestamp":1765404162108,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Lets work through the events that are marked emittted no, they probably should be emitted from something","pastedContents":{},"timestamp":1765405547562,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"One by one please","pastedContents":{},"timestamp":1765405670498,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"Lets change it to `LoyaltyMembershipActivated` - Enrollment happens on first app login (as a Just-In-Time migration), there are no tier levels, marketing consent is already managed, and where should the schema be defined?","pastedContents":{},"timestamp":1765406055478,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"/compact ","pastedContents":{},"timestamp":1765406236651,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"/plan ","pastedContents":{},"timestamp":1765406278778,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"continue","pastedContents":{},"timestamp":1765406428193,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"7a5b16f8-09e1-4166-9dde-757fb2c928b2"}
{"display":"I have a serios git issue, adding files changes them all i think it's a line ending issue, can you resolve it?","pastedContents":{},"timestamp":1765407625012,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"git pull and resolve any issues","pastedContents":{},"timestamp":1765408030596,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"try git push again","pastedContents":{},"timestamp":1765408064744,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"did our work from before with events survive this git change?","pastedContents":{},"timestamp":1765408667620,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"are all the events consistent across the arch and solution?","pastedContents":{},"timestamp":1765408945820,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes please","pastedContents":{},"timestamp":1765409499780,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Act like a Staff Software Engineer and Technical Writer and compare and constrast the Arch and Solution docs for Flybuys identifying inconsistencies, errors and other areas for improvement","pastedContents":{},"timestamp":1765409836358,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Lets resolve the critical issues 1-by-1","pastedContents":{},"timestamp":1765410210227,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Before we continue, catalog is not professional Australian English","pastedContents":{},"timestamp":1765410564378,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Continue that git commit","pastedContents":{},"timestamp":1765410825756,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Lets go through #4","pastedContents":{},"timestamp":1765414301090,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What's left","pastedContents":{},"timestamp":1765414372695,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"This is wrong `OTR Mobile / SPS Mobile        | VCI or OTR member ID     | Direct lookup → VCI                                    |\n       545 +  | Apple/Google Wallet Pass       | VCI or OTR member ID     | Direct lookup → VCI` The mobile apps only use OTR Member ID","pastedContents":{},"timestamp":1765414879631,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"POS Barcode - They are EAN barcodes, the data encoded on them depends which credential is presented, POS doesn't resolve it, Loyalty Service does","pastedContents":{},"timestamp":1765415115396,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Is that API spec in the OpenAPI spec files?","pastedContents":{},"timestamp":1765415413738,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Commit and push them","pastedContents":{},"timestamp":1765415525374,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"I see some inconsistency, there are transitional solution plans in the architectuer definition","pastedContents":{},"timestamp":1765415780411,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What other improvements can you suggest?","pastedContents":{},"timestamp":1765415834112,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"1 by 1 please, i'm sure that's in your claude file?","pastedContents":{},"timestamp":1765416257792,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"We will accept Loyalty Credentials at REXP, but part of the Loyalty Service resolution will have to either remain on the legacy process if a Visitor presents a Flybuys card, versus a Customer who presents Loyalty Credentials","pastedContents":{},"timestamp":1765416415341,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Skip to 7","pastedContents":{},"timestamp":1765416918741,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Talk through #8","pastedContents":{},"timestamp":1765417067892,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Mark them deferred, they're engineering/implementation choices","pastedContents":{},"timestamp":1765417357714,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Good, now do another pass to ensure consistent, no replication and adherence to the TOGAF-B C and D spec","pastedContents":{},"timestamp":1765417521133,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Solve 1 and 2 now","pastedContents":{},"timestamp":1765417941432,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What's next","pastedContents":{},"timestamp":1765418008023,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes","pastedContents":{},"timestamp":1765418164427,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What is 4?","pastedContents":{},"timestamp":1765419210132,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes","pastedContents":{},"timestamp":1765419362480,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What was #5","pastedContents":{},"timestamp":1765419620122,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes","pastedContents":{},"timestamp":1765419937324,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Remove any deliverability or timing references, those aren't in scope for these documetns","pastedContents":{},"timestamp":1765420200347,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Lets remove any reference to the CSV export process, it's an existing process and we don't intende to change it ","pastedContents":{},"timestamp":1765420562317,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"revert those changes","pastedContents":{},"timestamp":1765420599381,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"As a senior engineer leading the implementation team, read the arch and solution docs and critique them","pastedContents":{},"timestamp":1765420933562,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"1 is fine, that's for the implementation to decide","pastedContents":{},"timestamp":1765422866684,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Review this critique wihout being \"over-reaching\"","pastedContents":{},"timestamp":1765423121766,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"What's the simplest to solve?","pastedContents":{},"timestamp":1765423387164,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yeah","pastedContents":{},"timestamp":1765423570014,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes","pastedContents":{},"timestamp":1765423804598,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"what's next","pastedContents":{},"timestamp":1765425635171,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"7 is redundant, 5 we should be defining rules and standards not implmentation ","pastedContents":{},"timestamp":1765425826609,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"No, an evolution policy is redundant, we don't have an event system right now","pastedContents":{},"timestamp":1765425876896,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Explain 3","pastedContents":{},"timestamp":1765425923814,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"This is fine for now, we'll be retiring the legacy Loyalty later in the roadmap","pastedContents":{},"timestamp":1765426339305,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Add sequence diagrams with mermaid where appropriate","pastedContents":{},"timestamp":1765426557584,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"The pos integraiton flow should be a sequence diagram too","pastedContents":{},"timestamp":1765427112348,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Nah, lets go through the arch document section by section and review them","pastedContents":{},"timestamp":1765427245936,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"i think it's clear enough, and the last sentence is still relevant","pastedContents":{},"timestamp":1765427333802,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"lets combine 5 & 6, it will include non-Flybuys but not yet, these are the high level business requirements  Table of Contents\n\n1 Registration (Flybuys linking and Unlinking)\n2 Network and How to Find Flybuys\n3 Points Earning\n4 Points Earning In-App\n5 Points Earning In-Store\n6 Tracking, Calculation of Flybuys Points Earned, Reporting\n7 Invoicing, Billing & Finance\n8 Customer Experience\nThe high-level requirements are supported by the artefacts below, which inform the HLD.\n\nOTR App & FB Integration | Overview & Scope (to be reviewed)\n \n\nhttps://vivaenergy.atlassian.net/wiki/spaces/VER/pages/11037671425Request access(subject to ongoing updates as feedback is being received)\n\nDigital - Roadmap\n\n \n\n \n\n \n\nRegistration (Flybuys linking and Unlinking)\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nEnable customers to link their Flybuys membership to the App using the standard Flybuys linking process.\n\nmust have\n \n\n \n\n2    \nUpon successful Flybuys account linking, the App will display a cobranded “App Barcode” that incorporates Flybuys branding. into the existing OTR barcode.\n\nmust have\n  \n\nSPS barcode - TBC \n\nAdd requirement around linking in one app is separate to other\n\n3    \nThe cobranded barcode displayed in the App will be the same as the standard OTR barcode, with visual cobranding only.\n\nmust have\n  \n\n \n\n4    \nThe App will provide the ability to link Flybuys accounts via the appropriate option (i.e. the hamburger menu).\n\nmust have\n  \n\nReference the wireframes\n\n5    \nThe App will provide the ability to unlink Flybuys accounts via the appropriate option (i.e. the hamburger menu).\n\nmust have\n  \n\nReference the wireframes\n\n6    \nThe system will record the date and time of each linking and unlinking event and sync this data with both the CRM and Braze platforms.\n\nmust have\n  \n\n \n\n7    \nThe system will support marketing campaigns from Flybuys, OTR, and Reddy Express to promote account linking, including the use of in-app promotional tiles within OTR App.\n\nshould have\n  \n\nThis requirement is impacted by the SFMC—>Braze migration.\n\n8    \nThe system will send transactional email confirmations and push notifications to customers upon successful linking or unlinking of their Flybuys account.\n\n \n\nshould have\n  \n\n \n\nNetwork and How to Find Flybuys\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nFlybuys points will be able earned for all products capable of being purchased or preordered in the OTR App or the QSRs using OTR POS (e.g. includes Oporto, Subway, WIAB, Krispy Kreme and Moe’s Hot Dog but exclude Hungry Jack and GYG)\n\nmust have\n  \n\n \n\n2    \nA store finder feature will be developed on both the SPS and OTR App to allow customers to easily locate all available offers by store location (including QSRs).\n\nmust have\n    \n\nMap needs to be accessible on the website \n\nWe need to maintain site and location information .\n\n3    \nIf the convenience brand is REXP or OTR, customers will earn Flybuys points regardless of the fuel brand, including Shell, Liberty, and Caltex)\n\nmust have\n\nNEW - TBC\n\nPoints Earning\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nLinked Flybuys members will earn base points at a rate of 1 3 points per $21 spent on in-app eligible purchases for launch transactions.\n\nmust have\n  \n\nSolution will need to accommodate different earn rates.  In-app earn rates can be different to that of In-store earn rates.  These can change from time to time. \n\n2    \nLinked Flybuys members will earn bonus points for Shell V-Power (ie 3 points per $ spent instead of the standard base rate)\n\nshould have\n  \n\nNew as per the recent Flybuys presentation pack.\n\n3    \nBase points earned at a transaction level will be a queryable field at a transaction level (ie. at time of transaction, they were a linked member and had or had not selected to get SPS savings)\n\nmust have\n  \n\n \n\n4    \nStandard exclusions and volume limits will apply where eligible fuel types capped at 150L of eligible fuel type per transaction and excluding Adblue, Lotteries, and Tobacco products from points accrual.\n\nmust have\n  \n\nInclude Adblue, remove from exclusion list \n\n5    \nThe total Flybuys points earned by a customer through OTR Group will be displayed in both the OTR and SPS Apps.\n\nmust have\n  \n\nSubject to data availability \n\n6    \nOTR-Led Bonus points earned through occasional “Bonus Points Campaigns” will not be displayed at the transaction level within the App.\n\nmust have\n  \n\nMechanics of OTR-led campaigns needs to be confirmed outside FB integration work by @Isha Bakshi and @Paola Buchan .\n\nPoints Earning In-App\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nThe customer will earn Flybuys base points only if they have not selected SPS discounts.\n\nmust have\n  \n\n \n\n2    \nThe app will provide data to accurately calculate the base points earned and must display these points as per the approved wireframe and on the proforma invoice.\n\nmust have\n  \n\nExample of Proforma Invoice.docx\n\n \n\n3    \nBonus points will not be earned on fuel transactions where SPS CPL discount is selected.\n\nmust have\n  \n\n \n\n4    \nPoints on Fuel in App are only earned when payment is successfully processed. \n\nmust have\n  \n\n \n\n5    \nFor failed In App payments, points are earned when PayNow is completed. \n\nmust have\n  \n\n \n\n6    \nWhen bonus points campaigns are active, the App will display only base points earned, excluding any bonus points from the displayed total.\n\nshould have\n  \n\nTBC\n\nPoints Earning In-Store\nNote: Customers will earn Flybuys points for in-store purchase at REXP is by scanning the Flybuys App or Flybuys card (as per current process).\n\nHigh Level  Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nCustomer will earn Flybuys point for in-store OTR purchase when:\n\nThe customer has linked their Flybuys account.\n\nThe customer scans the loyalty credentials (via the Flybuys app, OTR app, SPS app, Apple Wallet, Google Wallet) during the transaction.\n\nmust have\n  \n\n \n\n2    \nThe app must notify unlinked guests during eligible in-store purchases to link their Flybuys account before completing payment, enabling them to earn points.\n\nWon't have\n  \n\n \n\nTracking, Calculation of Flybuys Points Earned, Reporting\nHigh Level Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nThe system must implement a process for OTR app, SPS app and In-store OTR to identify Flybuys points earned via OTR+ POS transactions. This process must:\n\nIdentify all relevant transactions.\n\nValidate purchased products against exclusion tables.\n\nCalculate points earned accurately.\n\nGenerate daily points files and transmit them to Flybuys for processing.\n\nmust have\n  \n\nLeverage off REXP process. \n\nCurrently there are BAU issues of tagging bonus point at REXP (maybe reviewed as we move to the Strategic Data Solution) - @Oli Young \n\n2    \nThe system must provide dashboard functionality (ie. Power BI) to display Flybuys points earned, segmented by store and by channel (ie. in-app OTR, in-store OTR, campaign name, site name, point type - base or bonus, oeprating brand - OTR or REXP etc)\n\nmust have\n  \n\n \n\n3    \nFlybuys invoices must separately identify and display OTR base points and bonus points \n\nmust have\n  \n\n \n\n4    \nThe system must provide the ability to query and generate reports on daily points-earn files to:\n\nValidate monthly billing.\n\nMonitor earning trends.\n\nSupport tracking and accurate calculation of Flybuys points.\n\nmust have\n  \n\n \n\n5    \nThe system will have the capability to:\n\nGenerate reports or\n\nExpose relevant data for querying and analysis of Flybuys points earning.\n\nmust have\n  \n\nExamples of reporting:\n\n1000 points for linking accounts\n\nPoints on In app transactions\n\nPoints for instore transactions\n\n6    \nThe system will provide the capability for end users to:\n\nEasily query FB points earning data.\n\nObtain insights into earning activities.\n\nmust have\n  \n\n \n\n7    \nThe reporting functionality will include (but is not limited to):\n\nFiltering by:\n\nUser ID\n\nTransaction Date\n\nEarning Type\n\nPoint Value\n\nGrouping of data by key attributes.\n\nSummarizing data to show:\n\nTotals\n\nAverages\n\nCounts\n\nOther relevant metrics based on selected attributes.\n\nmust have\n  \n\n \n\nInvoicing, Billing & Finance\nThe invoicing, billing, and finance process for points earned via  OTR app, SPS app and In-store OTR will leverage the existing backend account/finance processes.  \n\nCustomer Experience\nHigh Level  Requirement Description\n\nMoSCoW\n\nComments/Questions\n\n1    \nThe system will provide an interface accessible to Customer Experience Team that displays Flybuys account linking and unlinking details including:\n\nDate and time of account linking.\n\nDate and time of account unlinking.\n\nmust have\n  \n\nAmin to update Admin tool?\n\nNeed to expose data on personalised flybuys related campaigns to Customer Experience Team \n\nExpose campaigns to Flybuys?\n\n2    \nThe in-app and website feedback forms will be updated to include \"Flybuys Feedback\" as a selectable subject option to cover REXP and OTR feedback.\n\nmust have\n  \n\nBAU process for any FB queries\n\n ","pastedContents":{},"timestamp":1765427473081,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"We can add unlinking into BR-004, exclusions are operational, lets include notifications in the solution arch later","pastedContents":{},"timestamp":1765427536575,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yeah! It's Paola Buchan P.Buchan@otr.com.au","pastedContents":{},"timestamp":1765427895731,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"All thres","pastedContents":{},"timestamp":1765428104203,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Baseline only but can we do a sequence diagram here","pastedContents":{},"timestamp":1765428179251,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"I've manually changed them, move on","pastedContents":{},"timestamp":1765428356804,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Fixed it, move on","pastedContents":{},"timestamp":1765428422181,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"That's fine, move on","pastedContents":{},"timestamp":1765428460031,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"fxied, next","pastedContents":{},"timestamp":1765428669110,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Next","pastedContents":{},"timestamp":1765428705464,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Are 4 & 5 industry standards?","pastedContents":{},"timestamp":1765428768679,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yeah lets move on","pastedContents":{},"timestamp":1765428878456,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"y","pastedContents":{},"timestamp":1765428934757,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"2 - CustomerEnrolled is a loyalty service event ","pastedContents":{},"timestamp":1765429004237,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"done, keep going","pastedContents":{},"timestamp":1765429057650,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Next","pastedContents":{},"timestamp":1765429164092,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Next","pastedContents":{},"timestamp":1765430046841,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"3- Yes it's a mixed cloud","pastedContents":{},"timestamp":1765430131127,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes","pastedContents":{},"timestamp":1765430160503,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"next","pastedContents":{},"timestamp":1765430651673,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"next","pastedContents":{},"timestamp":1765430707706,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Nexxt","pastedContents":{},"timestamp":1765430780789,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"next","pastedContents":{},"timestamp":1765430956941,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Continue","pastedContents":{},"timestamp":1765431110072,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yep, commit and push","pastedContents":{},"timestamp":1765431156654,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Convert this to a mermaid sequence ```1. Customer presents Loyalty Credential at POS\n2. POS scans EAN-13 barcode (13 digits)\n3. POS → LoyaltyService API: POST /api/v1/loyalty/credentials/resolve\n   {\n     \"barcode\": \"1234567890123\",\n     \"storeId\": \"OTR001\",\n     \"transactionId\": \"TXN_20251211_001234\"\n   }\n4. LoyaltyService resolves barcode:\n   - OTR credentials (1-3): Direct VCI resolution (barcode encodes OTR member ID)\n     a. Extract OTR member ID from barcode\n     b. Query ProfileService: GET /api/v1/profile/customers?memberId={otrMemberId}\n   - Flybuys credentials (4-5): Indirect resolution via PartnerLink aggregate\n     a. Extract Flybuys 12-digit member number from barcode\n     b. Query ProfileService: GET /api/v1/profile/partner-links?partner=FLYBUYS&externalMemberId={flybuysNumber}\n     c. Retrieve VCI from PartnerLink aggregate\n5. LoyaltyService → ProfileService: GET /api/v1/profile/customers/{vci}\n6. Return customer context to POS:\n   {\n     \"vivaConsumerId\": \"vci_xyz789abc\",\n     \"rewardPreference\": \"FLYBUYS_POINTS\",\n     \"walletId\": \"wallet_123456\",\n     \"linkedPartners\": [\"FLYBUYS\"]\n   }\n```","pastedContents":{},"timestamp":1765431250885,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Yes please","pastedContents":{},"timestamp":1765431341161,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Can you suggest a rewrite to the intro & vision docs","pastedContents":{},"timestamp":1765431537070,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"That's a great exec summary, but too long for that vision & intro paragraph","pastedContents":{},"timestamp":1765431858728,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Don't use unverifed statistics","pastedContents":{},"timestamp":1765431887212,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"\"Phased extraction from legacy OTR App API\" we're not deprecating that yet, this is a parallel rollout","pastedContents":{},"timestamp":1765431924342,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Ys","pastedContents":{},"timestamp":1765431994993,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"I've changed the order of the business requirements, can you renumber them?","pastedContents":{},"timestamp":1765432538587,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"Add a sequence diagram for \"##### Customer Links Flybuys Digital Identity and earns Flybuys Points\"","pastedContents":{},"timestamp":1765434115233,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"189f451f-941a-45d9-9a33-d1bdefcc67d4"}
{"display":"My mermaid diagrams aren't rendering in the hugo output","pastedContents":{},"timestamp":1765750174898,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"845614d7-4a64-467b-a868-da7e9d05edcd"}
{"display":"run the hugo server","pastedContents":{},"timestamp":1765751121787,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"845614d7-4a64-467b-a868-da7e9d05edcd"}
{"display":"/exit ","pastedContents":{},"timestamp":1765752236967,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"845614d7-4a64-467b-a868-da7e9d05edcd"}
{"display":"I want to collate and package the deliverables for the flybuys initiative, what should i include?","pastedContents":{},"timestamp":1765753017121,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"02e871b4-65b7-4d27-a2ed-0495a3c7c19e"}
{"display":"Tell me more about I could do with option 4, I'd love to have a set of versioned PDFs i can deliver","pastedContents":{},"timestamp":1765754790421,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"02e871b4-65b7-4d27-a2ed-0495a3c7c19e"}
{"display":"1, call this version 0.1.0, it's the project team, BA, PM, lead engineers, no branding this version","pastedContents":{},"timestamp":1765754916667,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"02e871b4-65b7-4d27-a2ed-0495a3c7c19e"}
{"display":"/exit ","pastedContents":{},"timestamp":1765756517946,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"02e871b4-65b7-4d27-a2ed-0495a3c7c19e"}
{"display":"We were talking about maintaining a shadow points balance that's independent from what we calculate and send to flybuys","pastedContents":{},"timestamp":1765759020400,"project":"/home/oliy","sessionId":"e64518f5-25c8-489e-a4f9-bc29e62247b9"}
{"display":"/exit ","pastedContents":{},"timestamp":1765759037870,"project":"/home/oliy","sessionId":"e64518f5-25c8-489e-a4f9-bc29e62247b9"}
{"display":"Lets talk about how i want to build a shadow points balance in Loyalty Service that tracks points for flybuys transmission for now, but independently in the future","pastedContents":{},"timestamp":1765759150903,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"I want a dual track, i want to support the granting and transmission of flybuys AND having a shadow internal points balance","pastedContents":{},"timestamp":1765759234001,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"permament, parallel, and but behind the scenes","pastedContents":{},"timestamp":1765759287383,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Purely dormant for the forseeable future","pastedContents":{},"timestamp":1765759317294,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Yes, it does for now","pastedContents":{},"timestamp":1765759347029,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"running balance","pastedContents":{},"timestamp":1765759379052,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"No, EE is the system of record, we cna do multiple points balances in that system","pastedContents":{},"timestamp":1765759436024,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Yes","pastedContents":{},"timestamp":1765759557013,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"all or nothing works for now","pastedContents":{},"timestamp":1765759580975,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Are there any improvements you can suggest","pastedContents":{},"timestamp":1765759667332,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Perfect, draft how we can add that to the solution architecture, ensure we're sticking to TOGAF and DDD ","pastedContents":{},"timestamp":1765759784993,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"/exit ","pastedContents":{},"timestamp":1765766085244,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"5eef6e10-471d-497f-9232-b560b3e33b45"}
{"display":"Some of the links in Architecture Definitions\\Flybuys Integration.md aren't rendering","pastedContents":{},"timestamp":1765766862771,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"4deb8854-f34a-488b-b8c0-a004901e2163"}
{"display":"Some of the links in `content/Architecture Definitions\\Flybuys Integration` aren't rendering","pastedContents":{},"timestamp":1765766934482,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"4deb8854-f34a-488b-b8c0-a004901e2163"}
{"display":"There are still some unlinked sections, like this \"AS-1: Foundation#\nObjective#\nEstablish [[Profile Service]], [[Loyalty Service]] & Event Bus without impacting production workloads.\n\nTechnical Deliverables#\n[[Profile Service]]#\"","pastedContents":{},"timestamp":1765769147688,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"4deb8854-f34a-488b-b8c0-a004901e2163"}
{"display":"/exit ","pastedContents":{},"timestamp":1765771124381,"project":"/mnt/c/Users/o.young/work/architecture-build","sessionId":"4deb8854-f34a-488b-b8c0-a004901e2163"}
{"display":"I have links that look like `[](Ubiquitous%20Language.md#Partner%5C|Partner)` across this project, they should look like `[Partner](Ubiquitous%20Language.md#Partner)` derive a regex to match all errors and fix","pastedContents":{},"timestamp":1765771525864,"project":"/home/oliy","sessionId":"8d16695c-1b02-4875-9937-2c013cc7b386"}
{"display":"exit","pastedContents":{},"timestamp":1765771610553,"project":"/home/oliy","sessionId":"8d16695c-1b02-4875-9937-2c013cc7b386"}
{"display":"I have links that look like `[](Ubiquitous%20Language.md#Partner%5C|Partner)` across this project, they should look like \n`[Partner](Ubiquitous%20Language.md#Partner)` derive a regex to match all errors and fix ","pastedContents":{},"timestamp":1765771636599,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"This `[Flybuys%20Card]` should be this `[Flybuys Card]`","pastedContents":{},"timestamp":1765771790368,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"That didn't work, it broke everything","pastedContents":{},"timestamp":1765771839166,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"You'll have to convert all the wikilinks to markdown links again","pastedContents":{},"timestamp":1765771882836,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"Can you fix the links, this `[Profile Service](Profile%20Service.md)` should be `[Profile Service](/Bounded Context/Profile%20Service.md)`","pastedContents":{},"timestamp":1765772739628,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"Need to ensure the links are HTML encoded too, spaces should be %20","pastedContents":{},"timestamp":1765773204652,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f96aee43-434e-494c-998a-73a278a5759e"}
{"display":"What should the ABB name for the process that consumes and publishes points grants to flybuys be called","pastedContents":{},"timestamp":1765946306634,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff27b6be-c5cf-4007-94e4-d943291fb971"}
{"display":"/exit ","pastedContents":{},"timestamp":1765949791984,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff27b6be-c5cf-4007-94e4-d943291fb971"}
{"display":"generate release notes for the changes between HEAD and 3fa31a1","pastedContents":{},"timestamp":1765949820396,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"Emphasise the changes in the arch and solution files for the flybuys project, deemphasis any chore work","pastedContents":{},"timestamp":1765949957125,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"Noppe give me details on the differences between HEAD and 3fa31a1 for architecture_definitions\\flybuys_integration.md and solution_architectures\\flybuys_integration.md only ","pastedContents":{},"timestamp":1765950143137,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"That's good but drop the file name changes","pastedContents":{},"timestamp":1765950294112,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"Great, but rewrite it to be one summary set of release notes based on the last output","pastedContents":{},"timestamp":1765950372894,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"i've staged a file for commit, write a commit message and push","pastedContents":{},"timestamp":1766097505121,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"/exit ","pastedContents":{},"timestamp":1766097610762,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"00251090-625c-4756-a516-e7d7d2a023dc"}
{"display":"i have a file staged for commit, write a committ message and push","pastedContents":{},"timestamp":1766097797085,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fe650f69-efcc-41d0-9e80-3a6df1b0e157"}
{"display":"new file, do it agan","pastedContents":{},"timestamp":1766098028635,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fe650f69-efcc-41d0-9e80-3a6df1b0e157"}
{"display":"and again","pastedContents":{},"timestamp":1766098128027,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fe650f69-efcc-41d0-9e80-3a6df1b0e157"}
{"display":"and again","pastedContents":{},"timestamp":1766098210342,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fe650f69-efcc-41d0-9e80-3a6df1b0e157"}
{"display":"would it be idiomatic DDD to call the event bus an external bounded context","pastedContents":{},"timestamp":1766098392474,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fe650f69-efcc-41d0-9e80-3a6df1b0e157"}
{"display":"/context ","pastedContents":{},"timestamp":1767569132626,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0b24b7d6-9a54-414e-bfce-93768b6b6e32"}
{"display":"/output-style ","pastedContents":{},"timestamp":1767569147124,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0b24b7d6-9a54-414e-bfce-93768b6b6e32"}
{"display":"help me write an output style for claude that makes more sense for using this as a software architect https://code.claude.com/docs/en/output-styles","pastedContents":{},"timestamp":1767569257339,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"/output-style ","pastedContents":{},"timestamp":1767569332349,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"can you add it to the .claude/config","pastedContents":{},"timestamp":1767569362368,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Its the start of a new year, help me structure the first few weeks ","pastedContents":{},"timestamp":1767569506222,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"lets go strategic","pastedContents":{},"timestamp":1767569541703,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"are all the cml and adoc files in the bounded context folder consistent","pastedContents":{},"timestamp":1767569890580,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Fix what you can","pastedContents":{},"timestamp":1767570092585,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"add the type from the bounded context cml to the front-matter of the adoc partner file","pastedContents":{},"timestamp":1767572333154,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Yes","pastedContents":{},"timestamp":1767572440524,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"ive made updated to the type of some of the service files ","pastedContents":{},"timestamp":1767572796421,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Those bounded contexts i've marked \"CORE\" aren't correct, they don't match the documentation for CML defined here https://contextmapper.org/docs/bounded-context/ help me correct them","pastedContents":{},"timestamp":1767573310572,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"that works","pastedContents":{},"timestamp":1767573353295,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"This is what i've previously written about the loyalty service \"[Pasted text #1 +250 lines]\"","pastedContents":{},"timestamp":1767573659450,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"ooh yes do that for all of the BC services","pastedContents":{},"timestamp":1767573728372,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Are there any inconsistencies between the pasted text and the loyalty service as defined","pastedContents":{},"timestamp":1767574582413,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":" The CML is more correct","pastedContents":{},"timestamp":1767574706866,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"I want to update the Loyalty Service BC to match the style of the pasted text, help me draft the update","pastedContents":{},"timestamp":1767575133946,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Section 11 says repositiories, but that's incorrect isn't it?","pastedContents":{},"timestamp":1767577018831,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"The headings below it don't feel like they're in the right place","pastedContents":{},"timestamp":1767577149798,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Make all those updates","pastedContents":{},"timestamp":1767577200295,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Lets review the Engagement service the same way, this is my original spec [Pasted text #2 +60 lines]","pastedContents":{},"timestamp":1767582019640,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"The CML is correct","pastedContents":{},"timestamp":1767582106385,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Are there any consistencies between the pasted text and the local versions","pastedContents":{},"timestamp":1767582569418,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Fix those so they're structurally compatible with the loyalty doc","pastedContents":{},"timestamp":1767582860781,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Ensure the document is in Australian English","pastedContents":{},"timestamp":1767587968886,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"/exit ","pastedContents":{},"timestamp":1767590705540,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ffbb8ee7-3395-4737-9737-65ae353993b0"}
{"display":"Help me solve [Pasted text #1 +9 lines]","pastedContents":{},"timestamp":1767654707063,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"39f61564-b490-4c3a-be2f-c8cefd57bfef"}
{"display":"Nope [Pasted text #1 +11 lines]","pastedContents":{},"timestamp":1767655184003,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"39f61564-b490-4c3a-be2f-c8cefd57bfef"}
{"display":"i want a regular expression that finds all instances of xref that aren't follwed by \":\"","pastedContents":{},"timestamp":1767656929619,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff0dfef0-4d35-4031-bf30-a782e8e7224c"}
{"display":"ex=it","pastedContents":{},"timestamp":1767656979624,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff0dfef0-4d35-4031-bf30-a782e8e7224c"}
{"display":"exit","pastedContents":{},"timestamp":1767656980830,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff0dfef0-4d35-4031-bf30-a782e8e7224c"}
{"display":"exit","pastedContents":{},"timestamp":1767656981773,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff0dfef0-4d35-4031-bf30-a782e8e7224c"}
{"display":"/exit ","pastedContents":{},"timestamp":1767656986495,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff0dfef0-4d35-4031-bf30-a782e8e7224c"}
{"display":"Review solution_architectures\\flybuys_integration.adoc and tell me where we can add profile creation, i want to ensure that there's an endpoint that can create a new profile and link salesforce, create a wallet ","pastedContents":{},"timestamp":1767657857618,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"The just-in-time integration should use this endpoint","pastedContents":{},"timestamp":1767658088316,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Lets make those changes","pastedContents":{},"timestamp":1767658286043,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Lets drop the customers suffix on the api endpoint, it should just be a post to /api/v1/profile","pastedContents":{},"timestamp":1767658605116,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"maybe not, we should keep that customers suffix for consistency","pastedContents":{},"timestamp":1767658827500,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"lets add a GET /customers/{vivaConsumerId} too","pastedContents":{},"timestamp":1767659018405,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"GET /partners should consume the VCI off of the URL params like GET /customers","pastedContents":{},"timestamp":1767659215975,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"remove membership tiers from those documents","pastedContents":{},"timestamp":1767660235030,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Creating a new profile should upsert a Salesforce profile if it doesn't exist","pastedContents":{},"timestamp":1767660866591,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"This response is incorrect \"Invalid Salesforce Contact ID format\" - the Contact ID isn't part of the params so that endpoint can't reject it","pastedContents":{},"timestamp":1767661336395,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"vivaConsumerId shouldn't be part of requestBody for createCustomerProfile, but email address should","pastedContents":{},"timestamp":1767661634740,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Update the description block of the openAPI doc","pastedContents":{},"timestamp":1767663954148,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"\" VCI (Viva Consumer ID) is generated by ProfileService, not provided by clients\" this is wrong, it comes from Salesforce","pastedContents":{},"timestamp":1767664060425,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"What else is that service's API missing ","pastedContents":{},"timestamp":1767664606103,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"1 & 2 belong on the loyalty service, 3 is returned on the whole profile, 4 is on the oauth service, 5 and 6 can be added","pastedContents":{},"timestamp":1767665271278,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":" Create teh relevant Json Schemas for all this work","pastedContents":{},"timestamp":1767666223554,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"no i meant, event schemas","pastedContents":{},"timestamp":1767666475000,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"remove the other schemas that aren't events","pastedContents":{},"timestamp":1767666737135,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Lets rename \"CustomerEnrolled\" to \"CustomerProfileCreated\"","pastedContents":{},"timestamp":1767666806221,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"In strict DDD, should the engagement service create a user profile on braze or the profile service?","pastedContents":{},"timestamp":1767669651816,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Using that logic, then the Profile Service shouldn't create the Loyalty Wallet either","pastedContents":{},"timestamp":1767669769220,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"Lets keep it clean DDD, option 1","pastedContents":{},"timestamp":1767669878788,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"I'm writing up the Salesforce Customer Service migration solution design, help","pastedContents":{},"timestamp":1767748777003,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Current state is irrelevant since we're deprecating it","pastedContents":{},"timestamp":1767748876485,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Lets go through this one-by-one","pastedContents":{},"timestamp":1767749018126,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"/agents ","pastedContents":{},"timestamp":1767749020549,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"We're consolidating all the digital channels into Salesforce, via the Engagement Service","pastedContents":{},"timestamp":1767749062183,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Salesforce is already used for some customer support cases, by other business units","pastedContents":{},"timestamp":1767749106841,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Questions 1-by-1 please","pastedContents":{},"timestamp":1767749152228,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Its used by the Viva Energy side of our business, we've inherited it as part of a corporate merger","pastedContents":{},"timestamp":1767749250410,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Fuel wholesale, Shell Card customers, customers of other retail channels","pastedContents":{},"timestamp":1767749331630,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Yes","pastedContents":{},"timestamp":1767749366837,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Shared instance","pastedContents":{},"timestamp":1767750093259,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"I think it's just Service Cloud","pastedContents":{},"timestamp":1767750129202,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Cases and Contacts ","pastedContents":{},"timestamp":1767750241718,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"App Issues, transaction disputes, product issues, maybe store feedback? ","pastedContents":{},"timestamp":1767750298974,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"In app feedback ","pastedContents":{},"timestamp":1767750378763,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"That's correct","pastedContents":{},"timestamp":1767750811287,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"C makes the most sese","pastedContents":{},"timestamp":1767751111810,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Contacts, but they're stored in an app specific database, so we'll migrate/replicate that into Salesforce","pastedContents":{},"timestamp":1767751236313,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"A","pastedContents":{},"timestamp":1767751258832,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"No migration needed","pastedContents":{},"timestamp":1767751300422,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Big bang cutover","pastedContents":{},"timestamp":1767751495759,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"It should","pastedContents":{},"timestamp":1767751581174,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"We're going to do async case creation, lets mention that Salesforce is the system of record for the case data","pastedContents":{},"timestamp":1767751783089,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"It's a consolidation, a better unified view, and a retiring of the current support experience which isn't working so well","pastedContents":{},"timestamp":1767751857366,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Love all those","pastedContents":{},"timestamp":1767751921894,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Criticially evaluate my responses and suggest areas I haven't covered","pastedContents":{},"timestamp":1767751976348,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"one by one","pastedContents":{},"timestamp":1767752039371,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Option C","pastedContents":{},"timestamp":1767752155932,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"a","pastedContents":{},"timestamp":1767752190600,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"A, with B","pastedContents":{},"timestamp":1767752343380,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"A","pastedContents":{},"timestamp":1767752555482,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"A","pastedContents":{},"timestamp":1767752680575,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"That should configurable","pastedContents":{},"timestamp":1767752738214,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Upsert, matched by whatever params provided","pastedContents":{},"timestamp":1767752794747,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Probably email address","pastedContents":{},"timestamp":1767752831756,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"C","pastedContents":{},"timestamp":1767752907716,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Category selection - App, Service, Order, Rewards, Refund, Delete Account","pastedContents":{},"timestamp":1767752969630,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Theres more, Store Name, Time of Visit, Contact Phone Number and free text message","pastedContents":{},"timestamp":1767752995084,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Lets leave that unresolved","pastedContents":{},"timestamp":1767753022847,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Nope, and we're not considering adding it","pastedContents":{},"timestamp":1767753045253,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"I don't know, lets follow up","pastedContents":{},"timestamp":1767753229005,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Undecided but probably REST","pastedContents":{},"timestamp":1767753299102,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Undecided","pastedContents":{},"timestamp":1767753329937,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"I'm finding out numbers, but with the event based approach we can monitor it better","pastedContents":{},"timestamp":1767753722355,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Not our concern","pastedContents":{},"timestamp":1767753785539,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"B ","pastedContents":{},"timestamp":1767753816648,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Undecided","pastedContents":{},"timestamp":1767753857150,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Future enhancement ","pastedContents":{},"timestamp":1767753980031,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Event Schema can come later, testing approach would be good to touch on later, rollback plan is unnecessary, outlining the ProfileSevice is good","pastedContents":{},"timestamp":1767754188911,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"New, this will be deployed before the Flybuys project","pastedContents":{},"timestamp":1767754486877,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"C","pastedContents":{},"timestamp":1767754550211,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"You're right","pastedContents":{},"timestamp":1767754688981,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"B","pastedContents":{},"timestamp":1767754705920,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"B & C","pastedContents":{},"timestamp":1767754742066,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"C","pastedContents":{},"timestamp":1767754775745,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"A","pastedContents":{},"timestamp":1767754816439,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"Don't just constrain this to the exec summary, use this context across the whole doc","pastedContents":{},"timestamp":1767755107267,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"exut","pastedContents":{},"timestamp":1767755641641,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"exit","pastedContents":{},"timestamp":1767755642890,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"/exit ","pastedContents":{},"timestamp":1767755661633,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c7bf99a4-22b1-498b-b2bf-bb697fa65a6e"}
{"display":"exit","pastedContents":{},"timestamp":1767755694092,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d6f85549-d179-47c0-be32-c1c126337fbd"}
{"display":"We're working on the Salesforce solution architecture ","pastedContents":{},"timestamp":1767756299155,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"all of those, but first \"REQUIRES UPDATE - Add feedback form fields\n(Category, Store Name, Time of Visit, Contact\nPhone Number),\" is wrong, those exist in the UI of the App","pastedContents":{},"timestamp":1767756346737,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"Structurally, how does it compare to the flybuys solution doc","pastedContents":{},"timestamp":1767757710355,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"Bearing in mind this is a TOGAF compatible Solution Architecutre, lets make the necessary changes to the Salesforce Support doc","pastedContents":{},"timestamp":1767758048607,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"Ensure we're using Australian English","pastedContents":{},"timestamp":1767758569444,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"Lets do all that too","pastedContents":{},"timestamp":1767759063340,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":" Include somewhere that on 20k DAU we expect 100-150 submissions","pastedContents":{},"timestamp":1767760080529,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":" Domain event schemas should be in stored with the others, not in this doc","pastedContents":{},"timestamp":1767764837666,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"could you rationalise some of the architectural decisions we've made, and their reasoning","pastedContents":{},"timestamp":1767825383443,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c6b70995-fb42-44d0-878a-2a2a203ac178"}
{"display":"lets make the way we talk about phases consistent, we talk about AS-1 and AS-4 in one solution doc and TS-1 to TS-4 in another ","pastedContents":{},"timestamp":1767849535289,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"I think I like TS better","pastedContents":{},"timestamp":1767849790748,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"Does TOGAF have a suggestion on this?","pastedContents":{},"timestamp":1767850073959,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"Yeh, lets go with TS","pastedContents":{},"timestamp":1767850541755,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"Make architectural_approach.adoc more generic, and less specifically about the Salesforce project","pastedContents":{},"timestamp":1767851089269,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"exit","pastedContents":{},"timestamp":1767851395033,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e680ea8c-6c11-4a5a-ac3f-d4c072e5d046"}
{"display":"how do i convert this whole adoc repo into a HTML site?","pastedContents":{},"timestamp":1767911745670,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"lets go with antora","pastedContents":{},"timestamp":1767911811300,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"lets make those link conversions","pastedContents":{},"timestamp":1767912447464,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"commit all the changes","pastedContents":{},"timestamp":1767913303344,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"push them","pastedContents":{},"timestamp":1767913408449,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"The flybuys exec summary still refers to \"AS\" as stages","pastedContents":{},"timestamp":1767913647261,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"The solution architectures use TS","pastedContents":{},"timestamp":1767914109024,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"I have an exec summary for flybuys, write one in a similar style for the salesforce customer support","pastedContents":{},"timestamp":1767914269026,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"That new exec summary didn't appear in the antora generated HTML version","pastedContents":{},"timestamp":1767914598137,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"How do we configure antora to generate mermaid diagrams in the HTML","pastedContents":{},"timestamp":1767914944024,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"I want to chagne this piece of CSS in teh default stylesheet [Pasted text #1 +10 lines]","pastedContents":{"1":{"id":1,"type":"text","content":"@media screen and (min-width: 1024px) {\n    .doc {\n        -webkit-box-flex: 1;\n        -ms-flex: auto;\n        flex: auto;\n        font-size: .94444rem;\n        margin: 0 2rem;\n        max-width: 46rem;\n        min-width: 0;\n    }\n}"}},"timestamp":1767915275261,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"continue that prompt","pastedContents":{},"timestamp":1767915798364,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"continue","pastedContents":{},"timestamp":1767916319416,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0be73a0e-ee82-4e81-bfa6-967fc4e09322"}
{"display":"I don't want to call them projects, what else should i use as a collective noun for Flybuys Integraiton and Salesforce Customer Servcice reconcilliation","pastedContents":{},"timestamp":1767918073399,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"I think i like Initiatives better, because it encompasses architecture and solution","pastedContents":{},"timestamp":1767918321744,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"in executive_summaries\\salesforce_customer_support.adoc, link all the bounded contexts ","pastedContents":{},"timestamp":1767919648477,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"take those referennces out of the mermaid diagrams ","pastedContents":{},"timestamp":1767920029794,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"I wanto add that we're going to rely on Braze to do the outbound comms from Salesforce Service Cloud, add that to the relevant documetns and suggest one or two rationale for doing it ","pastedContents":{},"timestamp":1767920463047,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"lets resolve all of tese [Pasted text #1 +162 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"c1ed14d687a6fad1"}},"timestamp":1767921233431,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"I lost the base CSS styleing in antora","pastedContents":{},"timestamp":1767921907005,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"I need the kroki extensions for mermaid","pastedContents":{},"timestamp":1767922188881,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"exit","pastedContents":{},"timestamp":1767922466161,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0630e038-1cd9-48c5-8a08-a977cb08c697"}
{"display":"exit","pastedContents":{},"timestamp":1767922719099,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"dba6e3e3-690b-49d6-b871-5c43685dc58f"}
{"display":"Remove the inline interface specifications from the salesforce solution architecture and add them to the existing specifications","pastedContents":{},"timestamp":1767924420669,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"20efca1b-fb32-41ec-8809-d5d93e912a9c"}
{"display":"does that doc align to a good TOGAF Phase E doc?","pastedContents":{},"timestamp":1767926208454,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"20efca1b-fb32-41ec-8809-d5d93e912a9c"}
{"display":"Lets add work packages","pastedContents":{},"timestamp":1767926389476,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"20efca1b-fb32-41ec-8809-d5d93e912a9c"}
{"display":"can you make the flybuys doc consistent with those missing sections too, they should both be exemplarly TOGAF Phase E docs","pastedContents":{},"timestamp":1767927102798,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"20efca1b-fb32-41ec-8809-d5d93e912a9c"}
{"display":"commit and push these changes","pastedContents":{},"timestamp":1767927536718,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"20efca1b-fb32-41ec-8809-d5d93e912a9c"}
{"display":"internally link the work packages in teh salesforce soultion arch","pastedContents":{},"timestamp":1767928105505,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":"Commit and push this","pastedContents":{},"timestamp":1767928411849,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":" Why are my initiative documents not linking properly in the navigation ","pastedContents":{},"timestamp":1767931353968,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":"Update the Profile Service bounded context to reflect both initiatives and it's paired CML file","pastedContents":{},"timestamp":1767933153055,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":"Are teh structures of the solution architectures consistent","pastedContents":{},"timestamp":1767934390103,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":"Yep","pastedContents":{},"timestamp":1767934581584,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"c0394f79-edf2-458f-ac85-c72efa8db83c"}
{"display":"/exit ","pastedContents":{},"timestamp":1768187791088,"project":"/mnt/c/Users/o.young/work/architecture/pdf","sessionId":"9f13741d-169c-4bb6-bc09-c50bdca62938"}
{"display":"Looking at my domain structure, where does an API that provides access to pricing data for digital menu boards best sit, feel free to suggest a new domains","pastedContents":{},"timestamp":1768187898768,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"The first usecase is in our QSR (quick service restaurants)","pastedContents":{},"timestamp":1768188181502,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"lets go through this point by point and refine the problem scope, but initially not all price boards are for QSRs necessarily, we have home brands that might use this feature, and potentially we could use it for the mobile app too","pastedContents":{},"timestamp":1768188540624,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"point by point!","pastedContents":{},"timestamp":1768188591330,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"All of those potentially","pastedContents":{},"timestamp":1768188618077,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"That covers the extent feature set","pastedContents":{},"timestamp":1768188654974,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"236729f7-4117-4ee0-b2f4-8e4c53836978"}
{"display":"consider subway_draft.md and the context of the architecture in this repo","pastedContents":{},"timestamp":1768272835103,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"lets go 1 by 1","pastedContents":{},"timestamp":1768275268348,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"I want to break this draft up into one file for TOGAF phase A B & C, one for phase D in architecture_definitions and a phase E doc in solution_architectures","pastedContents":{},"timestamp":1768275435913,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"Option A is good, it is proejct OTR-003 and i need to determine which domain it is (we don't have one that fits this)","pastedContents":{},"timestamp":1768275519902,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"Yep, lets call it the Product domain","pastedContents":{},"timestamp":1768276214110,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"call it ProductCatalogService","pastedContents":{},"timestamp":1768276299892,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"it's a Facade layer","pastedContents":{},"timestamp":1768276342986,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"Yes, but it's future proofing","pastedContents":{},"timestamp":1768276379555,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"exit","pastedContents":{},"timestamp":1768276988538,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"851e1471-ae93-4988-b3c0-ae1d37965d86"}
{"display":"fix the symlinks for antora","pastedContents":{},"timestamp":1768277665945,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0c6a7a51-bd07-4ead-8a9a-05b6932ba3ec"}
{"display":"we're missing the subway dmb pages","pastedContents":{},"timestamp":1768277861758,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0c6a7a51-bd07-4ead-8a9a-05b6932ba3ec"}
{"display":"create the initiative doc too","pastedContents":{},"timestamp":1768278225229,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0c6a7a51-bd07-4ead-8a9a-05b6932ba3ec"}
{"display":"lets create a CML file for the ProductCatalog domain","pastedContents":{},"timestamp":1768278814862,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"3","pastedContents":{},"timestamp":1768278854130,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"right now it's just orchestration for the DMB project but we could review in the future","pastedContents":{},"timestamp":1768279089297,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"1, fix the naming","pastedContents":{},"timestamp":1768279481200,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"'ProductRecommendation' doesn't bleong in that domain, we have an whole domain for that ","pastedContents":{},"timestamp":1768279577563,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"create a AsciiDoc for the CML file","pastedContents":{},"timestamp":1768280151983,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"Are all of those paired docs consistent","pastedContents":{},"timestamp":1768280465222,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"1","pastedContents":{},"timestamp":1768280688072,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"exit","pastedContents":{},"timestamp":1768280948007,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"0c6a7a51-bd07-4ead-8a9a-05b6932ba3ec"}
{"display":"Lets make initiatives\\subway_dmb.adoc consistent with the structure and tone of initiatives\\salesforce_customer_support.adoc","pastedContents":{},"timestamp":1768281222626,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"Match the structures too","pastedContents":{},"timestamp":1768281626016,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"\u0004\u0004\u0004\u0004\u0004\u0004\u0004\u0004\u0004\u0004\u0004do the same with the solution architectures","pastedContents":{},"timestamp":1768282274132,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"Option 2","pastedContents":{},"timestamp":1768282403593,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"lastly, again with the architecture definitions","pastedContents":{},"timestamp":1768283165054,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"\"Amped Digital\n\nDigital Menu Board platform consuming pricing API (external vendor)\" is wrong, https://www.menuzen.com/ is teh platform, Amped are the agency managing it","pastedContents":{},"timestamp":1768283454959,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"Remove [Pasted text #1 +6 lines]","pastedContents":{"1":{"id":1,"type":"text","content":"Future: OTR Mobile App\n\nProduct catalog queries for in-app ordering and promotions\n\nFuture: SMGB Online Ordering\n\nReal-time product availability and pricing"}},"timestamp":1768283805060,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"exit","pastedContents":{},"timestamp":1768342873058,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"25770c90-8459-4fa8-a418-0a36a99765ec"}
{"display":"my settings file is a mess, tidy it up","pastedContents":{},"timestamp":1768343082446,"project":"/mnt/c/Users/o.young/AppData/Roaming/Code/User","sessionId":"68f64a10-f944-419e-b61e-6969bd55e643"}
{"display":"ensure that my editor settings override any duplicated language specific settings, tabSize for isntance","pastedContents":{},"timestamp":1768343220019,"project":"/mnt/c/Users/o.young/AppData/Roaming/Code/User","sessionId":"68f64a10-f944-419e-b61e-6969bd55e643"}
{"display":"what does  \"editor.formatOnSaveMode\": \"file\" mean?","pastedContents":{},"timestamp":1768343318836,"project":"/mnt/c/Users/o.young/AppData/Roaming/Code/User","sessionId":"68f64a10-f944-419e-b61e-6969bd55e643"}
{"display":"i've made changes to my initiative doc for the digital menu boards, ensure the solution design and architecture is still consistent","pastedContents":{},"timestamp":1768348845113,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Go One by one ","pastedContents":{},"timestamp":1768348982518,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"yes, fix all links without prompting","pastedContents":{},"timestamp":1768349052886,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"year based","pastedContents":{},"timestamp":1768349172322,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"lets go with configurable","pastedContents":{},"timestamp":1768349363942,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Are tehre any other inconsistencies","pastedContents":{},"timestamp":1768349713036,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Yeah","pastedContents":{},"timestamp":1768349977576,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"99%","pastedContents":{},"timestamp":1768350129092,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"combine them, take out time estimation","pastedContents":{},"timestamp":1768350269183,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Yes please","pastedContents":{},"timestamp":1768350351614,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"yes, but that's unimportant, that's implementation detail","pastedContents":{},"timestamp":1768350405635,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"1.2+","pastedContents":{},"timestamp":1768350512879,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Take out the rate limiting, that shouldn't be an issue","pastedContents":{},"timestamp":1768350670828,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"Yes","pastedContents":{},"timestamp":1768354153975,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"i want a build script that runs `asciidoctor-pdf --theme asciidoc/theme.yml -a pdf-fontsdir=asciidoc/fonts -r asciidoctor-diagram -D pdf` for all asciidocs and maintains the folder structure under the pdf folder","pastedContents":{},"timestamp":1768363960628,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"exit","pastedContents":{},"timestamp":1768364130399,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6d11c0b1-19c6-4161-8d22-2463d67472ef"}
{"display":"exit","pastedContents":{},"timestamp":1768437476252,"project":"/mnt/c/Users/o.young/AppData/Roaming/Code/User","sessionId":"68f64a10-f944-419e-b61e-6969bd55e643"}
{"display":"Replicate the structure of other initiatives In initiatives\\flybuys_strategic_data.adoc ","pastedContents":{},"timestamp":1768528250960,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"f6407e15-51b0-43e0-92bf-7016f51baa0c"}
{"display":"replicate the document structure from initiatives\\digital_menu_board.adoc into initiatives\\flybuys_strategic_data.adoc","pastedContents":{},"timestamp":1768529147168,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"create a template file and suggest the best place to put that in your configuraiton files or skills or agents to ensure it's used for all upcoming initiative files","pastedContents":{},"timestamp":1768529265857,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"Consider this [Pasted text #1 +202 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"9de7cb419d654ed6"}},"timestamp":1768534255635,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"This is the current as-is state, the initiative doc is kind of retrospectively documenting it (it's already in production) so we can change the target SFTP location and cadence in phase one, and extend it to the OTR stores in phase 2","pastedContents":{},"timestamp":1768534483913,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"\"VIVA stores (Subway, Oporto, Red Rooster) currently sending Flybuys transaction data\" This is incorrect. We refer to them as QSRs, they're OTRG stores, and Red Rooster isn't one of them","pastedContents":{},"timestamp":1768535034479,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"I need the tone of the document to be less \"we will build\" and more \"this is the current state and these are the changes\"","pastedContents":{},"timestamp":1768535165993,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"these are not \"VIVA QSRs\" either, they are \"Reddy Express stores\"","pastedContents":{},"timestamp":1768535613716,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"Replace VIVA Group with OTRG and  VIVA product taxonomy/categorisation as Reddy Express product taxonomy/categorisation","pastedContents":{},"timestamp":1768535753951,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"exit","pastedContents":{},"timestamp":1768535937324,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6977e7e4-83c4-46c7-8257-69ca1ace5475"}
{"display":"Through \"initiatives\\flybuys_strategic_data.adoc\" we refer to Phase 1 changing to daily, but in implementation phases, it's considerd TS-2, make this consistent","pastedContents":{},"timestamp":1768536601316,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"display":"create vscode actions from the shell scripts and makeiles in this project","pastedContents":{},"timestamp":1768537499100,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"there's redundancy between the build-site.sh and the package.json, remove the shell file from references everywhere","pastedContents":{},"timestamp":1768538100252,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003Ensure all of the antora navigations are correctly link and don't leave out any pages including content we just created","pastedContents":{},"timestamp":1768539038781,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"\u0003\u0003ensure all the initiatives are linked correctly ","pastedContents":{},"timestamp":1768539806690,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"+","pastedContents":{},"timestamp":1768540124417,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"exit","pastedContents":{},"timestamp":1768540127018,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"a4169231-4394-4018-9ea1-2f9a6d4da666"}
{"display":"incorporate these notes into this doc, but translate their \"Phase 1\" to be our TS-2, and their \"Phase 2\" to be our TS-3 [Pasted text #1 +37 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"d309fbdeba0b6f93"}},"timestamp":1768540517848,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"display":"what happened? you haven't changed anything","pastedContents":{},"timestamp":1768541451126,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"355e98b6-186d-4e93-a5c7-30b5da789eef"}
{"display":"[Pasted text #1 +38 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"ba112aee8ca092a5"}},"timestamp":1768541498141,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d29de7ce-50e2-431c-9dce-845c8ed01a65"}
{"display":"remove my name from that doc, it should be generic","pastedContents":{},"timestamp":1768541641015,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d29de7ce-50e2-431c-9dce-845c8ed01a65"}
{"display":"Reverse engineer this into a TOGAF compatiable Phase C: Information Systems Architectures doc like the others in architecture_definitions","pastedContents":{},"timestamp":1768541736924,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d29de7ce-50e2-431c-9dce-845c8ed01a65"}
{"display":"/rate-limit-options","pastedContents":{},"timestamp":1768541968785,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"d29de7ce-50e2-431c-9dce-845c8ed01a65"}
{"display":"how do i stop folders having a green background in my terminal","pastedContents":{},"timestamp":1768781783317,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"i'm also getting E303: Unable to open swap file for \"/home/oliy/.zshrc\", recovery impossible","pastedContents":{},"timestamp":1768781912562,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"i want the foreground of directories to a different color","pastedContents":{},"timestamp":1768781988324,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"bright cyan","pastedContents":{},"timestamp":1768782044849,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"i lost all folder colors","pastedContents":{},"timestamp":1768782089611,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"nope","pastedContents":{},"timestamp":1768782121667,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"nope","pastedContents":{},"timestamp":1768782156896,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"keep going","pastedContents":{},"timestamp":1768782221149,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"exit","pastedContents":{},"timestamp":1768782299006,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ff355909-2491-4445-af4e-4ae1dca94741"}
{"display":"lets review architecture_definitions\\flybuys_integration.adoc","pastedContents":{},"timestamp":1768782372376,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"66d0b50c-35b6-4220-a996-9c8fe1c489af"}
{"display":"All of the domain models in this doc should already have CML files","pastedContents":{},"timestamp":1768782485850,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"66d0b50c-35b6-4220-a996-9c8fe1c489af"}
{"display":"lets do #1 first","pastedContents":{},"timestamp":1768782636345,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"66d0b50c-35b6-4220-a996-9c8fe1c489af"}
{"display":"do all that","pastedContents":{},"timestamp":1768782789985,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"66d0b50c-35b6-4220-a996-9c8fe1c489af"}
{"display":"lets migrate the architecture definition first","pastedContents":{},"timestamp":1768783645462,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"66d0b50c-35b6-4220-a996-9c8fe1c489af"}
{"display":"consider this article [Pasted text #1 +97 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"8f105928e3283781"}},"timestamp":1768796164373,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6255da7a-23f4-4281-addc-a4e36121a3a7"}
{"display":"can you check your findings from that doc agains the initiative files, the solution architectures and the architectural definitions","pastedContents":{},"timestamp":1768796227817,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6255da7a-23f4-4281-addc-a4e36121a3a7"}
{"display":"Add the problem statement to those two files, and update the template","pastedContents":{},"timestamp":1768796407684,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6255da7a-23f4-4281-addc-a4e36121a3a7"}
{"display":"this is incorrect \"Reducing points attribution delay from D+7 to D+1\" this initiative doesn't touch the points file","pastedContents":{},"timestamp":1768796631358,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6255da7a-23f4-4281-addc-a4e36121a3a7"}
{"display":"exit","pastedContents":{},"timestamp":1768797339481,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"6255da7a-23f4-4281-addc-a4e36121a3a7"}
{"display":"help me merge 'subway-dmb' into this branch","pastedContents":{},"timestamp":1768797709360,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ab880868-71ac-4f85-9d90-ae1d8f0679dc"}
{"display":"exit","pastedContents":{},"timestamp":1768798261360,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ab880868-71ac-4f85-9d90-ae1d8f0679dc"}
{"display":"git st","pastedContents":{},"timestamp":1768798262421,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"ab880868-71ac-4f85-9d90-ae1d8f0679dc"}
{"display":"the shortcuts in the modules subfolder make git think they're not updated, can you fix it","pastedContents":{},"timestamp":1768798432321,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"4a60f12c-c125-4e6a-9a34-9cce641d11c3"}
{"display":"\u0003\u0003\u0003\u0003\u0003\u0003\u0003exit","pastedContents":{},"timestamp":1768798453463,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"4a60f12c-c125-4e6a-9a34-9cce641d11c3"}
{"display":"dksadkasl;d","pastedContents":{},"timestamp":1768798472752,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"4a60f12c-c125-4e6a-9a34-9cce641d11c3"}
{"display":"can you produce a solution architecture from initiatives\\flybuys_strategic_data.adoc","pastedContents":{},"timestamp":1768799560613,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fdefcb4a-7dbb-4bf2-a13c-29deebb4e226"}
{"display":"that doc should live in solution_architectures","pastedContents":{},"timestamp":1768799879524,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fdefcb4a-7dbb-4bf2-a13c-29deebb4e226"}
{"display":"is it consistent with the other solution architectures, remember it should reflect a TOGAF E document","pastedContents":{},"timestamp":1768799965772,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"fdefcb4a-7dbb-4bf2-a13c-29deebb4e226"}
{"display":"my dircolors aren't working in my shell","pastedContents":{},"timestamp":1768862337009,"project":"/home/oliy","sessionId":"ef60f740-c7d1-4166-ad25-572637ed98f7"}
{"display":"i have a ","pastedContents":{},"timestamp":1768862582739,"project":"/home/oliy","sessionId":"ef60f740-c7d1-4166-ad25-572637ed98f7"}
{"display":"i have a ~/.bashrc and a ~/dotfiles/.bashrc and a ~/dotfiles/.zshrc - i exclusively use zsh, consolidate the two bashrc files, and add the important things to the zshrc","pastedContents":{},"timestamp":1768862675959,"project":"/home/oliy","sessionId":"ef60f740-c7d1-4166-ad25-572637ed98f7"}
{"display":"which bashrc can i delete","pastedContents":{},"timestamp":1768862773805,"project":"/home/oliy","sessionId":"ef60f740-c7d1-4166-ad25-572637ed98f7"}
{"display":"i have claude config all through this project, can you consolidate it ","pastedContents":{},"timestamp":1768864057266,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e2125f3a-9686-4d40-88ac-8cca993cc5fc"}
{"display":"exit","pastedContents":{},"timestamp":1768864210629,"project":"/home/oliy","sessionId":"ef60f740-c7d1-4166-ad25-572637ed98f7"}
{"display":"conver templates\\architecture_definition_template.md to asciidoc","pastedContents":{},"timestamp":1768864568828,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e2125f3a-9686-4d40-88ac-8cca993cc5fc"}
{"display":"how can i use the front-matter of the asciidocs more effectively, like as a table in the HTML output","pastedContents":{},"timestamp":1768865166601,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e2125f3a-9686-4d40-88ac-8cca993cc5fc"}
{"display":"add all these to all the asciidoc in the initiative folder","pastedContents":{},"timestamp":1768865822695,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e2125f3a-9686-4d40-88ac-8cca993cc5fc"}
{"display":"exit","pastedContents":{},"timestamp":1768866134808,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"e2125f3a-9686-4d40-88ac-8cca993cc5fc"}
{"display":"can we move '[Pasted text #1 +10 lines]' into a shared component?","pastedContents":{"1":{"id":1,"type":"text","content":"[discrete]\n=== Initiative Information\n\n[cols=\"2,5\"]\n|===\n|Project Code |{project}\n|Domain |{domain}\n|Status |icon:hourglass-half[role=yellow] {status}\n|Target Delivery |{target-delivery}\n|Domain Architect |mailto:{domain-architect}[{domain-architect}]\n|==="}},"timestamp":1768867281194,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"yes","pastedContents":{},"timestamp":1768867399099,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"getting \"Unresolved include directive in modules/initiatives/pages/flybuys_integration.adoc - include::../templates/_initiative_metadata.adoc[]\"","pastedContents":{},"timestamp":1768868091618,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"now i get include file not found: c:/Users/o.young/work/architecture/initiatives/partial$_initiative_metadata.adoc","pastedContents":{},"timestamp":1768868269195,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"Lets resolve all these [Pasted text #1 +422 lines]","pastedContents":{"1":{"id":1,"type":"text","contentHash":"953201dfbd44c30e"}},"timestamp":1768885867916,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"commit and push all the changes","pastedContents":{},"timestamp":1768887472387,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"Do the architecture docs here reflect a good application of clean architecture concepts?","pastedContents":{},"timestamp":1768947730154,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"lets go through those one by one and resolve them, and then sprinkle in references to Clean Architecture where appropriate","pastedContents":{},"timestamp":1768947961710,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"yes","pastedContents":{},"timestamp":1768948379816,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"In the future, don't create code examples, keep it to generic or with diagrams","pastedContents":{},"timestamp":1768949248187,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"lets do 2 first","pastedContents":{},"timestamp":1768949294247,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"1","pastedContents":{},"timestamp":1768950008842,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"exit","pastedContents":{},"timestamp":1768976203732,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"git st","pastedContents":{},"timestamp":1768976206042,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"b0b6f6ee-c582-4047-a226-4d113c905b6a"}
{"display":"git commit and push ","pastedContents":{},"timestamp":1769153790535,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"14e34d7a-e717-49e9-88df-9ee480b9819f"}
{"display":"exit","pastedContents":{},"timestamp":1769153880839,"project":"/mnt/c/Users/o.young/work/architecture","sessionId":"14e34d7a-e717-49e9-88df-9ee480b9819f"}
{"display":"fix ls: unrecognized option `--group-directories-first'","pastedContents":{},"timestamp":1769156817283,"project":"/Users/oliyoung/dotfiles","sessionId":"6605e187-0b1f-41fd-a514-908d628fc4f3"}
{"display":"exit","pastedContents":{},"timestamp":1769156864954,"project":"/Users/oliyoung/dotfiles","sessionId":"6605e187-0b1f-41fd-a514-908d628fc4f3"}
{"display":"replace ls with eza in my dotfiles","pastedContents":{},"timestamp":1769156900980,"project":"/Users/oliyoung/dotfiles","sessionId":"21cb9da8-70eb-4b3b-82b1-857211591373"}
{"display":"add `source ~/.zshrc` to the makefiles","pastedContents":{},"timestamp":1769156942458,"project":"/Users/oliyoung/dotfiles","sessionId":"21cb9da8-70eb-4b3b-82b1-857211591373"}
{"display":"why show? can't you just run the command?","pastedContents":{},"timestamp":1769156991519,"project":"/Users/oliyoung/dotfiles","sessionId":"21cb9da8-70eb-4b3b-82b1-857211591373"}
{"display":"yeah","pastedContents":{},"timestamp":1769157011229,"project":"/Users/oliyoung/dotfiles","sessionId":"21cb9da8-70eb-4b3b-82b1-857211591373"}
{"display":"exit","pastedContents":{},"timestamp":1769157026095,"project":"/Users/oliyoung/dotfiles","sessionId":"21cb9da8-70eb-4b3b-82b1-857211591373"}
