= ProductCatalog Domain
:canonical: ProductCatalog
:domain-architect: O.Young@otr.com.au
:version: 0.1.0
:domain: ProductCatalog
:doctype: article
:toc: left
:toclevels: 4
:sectanchors:
:sectlinks:
:sectnums:
:icons: font
:source-highlighter: highlightjs
:experimental:

== Domain Vision

Enable product discovery, search, and information retrieval across all retail channels (POS, mobile, web, Digital Menu Boards) by providing accurate, up-to-date product details, pricing, and availability.

== What is the ProductCatalog Domain?

The ProductCatalog Domain encompasses everything customers need to discover, browse, and understand products across all OTR brands (OTR, Reddy Express, Smokemart & GiftBox, Subway). It handles product information, pricing data, search capabilities, and channel-specific product displays like Digital Menu Boards.

This domain acts as a bridge between back-office product management systems (D365 Commerce) and customer-facing digital experiences (mobile apps, web, digital signage).

== Domain Structure

This domain is divided into several subdomains, each handling a specific aspect of product information and discovery:

=== Core Subdomains

Core subdomains represent the unique competitive advantage and primary business value of the ProductCatalog Domain. These are the capabilities that differentiate OTR's product catalog experience.

==== ProductDiscovery

===== Purpose

Provide product search, filtering, and browsing capabilities tailored to customer context and channel.

===== Plain English

This is how customers find products:

*Search Capabilities:*

- Keyword search ("coffee", "fuel", "sandwich")
- Category browsing ("Beverages", "Food", "Tobacco")
- Filter by attributes (price range, dietary restrictions, brand)
- Location-aware search (show products available at nearby stores)
- Channel-specific search (mobile vs web vs DMB)

*Contextual Discovery:*

- Time-based filtering (breakfast menu vs lunch menu for DMBs)
- Location-based availability (fuel products only at fuel sites)
- Customer preferences (vegetarian options, allergen filtering)
- Popular products at specific stores

This is core because the specific search algorithms, filtering logic, and contextual discovery rules reflect OTR's multi-brand, multi-channel retail strategy.

=== Supporting Subdomains

Supporting subdomains are necessary for the domain to function but don't provide competitive differentiation. These could potentially be replaced by third-party solutions or standard platforms.

==== ProductInformation

===== Purpose

Deliver accurate, up-to-date product details, pricing, and availability across channels.

===== Plain English

This is the detailed information about each product:

*Product Attributes:*

- Product name and description
- Category and subcategory
- Pricing (base price, current price, discounts)
- Images and media
- Nutritional information (for food products)
- Allergen information
- Age restrictions (tobacco, alcohol)

*Real-Time Data:*

- Current pricing (updated hourly from D365 Commerce)
- Stock availability (in-stock, out-of-stock, expected restock)
- Location-specific pricing (fuel prices vary by store)
- Promotional pricing (sale prices, limited-time offers)

===== Note

In the current architecture, authoritative product data is owned by D365 Commerce. ProductCatalogService caches this data in RDS PostgreSQL for fast API queries, with hourly updates via ETL pipeline.

==== DigitalMenuBoard

===== Purpose

Display dynamic product offerings on digital menu boards with location-specific pricing and availability.

===== Plain English

This handles Digital Menu Board (DMB) specific capabilities:

*DMB Display Features:*

- Featured products (highlighted items, new arrivals)
- Time-based menu changes (breakfast → lunch → dinner)
- Location-specific menus (Subway vs OTR convenience products)
- Promotional messaging ("Limited time offer!")
- Dynamic pricing updates (fuel prices change hourly)

*DMB Configuration:*

- Display format (portrait vs landscape, screen resolution)
- Product display priority (which products appear first)
- Promotional rotation schedules
- Store-specific customization

===== Note

Initial implementation for Subway DMB project with Amped Digital vendor. ProductCatalogService provides REST API with OAuth 2.0 authentication for external DMB systems.

== Domain Type Classifications

=== Core Domain

These are the unique, differentiating capabilities that provide competitive advantage. We build these in-house because they embody our specific business rules and strategy.

- *ProductDiscovery*: OTR's specific search algorithms, contextual filtering, and multi-brand product discovery patterns

=== Supporting Domain

These are necessary but not differentiating. They could be bought or replaced with third-party platforms.

- *ProductInformation*: Standard product catalog capabilities (could use D365 Commerce, Shopify, or similar)
- *DigitalMenuBoard*: Standard DMB integration patterns (could use third-party DMB platforms)

== Relationship to Bounded Contexts

The ProductCatalog Domain is implemented primarily through the *ProductCatalogService* bounded context, which:

- *Owns:* ProductPrice aggregate (cached pricing data from D365 Commerce)
- *Orchestrates:* ETL pipeline from D365 Commerce S3 exports to RDS PostgreSQL
- *Publishes:* Domain events for pricing changes (future-proofing for event consumers)
- *Exposes:* REST API with Published Language for external consumers (DMB, mobile, web)

*D365 Commerce* also participates in this domain as the authoritative source:

- *Owns:* Product master data, pricing configuration, store assignments, promotional pricing
- *Publishes:* Hourly pricing exports to S3 (cross-cloud Azure → AWS integration)

== Key Architectural Patterns

=== Facade and Anti-Corruption Layer (ACL)

ProductCatalogService acts as a facade that shields customer-facing systems from D365 Commerce's data model and Azure infrastructure. The D365PricingTranslator service provides ACL translation.

=== Cross-Cloud Integration via S3 Data Contract

Clean separation between back-office domain (Azure) and ecommerce domain (AWS) using S3 as the domain boundary with defined data contract.

=== Eventually Consistent Caching

Rather than real-time queries to D365 Commerce, ProductCatalogService caches pricing data in RDS PostgreSQL (hourly refresh). This provides fast API response times but accepts eventual consistency (max 1 hour lag).

=== Open Host Service + Published Language

ProductCatalogService exposes a stable REST API contract in OTR's ubiquitous language (product, price, store, price group), allowing external consumers to integrate without translation.

=== ETL Pipeline Pattern

Hourly batch ETL pipeline (Extract from S3, Transform via ACL, Load to RDS PostgreSQL) rather than real-time CDC (Change Data Capture), balancing simplicity and data freshness requirements.

== Integration Patterns

=== Upstream: D365 Commerce → ProductCatalogService

*Pattern:* Customer-Supplier + Conformist

- D365 Commerce (Supplier) exports pricing data to S3
- ProductCatalogService (Customer) conforms to D365's data contract
- Hourly batch export in Apache Parquet format
- Cross-account IAM access (Azure → AWS)
- Anti-Corruption Layer translates D365 terminology

=== Downstream: ProductCatalogService → External Consumers

*Pattern:* Open Host Service + Published Language

- ProductCatalogService provides stable REST API
- External consumers (Amped Digital DMB, mobile, web) consume without translation
- JSON API with OpenAPI specification
- OAuth 2.0 Client Credentials authentication
- OTR domain terminology (not D365 Commerce terminology)

== Future Enhancements

=== Event-Driven Architecture

Publish domain events for real-time pricing updates:

- *ProductPriceUpdated*: Notify mobile apps and DMBs of price changes
- *ProductAdded/Removed*: Update product catalogs across channels
- *DataValidationFailed*: Alert on data quality issues

*Potential Consumers:*

- LocationService (update store-specific pricing)
- MobileApp (invalidate cached prices, "price drop" notifications)
- EngagementService (trigger "price drop" campaigns)
- Data Platform (analytics on pricing changes)

=== Additional Aggregates

- *ProductSearchHistory*: Track customer searches for analytics and recommendations
- *ProductPreference*: Store customer favorites and preferences
- *MenuBoardConfiguration*: DMB-specific display rules and configurations

=== Advanced Product Discovery

- Personalized search results based on purchase history
- AI-powered product recommendations
- Visual search (image-based product discovery)
- Voice search integration

=== Real-Time Inventory Integration

Currently, ProductCatalogService only caches pricing. Future integration with D365 Commerce for real-time inventory availability would enable:

- "Low stock" indicators
- "Out of stock" notifications
- Expected restock dates
- Reserve products for click-and-collect

== Current Implementation Status

=== In Production

- None (new bounded context)

=== In Development

- Subway DMB pricing API (initial implementation)
- D365 Commerce → S3 hourly export pipeline
- ProductCatalogService ETL pipeline (S3 → RDS PostgreSQL)
- REST API with OAuth 2.0 authentication
- ProductPrice aggregate with pricing cache

=== Planned

- Event publishing for pricing changes
- Redis caching layer for API performance
- Additional aggregates (ProductSearchHistory, ProductPreference)
- GraphQL API for flexible queries
- Real-time inventory integration

== Related Documentation

- *Bounded Context:* xref:bounded-contexts:product_catalog.adoc[ProductCatalogService Bounded Context]
- *Solution Architecture:* xref:solution-architectures:digital_menu_board.adoc[Digital Menu Board Solution Architecture]
- *External Systems:* xref:bounded-contexts:microsoft_dynamics_365_commerce.adoc[D365 Commerce]
- *Domain CML Definition:* `domains/product_catalog.cml`
