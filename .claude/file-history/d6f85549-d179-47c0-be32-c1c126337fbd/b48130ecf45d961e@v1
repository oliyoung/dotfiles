= Salesforce Customer Support
:project-name: Salesforce Customer Support
:togaf-adm-phase: Phase C: Information Systems Architectures
:last-updated: 2026-01-07
:document-type: Architecture Definition Document
:status: Discovery
:version: 0.1
:programme-lead:
:domain-architect: O.Young@otr.com.au
:doctype: article
:toc: left
:toclevels: 4
:sectanchors:
:sectlinks:
:sectnums:
:icons: font
:source-highlighter: highlightjs
:experimental:
:description:
:keywords:

== Introduction & Vision

=== Purpose

The purpose of this Solution Architecture is to define the technical implementation approach for replacing D365 Customer Engagement with Salesforce for customer feedback and support. This document outlines the specific technology products, configurations, interfaces, and deployment architecture that will realize the business objectives and technical requirements defined in the associated Architecture Definition.

=== Vision

> To replace D365 Customer Engagement with Salesforce for customer feedback and support, enabling seamless data flow, unified customer profiles, and streamlined support workflows.

=== Architectural Approach

This architecture adopts a phased migration strategy to transition from D365 Customer Engagement to Salesforce, leveraging middleware for data synchronisation and ensuring minimal disruption to existing support operations.

* *link:../bounded_context/profile.adoc[Profile Service]*: canonical customer identity, data reconciliation, Just-In-Time Integration with Salesforce
* *link:../bounded_context/loyalty.adoc[Loyalty Service]*: Wallet provisioning
* *link:../bounded_context/engagement.adoc[Engagement Service]*: notification orchestration, Braze Anti-Corruption Layer
* *Event-driven integration*: Loose coupling via Event Bus with published domain events
* *Anti-Corruption Layers*: Isolation from external systems (link:../bounded_context/external/braze.adoc[Braze], link:../bounded_context/external/eagle_eye.adoc[EagleEye], link:../bounded_context/external/flybuys.adoc[Flybuys])

=== Scope

==== In Scope

- Solution Building Blocks (SBBs) - specific technology products and versions
- Interface specifications (APIs, events, data formats)
- Data architecture and schema specifications
- Deployment architecture and infrastructure configuration
- Transition architecture with phased implementation states
- Technical validation criteria and testing approach
- External system integration specifications

=== Out Of Scope (covered in Architecture Definition):
- Business requirements and stakeholder analysis
- Architecture decisions and rationale (ADRs)
- Bounded context definitions and responsibilities
- High-level integration patterns (ACL, Conformist, OHS+PL)
- Business capability mapping and value streams
- Non-functional requirements (referenced, not duplicated)
- Architecture principles and governance

=== Architecture Overview

[mermaid]
----
---
config:
  layout: elk
---
flowchart TB
    Customer(["Customer"]) -- Uses --> MobileApp["Mobile App<br>iOS/Android"]
    Customer -- Shops at --> POS["OTR/OTR+ POS<br>D365 Commerce"]
    MobileApp -- Authenticate --> EntraID["Microsoft Entra"]
    MobileApp -- Identifies & Reconciles --> ProfileService["ProfileService"]
    ProfileService <-- Reconcile App User as Salesforce Contact --> Salesforce["Salesforce"]
    ProfileService -- On Create --> EventBus["EventBus"]
    EventBus -- Emits CreateUser Event --> LoyaltyService["LoyaltyService"] & EngagementService["EngagementService"]
    LoyaltyService -- Reconcile Wallet --> EagleEye["EagleEye"]
    EngagementService -- Reconcile Braze Profile --> Braze["Braze"]
    EngagementService --> Salesforce
    D365CE["D365CE"] -- Data Migration --> Salesforce
    MobileApp -- Submits Feedback --> EngagementService

    Customer:::customer
    MobileApp:::presentation
    POS:::presentation
    EntraID:::external
    ProfileService:::newService
    Salesforce:::external
    EventBus:::infrastructure
    LoyaltyService:::newService
    EngagementService:::newService
    EagleEye:::external
    Braze:::external
    D365CE:::external
    classDef newService fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef external fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef infrastructure fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff
    classDef presentation fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff
    classDef customer fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff
----


==== Key Architectural Patterns

== Executive Summary

=== Challenge

OTR digital customers (Mobile App, Web) currently submit feedback and support requests to D365 Customer Engagement, while Viva Energy's broader business units (fuel wholesale, Shell Card customers, other retail channels) use Salesforce Service Cloud. This creates:

* *Fragmented customer support platform*: Customer support data split across two systems, preventing support agents from having a unified view of customer interactions across all channels
* *Operational inefficiency*: Maintaining two separate customer support platforms increases operational overhead and costs
* *Poor support experience*: D365 CE is not working well for digital customer support, impacting customer satisfaction and case resolution times
* *Post-merger consolidation opportunity*: Following Viva Energy's acquisition of OTR, strategic alignment on Salesforce as the enterprise customer support platform

=== Solution

This architecture establishes the **foundational Domain-Driven Design (DDD) implementation** for OTR's target state architecture by introducing two new bounded contexts (link:../bounded_context/profile.adoc[ProfileService], link:../bounded_context/engagement.adoc[EngagementService]) and event-driven integration patterns:

==== New Bounded Contexts

* *link:../bounded_context/profile.adoc[ProfileService]* (NEW): Just-In-Time (JIT) Contact reconciliation with Salesforce, upsert by email, returns Salesforce Contact ID to Mobile App
* *link:../bounded_context/engagement.adoc[EngagementService]* (NEW): Customer feedback submission, Anti-Corruption Layer (ACL) for Salesforce Case creation, Braze integration for customer notifications, async Case processing via Event Bus
* *Event Bus* (NEW pattern): Domain event publishing using existing AWS infrastructure (SNS+SQS/EventBridge/Kinesis) - first implementation of event-driven architecture pattern

==== Integration Architecture

* *Salesforce = System of Record*: Salesforce Service Cloud (shared Viva Energy instance) owns Contact and Case data
* *Conformist Pattern*: ProfileService and EngagementService conform to existing Salesforce configuration and API contracts
* *Anti-Corruption Layer*: EngagementService protects digital channels from Salesforce API changes, translates between OTR domain language and Salesforce
* *Async Case Creation*: Non-blocking user experience, resilience to Salesforce downtime, automatic retry with exponential backoff, dead letter queue for failed Cases
* *Event-Driven Notifications*: Salesforce webhook → EngagementService → Braze push notifications for Case status updates

==== Migration Approach

* *Contact Migration*: One-time migration from app-specific database → Salesforce (upsert with flexible matching by email/phone/VCI)
* *No Case Migration*: Historical D365 CE Cases not migrated (fresh start in Salesforce)
* *Big Bang Cutover*: Single deployment, no phased rollout or parallel run
* *D365 CE Retirement*: Complete decommissioning of D365 Customer Engagement post-cutover

=== Key Architectural Significance

This migration is **not just a system replacement** - it establishes the first implementation of OTR's target DDD architecture:

* First bounded contexts implemented (ProfileService, EngagementService)
* First event-driven domain event pattern (foundation for future bounded contexts)
* Foundation for Flybuys integration (ProfileService Contact reconciliation reused)
* Establishes integration patterns (Conformist, ACL, Event-Driven) for future services

=== Success Criteria

* All digital customer feedback routed to Salesforce Service Cloud within 30 days of launch
* Support agents have unified customer view across all Viva Energy channels (digital, wholesale, Shell Card, other retail)
* D365 Customer Engagement decommissioned within 90 days post-cutover
* Customer satisfaction score improves by 15% within 6 months
* Average case resolution time decreases by 20% within 6 months
* Zero data loss during Contact migration (100% validation pass rate)
* Mobile App feedback submission success rate > 99.5% (including async Case creation)

=== Technical Constraints

* Shared Salesforce instance (Viva Energy multi-tenant environment)
* Conform to existing Salesforce configuration and governance (data isolation strategy TBD with Salesforce admin team)
* Contact migration must complete before cutover (no parallel run)
* Async Case creation mandatory (non-blocking user experience)

=== Open Technical Decisions (TBD)

* Salesforce Case field mapping for digital feedback categories (App, Service, Order, Rewards, Refund, Delete Account)
* Salesforce data isolation strategy (Record Types, custom fields, queues)
* Salesforce REST API authentication method (OAuth 2.0, Connected App, JWT bearer flow)
* Salesforce webhook mechanism for Case updates (Outbound Messages, Platform Events, Process Builder)
* Retry policy configuration (attempts, backoff intervals)
* Expected feedback volume and Salesforce API rate limit strategy

== Technical Requirements

== Technical Architecture

=== Technical Capability Requirements

==== Requirements Traceability

=== Service Catalogues

==== Application Portfolio Catalogue

==== Technology Capability Requirements

==== Feature Flag Register

==== Data Entity Catalogue

=== Baseline Architecture

==== Existing System Components

==== Integration Architecture

==== Technical Debt

=== Gap Analysis

==== Missing Capabilities

==== Missing Bounded Contexts

==== Missing Integration Patterns

=== Target State Architecture

==== Architectural Building Blocks (ABB)

==== Integration Architecture

===== System of Record Boundaries

==== Data Architecture Principles

===== Aggregate Persistence

===== Event Store

=== Architecture Decisions

=== Migration Strategy

=== Architectural Scope Boundaries

==== Capabilities Included

==== Capabilities Excluded

==== Architectural Dependencies on Future Initiatives

=== Technical Risks and Mitigation

== Assumptions and Constraints

=== Assumptions

=== Constraints

== Non-Functional Requirements

== Monitoring and Observability

=== Key Metrics

=== Alerting Thresholds

=== Dashboards