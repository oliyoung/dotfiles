/*
 * ProductCatalogService - Bounded Context Definition
 * ===================================================
 *
 * Backend-for-Frontend (BFF) service for product catalog operations across all channels.
 * Currently supports Digital Menu Board (DMB) project with pure orchestration pattern.
 *
 * See product-catalog.md for comprehensive architecture documentation and decision log.
 */

import "../domains/product-catalog.cml"

BoundedContext ProductCatalogService implements ProductCatalogDomain {

    type = APPLICATION

    // Strategic DDD Classification: SUPPORTING_DOMAIN
    // Enables product discovery and display across channels but is not a primary competitive differentiator.
    // D365 Commerce owns the product catalog; this service orchestrates and translates.
    strategicClassification = "SUPPORTING_DOMAIN"

    domainVisionStatement = "Orchestrates product catalog operations across D365 Commerce and other systems. Translates between D365 Commerce's product model and OTR's domain language. Provides BFF capabilities for mobile app, web, and Digital Menu Boards."

    responsibilities = "Product query orchestration across D365 Commerce",
                      "Translation from D365 Commerce product model to OTR domain language",
                      "Product search and filtering for Digital Menu Boards",
                      "Location-specific product availability and pricing",
                      "Backend-for-Frontend (BFF) facade for product discovery features",
                      "Future: Product search history and customer product preferences"

    implementationTechnology = "Azure Functions, .NET Core, D365 Commerce API, Azure Cache for Redis (future), Event Bus"

    // ========================================================================
    // SECTION 1: CURRENT STATE - NO AGGREGATES (Pure Orchestration BFF)
    // ========================================================================
    // ProductCatalogService currently owns NO persistent state.
    // All product data queries are orchestrated to D365 Commerce in real-time.
    // This follows the same pattern as LoyaltyService orchestrating to EagleEye.
    //
    // Future Work:
    // - ProductSearchHistory aggregate: Track customer product searches and views
    // - ProductPreference aggregate: Store customer product preferences and favorites
    // - MenuBoardConfiguration aggregate: Store DMB display rules and configurations
    // ========================================================================

    // ========================================================================
    // SECTION 2: APPLICATION SERVICES (Orchestration Layer)
    // ========================================================================
    // Application services define the operations exposed by this bounded context.
    // All operations currently delegate to D365 Commerce via ACL.
    // ========================================================================

    Service ProductQueryService {
        // Search products by keyword, category, or location
        @ProductSearchResult searchProducts(@ProductSearchCriteria criteria)

        // Get detailed product information by product code
        @ProductDetail getProductDetail(@ProductCode productCode, @StoreId storeId)

        // Get products available at a specific store location
        @List<Product> getProductsByLocation(@StoreId storeId, @ProductCategory category)

        // Get featured products for Digital Menu Board display
        @List<FeaturedProduct> getFeaturedProducts(@StoreId storeId, @MenuBoardContext context)

        // Get real-time pricing for products at a specific location
        @ProductPricing getProductPricing(@ProductCode productCode, @StoreId storeId)

        // Get product availability/inventory status
        @ProductAvailability getProductAvailability(@ProductCode productCode, @StoreId storeId)
    }

    // ========================================================================
    // SECTION 3: VALUE OBJECTS
    // ========================================================================

    ValueObject ProductSearchCriteria {
        - String keyword
        - ProductCategory category
        - StoreId storeId
        - PriceRange priceRange
        - boolean inStockOnly
        - int pageSize
        - int pageNumber
    }

    ValueObject ProductSearchResult {
        - List<ProductSummary> products
        - int totalResults
        - int currentPage
        - int totalPages
    }

    ValueObject ProductSummary {
        - ProductCode productCode
        - String productName
        - ProductCategory category
        - Money price
        - String imageUrl
        - boolean isAvailable
        - boolean isAgeRestricted
    }

    ValueObject ProductDetail {
        - ProductCode productCode
        - String productName
        - String description
        - ProductCategory category
        - Money price
        - String imageUrl
        - NutritionalInfo nutritionalInfo
        - List<String> allergens
        - boolean isAgeRestricted
        - boolean isAvailable
        - int stockLevel
    }

    ValueObject Product {
        - ProductCode productCode
        - String productName
        - ProductCategory category
        - Money price
        - String imageUrl
        - boolean isAvailable
    }

    ValueObject FeaturedProduct {
        - ProductCode productCode
        - String productName
        - String description
        - Money price
        - String imageUrl
        - String promotionalMessage
        - int displayPriority
        - DisplayDuration duration
    }

    ValueObject ProductPricing {
        - ProductCode productCode
        - Money basePrice
        - Money currentPrice
        - List<Discount> activeDiscounts
        - DateTime priceValidUntil
    }

    ValueObject ProductAvailability {
        - ProductCode productCode
        - boolean isAvailable
        - int stockLevel
        - DateTime expectedRestockDate
    }

    ValueObject MenuBoardContext {
        - String menuBoardId
        - DisplayFormat format
        - DateTime displayTime
        - DayOfWeek dayOfWeek
    }

    ValueObject ProductCode {
        - String code  // D365 Commerce product identifier
    }

    ValueObject StoreId {
        - String id
    }

    ValueObject ProductCategory {
        - String code
        - String name
        - boolean isAgeRestricted
    }

    ValueObject Money {
        - Decimal amount
        - String currency  // AUD
    }

    ValueObject PriceRange {
        - Money minPrice
        - Money maxPrice
    }

    ValueObject NutritionalInfo {
        - int calories
        - Decimal protein
        - Decimal carbohydrates
        - Decimal fat
        - Decimal sugar
        - Decimal sodium
    }

    ValueObject Discount {
        - String discountId
        - String description
        - Money discountAmount
        - Decimal discountPercentage
        - DiscountType type  // PERCENTAGE | FIXED_AMOUNT | BUY_X_GET_Y
    }

    ValueObject DisplayDuration {
        - DateTime startTime
        - DateTime endTime
    }

    ValueObject DisplayFormat {
        - String formatId
        - int width
        - int height
        - String orientation  // PORTRAIT | LANDSCAPE
    }

    ValueObject DiscountType {
        - String type  // PERCENTAGE | FIXED_AMOUNT | BUY_X_GET_Y
    }

    ValueObject DayOfWeek {
        - String day  // MONDAY | TUESDAY | WEDNESDAY | etc.
    }

    // ========================================================================
    // SECTION 4: DOMAIN EVENTS (Future)
    // ========================================================================
    // ProductCatalogService currently does NOT publish domain events.
    // Future events when aggregates are added:
    //
    // - ProductSearched: Customer performed a product search
    // - ProductViewed: Customer viewed product details
    // - ProductFavorited: Customer added product to favorites
    // - MenuBoardConfigured: DMB display configuration updated
    // ========================================================================
}

// ============================================================================
// INTEGRATION NOTES
// ============================================================================
//
// Current Architecture (DMB Project):
// - Pure orchestration BFF with no persistent state
// - All product queries delegated to D365 Commerce via ACL
// - Anti-Corruption Layer (ACL) translates D365 Commerce product model to OTR domain language
// - Synchronous REST API calls to D365 Commerce
// - Caching layer (Redis) planned for performance optimization
//
// Integration Pattern:
// - **Customer-Supplier with Conformist**: ProductCatalogService consumes D365 Commerce APIs
// - **Anti-Corruption Layer (ACL)**: Protects OTR domain from D365 Commerce model changes
// - D365 Commerce owns product catalog, inventory, pricing, and promotions
// - ProductCatalogService translates and orchestrates, does not own product data
//
// DMB-Specific Requirements:
// - Real-time product availability (stock levels updated frequently)
// - Location-specific pricing (fuel prices vary by store)
// - Time-based product display (breakfast vs. lunch menu)
// - Promotional content (featured products, special offers)
// - Image and nutritional information for display
//
// Future Enhancements:
// - Add ProductSearchHistory aggregate: Track customer searches for analytics
// - Add ProductPreference aggregate: Store customer favorites and preferences
// - Add MenuBoardConfiguration aggregate: DMB-specific display rules
// - Event publishing: ProductSearched, ProductViewed for RecommendationService
// - Redis caching: Reduce load on D365 Commerce, improve response times
// - GraphQL API: Flexible queries for different client needs (mobile, web, DMB)
//
// Resilience Patterns:
// - Circuit breaker for D365 Commerce API calls
// - Fallback to cached data if D365 Commerce unavailable
// - Retry with exponential backoff for transient failures
//
// ============================================================================
