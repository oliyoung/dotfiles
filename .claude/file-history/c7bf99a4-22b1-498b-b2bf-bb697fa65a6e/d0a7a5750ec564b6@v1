{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/events/CustomerEnrolled.schema.json",
  "title": "CustomerEnrolled Event",
  "description": "Event published when a customer is enrolled in the loyalty program (EagleEye wallet created).",
  "type": "object",
  "properties": {
    "specversion": {
      "type": "string",
      "const": "1.0",
      "description": "CloudEvents specification version."
    },
    "type": {
      "type": "string",
      "const": "com.otr.loyalty.CustomerEnrolled",
      "description": "Type of event."
    },
    "source": {
      "type": "string",
      "const": "/loyalty-service",
      "description": "Context in which the event happened."
    },
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique event identifier."
    },
    "time": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp of event creation."
    },
    "datacontenttype": {
      "type": "string",
      "const": "application/json"
    },
    "data": {
      "type": "object",
      "description": "The custom event data payload.",
      "properties": {
        "vivaConsumerId": {
          "type": "string",
          "pattern": "^vci_[a-zA-Z0-9]+$",
          "description": "The customer's Viva Consumer ID from Salesforce."
        },
        "salesforceContactId": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9]{15,18}$",
          "description": "Salesforce Contact record ID (upserted during profile creation)."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Customer email address used for profile creation."
        },
        "eagleEyeWalletId": {
          "type": "string",
          "description": "The EagleEye wallet identifier created for this customer."
        },
        "rewardPreference": {
          "type": "string",
          "enum": [
            "OTR_FUEL_DISCOUNT",
            "FLYBUYS_POINTS",
            "SHELL_PRICE_SAVE"
          ],
          "description": "Customer's default reward preference."
        },
        "enrolledAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the customer was enrolled."
        }
      },
      "required": ["vivaConsumerId", "salesforceContactId", "email", "eagleEyeWalletId", "rewardPreference", "enrolledAt"],
      "additionalProperties": false
    }
  },
  "required": ["specversion", "type", "source", "id", "time", "datacontenttype", "data"],
  "additionalProperties": false
}
