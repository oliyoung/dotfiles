# OTR Digital Architecture Documentation

Domain-Driven Design (DDD) architecture documentation for OTR Group's digital platform, built with [Antora](https://antora.org/).

## Quick Start

### Build the HTML site

```bash
npm run build
```

### View the site locally

```bash
npm run serve
```

Or simply open `build/site/index.html` in your browser.

### Build and serve in one command

```bash
npm run dev
```

## Project Structure

```
├── modules/                    # Antora module structure
│   ├── ROOT/                   # Landing pages and overview
│   │   ├── pages/              # Documentation pages
│   │   ├── images/             # Images and diagrams
│   │   └── nav.adoc            # Navigation for ROOT module
│   ├── bounded-contexts/       # Bounded context documentation
│   ├── domains/                # Domain definitions
│   ├── solution-architectures/ # Solution architecture docs
│   └── events/                 # Event catalog
├── antora.yml                  # Antora component descriptor
├── antora-playbook.yml         # Antora site configuration
├── build-site.sh               # Build script
└── package.json                # NPM scripts
```

## Working with Content

### Adding New Pages

1. Add your `.adoc` file to the appropriate module directory under `pages/`:
   - `modules/ROOT/pages/` - For overview and general content
   - `modules/bounded-contexts/pages/` - For bounded context documentation
   - `modules/domains/pages/` - For domain definitions
   - `modules/solution-architectures/pages/` - For solution architectures
   - `modules/events/pages/` - For event documentation

2. Update the corresponding `nav.adoc` file to add your page to the navigation menu

### Cross-References in Antora

Antora uses module-based cross-references instead of relative file paths:

**Old style (doesn't work in Antora):**
```asciidoc
xref:../bounded_context/loyalty.adoc[Loyalty Service]
```

**New Antora style:**
```asciidoc
xref:bounded-contexts:loyalty.adoc[Loyalty Service]
xref:domains:loyalty.adoc[Loyalty Domain]
xref:ROOT:ubiquitous_language.adoc[Ubiquitous Language]
```

**Format:** `xref:module-name:page-name.adoc[Link Text]`

### Including Images

Images should be placed in `modules/<module-name>/images/` and referenced as:

```asciidoc
image::diagrams/context-map.png[Context Map]
```

## Build Output

The generated HTML site is created in `build/site/` with:

- Full navigation menu based on your `nav.adoc` files
- Search functionality
- Responsive design
- Cross-referenced documentation

## NPM Scripts

- `npm run build` - Build the Antora site
- `npm run build:local` - Build with content fetching
- `npm run serve` - Start local HTTP server to view the site
- `npm run dev` - Build and serve in one command

## GitHub Pages Deployment

To deploy to GitHub Pages, add this workflow to `.github/workflows/build-docs.yml`:

```yaml
name: Build Documentation

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - run: npm install
      - run: npm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build/site
```

## Known Issues

The build currently shows warnings about cross-references because existing `.adoc` files use relative paths. To fix these:

1. Update xref syntax to use Antora module references (see "Cross-References in Antora" above)
2. Fix any broken image paths
3. Update navigation files as needed

## Resources

- [Antora Documentation](https://docs.antora.org/)
- [AsciiDoc Syntax Quick Reference](https://docs.asciidoctor.org/asciidoc/latest/syntax-quick-reference/)
- [Antora Navigation](https://docs.antora.org/antora/latest/navigation/)
